
(function(window,undefined){var
rootjQuery,readyList,document=window.document,location=window.location,navigator=window.navigator,_jQuery=window.jQuery,_$=window.$,core_push=Array.prototype.push,core_slice=Array.prototype.slice,core_indexOf=Array.prototype.indexOf,core_toString=Object.prototype.toString,core_hasOwn=Object.prototype.hasOwnProperty,core_trim=String.prototype.trim,jQuery=function(selector,context){return new jQuery.fn.init(selector,context,rootjQuery);},core_pnum=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,core_rnotwhite=/\S/,core_rspace=/\s+/,rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,rquickExpr=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,rsingleTag=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,rvalidchars=/^[\],:{}\s]*$/,rvalidbraces=/(?:^|:|,)(?:\s*\[)+/g,rvalidescape=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,rvalidtokens=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,rmsPrefix=/^-ms-/,rdashAlpha=/-([\da-z])/gi,fcamelCase=function(all,letter){return(letter+"").toUpperCase();},DOMContentLoaded=function(){if(document.addEventListener){document.removeEventListener("DOMContentLoaded",DOMContentLoaded,false);jQuery.ready();}else if(document.readyState==="complete"){document.detachEvent("onreadystatechange",DOMContentLoaded);jQuery.ready();}},class2type={};jQuery.fn=jQuery.prototype={constructor:jQuery,init:function(selector,context,rootjQuery){var match,elem,ret,doc;if(!selector){return this;}
if(selector.nodeType){this.context=this[0]=selector;this.length=1;return this;}
if(typeof selector==="string"){if(selector.charAt(0)==="<"&&selector.charAt(selector.length-1)===">"&&selector.length>=3){match=[null,selector,null];}else{match=rquickExpr.exec(selector);}
if(match&&(match[1]||!context)){if(match[1]){context=context instanceof jQuery?context[0]:context;doc=(context&&context.nodeType?context.ownerDocument||context:document);selector=jQuery.parseHTML(match[1],doc,true);if(rsingleTag.test(match[1])&&jQuery.isPlainObject(context)){this.attr.call(selector,context,true);}
return jQuery.merge(this,selector);}else{elem=document.getElementById(match[2]);if(elem&&elem.parentNode){if(elem.id!==match[2]){return rootjQuery.find(selector);}
this.length=1;this[0]=elem;}
this.context=document;this.selector=selector;return this;}}else if(!context||context.jquery){return(context||rootjQuery).find(selector);}else{return this.constructor(context).find(selector);}}else if(jQuery.isFunction(selector)){return rootjQuery.ready(selector);}
if(selector.selector!==undefined){this.selector=selector.selector;this.context=selector.context;}
return jQuery.makeArray(selector,this);},selector:"",jquery:"1.8.2",length:0,size:function(){return this.length;},toArray:function(){return core_slice.call(this);},get:function(num){return num==null?this.toArray():(num<0?this[this.length+num]:this[num]);},pushStack:function(elems,name,selector){var ret=jQuery.merge(this.constructor(),elems);ret.prevObject=this;ret.context=this.context;if(name==="find"){ret.selector=this.selector+(this.selector?" ":"")+selector;}else if(name){ret.selector=this.selector+"."+name+"("+selector+")";}
return ret;},each:function(callback,args){return jQuery.each(this,callback,args);},ready:function(fn){jQuery.ready.promise().done(fn);return this;},eq:function(i){i=+i;return i===-1?this.slice(i):this.slice(i,i+1);},first:function(){return this.eq(0);},last:function(){return this.eq(-1);},slice:function(){return this.pushStack(core_slice.apply(this,arguments),"slice",core_slice.call(arguments).join(","));},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem);}));},end:function(){return this.prevObject||this.constructor(null);},push:core_push,sort:[].sort,splice:[].splice};jQuery.fn.init.prototype=jQuery.fn;jQuery.extend=jQuery.fn.extend=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[1]||{};i=2;}
if(typeof target!=="object"&&!jQuery.isFunction(target)){target={};}
if(length===i){target=this;--i;}
for(;i<length;i++){if((options=arguments[i])!=null){for(name in options){src=target[name];copy=options[name];if(target===copy){continue;}
if(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=jQuery.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&jQuery.isArray(src)?src:[];}else{clone=src&&jQuery.isPlainObject(src)?src:{};}
target[name]=jQuery.extend(deep,clone,copy);}else if(copy!==undefined){target[name]=copy;}}}}
return target;};jQuery.extend({noConflict:function(deep){if(window.$===jQuery){window.$=_$;}
if(deep&&window.jQuery===jQuery){window.jQuery=_jQuery;}
return jQuery;},isReady:false,readyWait:1,holdReady:function(hold){if(hold){jQuery.readyWait++;}else{jQuery.ready(true);}},ready:function(wait){if(wait===true?--jQuery.readyWait:jQuery.isReady){return;}
if(!document.body){return setTimeout(jQuery.ready,1);}
jQuery.isReady=true;if(wait!==true&&--jQuery.readyWait>0){return;}
readyList.resolveWith(document,[jQuery]);if(jQuery.fn.trigger){jQuery(document).trigger("ready").off("ready");}},isFunction:function(obj){return jQuery.type(obj)==="function";},isArray:Array.isArray||function(obj){return jQuery.type(obj)==="array";},isWindow:function(obj){return obj!=null&&obj==obj.window;},isNumeric:function(obj){return!isNaN(parseFloat(obj))&&isFinite(obj);},type:function(obj){return obj==null?String(obj):class2type[core_toString.call(obj)]||"object";},isPlainObject:function(obj){if(!obj||jQuery.type(obj)!=="object"||obj.nodeType||jQuery.isWindow(obj)){return false;}
try{if(obj.constructor&&!core_hasOwn.call(obj,"constructor")&&!core_hasOwn.call(obj.constructor.prototype,"isPrototypeOf")){return false;}}catch(e){return false;}
var key;for(key in obj){}
return key===undefined||core_hasOwn.call(obj,key);},isEmptyObject:function(obj){var name;for(name in obj){return false;}
return true;},error:function(msg){throw new Error(msg);},parseHTML:function(data,context,scripts){var parsed;if(!data||typeof data!=="string"){return null;}
if(typeof context==="boolean"){scripts=context;context=0;}
context=context||document;if((parsed=rsingleTag.exec(data))){return[context.createElement(parsed[1])];}
parsed=jQuery.buildFragment([data],context,scripts?null:[]);return jQuery.merge([],(parsed.cacheable?jQuery.clone(parsed.fragment):parsed.fragment).childNodes);},parseJSON:function(data){if(!data||typeof data!=="string"){return null;}
data=jQuery.trim(data);if(window.JSON&&window.JSON.parse){return window.JSON.parse(data);}
if(rvalidchars.test(data.replace(rvalidescape,"@").replace(rvalidtokens,"]").replace(rvalidbraces,""))){return(new Function("return "+data))();}
jQuery.error("Invalid JSON: "+data);},parseXML:function(data){var xml,tmp;if(!data||typeof data!=="string"){return null;}
try{if(window.DOMParser){tmp=new DOMParser();xml=tmp.parseFromString(data,"text/xml");}else{xml=new ActiveXObject("Microsoft.XMLDOM");xml.async="false";xml.loadXML(data);}}catch(e){xml=undefined;}
if(!xml||!xml.documentElement||xml.getElementsByTagName("parsererror").length){jQuery.error("Invalid XML: "+data);}
return xml;},noop:function(){},globalEval:function(data){if(data&&core_rnotwhite.test(data)){(window.execScript||function(data){window["eval"].call(window,data);})(data);}},camelCase:function(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase);},nodeName:function(elem,name){return elem.nodeName&&elem.nodeName.toLowerCase()===name.toLowerCase();},each:function(obj,callback,args){var name,i=0,length=obj.length,isObj=length===undefined||jQuery.isFunction(obj);if(args){if(isObj){for(name in obj){if(callback.apply(obj[name],args)===false){break;}}}else{for(;i<length;){if(callback.apply(obj[i++],args)===false){break;}}}}else{if(isObj){for(name in obj){if(callback.call(obj[name],name,obj[name])===false){break;}}}else{for(;i<length;){if(callback.call(obj[i],i,obj[i++])===false){break;}}}}
return obj;},trim:core_trim&&!core_trim.call("\uFEFF\xA0")?function(text){return text==null?"":core_trim.call(text);}:function(text){return text==null?"":(text+"").replace(rtrim,"");},makeArray:function(arr,results){var type,ret=results||[];if(arr!=null){type=jQuery.type(arr);if(arr.length==null||type==="string"||type==="function"||type==="regexp"||jQuery.isWindow(arr)){core_push.call(ret,arr);}else{jQuery.merge(ret,arr);}}
return ret;},inArray:function(elem,arr,i){var len;if(arr){if(core_indexOf){return core_indexOf.call(arr,elem,i);}
len=arr.length;i=i?i<0?Math.max(0,len+i):i:0;for(;i<len;i++){if(i in arr&&arr[i]===elem){return i;}}}
return-1;},merge:function(first,second){var l=second.length,i=first.length,j=0;if(typeof l==="number"){for(;j<l;j++){first[i++]=second[j];}}else{while(second[j]!==undefined){first[i++]=second[j++];}}
first.length=i;return first;},grep:function(elems,callback,inv){var retVal,ret=[],i=0,length=elems.length;inv=!!inv;for(;i<length;i++){retVal=!!callback(elems[i],i);if(inv!==retVal){ret.push(elems[i]);}}
return ret;},map:function(elems,callback,arg){var value,key,ret=[],i=0,length=elems.length,isArray=elems instanceof jQuery||length!==undefined&&typeof length==="number"&&((length>0&&elems[0]&&elems[length-1])||length===0||jQuery.isArray(elems));if(isArray){for(;i<length;i++){value=callback(elems[i],i,arg);if(value!=null){ret[ret.length]=value;}}}else{for(key in elems){value=callback(elems[key],key,arg);if(value!=null){ret[ret.length]=value;}}}
return ret.concat.apply([],ret);},guid:1,proxy:function(fn,context){var tmp,args,proxy;if(typeof context==="string"){tmp=fn[context];context=fn;fn=tmp;}
if(!jQuery.isFunction(fn)){return undefined;}
args=core_slice.call(arguments,2);proxy=function(){return fn.apply(context,args.concat(core_slice.call(arguments)));};proxy.guid=fn.guid=fn.guid||jQuery.guid++;return proxy;},access:function(elems,fn,key,value,chainable,emptyGet,pass){var exec,bulk=key==null,i=0,length=elems.length;if(key&&typeof key==="object"){for(i in key){jQuery.access(elems,fn,i,key[i],1,emptyGet,value);}
chainable=1;}else if(value!==undefined){exec=pass===undefined&&jQuery.isFunction(value);if(bulk){if(exec){exec=fn;fn=function(elem,key,value){return exec.call(jQuery(elem),value);};}else{fn.call(elems,value);fn=null;}}
if(fn){for(;i<length;i++){fn(elems[i],key,exec?value.call(elems[i],i,fn(elems[i],key)):value,pass);}}
chainable=1;}
return chainable?elems:bulk?fn.call(elems):length?fn(elems[0],key):emptyGet;},now:function(){return(new Date()).getTime();}});jQuery.ready.promise=function(obj){if(!readyList){readyList=jQuery.Deferred();if(document.readyState==="complete"){setTimeout(jQuery.ready,1);}else if(document.addEventListener){document.addEventListener("DOMContentLoaded",DOMContentLoaded,false);window.addEventListener("load",jQuery.ready,false);}else{document.attachEvent("onreadystatechange",DOMContentLoaded);window.attachEvent("onload",jQuery.ready);var top=false;try{top=window.frameElement==null&&document.documentElement;}catch(e){}
if(top&&top.doScroll){(function doScrollCheck(){if(!jQuery.isReady){try{top.doScroll("left");}catch(e){return setTimeout(doScrollCheck,50);}
jQuery.ready();}})();}}}
return readyList.promise(obj);};jQuery.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(i,name){class2type["[object "+name+"]"]=name.toLowerCase();});rootjQuery=jQuery(document);var optionsCache={};function createOptions(options){var object=optionsCache[options]={};jQuery.each(options.split(core_rspace),function(_,flag){object[flag]=true;});return object;}
jQuery.Callbacks=function(options){options=typeof options==="string"?(optionsCache[options]||createOptions(options)):jQuery.extend({},options);var
memory,fired,firing,firingStart,firingLength,firingIndex,list=[],stack=!options.once&&[],fire=function(data){memory=options.memory&&data;fired=true;firingIndex=firingStart||0;firingStart=0;firingLength=list.length;firing=true;for(;list&&firingIndex<firingLength;firingIndex++){if(list[firingIndex].apply(data[0],data[1])===false&&options.stopOnFalse){memory=false;break;}}
firing=false;if(list){if(stack){if(stack.length){fire(stack.shift());}}else if(memory){list=[];}else{self.disable();}}},self={add:function(){if(list){var start=list.length;(function add(args){jQuery.each(args,function(_,arg){var type=jQuery.type(arg);if(type==="function"&&(!options.unique||!self.has(arg))){list.push(arg);}else if(arg&&arg.length&&type!=="string"){add(arg);}});})(arguments);if(firing){firingLength=list.length;}else if(memory){firingStart=start;fire(memory);}}
return this;},remove:function(){if(list){jQuery.each(arguments,function(_,arg){var index;while((index=jQuery.inArray(arg,list,index))>-1){list.splice(index,1);if(firing){if(index<=firingLength){firingLength--;}
if(index<=firingIndex){firingIndex--;}}}});}
return this;},has:function(fn){return jQuery.inArray(fn,list)>-1;},empty:function(){list=[];return this;},disable:function(){list=stack=memory=undefined;return this;},disabled:function(){return!list;},lock:function(){stack=undefined;if(!memory){self.disable();}
return this;},locked:function(){return!stack;},fireWith:function(context,args){args=args||[];args=[context,args.slice?args.slice():args];if(list&&(!fired||stack)){if(firing){stack.push(args);}else{fire(args);}}
return this;},fire:function(){self.fireWith(this,arguments);return this;},fired:function(){return!!fired;}};return self;};jQuery.extend({Deferred:function(func){var tuples=[["resolve","done",jQuery.Callbacks("once memory"),"resolved"],["reject","fail",jQuery.Callbacks("once memory"),"rejected"],["notify","progress",jQuery.Callbacks("memory")]],state="pending",promise={state:function(){return state;},always:function(){deferred.done(arguments).fail(arguments);return this;},then:function(){var fns=arguments;return jQuery.Deferred(function(newDefer){jQuery.each(tuples,function(i,tuple){var action=tuple[0],fn=fns[i];deferred[tuple[1]](jQuery.isFunction(fn)?function(){var returned=fn.apply(this,arguments);if(returned&&jQuery.isFunction(returned.promise)){returned.promise().done(newDefer.resolve).fail(newDefer.reject).progress(newDefer.notify);}else{newDefer[action+"With"](this===deferred?newDefer:this,[returned]);}}:newDefer[action]);});fns=null;}).promise();},promise:function(obj){return obj!=null?jQuery.extend(obj,promise):promise;}},deferred={};promise.pipe=promise.then;jQuery.each(tuples,function(i,tuple){var list=tuple[2],stateString=tuple[3];promise[tuple[1]]=list.add;if(stateString){list.add(function(){state=stateString;},tuples[i^1][2].disable,tuples[2][2].lock);}
deferred[tuple[0]]=list.fire;deferred[tuple[0]+"With"]=list.fireWith;});promise.promise(deferred);if(func){func.call(deferred,deferred);}
return deferred;},when:function(subordinate){var i=0,resolveValues=core_slice.call(arguments),length=resolveValues.length,remaining=length!==1||(subordinate&&jQuery.isFunction(subordinate.promise))?length:0,deferred=remaining===1?subordinate:jQuery.Deferred(),updateFunc=function(i,contexts,values){return function(value){contexts[i]=this;values[i]=arguments.length>1?core_slice.call(arguments):value;if(values===progressValues){deferred.notifyWith(contexts,values);}else if(!(--remaining)){deferred.resolveWith(contexts,values);}};},progressValues,progressContexts,resolveContexts;if(length>1){progressValues=new Array(length);progressContexts=new Array(length);resolveContexts=new Array(length);for(;i<length;i++){if(resolveValues[i]&&jQuery.isFunction(resolveValues[i].promise)){resolveValues[i].promise().done(updateFunc(i,resolveContexts,resolveValues)).fail(deferred.reject).progress(updateFunc(i,progressContexts,progressValues));}else{--remaining;}}}
if(!remaining){deferred.resolveWith(resolveContexts,resolveValues);}
return deferred.promise();}});jQuery.support=(function(){var support,all,a,select,opt,input,fragment,eventName,i,isSupported,clickFn,div=document.createElement("div");div.setAttribute("className","t");div.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>";all=div.getElementsByTagName("*");a=div.getElementsByTagName("a")[0];a.style.cssText="top:1px;float:left;opacity:.5";if(!all||!all.length){return{};}
select=document.createElement("select");opt=select.appendChild(document.createElement("option"));input=div.getElementsByTagName("input")[0];support={leadingWhitespace:(div.firstChild.nodeType===3),tbody:!div.getElementsByTagName("tbody").length,htmlSerialize:!!div.getElementsByTagName("link").length,style:/top/.test(a.getAttribute("style")),hrefNormalized:(a.getAttribute("href")==="/a"),opacity:/^0.5/.test(a.style.opacity),cssFloat:!!a.style.cssFloat,checkOn:(input.value==="on"),optSelected:opt.selected,getSetAttribute:div.className!=="t",enctype:!!document.createElement("form").enctype,html5Clone:document.createElement("nav").cloneNode(true).outerHTML!=="<:nav></:nav>",boxModel:(document.compatMode==="CSS1Compat"),submitBubbles:true,changeBubbles:true,focusinBubbles:false,deleteExpando:true,noCloneEvent:true,inlineBlockNeedsLayout:false,shrinkWrapBlocks:false,reliableMarginRight:true,boxSizingReliable:true,pixelPosition:false};input.checked=true;support.noCloneChecked=input.cloneNode(true).checked;select.disabled=true;support.optDisabled=!opt.disabled;try{delete div.test;}catch(e){support.deleteExpando=false;}
if(!div.addEventListener&&div.attachEvent&&div.fireEvent){div.attachEvent("onclick",clickFn=function(){support.noCloneEvent=false;});div.cloneNode(true).fireEvent("onclick");div.detachEvent("onclick",clickFn);}
input=document.createElement("input");input.value="t";input.setAttribute("type","radio");support.radioValue=input.value==="t";input.setAttribute("checked","checked");input.setAttribute("name","t");div.appendChild(input);fragment=document.createDocumentFragment();fragment.appendChild(div.lastChild);support.checkClone=fragment.cloneNode(true).cloneNode(true).lastChild.checked;support.appendChecked=input.checked;fragment.removeChild(input);fragment.appendChild(div);if(div.attachEvent){for(i in{submit:true,change:true,focusin:true}){eventName="on"+i;isSupported=(eventName in div);if(!isSupported){div.setAttribute(eventName,"return;");isSupported=(typeof div[eventName]==="function");}
support[i+"Bubbles"]=isSupported;}}
jQuery(function(){var container,div,tds,marginDiv,divReset="padding:0;margin:0;border:0;display:block;overflow:hidden;",body=document.getElementsByTagName("body")[0];if(!body){return;}
container=document.createElement("div");container.style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px";body.insertBefore(container,body.firstChild);div=document.createElement("div");container.appendChild(div);div.innerHTML="<table><tr><td></td><td>t</td></tr></table>";tds=div.getElementsByTagName("td");tds[0].style.cssText="padding:0;margin:0;border:0;display:none";isSupported=(tds[0].offsetHeight===0);tds[0].style.display="";tds[1].style.display="none";support.reliableHiddenOffsets=isSupported&&(tds[0].offsetHeight===0);div.innerHTML="";div.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;";support.boxSizing=(div.offsetWidth===4);support.doesNotIncludeMarginInBodyOffset=(body.offsetTop!==1);if(window.getComputedStyle){support.pixelPosition=(window.getComputedStyle(div,null)||{}).top!=="1%";support.boxSizingReliable=(window.getComputedStyle(div,null)||{width:"4px"}).width==="4px";marginDiv=document.createElement("div");marginDiv.style.cssText=div.style.cssText=divReset;marginDiv.style.marginRight=marginDiv.style.width="0";div.style.width="1px";div.appendChild(marginDiv);support.reliableMarginRight=!parseFloat((window.getComputedStyle(marginDiv,null)||{}).marginRight);}
if(typeof div.style.zoom!=="undefined"){div.innerHTML="";div.style.cssText=divReset+"width:1px;padding:1px;display:inline;zoom:1";support.inlineBlockNeedsLayout=(div.offsetWidth===3);div.style.display="block";div.style.overflow="visible";div.innerHTML="<div></div>";div.firstChild.style.width="5px";support.shrinkWrapBlocks=(div.offsetWidth!==3);container.style.zoom=1;}
body.removeChild(container);container=div=tds=marginDiv=null;});fragment.removeChild(div);all=a=select=opt=input=fragment=div=null;return support;})();var rbrace=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,rmultiDash=/([A-Z])/g;jQuery.extend({cache:{},deletedIds:[],uuid:0,expando:"jQuery"+(jQuery.fn.jquery+Math.random()).replace(/\D/g,""),noData:{"embed":true,"object":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000","applet":true},hasData:function(elem){elem=elem.nodeType?jQuery.cache[elem[jQuery.expando]]:elem[jQuery.expando];return!!elem&&!isEmptyDataObject(elem);},data:function(elem,name,data,pvt){if(!jQuery.acceptData(elem)){return;}
var thisCache,ret,internalKey=jQuery.expando,getByName=typeof name==="string",isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[internalKey]:elem[internalKey]&&internalKey;if((!id||!cache[id]||(!pvt&&!cache[id].data))&&getByName&&data===undefined){return;}
if(!id){if(isNode){elem[internalKey]=id=jQuery.deletedIds.pop()||jQuery.guid++;}else{id=internalKey;}}
if(!cache[id]){cache[id]={};if(!isNode){cache[id].toJSON=jQuery.noop;}}
if(typeof name==="object"||typeof name==="function"){if(pvt){cache[id]=jQuery.extend(cache[id],name);}else{cache[id].data=jQuery.extend(cache[id].data,name);}}
thisCache=cache[id];if(!pvt){if(!thisCache.data){thisCache.data={};}
thisCache=thisCache.data;}
if(data!==undefined){thisCache[jQuery.camelCase(name)]=data;}
if(getByName){ret=thisCache[name];if(ret==null){ret=thisCache[jQuery.camelCase(name)];}}else{ret=thisCache;}
return ret;},removeData:function(elem,name,pvt){if(!jQuery.acceptData(elem)){return;}
var thisCache,i,l,isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[jQuery.expando]:jQuery.expando;if(!cache[id]){return;}
if(name){thisCache=pvt?cache[id]:cache[id].data;if(thisCache){if(!jQuery.isArray(name)){if(name in thisCache){name=[name];}else{name=jQuery.camelCase(name);if(name in thisCache){name=[name];}else{name=name.split(" ");}}}
for(i=0,l=name.length;i<l;i++){delete thisCache[name[i]];}
if(!(pvt?isEmptyDataObject:jQuery.isEmptyObject)(thisCache)){return;}}}
if(!pvt){delete cache[id].data;if(!isEmptyDataObject(cache[id])){return;}}
if(isNode){jQuery.cleanData([elem],true);}else if(jQuery.support.deleteExpando||cache!=cache.window){delete cache[id];}else{cache[id]=null;}},_data:function(elem,name,data){return jQuery.data(elem,name,data,true);},acceptData:function(elem){var noData=elem.nodeName&&jQuery.noData[elem.nodeName.toLowerCase()];return!noData||noData!==true&&elem.getAttribute("classid")===noData;}});jQuery.fn.extend({data:function(key,value){var parts,part,attr,name,l,elem=this[0],i=0,data=null;if(key===undefined){if(this.length){data=jQuery.data(elem);if(elem.nodeType===1&&!jQuery._data(elem,"parsedAttrs")){attr=elem.attributes;for(l=attr.length;i<l;i++){name=attr[i].name;if(!name.indexOf("data-")){name=jQuery.camelCase(name.substring(5));dataAttr(elem,name,data[name]);}}
jQuery._data(elem,"parsedAttrs",true);}}
return data;}
if(typeof key==="object"){return this.each(function(){jQuery.data(this,key);});}
parts=key.split(".",2);parts[1]=parts[1]?"."+parts[1]:"";part=parts[1]+"!";return jQuery.access(this,function(value){if(value===undefined){data=this.triggerHandler("getData"+part,[parts[0]]);if(data===undefined&&elem){data=jQuery.data(elem,key);data=dataAttr(elem,key,data);}
return data===undefined&&parts[1]?this.data(parts[0]):data;}
parts[1]=value;this.each(function(){var self=jQuery(this);self.triggerHandler("setData"+part,parts);jQuery.data(this,key,value);self.triggerHandler("changeData"+part,parts);});},null,value,arguments.length>1,null,false);},removeData:function(key){return this.each(function(){jQuery.removeData(this,key);});}});function dataAttr(elem,key,data){if(data===undefined&&elem.nodeType===1){var name="data-"+key.replace(rmultiDash,"-$1").toLowerCase();data=elem.getAttribute(name);if(typeof data==="string"){try{data=data==="true"?true:data==="false"?false:data==="null"?null:+data+""===data?+data:rbrace.test(data)?jQuery.parseJSON(data):data;}catch(e){}
jQuery.data(elem,key,data);}else{data=undefined;}}
return data;}
function isEmptyDataObject(obj){var name;for(name in obj){if(name==="data"&&jQuery.isEmptyObject(obj[name])){continue;}
if(name!=="toJSON"){return false;}}
return true;}
jQuery.extend({queue:function(elem,type,data){var queue;if(elem){type=(type||"fx")+"queue";queue=jQuery._data(elem,type);if(data){if(!queue||jQuery.isArray(data)){queue=jQuery._data(elem,type,jQuery.makeArray(data));}else{queue.push(data);}}
return queue||[];}},dequeue:function(elem,type){type=type||"fx";var queue=jQuery.queue(elem,type),startLength=queue.length,fn=queue.shift(),hooks=jQuery._queueHooks(elem,type),next=function(){jQuery.dequeue(elem,type);};if(fn==="inprogress"){fn=queue.shift();startLength--;}
if(fn){if(type==="fx"){queue.unshift("inprogress");}
delete hooks.stop;fn.call(elem,next,hooks);}
if(!startLength&&hooks){hooks.empty.fire();}},_queueHooks:function(elem,type){var key=type+"queueHooks";return jQuery._data(elem,key)||jQuery._data(elem,key,{empty:jQuery.Callbacks("once memory").add(function(){jQuery.removeData(elem,type+"queue",true);jQuery.removeData(elem,key,true);})});}});jQuery.fn.extend({queue:function(type,data){var setter=2;if(typeof type!=="string"){data=type;type="fx";setter--;}
if(arguments.length<setter){return jQuery.queue(this[0],type);}
return data===undefined?this:this.each(function(){var queue=jQuery.queue(this,type,data);jQuery._queueHooks(this,type);if(type==="fx"&&queue[0]!=="inprogress"){jQuery.dequeue(this,type);}});},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type);});},delay:function(time,type){time=jQuery.fx?jQuery.fx.speeds[time]||time:time;type=type||"fx";return this.queue(type,function(next,hooks){var timeout=setTimeout(next,time);hooks.stop=function(){clearTimeout(timeout);};});},clearQueue:function(type){return this.queue(type||"fx",[]);},promise:function(type,obj){var tmp,count=1,defer=jQuery.Deferred(),elements=this,i=this.length,resolve=function(){if(!(--count)){defer.resolveWith(elements,[elements]);}};if(typeof type!=="string"){obj=type;type=undefined;}
type=type||"fx";while(i--){tmp=jQuery._data(elements[i],type+"queueHooks");if(tmp&&tmp.empty){count++;tmp.empty.add(resolve);}}
resolve();return defer.promise(obj);}});var nodeHook,boolHook,fixSpecified,rclass=/[\t\r\n]/g,rreturn=/\r/g,rtype=/^(?:button|input)$/i,rfocusable=/^(?:button|input|object|select|textarea)$/i,rclickable=/^a(?:rea|)$/i,rboolean=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,getSetAttribute=jQuery.support.getSetAttribute;jQuery.fn.extend({attr:function(name,value){return jQuery.access(this,jQuery.attr,name,value,arguments.length>1);},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name);});},prop:function(name,value){return jQuery.access(this,jQuery.prop,name,value,arguments.length>1);},removeProp:function(name){name=jQuery.propFix[name]||name;return this.each(function(){try{this[name]=undefined;delete this[name];}catch(e){}});},addClass:function(value){var classNames,i,l,elem,setClass,c,cl;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).addClass(value.call(this,j,this.className));});}
if(value&&typeof value==="string"){classNames=value.split(core_rspace);for(i=0,l=this.length;i<l;i++){elem=this[i];if(elem.nodeType===1){if(!elem.className&&classNames.length===1){elem.className=value;}else{setClass=" "+elem.className+" ";for(c=0,cl=classNames.length;c<cl;c++){if(setClass.indexOf(" "+classNames[c]+" ")<0){setClass+=classNames[c]+" ";}}
elem.className=jQuery.trim(setClass);}}}}
return this;},removeClass:function(value){var removes,className,elem,c,cl,i,l;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).removeClass(value.call(this,j,this.className));});}
if((value&&typeof value==="string")||value===undefined){removes=(value||"").split(core_rspace);for(i=0,l=this.length;i<l;i++){elem=this[i];if(elem.nodeType===1&&elem.className){className=(" "+elem.className+" ").replace(rclass," ");for(c=0,cl=removes.length;c<cl;c++){while(className.indexOf(" "+removes[c]+" ")>=0){className=className.replace(" "+removes[c]+" "," ");}}
elem.className=value?jQuery.trim(className):"";}}}
return this;},toggleClass:function(value,stateVal){var type=typeof value,isBool=typeof stateVal==="boolean";if(jQuery.isFunction(value)){return this.each(function(i){jQuery(this).toggleClass(value.call(this,i,this.className,stateVal),stateVal);});}
return this.each(function(){if(type==="string"){var className,i=0,self=jQuery(this),state=stateVal,classNames=value.split(core_rspace);while((className=classNames[i++])){state=isBool?state:!self.hasClass(className);self[state?"addClass":"removeClass"](className);}}else if(type==="undefined"||type==="boolean"){if(this.className){jQuery._data(this,"__className__",this.className);}
this.className=this.className||value===false?"":jQuery._data(this,"__className__")||"";}});},hasClass:function(selector){var className=" "+selector+" ",i=0,l=this.length;for(;i<l;i++){if(this[i].nodeType===1&&(" "+this[i].className+" ").replace(rclass," ").indexOf(className)>=0){return true;}}
return false;},val:function(value){var hooks,ret,isFunction,elem=this[0];if(!arguments.length){if(elem){hooks=jQuery.valHooks[elem.type]||jQuery.valHooks[elem.nodeName.toLowerCase()];if(hooks&&"get"in hooks&&(ret=hooks.get(elem,"value"))!==undefined){return ret;}
ret=elem.value;return typeof ret==="string"?ret.replace(rreturn,""):ret==null?"":ret;}
return;}
isFunction=jQuery.isFunction(value);return this.each(function(i){var val,self=jQuery(this);if(this.nodeType!==1){return;}
if(isFunction){val=value.call(this,i,self.val());}else{val=value;}
if(val==null){val="";}else if(typeof val==="number"){val+="";}else if(jQuery.isArray(val)){val=jQuery.map(val,function(value){return value==null?"":value+"";});}
hooks=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()];if(!hooks||!("set"in hooks)||hooks.set(this,val,"value")===undefined){this.value=val;}});}});jQuery.extend({valHooks:{option:{get:function(elem){var val=elem.attributes.value;return!val||val.specified?elem.value:elem.text;}},select:{get:function(elem){var value,i,max,option,index=elem.selectedIndex,values=[],options=elem.options,one=elem.type==="select-one";if(index<0){return null;}
i=one?index:0;max=one?index+1:options.length;for(;i<max;i++){option=options[i];if(option.selected&&(jQuery.support.optDisabled?!option.disabled:option.getAttribute("disabled")===null)&&(!option.parentNode.disabled||!jQuery.nodeName(option.parentNode,"optgroup"))){value=jQuery(option).val();if(one){return value;}
values.push(value);}}
if(one&&!values.length&&options.length){return jQuery(options[index]).val();}
return values;},set:function(elem,value){var values=jQuery.makeArray(value);jQuery(elem).find("option").each(function(){this.selected=jQuery.inArray(jQuery(this).val(),values)>=0;});if(!values.length){elem.selectedIndex=-1;}
return values;}}},attrFn:{},attr:function(elem,name,value,pass){var ret,hooks,notxml,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2){return;}
if(pass&&jQuery.isFunction(jQuery.fn[name])){return jQuery(elem)[name](value);}
if(typeof elem.getAttribute==="undefined"){return jQuery.prop(elem,name,value);}
notxml=nType!==1||!jQuery.isXMLDoc(elem);if(notxml){name=name.toLowerCase();hooks=jQuery.attrHooks[name]||(rboolean.test(name)?boolHook:nodeHook);}
if(value!==undefined){if(value===null){jQuery.removeAttr(elem,name);return;}else if(hooks&&"set"in hooks&&notxml&&(ret=hooks.set(elem,value,name))!==undefined){return ret;}else{elem.setAttribute(name,value+"");return value;}}else if(hooks&&"get"in hooks&&notxml&&(ret=hooks.get(elem,name))!==null){return ret;}else{ret=elem.getAttribute(name);return ret===null?undefined:ret;}},removeAttr:function(elem,value){var propName,attrNames,name,isBool,i=0;if(value&&elem.nodeType===1){attrNames=value.split(core_rspace);for(;i<attrNames.length;i++){name=attrNames[i];if(name){propName=jQuery.propFix[name]||name;isBool=rboolean.test(name);if(!isBool){jQuery.attr(elem,name,"");}
elem.removeAttribute(getSetAttribute?name:propName);if(isBool&&propName in elem){elem[propName]=false;}}}}},attrHooks:{type:{set:function(elem,value){if(rtype.test(elem.nodeName)&&elem.parentNode){jQuery.error("type property can't be changed");}else if(!jQuery.support.radioValue&&value==="radio"&&jQuery.nodeName(elem,"input")){var val=elem.value;elem.setAttribute("type",value);if(val){elem.value=val;}
return value;}}},value:{get:function(elem,name){if(nodeHook&&jQuery.nodeName(elem,"button")){return nodeHook.get(elem,name);}
return name in elem?elem.value:null;},set:function(elem,value,name){if(nodeHook&&jQuery.nodeName(elem,"button")){return nodeHook.set(elem,value,name);}
elem.value=value;}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(elem,name,value){var ret,hooks,notxml,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2){return;}
notxml=nType!==1||!jQuery.isXMLDoc(elem);if(notxml){name=jQuery.propFix[name]||name;hooks=jQuery.propHooks[name];}
if(value!==undefined){if(hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined){return ret;}else{return(elem[name]=value);}}else{if(hooks&&"get"in hooks&&(ret=hooks.get(elem,name))!==null){return ret;}else{return elem[name];}}},propHooks:{tabIndex:{get:function(elem){var attributeNode=elem.getAttributeNode("tabindex");return attributeNode&&attributeNode.specified?parseInt(attributeNode.value,10):rfocusable.test(elem.nodeName)||rclickable.test(elem.nodeName)&&elem.href?0:undefined;}}}});boolHook={get:function(elem,name){var attrNode,property=jQuery.prop(elem,name);return property===true||typeof property!=="boolean"&&(attrNode=elem.getAttributeNode(name))&&attrNode.nodeValue!==false?name.toLowerCase():undefined;},set:function(elem,value,name){var propName;if(value===false){jQuery.removeAttr(elem,name);}else{propName=jQuery.propFix[name]||name;if(propName in elem){elem[propName]=true;}
elem.setAttribute(name,name.toLowerCase());}
return name;}};if(!getSetAttribute){fixSpecified={name:true,id:true,coords:true};nodeHook=jQuery.valHooks.button={get:function(elem,name){var ret;ret=elem.getAttributeNode(name);return ret&&(fixSpecified[name]?ret.value!=="":ret.specified)?ret.value:undefined;},set:function(elem,value,name){var ret=elem.getAttributeNode(name);if(!ret){ret=document.createAttribute(name);elem.setAttributeNode(ret);}
return(ret.value=value+"");}};jQuery.each(["width","height"],function(i,name){jQuery.attrHooks[name]=jQuery.extend(jQuery.attrHooks[name],{set:function(elem,value){if(value===""){elem.setAttribute(name,"auto");return value;}}});});jQuery.attrHooks.contenteditable={get:nodeHook.get,set:function(elem,value,name){if(value===""){value="false";}
nodeHook.set(elem,value,name);}};}
if(!jQuery.support.hrefNormalized){jQuery.each(["href","src","width","height"],function(i,name){jQuery.attrHooks[name]=jQuery.extend(jQuery.attrHooks[name],{get:function(elem){var ret=elem.getAttribute(name,2);return ret===null?undefined:ret;}});});}
if(!jQuery.support.style){jQuery.attrHooks.style={get:function(elem){return elem.style.cssText.toLowerCase()||undefined;},set:function(elem,value){return(elem.style.cssText=value+"");}};}
if(!jQuery.support.optSelected){jQuery.propHooks.selected=jQuery.extend(jQuery.propHooks.selected,{get:function(elem){var parent=elem.parentNode;if(parent){parent.selectedIndex;if(parent.parentNode){parent.parentNode.selectedIndex;}}
return null;}});}
if(!jQuery.support.enctype){jQuery.propFix.enctype="encoding";}
if(!jQuery.support.checkOn){jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={get:function(elem){return elem.getAttribute("value")===null?"on":elem.value;}};});}
jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]=jQuery.extend(jQuery.valHooks[this],{set:function(elem,value){if(jQuery.isArray(value)){return(elem.checked=jQuery.inArray(jQuery(elem).val(),value)>=0);}}});});var rformElems=/^(?:textarea|input|select)$/i,rtypenamespace=/^([^\.]*|)(?:\.(.+)|)$/,rhoverHack=/(?:^|\s)hover(\.\S+|)\b/,rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|contextmenu)|click/,rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,hoverHack=function(events){return jQuery.event.special.hover?events:events.replace(rhoverHack,"mouseenter$1 mouseleave$1");};jQuery.event={add:function(elem,types,handler,data,selector){var elemData,eventHandle,events,t,tns,type,namespaces,handleObj,handleObjIn,handlers,special;if(elem.nodeType===3||elem.nodeType===8||!types||!handler||!(elemData=jQuery._data(elem))){return;}
if(handler.handler){handleObjIn=handler;handler=handleObjIn.handler;selector=handleObjIn.selector;}
if(!handler.guid){handler.guid=jQuery.guid++;}
events=elemData.events;if(!events){elemData.events=events={};}
eventHandle=elemData.handle;if(!eventHandle){elemData.handle=eventHandle=function(e){return typeof jQuery!=="undefined"&&(!e||jQuery.event.triggered!==e.type)?jQuery.event.dispatch.apply(eventHandle.elem,arguments):undefined;};eventHandle.elem=elem;}
types=jQuery.trim(hoverHack(types)).split(" ");for(t=0;t<types.length;t++){tns=rtypenamespace.exec(types[t])||[];type=tns[1];namespaces=(tns[2]||"").split(".").sort();special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;special=jQuery.event.special[type]||{};handleObj=jQuery.extend({type:type,origType:tns[1],data:data,handler:handler,guid:handler.guid,selector:selector,needsContext:selector&&jQuery.expr.match.needsContext.test(selector),namespace:namespaces.join(".")},handleObjIn);handlers=events[type];if(!handlers){handlers=events[type]=[];handlers.delegateCount=0;if(!special.setup||special.setup.call(elem,data,namespaces,eventHandle)===false){if(elem.addEventListener){elem.addEventListener(type,eventHandle,false);}else if(elem.attachEvent){elem.attachEvent("on"+type,eventHandle);}}}
if(special.add){special.add.call(elem,handleObj);if(!handleObj.handler.guid){handleObj.handler.guid=handler.guid;}}
if(selector){handlers.splice(handlers.delegateCount++,0,handleObj);}else{handlers.push(handleObj);}
jQuery.event.global[type]=true;}
elem=null;},global:{},remove:function(elem,types,handler,selector,mappedTypes){var t,tns,type,origType,namespaces,origCount,j,events,special,eventType,handleObj,elemData=jQuery.hasData(elem)&&jQuery._data(elem);if(!elemData||!(events=elemData.events)){return;}
types=jQuery.trim(hoverHack(types||"")).split(" ");for(t=0;t<types.length;t++){tns=rtypenamespace.exec(types[t])||[];type=origType=tns[1];namespaces=tns[2];if(!type){for(type in events){jQuery.event.remove(elem,type+types[t],handler,selector,true);}
continue;}
special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;eventType=events[type]||[];origCount=eventType.length;namespaces=namespaces?new RegExp("(^|\\.)"+namespaces.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null;for(j=0;j<eventType.length;j++){handleObj=eventType[j];if((mappedTypes||origType===handleObj.origType)&&(!handler||handler.guid===handleObj.guid)&&(!namespaces||namespaces.test(handleObj.namespace))&&(!selector||selector===handleObj.selector||selector==="**"&&handleObj.selector)){eventType.splice(j--,1);if(handleObj.selector){eventType.delegateCount--;}
if(special.remove){special.remove.call(elem,handleObj);}}}
if(eventType.length===0&&origCount!==eventType.length){if(!special.teardown||special.teardown.call(elem,namespaces,elemData.handle)===false){jQuery.removeEvent(elem,type,elemData.handle);}
delete events[type];}}
if(jQuery.isEmptyObject(events)){delete elemData.handle;jQuery.removeData(elem,"events",true);}},customEvent:{"getData":true,"setData":true,"changeData":true},trigger:function(event,data,elem,onlyHandlers){if(elem&&(elem.nodeType===3||elem.nodeType===8)){return;}
var cache,exclusive,i,cur,old,ontype,special,handle,eventPath,bubbleType,type=event.type||event,namespaces=[];if(rfocusMorph.test(type+jQuery.event.triggered)){return;}
if(type.indexOf("!")>=0){type=type.slice(0,-1);exclusive=true;}
if(type.indexOf(".")>=0){namespaces=type.split(".");type=namespaces.shift();namespaces.sort();}
if((!elem||jQuery.event.customEvent[type])&&!jQuery.event.global[type]){return;}
event=typeof event==="object"?event[jQuery.expando]?event:new jQuery.Event(type,event):new jQuery.Event(type);event.type=type;event.isTrigger=true;event.exclusive=exclusive;event.namespace=namespaces.join(".");event.namespace_re=event.namespace?new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"):null;ontype=type.indexOf(":")<0?"on"+type:"";if(!elem){cache=jQuery.cache;for(i in cache){if(cache[i].events&&cache[i].events[type]){jQuery.event.trigger(event,data,cache[i].handle.elem,true);}}
return;}
event.result=undefined;if(!event.target){event.target=elem;}
data=data!=null?jQuery.makeArray(data):[];data.unshift(event);special=jQuery.event.special[type]||{};if(special.trigger&&special.trigger.apply(elem,data)===false){return;}
eventPath=[[elem,special.bindType||type]];if(!onlyHandlers&&!special.noBubble&&!jQuery.isWindow(elem)){bubbleType=special.delegateType||type;cur=rfocusMorph.test(bubbleType+type)?elem:elem.parentNode;for(old=elem;cur;cur=cur.parentNode){eventPath.push([cur,bubbleType]);old=cur;}
if(old===(elem.ownerDocument||document)){eventPath.push([old.defaultView||old.parentWindow||window,bubbleType]);}}
for(i=0;i<eventPath.length&&!event.isPropagationStopped();i++){cur=eventPath[i][0];event.type=eventPath[i][1];handle=(jQuery._data(cur,"events")||{})[event.type]&&jQuery._data(cur,"handle");if(handle){handle.apply(cur,data);}
handle=ontype&&cur[ontype];if(handle&&jQuery.acceptData(cur)&&handle.apply&&handle.apply(cur,data)===false){event.preventDefault();}}
event.type=type;if(!onlyHandlers&&!event.isDefaultPrevented()){if((!special._default||special._default.apply(elem.ownerDocument,data)===false)&&!(type==="click"&&jQuery.nodeName(elem,"a"))&&jQuery.acceptData(elem)){if(ontype&&elem[type]&&((type!=="focus"&&type!=="blur")||event.target.offsetWidth!==0)&&!jQuery.isWindow(elem)){old=elem[ontype];if(old){elem[ontype]=null;}
jQuery.event.triggered=type;elem[type]();jQuery.event.triggered=undefined;if(old){elem[ontype]=old;}}}}
return event.result;},dispatch:function(event){event=jQuery.event.fix(event||window.event);var i,j,cur,ret,selMatch,matched,matches,handleObj,sel,related,handlers=((jQuery._data(this,"events")||{})[event.type]||[]),delegateCount=handlers.delegateCount,args=core_slice.call(arguments),run_all=!event.exclusive&&!event.namespace,special=jQuery.event.special[event.type]||{},handlerQueue=[];args[0]=event;event.delegateTarget=this;if(special.preDispatch&&special.preDispatch.call(this,event)===false){return;}
if(delegateCount&&!(event.button&&event.type==="click")){for(cur=event.target;cur!=this;cur=cur.parentNode||this){if(cur.disabled!==true||event.type!=="click"){selMatch={};matches=[];for(i=0;i<delegateCount;i++){handleObj=handlers[i];sel=handleObj.selector;if(selMatch[sel]===undefined){selMatch[sel]=handleObj.needsContext?jQuery(sel,this).index(cur)>=0:jQuery.find(sel,this,null,[cur]).length;}
if(selMatch[sel]){matches.push(handleObj);}}
if(matches.length){handlerQueue.push({elem:cur,matches:matches});}}}}
if(handlers.length>delegateCount){handlerQueue.push({elem:this,matches:handlers.slice(delegateCount)});}
for(i=0;i<handlerQueue.length&&!event.isPropagationStopped();i++){matched=handlerQueue[i];event.currentTarget=matched.elem;for(j=0;j<matched.matches.length&&!event.isImmediatePropagationStopped();j++){handleObj=matched.matches[j];if(run_all||(!event.namespace&&!handleObj.namespace)||event.namespace_re&&event.namespace_re.test(handleObj.namespace)){event.data=handleObj.data;event.handleObj=handleObj;ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args);if(ret!==undefined){event.result=ret;if(ret===false){event.preventDefault();event.stopPropagation();}}}}}
if(special.postDispatch){special.postDispatch.call(this,event);}
return event.result;},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(event,original){if(event.which==null){event.which=original.charCode!=null?original.charCode:original.keyCode;}
return event;}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(event,original){var eventDoc,doc,body,button=original.button,fromElement=original.fromElement;if(event.pageX==null&&original.clientX!=null){eventDoc=event.target.ownerDocument||document;doc=eventDoc.documentElement;body=eventDoc.body;event.pageX=original.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0);event.pageY=original.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0);}
if(!event.relatedTarget&&fromElement){event.relatedTarget=fromElement===event.target?original.toElement:fromElement;}
if(!event.which&&button!==undefined){event.which=(button&1?1:(button&2?3:(button&4?2:0)));}
return event;}},fix:function(event){if(event[jQuery.expando]){return event;}
var i,prop,originalEvent=event,fixHook=jQuery.event.fixHooks[event.type]||{},copy=fixHook.props?this.props.concat(fixHook.props):this.props;event=jQuery.Event(originalEvent);for(i=copy.length;i;){prop=copy[--i];event[prop]=originalEvent[prop];}
if(!event.target){event.target=originalEvent.srcElement||document;}
if(event.target.nodeType===3){event.target=event.target.parentNode;}
event.metaKey=!!event.metaKey;return fixHook.filter?fixHook.filter(event,originalEvent):event;},special:{load:{noBubble:true},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(data,namespaces,eventHandle){if(jQuery.isWindow(this)){this.onbeforeunload=eventHandle;}},teardown:function(namespaces,eventHandle){if(this.onbeforeunload===eventHandle){this.onbeforeunload=null;}}}},simulate:function(type,elem,event,bubble){var e=jQuery.extend(new jQuery.Event(),event,{type:type,isSimulated:true,originalEvent:{}});if(bubble){jQuery.event.trigger(e,null,elem);}else{jQuery.event.dispatch.call(elem,e);}
if(e.isDefaultPrevented()){event.preventDefault();}}};jQuery.event.handle=jQuery.event.dispatch;jQuery.removeEvent=document.removeEventListener?function(elem,type,handle){if(elem.removeEventListener){elem.removeEventListener(type,handle,false);}}:function(elem,type,handle){var name="on"+type;if(elem.detachEvent){if(typeof elem[name]==="undefined"){elem[name]=null;}
elem.detachEvent(name,handle);}};jQuery.Event=function(src,props){if(!(this instanceof jQuery.Event)){return new jQuery.Event(src,props);}
if(src&&src.type){this.originalEvent=src;this.type=src.type;this.isDefaultPrevented=(src.defaultPrevented||src.returnValue===false||src.getPreventDefault&&src.getPreventDefault())?returnTrue:returnFalse;}else{this.type=src;}
if(props){jQuery.extend(this,props);}
this.timeStamp=src&&src.timeStamp||jQuery.now();this[jQuery.expando]=true;};function returnFalse(){return false;}
function returnTrue(){return true;}
jQuery.Event.prototype={preventDefault:function(){this.isDefaultPrevented=returnTrue;var e=this.originalEvent;if(!e){return;}
if(e.preventDefault){e.preventDefault();}else{e.returnValue=false;}},stopPropagation:function(){this.isPropagationStopped=returnTrue;var e=this.originalEvent;if(!e){return;}
if(e.stopPropagation){e.stopPropagation();}
e.cancelBubble=true;},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=returnTrue;this.stopPropagation();},isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse};jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var ret,target=this,related=event.relatedTarget,handleObj=event.handleObj,selector=handleObj.selector;if(!related||(related!==target&&!jQuery.contains(target,related))){event.type=handleObj.origType;ret=handleObj.handler.apply(this,arguments);event.type=fix;}
return ret;}};});if(!jQuery.support.submitBubbles){jQuery.event.special.submit={setup:function(){if(jQuery.nodeName(this,"form")){return false;}
jQuery.event.add(this,"click._submit keypress._submit",function(e){var elem=e.target,form=jQuery.nodeName(elem,"input")||jQuery.nodeName(elem,"button")?elem.form:undefined;if(form&&!jQuery._data(form,"_submit_attached")){jQuery.event.add(form,"submit._submit",function(event){event._submit_bubble=true;});jQuery._data(form,"_submit_attached",true);}});},postDispatch:function(event){if(event._submit_bubble){delete event._submit_bubble;if(this.parentNode&&!event.isTrigger){jQuery.event.simulate("submit",this.parentNode,event,true);}}},teardown:function(){if(jQuery.nodeName(this,"form")){return false;}
jQuery.event.remove(this,"._submit");}};}
if(!jQuery.support.changeBubbles){jQuery.event.special.change={setup:function(){if(rformElems.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio"){jQuery.event.add(this,"propertychange._change",function(event){if(event.originalEvent.propertyName==="checked"){this._just_changed=true;}});jQuery.event.add(this,"click._change",function(event){if(this._just_changed&&!event.isTrigger){this._just_changed=false;}
jQuery.event.simulate("change",this,event,true);});}
return false;}
jQuery.event.add(this,"beforeactivate._change",function(e){var elem=e.target;if(rformElems.test(elem.nodeName)&&!jQuery._data(elem,"_change_attached")){jQuery.event.add(elem,"change._change",function(event){if(this.parentNode&&!event.isSimulated&&!event.isTrigger){jQuery.event.simulate("change",this.parentNode,event,true);}});jQuery._data(elem,"_change_attached",true);}});},handle:function(event){var elem=event.target;if(this!==elem||event.isSimulated||event.isTrigger||(elem.type!=="radio"&&elem.type!=="checkbox")){return event.handleObj.handler.apply(this,arguments);}},teardown:function(){jQuery.event.remove(this,"._change");return!rformElems.test(this.nodeName);}};}
if(!jQuery.support.focusinBubbles){jQuery.each({focus:"focusin",blur:"focusout"},function(orig,fix){var attaches=0,handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event),true);};jQuery.event.special[fix]={setup:function(){if(attaches++===0){document.addEventListener(orig,handler,true);}},teardown:function(){if(--attaches===0){document.removeEventListener(orig,handler,true);}}};});}
jQuery.fn.extend({on:function(types,selector,data,fn,one){var origFn,type;if(typeof types==="object"){if(typeof selector!=="string"){data=data||selector;selector=undefined;}
for(type in types){this.on(type,selector,data,types[type],one);}
return this;}
if(data==null&&fn==null){fn=selector;data=selector=undefined;}else if(fn==null){if(typeof selector==="string"){fn=data;data=undefined;}else{fn=data;data=selector;selector=undefined;}}
if(fn===false){fn=returnFalse;}else if(!fn){return this;}
if(one===1){origFn=fn;fn=function(event){jQuery().off(event);return origFn.apply(this,arguments);};fn.guid=origFn.guid||(origFn.guid=jQuery.guid++);}
return this.each(function(){jQuery.event.add(this,types,fn,data,selector);});},one:function(types,selector,data,fn){return this.on(types,selector,data,fn,1);},off:function(types,selector,fn){var handleObj,type;if(types&&types.preventDefault&&types.handleObj){handleObj=types.handleObj;jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.origType+"."+handleObj.namespace:handleObj.origType,handleObj.selector,handleObj.handler);return this;}
if(typeof types==="object"){for(type in types){this.off(type,selector,types[type]);}
return this;}
if(selector===false||typeof selector==="function"){fn=selector;selector=undefined;}
if(fn===false){fn=returnFalse;}
return this.each(function(){jQuery.event.remove(this,types,fn,selector);});},bind:function(types,data,fn){return this.on(types,null,data,fn);},unbind:function(types,fn){return this.off(types,null,fn);},live:function(types,data,fn){jQuery(this.context).on(types,this.selector,data,fn);return this;},die:function(types,fn){jQuery(this.context).off(types,this.selector||"**",fn);return this;},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn);},undelegate:function(selector,types,fn){return arguments.length===1?this.off(selector,"**"):this.off(types,selector||"**",fn);},trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this);});},triggerHandler:function(type,data){if(this[0]){return jQuery.event.trigger(type,data,this[0],true);}},toggle:function(fn){var args=arguments,guid=fn.guid||jQuery.guid++,i=0,toggler=function(event){var lastToggle=(jQuery._data(this,"lastToggle"+fn.guid)||0)%i;jQuery._data(this,"lastToggle"+fn.guid,lastToggle+1);event.preventDefault();return args[lastToggle].apply(this,arguments)||false;};toggler.guid=guid;while(i<args.length){args[i++].guid=guid;}
return this.click(toggler);},hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver);}});jQuery.each(("blur focus focusin focusout load resize scroll unload click dblclick "+"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave "+"change select submit keydown keypress keyup error contextmenu").split(" "),function(i,name){jQuery.fn[name]=function(data,fn){if(fn==null){fn=data;data=null;}
return arguments.length>0?this.on(name,null,data,fn):this.trigger(name);};if(rkeyEvent.test(name)){jQuery.event.fixHooks[name]=jQuery.event.keyHooks;}
if(rmouseEvent.test(name)){jQuery.event.fixHooks[name]=jQuery.event.mouseHooks;}});(function(window,undefined){var cachedruns,assertGetIdNotName,Expr,getText,isXML,contains,compile,sortOrder,hasDuplicate,outermostContext,baseHasDuplicate=true,strundefined="undefined",expando=("sizcache"+Math.random()).replace(".",""),Token=String,document=window.document,docElem=document.documentElement,dirruns=0,done=0,pop=[].pop,push=[].push,slice=[].slice,indexOf=[].indexOf||function(elem){var i=0,len=this.length;for(;i<len;i++){if(this[i]===elem){return i;}}
return-1;},markFunction=function(fn,value){fn[expando]=value==null||value;return fn;},createCache=function(){var cache={},keys=[];return markFunction(function(key,value){if(keys.push(key)>Expr.cacheLength){delete cache[keys.shift()];}
return(cache[key]=value);},cache);},classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),whitespace="[\\x20\\t\\r\\n\\f]",characterEncoding="(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+",identifier=characterEncoding.replace("w","w#"),operators="([*^$|!~]?=)",attributes="\\["+whitespace+"*("+characterEncoding+")"+whitespace+"*(?:"+operators+whitespace+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+identifier+")|)|)"+whitespace+"*\\]",pseudos=":("+characterEncoding+")(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|([^()[\\]]*|(?:(?:"+attributes+")|[^:]|\\\\.)*|.*))\\)|)",pos=":(even|odd|eq|gt|lt|nth|first|last)(?:\\("+whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)",rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([\\x20\\t\\r\\n\\f>+~])"+whitespace+"*"),rpseudo=new RegExp(pseudos),rquickExpr=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,rnot=/^:not/,rsibling=/[\x20\t\r\n\f]*[+~]/,rendsWithNot=/:not\($/,rheader=/h\d/i,rinputs=/input|select|textarea|button/i,rbackslash=/\\(?!\\)/g,matchExpr={"ID":new RegExp("^#("+characterEncoding+")"),"CLASS":new RegExp("^\\.("+characterEncoding+")"),"NAME":new RegExp("^\\[name=['\"]?("+characterEncoding+")['\"]?\\]"),"TAG":new RegExp("^("+characterEncoding.replace("w","w*")+")"),"ATTR":new RegExp("^"+attributes),"PSEUDO":new RegExp("^"+pseudos),"POS":new RegExp(pos,"i"),"CHILD":new RegExp("^:(only|nth|first|last)-child(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),"needsContext":new RegExp("^"+whitespace+"*[>+~]|"+pos,"i")},assert=function(fn){var div=document.createElement("div");try{return fn(div);}catch(e){return false;}finally{div=null;}},assertTagNameNoComments=assert(function(div){div.appendChild(document.createComment(""));return!div.getElementsByTagName("*").length;}),assertHrefNotNormalized=assert(function(div){div.innerHTML="<a href='#'></a>";return div.firstChild&&typeof div.firstChild.getAttribute!==strundefined&&div.firstChild.getAttribute("href")==="#";}),assertAttributes=assert(function(div){div.innerHTML="<select></select>";var type=typeof div.lastChild.getAttribute("multiple");return type!=="boolean"&&type!=="string";}),assertUsableClassName=assert(function(div){div.innerHTML="<div class='hidden e'></div><div class='hidden'></div>";if(!div.getElementsByClassName||!div.getElementsByClassName("e").length){return false;}
div.lastChild.className="e";return div.getElementsByClassName("e").length===2;}),assertUsableName=assert(function(div){div.id=expando+0;div.innerHTML="<a name='"+expando+"'></a><div name='"+expando+"'></div>";docElem.insertBefore(div,docElem.firstChild);var pass=document.getElementsByName&&document.getElementsByName(expando).length===2+
document.getElementsByName(expando+0).length;assertGetIdNotName=!document.getElementById(expando);docElem.removeChild(div);return pass;});try{slice.call(docElem.childNodes,0)[0].nodeType;}catch(e){slice=function(i){var elem,results=[];for(;(elem=this[i]);i++){results.push(elem);}
return results;};}
function Sizzle(selector,context,results,seed){results=results||[];context=context||document;var match,elem,xml,m,nodeType=context.nodeType;if(!selector||typeof selector!=="string"){return results;}
if(nodeType!==1&&nodeType!==9){return[];}
xml=isXML(context);if(!xml&&!seed){if((match=rquickExpr.exec(selector))){if((m=match[1])){if(nodeType===9){elem=context.getElementById(m);if(elem&&elem.parentNode){if(elem.id===m){results.push(elem);return results;}}else{return results;}}else{if(context.ownerDocument&&(elem=context.ownerDocument.getElementById(m))&&contains(context,elem)&&elem.id===m){results.push(elem);return results;}}}else if(match[2]){push.apply(results,slice.call(context.getElementsByTagName(selector),0));return results;}else if((m=match[3])&&assertUsableClassName&&context.getElementsByClassName){push.apply(results,slice.call(context.getElementsByClassName(m),0));return results;}}}
return select(selector.replace(rtrim,"$1"),context,results,seed,xml);}
Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements);};Sizzle.matchesSelector=function(elem,expr){return Sizzle(expr,null,null,[elem]).length>0;};function createInputPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type===type;};}
function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return(name==="input"||name==="button")&&elem.type===type;};}
function createPositionalPseudo(fn){return markFunction(function(argument){argument=+argument;return markFunction(function(seed,matches){var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;while(i--){if(seed[(j=matchIndexes[i])]){seed[j]=!(matches[j]=seed[j]);}}});});}
getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(nodeType){if(nodeType===1||nodeType===9||nodeType===11){if(typeof elem.textContent==="string"){return elem.textContent;}else{for(elem=elem.firstChild;elem;elem=elem.nextSibling){ret+=getText(elem);}}}else if(nodeType===3||nodeType===4){return elem.nodeValue;}}else{for(;(node=elem[i]);i++){ret+=getText(node);}}
return ret;};isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return documentElement?documentElement.nodeName!=="HTML":false;};contains=Sizzle.contains=docElem.contains?function(a,b){var adown=a.nodeType===9?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!!(bup&&bup.nodeType===1&&adown.contains&&adown.contains(bup));}:docElem.compareDocumentPosition?function(a,b){return b&&!!(a.compareDocumentPosition(b)&16);}:function(a,b){while((b=b.parentNode)){if(b===a){return true;}}
return false;};Sizzle.attr=function(elem,name){var val,xml=isXML(elem);if(!xml){name=name.toLowerCase();}
if((val=Expr.attrHandle[name])){return val(elem);}
if(xml||assertAttributes){return elem.getAttribute(name);}
val=elem.getAttributeNode(name);return val?typeof elem[name]==="boolean"?elem[name]?name:null:val.specified?val.value:null:null;};Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:assertHrefNotNormalized?{}:{"href":function(elem){return elem.getAttribute("href",2);},"type":function(elem){return elem.getAttribute("type");}},find:{"ID":assertGetIdNotName?function(id,context,xml){if(typeof context.getElementById!==strundefined&&!xml){var m=context.getElementById(id);return m&&m.parentNode?[m]:[];}}:function(id,context,xml){if(typeof context.getElementById!==strundefined&&!xml){var m=context.getElementById(id);return m?m.id===id||typeof m.getAttributeNode!==strundefined&&m.getAttributeNode("id").value===id?[m]:undefined:[];}},"TAG":assertTagNameNoComments?function(tag,context){if(typeof context.getElementsByTagName!==strundefined){return context.getElementsByTagName(tag);}}:function(tag,context){var results=context.getElementsByTagName(tag);if(tag==="*"){var elem,tmp=[],i=0;for(;(elem=results[i]);i++){if(elem.nodeType===1){tmp.push(elem);}}
return tmp;}
return results;},"NAME":assertUsableName&&function(tag,context){if(typeof context.getElementsByName!==strundefined){return context.getElementsByName(name);}},"CLASS":assertUsableClassName&&function(className,context,xml){if(typeof context.getElementsByClassName!==strundefined&&!xml){return context.getElementsByClassName(className);}}},relative:{">":{dir:"parentNode",first:true}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:true},"~":{dir:"previousSibling"}},preFilter:{"ATTR":function(match){match[1]=match[1].replace(rbackslash,"");match[3]=(match[4]||match[5]||"").replace(rbackslash,"");if(match[2]==="~="){match[3]=" "+match[3]+" ";}
return match.slice(0,4);},"CHILD":function(match){match[1]=match[1].toLowerCase();if(match[1]==="nth"){if(!match[2]){Sizzle.error(match[0]);}
match[3]=+(match[3]?match[4]+(match[5]||1):2*(match[2]==="even"||match[2]==="odd"));match[4]=+((match[6]+match[7])||match[2]==="odd");}else if(match[2]){Sizzle.error(match[0]);}
return match;},"PSEUDO":function(match){var unquoted,excess;if(matchExpr["CHILD"].test(match[0])){return null;}
if(match[3]){match[2]=match[3];}else if((unquoted=match[4])){if(rpseudo.test(unquoted)&&(excess=tokenize(unquoted,true))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)){unquoted=unquoted.slice(0,excess);match[0]=match[0].slice(0,excess);}
match[2]=unquoted;}
return match.slice(0,3);}},filter:{"ID":assertGetIdNotName?function(id){id=id.replace(rbackslash,"");return function(elem){return elem.getAttribute("id")===id;};}:function(id){id=id.replace(rbackslash,"");return function(elem){var node=typeof elem.getAttributeNode!==strundefined&&elem.getAttributeNode("id");return node&&node.value===id;};},"TAG":function(nodeName){if(nodeName==="*"){return function(){return true;};}
nodeName=nodeName.replace(rbackslash,"").toLowerCase();return function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName;};},"CLASS":function(className){var pattern=classCache[expando][className];if(!pattern){pattern=classCache(className,new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"));}
return function(elem){return pattern.test(elem.className||(typeof elem.getAttribute!==strundefined&&elem.getAttribute("class"))||"");};},"ATTR":function(name,operator,check){return function(elem,context){var result=Sizzle.attr(elem,name);if(result==null){return operator==="!=";}
if(!operator){return true;}
result+="";return operator==="="?result===check:operator==="!="?result!==check:operator==="^="?check&&result.indexOf(check)===0:operator==="*="?check&&result.indexOf(check)>-1:operator==="$="?check&&result.substr(result.length-check.length)===check:operator==="~="?(" "+result+" ").indexOf(check)>-1:operator==="|="?result===check||result.substr(0,check.length+1)===check+"-":false;};},"CHILD":function(type,argument,first,last){if(type==="nth"){return function(elem){var node,diff,parent=elem.parentNode;if(first===1&&last===0){return true;}
if(parent){diff=0;for(node=parent.firstChild;node;node=node.nextSibling){if(node.nodeType===1){diff++;if(elem===node){break;}}}}
diff-=last;return diff===first||(diff%first===0&&diff/first>=0);};}
return function(elem){var node=elem;switch(type){case"only":case"first":while((node=node.previousSibling)){if(node.nodeType===1){return false;}}
if(type==="first"){return true;}
node=elem;case"last":while((node=node.nextSibling)){if(node.nodeType===1){return false;}}
return true;}};},"PSEUDO":function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);if(fn[expando]){return fn(argument);}
if(fn.length>1){args=[pseudo,pseudo,"",argument];return Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){var idx,matched=fn(seed,argument),i=matched.length;while(i--){idx=indexOf.call(seed,matched[i]);seed[idx]=!(matches[idx]=matched[i]);}}):function(elem){return fn(elem,0,args);};}
return fn;}},pseudos:{"not":markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction(function(seed,matches,context,xml){var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;while(i--){if((elem=unmatched[i])){seed[i]=!(matches[i]=elem);}}}):function(elem,context,xml){input[0]=elem;matcher(input,null,xml,results);return!results.pop();};}),"has":markFunction(function(selector){return function(elem){return Sizzle(selector,elem).length>0;};}),"contains":markFunction(function(text){return function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1;};}),"enabled":function(elem){return elem.disabled===false;},"disabled":function(elem){return elem.disabled===true;},"checked":function(elem){var nodeName=elem.nodeName.toLowerCase();return(nodeName==="input"&&!!elem.checked)||(nodeName==="option"&&!!elem.selected);},"selected":function(elem){if(elem.parentNode){elem.parentNode.selectedIndex;}
return elem.selected===true;},"parent":function(elem){return!Expr.pseudos["empty"](elem);},"empty":function(elem){var nodeType;elem=elem.firstChild;while(elem){if(elem.nodeName>"@"||(nodeType=elem.nodeType)===3||nodeType===4){return false;}
elem=elem.nextSibling;}
return true;},"header":function(elem){return rheader.test(elem.nodeName);},"text":function(elem){var type,attr;return elem.nodeName.toLowerCase()==="input"&&(type=elem.type)==="text"&&((attr=elem.getAttribute("type"))==null||attr.toLowerCase()===type);},"radio":createInputPseudo("radio"),"checkbox":createInputPseudo("checkbox"),"file":createInputPseudo("file"),"password":createInputPseudo("password"),"image":createInputPseudo("image"),"submit":createButtonPseudo("submit"),"reset":createButtonPseudo("reset"),"button":function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type==="button"||name==="button";},"input":function(elem){return rinputs.test(elem.nodeName);},"focus":function(elem){var doc=elem.ownerDocument;return elem===doc.activeElement&&(!doc.hasFocus||doc.hasFocus())&&!!(elem.type||elem.href);},"active":function(elem){return elem===elem.ownerDocument.activeElement;},"first":createPositionalPseudo(function(matchIndexes,length,argument){return[0];}),"last":createPositionalPseudo(function(matchIndexes,length,argument){return[length-1];}),"eq":createPositionalPseudo(function(matchIndexes,length,argument){return[argument<0?argument+length:argument];}),"even":createPositionalPseudo(function(matchIndexes,length,argument){for(var i=0;i<length;i+=2){matchIndexes.push(i);}
return matchIndexes;}),"odd":createPositionalPseudo(function(matchIndexes,length,argument){for(var i=1;i<length;i+=2){matchIndexes.push(i);}
return matchIndexes;}),"lt":createPositionalPseudo(function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument;--i>=0;){matchIndexes.push(i);}
return matchIndexes;}),"gt":createPositionalPseudo(function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument;++i<length;){matchIndexes.push(i);}
return matchIndexes;})}};function siblingCheck(a,b,ret){if(a===b){return ret;}
var cur=a.nextSibling;while(cur){if(cur===b){return-1;}
cur=cur.nextSibling;}
return 1;}
sortOrder=docElem.compareDocumentPosition?function(a,b){if(a===b){hasDuplicate=true;return 0;}
return(!a.compareDocumentPosition||!b.compareDocumentPosition?a.compareDocumentPosition:a.compareDocumentPosition(b)&4)?-1:1;}:function(a,b){if(a===b){hasDuplicate=true;return 0;}else if(a.sourceIndex&&b.sourceIndex){return a.sourceIndex-b.sourceIndex;}
var al,bl,ap=[],bp=[],aup=a.parentNode,bup=b.parentNode,cur=aup;if(aup===bup){return siblingCheck(a,b);}else if(!aup){return-1;}else if(!bup){return 1;}
while(cur){ap.unshift(cur);cur=cur.parentNode;}
cur=bup;while(cur){bp.unshift(cur);cur=cur.parentNode;}
al=ap.length;bl=bp.length;for(var i=0;i<al&&i<bl;i++){if(ap[i]!==bp[i]){return siblingCheck(ap[i],bp[i]);}}
return i===al?siblingCheck(a,bp[i],-1):siblingCheck(ap[i],b,1);};[0,0].sort(sortOrder);baseHasDuplicate=!hasDuplicate;Sizzle.uniqueSort=function(results){var elem,i=1;hasDuplicate=baseHasDuplicate;results.sort(sortOrder);if(hasDuplicate){for(;(elem=results[i]);i++){if(elem===results[i-1]){results.splice(i--,1);}}}
return results;};Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg);};function tokenize(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[expando][selector];if(cached){return parseOnly?0:cached.slice(0);}
soFar=selector;groups=[];preFilters=Expr.preFilter;while(soFar){if(!matched||(match=rcomma.exec(soFar))){if(match){soFar=soFar.slice(match[0].length);}
groups.push(tokens=[]);}
matched=false;if((match=rcombinators.exec(soFar))){tokens.push(matched=new Token(match.shift()));soFar=soFar.slice(matched.length);matched.type=match[0].replace(rtrim," ");}
for(type in Expr.filter){if((match=matchExpr[type].exec(soFar))&&(!preFilters[type]||(match=preFilters[type](match,document,true)))){tokens.push(matched=new Token(match.shift()));soFar=soFar.slice(matched.length);matched.type=type;matched.matches=match;}}
if(!matched){break;}}
return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0);}
function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base&&combinator.dir==="parentNode",doneName=done++;return combinator.first?function(elem,context,xml){while((elem=elem[dir])){if(checkNonElements||elem.nodeType===1){return matcher(elem,context,xml);}}}:function(elem,context,xml){if(!xml){var cache,dirkey=dirruns+" "+doneName+" ",cachedkey=dirkey+cachedruns;while((elem=elem[dir])){if(checkNonElements||elem.nodeType===1){if((cache=elem[expando])===cachedkey){return elem.sizset;}else if(typeof cache==="string"&&cache.indexOf(dirkey)===0){if(elem.sizset){return elem;}}else{elem[expando]=cachedkey;if(matcher(elem,context,xml)){elem.sizset=true;return elem;}
elem.sizset=false;}}}}else{while((elem=elem[dir])){if(checkNonElements||elem.nodeType===1){if(matcher(elem,context,xml)){return elem;}}}}};}
function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){var i=matchers.length;while(i--){if(!matchers[i](elem,context,xml)){return false;}}
return true;}:matchers[0];}
function condense(unmatched,map,filter,context,xml){var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=map!=null;for(;i<len;i++){if((elem=unmatched[i])){if(!filter||filter(elem,context,xml)){newUnmatched.push(elem);if(mapped){map.push(i);}}}}
return newUnmatched;}
function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){if(postFilter&&!postFilter[expando]){postFilter=setMatcher(postFilter);}
if(postFinder&&!postFinder[expando]){postFinder=setMatcher(postFinder,postSelector);}
return markFunction(function(seed,results,context,xml){if(seed&&postFinder){return;}
var i,elem,postFilterIn,preMap=[],postMap=[],preexisting=results.length,elems=seed||multipleContexts(selector||"*",context.nodeType?[context]:context,[],seed),matcherIn=preFilter&&(seed||!selector)?condense(elems,preMap,preFilter,context,xml):elems,matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher){matcher(matcherIn,matcherOut,context,xml);}
if(postFilter){postFilterIn=condense(matcherOut,postMap);postFilter(postFilterIn,[],context,xml);i=postFilterIn.length;while(i--){if((elem=postFilterIn[i])){matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem);}}}
if(seed){i=preFilter&&matcherOut.length;while(i--){if((elem=matcherOut[i])){seed[preMap[i]]=!(results[preMap[i]]=elem);}}}else{matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut);if(postFinder){postFinder(null,results,matcherOut,xml);}else{push.apply(results,matcherOut);}}});}
function matcherFromTokens(tokens){var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext;},implicitRelative,true),matchAnyContext=addCombinator(function(elem){return indexOf.call(checkContext,elem)>-1;},implicitRelative,true),matchers=[function(elem,context,xml){return(!leadingRelative&&(xml||context!==outermostContext))||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml));}];for(;i<len;i++){if((matcher=Expr.relative[tokens[i].type])){matchers=[addCombinator(elementMatcher(matchers),matcher)];}else{matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches);if(matcher[expando]){j=++i;for(;j<len;j++){if(Expr.relative[tokens[j].type]){break;}}
return setMatcher(i>1&&elementMatcher(matchers),i>1&&tokens.slice(0,i-1).join("").replace(rtrim,"$1"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens((tokens=tokens.slice(j))),j<len&&tokens.join(""));}
matchers.push(matcher);}}
return elementMatcher(matchers);}
function matcherFromGroupMatchers(elementMatchers,setMatchers){var bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,expandContext){var elem,j,matcher,setMatched=[],matchedCount=0,i="0",unmatched=seed&&[],outermost=expandContext!=null,contextBackup=outermostContext,elems=seed||byElement&&Expr.find["TAG"]("*",expandContext&&context.parentNode||context),dirrunsUnique=(dirruns+=contextBackup==null?1:Math.E);if(outermost){outermostContext=context!==document&&context;cachedruns=superMatcher.el;}
for(;(elem=elems[i])!=null;i++){if(byElement&&elem){for(j=0;(matcher=elementMatchers[j]);j++){if(matcher(elem,context,xml)){results.push(elem);break;}}
if(outermost){dirruns=dirrunsUnique;cachedruns=++superMatcher.el;}}
if(bySet){if((elem=!matcher&&elem)){matchedCount--;}
if(seed){unmatched.push(elem);}}}
matchedCount+=i;if(bySet&&i!==matchedCount){for(j=0;(matcher=setMatchers[j]);j++){matcher(unmatched,setMatched,context,xml);}
if(seed){if(matchedCount>0){while(i--){if(!(unmatched[i]||setMatched[i])){setMatched[i]=pop.call(results);}}}
setMatched=condense(setMatched);}
push.apply(results,setMatched);if(outermost&&!seed&&setMatched.length>0&&(matchedCount+setMatchers.length)>1){Sizzle.uniqueSort(results);}}
if(outermost){dirruns=dirrunsUnique;outermostContext=contextBackup;}
return unmatched;};superMatcher.el=0;return bySet?markFunction(superMatcher):superMatcher;}
compile=Sizzle.compile=function(selector,group){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[expando][selector];if(!cached){if(!group){group=tokenize(selector);}
i=group.length;while(i--){cached=matcherFromTokens(group[i]);if(cached[expando]){setMatchers.push(cached);}else{elementMatchers.push(cached);}}
cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers));}
return cached;};function multipleContexts(selector,contexts,results,seed){var i=0,len=contexts.length;for(;i<len;i++){Sizzle(selector,contexts[i],results,seed);}
return results;}
function select(selector,context,results,seed,xml){var i,tokens,token,type,find,match=tokenize(selector),j=match.length;if(!seed){if(match.length===1){tokens=match[0]=match[0].slice(0);if(tokens.length>2&&(token=tokens[0]).type==="ID"&&context.nodeType===9&&!xml&&Expr.relative[tokens[1].type]){context=Expr.find["ID"](token.matches[0].replace(rbackslash,""),context,xml)[0];if(!context){return results;}
selector=selector.slice(tokens.shift().length);}
for(i=matchExpr["POS"].test(selector)?-1:tokens.length-1;i>=0;i--){token=tokens[i];if(Expr.relative[(type=token.type)]){break;}
if((find=Expr.find[type])){if((seed=find(token.matches[0].replace(rbackslash,""),rsibling.test(tokens[0].type)&&context.parentNode||context,xml))){tokens.splice(i,1);selector=seed.length&&tokens.join("");if(!selector){push.apply(results,slice.call(seed,0));return results;}
break;}}}}}
compile(selector,match)(seed,context,xml,results,rsibling.test(selector));return results;}
if(document.querySelectorAll){(function(){var disconnectedMatch,oldSelect=select,rescape=/'|\\/g,rattributeQuotes=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,rbuggyQSA=[":focus"],rbuggyMatches=[":active",":focus"],matches=docElem.matchesSelector||docElem.mozMatchesSelector||docElem.webkitMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector;assert(function(div){div.innerHTML="<select><option selected=''></option></select>";if(!div.querySelectorAll("[selected]").length){rbuggyQSA.push("\\["+whitespace+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)");}
if(!div.querySelectorAll(":checked").length){rbuggyQSA.push(":checked");}});assert(function(div){div.innerHTML="<p test=''></p>";if(div.querySelectorAll("[test^='']").length){rbuggyQSA.push("[*^$]="+whitespace+"*(?:\"\"|'')");}
div.innerHTML="<input type='hidden'/>";if(!div.querySelectorAll(":enabled").length){rbuggyQSA.push(":enabled",":disabled");}});rbuggyQSA=new RegExp(rbuggyQSA.join("|"));select=function(selector,context,results,seed,xml){if(!seed&&!xml&&(!rbuggyQSA||!rbuggyQSA.test(selector))){var groups,i,old=true,nid=expando,newContext=context,newSelector=context.nodeType===9&&selector;if(context.nodeType===1&&context.nodeName.toLowerCase()!=="object"){groups=tokenize(selector);if((old=context.getAttribute("id"))){nid=old.replace(rescape,"\\$&");}else{context.setAttribute("id",nid);}
nid="[id='"+nid+"'] ";i=groups.length;while(i--){groups[i]=nid+groups[i].join("");}
newContext=rsibling.test(selector)&&context.parentNode||context;newSelector=groups.join(",");}
if(newSelector){try{push.apply(results,slice.call(newContext.querySelectorAll(newSelector),0));return results;}catch(qsaError){}finally{if(!old){context.removeAttribute("id");}}}}
return oldSelect(selector,context,results,seed,xml);};if(matches){assert(function(div){disconnectedMatch=matches.call(div,"div");try{matches.call(div,"[test!='']:sizzle");rbuggyMatches.push("!=",pseudos);}catch(e){}});rbuggyMatches=new RegExp(rbuggyMatches.join("|"));Sizzle.matchesSelector=function(elem,expr){expr=expr.replace(rattributeQuotes,"='$1']");if(!isXML(elem)&&!rbuggyMatches.test(expr)&&(!rbuggyQSA||!rbuggyQSA.test(expr))){try{var ret=matches.call(elem,expr);if(ret||disconnectedMatch||elem.document&&elem.document.nodeType!==11){return ret;}}catch(e){}}
return Sizzle(expr,null,null,[elem]).length>0;};}})();}
Expr.pseudos["nth"]=Expr.pseudos["eq"];function setFilters(){}
Expr.filters=setFilters.prototype=Expr.pseudos;Expr.setFilters=new setFilters();Sizzle.attr=jQuery.attr;jQuery.find=Sizzle;jQuery.expr=Sizzle.selectors;jQuery.expr[":"]=jQuery.expr.pseudos;jQuery.unique=Sizzle.uniqueSort;jQuery.text=Sizzle.getText;jQuery.isXMLDoc=Sizzle.isXML;jQuery.contains=Sizzle.contains;})(window);var runtil=/Until$/,rparentsprev=/^(?:parents|prev(?:Until|All))/,isSimple=/^.[^:#\[\.,]*$/,rneedsContext=jQuery.expr.match.needsContext,guaranteedUnique={children:true,contents:true,next:true,prev:true};jQuery.fn.extend({find:function(selector){var i,l,length,n,r,ret,self=this;if(typeof selector!=="string"){return jQuery(selector).filter(function(){for(i=0,l=self.length;i<l;i++){if(jQuery.contains(self[i],this)){return true;}}});}
ret=this.pushStack("","find",selector);for(i=0,l=this.length;i<l;i++){length=ret.length;jQuery.find(selector,this[i],ret);if(i>0){for(n=length;n<ret.length;n++){for(r=0;r<length;r++){if(ret[r]===ret[n]){ret.splice(n--,1);break;}}}}}
return ret;},has:function(target){var i,targets=jQuery(target,this),len=targets.length;return this.filter(function(){for(i=0;i<len;i++){if(jQuery.contains(this,targets[i])){return true;}}});},not:function(selector){return this.pushStack(winnow(this,selector,false),"not",selector);},filter:function(selector){return this.pushStack(winnow(this,selector,true),"filter",selector);},is:function(selector){return!!selector&&(typeof selector==="string"?rneedsContext.test(selector)?jQuery(selector,this.context).index(this[0])>=0:jQuery.filter(selector,this).length>0:this.filter(selector).length>0);},closest:function(selectors,context){var cur,i=0,l=this.length,ret=[],pos=rneedsContext.test(selectors)||typeof selectors!=="string"?jQuery(selectors,context||this.context):0;for(;i<l;i++){cur=this[i];while(cur&&cur.ownerDocument&&cur!==context&&cur.nodeType!==11){if(pos?pos.index(cur)>-1:jQuery.find.matchesSelector(cur,selectors)){ret.push(cur);break;}
cur=cur.parentNode;}}
ret=ret.length>1?jQuery.unique(ret):ret;return this.pushStack(ret,"closest",selectors);},index:function(elem){if(!elem){return(this[0]&&this[0].parentNode)?this.prevAll().length:-1;}
if(typeof elem==="string"){return jQuery.inArray(this[0],jQuery(elem));}
return jQuery.inArray(elem.jquery?elem[0]:elem,this);},add:function(selector,context){var set=typeof selector==="string"?jQuery(selector,context):jQuery.makeArray(selector&&selector.nodeType?[selector]:selector),all=jQuery.merge(this.get(),set);return this.pushStack(isDisconnected(set[0])||isDisconnected(all[0])?all:jQuery.unique(all));},addBack:function(selector){return this.add(selector==null?this.prevObject:this.prevObject.filter(selector));}});jQuery.fn.andSelf=jQuery.fn.addBack;function isDisconnected(node){return!node||!node.parentNode||node.parentNode.nodeType===11;}
function sibling(cur,dir){do{cur=cur[dir];}while(cur&&cur.nodeType!==1);return cur;}
jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&parent.nodeType!==11?parent:null;},parents:function(elem){return jQuery.dir(elem,"parentNode");},parentsUntil:function(elem,i,until){return jQuery.dir(elem,"parentNode",until);},next:function(elem){return sibling(elem,"nextSibling");},prev:function(elem){return sibling(elem,"previousSibling");},nextAll:function(elem){return jQuery.dir(elem,"nextSibling");},prevAll:function(elem){return jQuery.dir(elem,"previousSibling");},nextUntil:function(elem,i,until){return jQuery.dir(elem,"nextSibling",until);},prevUntil:function(elem,i,until){return jQuery.dir(elem,"previousSibling",until);},siblings:function(elem){return jQuery.sibling((elem.parentNode||{}).firstChild,elem);},children:function(elem){return jQuery.sibling(elem.firstChild);},contents:function(elem){return jQuery.nodeName(elem,"iframe")?elem.contentDocument||elem.contentWindow.document:jQuery.merge([],elem.childNodes);}},function(name,fn){jQuery.fn[name]=function(until,selector){var ret=jQuery.map(this,fn,until);if(!runtil.test(name)){selector=until;}
if(selector&&typeof selector==="string"){ret=jQuery.filter(selector,ret);}
ret=this.length>1&&!guaranteedUnique[name]?jQuery.unique(ret):ret;if(this.length>1&&rparentsprev.test(name)){ret=ret.reverse();}
return this.pushStack(ret,name,core_slice.call(arguments).join(","));};});jQuery.extend({filter:function(expr,elems,not){if(not){expr=":not("+expr+")";}
return elems.length===1?jQuery.find.matchesSelector(elems[0],expr)?[elems[0]]:[]:jQuery.find.matches(expr,elems);},dir:function(elem,dir,until){var matched=[],cur=elem[dir];while(cur&&cur.nodeType!==9&&(until===undefined||cur.nodeType!==1||!jQuery(cur).is(until))){if(cur.nodeType===1){matched.push(cur);}
cur=cur[dir];}
return matched;},sibling:function(n,elem){var r=[];for(;n;n=n.nextSibling){if(n.nodeType===1&&n!==elem){r.push(n);}}
return r;}});function winnow(elements,qualifier,keep){qualifier=qualifier||0;if(jQuery.isFunction(qualifier)){return jQuery.grep(elements,function(elem,i){var retVal=!!qualifier.call(elem,i,elem);return retVal===keep;});}else if(qualifier.nodeType){return jQuery.grep(elements,function(elem,i){return(elem===qualifier)===keep;});}else if(typeof qualifier==="string"){var filtered=jQuery.grep(elements,function(elem){return elem.nodeType===1;});if(isSimple.test(qualifier)){return jQuery.filter(qualifier,filtered,!keep);}else{qualifier=jQuery.filter(qualifier,filtered);}}
return jQuery.grep(elements,function(elem,i){return(jQuery.inArray(elem,qualifier)>=0)===keep;});}
function createSafeFragment(document){var list=nodeNames.split("|"),safeFrag=document.createDocumentFragment();if(safeFrag.createElement){while(list.length){safeFrag.createElement(list.pop());}}
return safeFrag;}
var nodeNames="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|"+"header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",rinlinejQuery=/ jQuery\d+="(?:null|\d+)"/g,rleadingWhitespace=/^\s+/,rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,rtagName=/<([\w:]+)/,rtbody=/<tbody/i,rhtml=/<|&#?\w+;/,rnoInnerhtml=/<(?:script|style|link)/i,rnocache=/<(?:script|object|embed|option|style)/i,rnoshimcache=new RegExp("<(?:"+nodeNames+")[\\s/>]","i"),rcheckableType=/^(?:checkbox|radio)$/,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptType=/\/(java|ecma)script/i,rcleanScript=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,wrapMap={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},safeFragment=createSafeFragment(document),fragmentDiv=safeFragment.appendChild(document.createElement("div"));wrapMap.optgroup=wrapMap.option;wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead;wrapMap.th=wrapMap.td;if(!jQuery.support.htmlSerialize){wrapMap._default=[1,"X<div>","</div>"];}
jQuery.fn.extend({text:function(value){return jQuery.access(this,function(value){return value===undefined?jQuery.text(this):this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(value));},null,value,arguments.length);},wrapAll:function(html){if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapAll(html.call(this,i));});}
if(this[0]){var wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(true);if(this[0].parentNode){wrap.insertBefore(this[0]);}
wrap.map(function(){var elem=this;while(elem.firstChild&&elem.firstChild.nodeType===1){elem=elem.firstChild;}
return elem;}).append(this);}
return this;},wrapInner:function(html){if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapInner(html.call(this,i));});}
return this.each(function(){var self=jQuery(this),contents=self.contents();if(contents.length){contents.wrapAll(html);}else{self.append(html);}});},wrap:function(html){var isFunction=jQuery.isFunction(html);return this.each(function(i){jQuery(this).wrapAll(isFunction?html.call(this,i):html);});},unwrap:function(){return this.parent().each(function(){if(!jQuery.nodeName(this,"body")){jQuery(this).replaceWith(this.childNodes);}}).end();},append:function(){return this.domManip(arguments,true,function(elem){if(this.nodeType===1||this.nodeType===11){this.appendChild(elem);}});},prepend:function(){return this.domManip(arguments,true,function(elem){if(this.nodeType===1||this.nodeType===11){this.insertBefore(elem,this.firstChild);}});},before:function(){if(!isDisconnected(this[0])){return this.domManip(arguments,false,function(elem){this.parentNode.insertBefore(elem,this);});}
if(arguments.length){var set=jQuery.clean(arguments);return this.pushStack(jQuery.merge(set,this),"before",this.selector);}},after:function(){if(!isDisconnected(this[0])){return this.domManip(arguments,false,function(elem){this.parentNode.insertBefore(elem,this.nextSibling);});}
if(arguments.length){var set=jQuery.clean(arguments);return this.pushStack(jQuery.merge(this,set),"after",this.selector);}},remove:function(selector,keepData){var elem,i=0;for(;(elem=this[i])!=null;i++){if(!selector||jQuery.filter(selector,[elem]).length){if(!keepData&&elem.nodeType===1){jQuery.cleanData(elem.getElementsByTagName("*"));jQuery.cleanData([elem]);}
if(elem.parentNode){elem.parentNode.removeChild(elem);}}}
return this;},empty:function(){var elem,i=0;for(;(elem=this[i])!=null;i++){if(elem.nodeType===1){jQuery.cleanData(elem.getElementsByTagName("*"));}
while(elem.firstChild){elem.removeChild(elem.firstChild);}}
return this;},clone:function(dataAndEvents,deepDataAndEvents){dataAndEvents=dataAndEvents==null?false:dataAndEvents;deepDataAndEvents=deepDataAndEvents==null?dataAndEvents:deepDataAndEvents;return this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents);});},html:function(value){return jQuery.access(this,function(value){var elem=this[0]||{},i=0,l=this.length;if(value===undefined){return elem.nodeType===1?elem.innerHTML.replace(rinlinejQuery,""):undefined;}
if(typeof value==="string"&&!rnoInnerhtml.test(value)&&(jQuery.support.htmlSerialize||!rnoshimcache.test(value))&&(jQuery.support.leadingWhitespace||!rleadingWhitespace.test(value))&&!wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()]){value=value.replace(rxhtmlTag,"<$1></$2>");try{for(;i<l;i++){elem=this[i]||{};if(elem.nodeType===1){jQuery.cleanData(elem.getElementsByTagName("*"));elem.innerHTML=value;}}
elem=0;}catch(e){}}
if(elem){this.empty().append(value);}},null,value,arguments.length);},replaceWith:function(value){if(!isDisconnected(this[0])){if(jQuery.isFunction(value)){return this.each(function(i){var self=jQuery(this),old=self.html();self.replaceWith(value.call(this,i,old));});}
if(typeof value!=="string"){value=jQuery(value).detach();}
return this.each(function(){var next=this.nextSibling,parent=this.parentNode;jQuery(this).remove();if(next){jQuery(next).before(value);}else{jQuery(parent).append(value);}});}
return this.length?this.pushStack(jQuery(jQuery.isFunction(value)?value():value),"replaceWith",value):this;},detach:function(selector){return this.remove(selector,true);},domManip:function(args,table,callback){args=[].concat.apply([],args);var results,first,fragment,iNoClone,i=0,value=args[0],scripts=[],l=this.length;if(!jQuery.support.checkClone&&l>1&&typeof value==="string"&&rchecked.test(value)){return this.each(function(){jQuery(this).domManip(args,table,callback);});}
if(jQuery.isFunction(value)){return this.each(function(i){var self=jQuery(this);args[0]=value.call(this,i,table?self.html():undefined);self.domManip(args,table,callback);});}
if(this[0]){results=jQuery.buildFragment(args,this,scripts);fragment=results.fragment;first=fragment.firstChild;if(fragment.childNodes.length===1){fragment=first;}
if(first){table=table&&jQuery.nodeName(first,"tr");for(iNoClone=results.cacheable||l-1;i<l;i++){callback.call(table&&jQuery.nodeName(this[i],"table")?findOrAppend(this[i],"tbody"):this[i],i===iNoClone?fragment:jQuery.clone(fragment,true,true));}}
fragment=first=null;if(scripts.length){jQuery.each(scripts,function(i,elem){if(elem.src){if(jQuery.ajax){jQuery.ajax({url:elem.src,type:"GET",dataType:"script",async:false,global:false,"throws":true});}else{jQuery.error("no ajax");}}else{jQuery.globalEval((elem.text||elem.textContent||elem.innerHTML||"").replace(rcleanScript,""));}
if(elem.parentNode){elem.parentNode.removeChild(elem);}});}}
return this;}});function findOrAppend(elem,tag){return elem.getElementsByTagName(tag)[0]||elem.appendChild(elem.ownerDocument.createElement(tag));}
function cloneCopyEvent(src,dest){if(dest.nodeType!==1||!jQuery.hasData(src)){return;}
var type,i,l,oldData=jQuery._data(src),curData=jQuery._data(dest,oldData),events=oldData.events;if(events){delete curData.handle;curData.events={};for(type in events){for(i=0,l=events[type].length;i<l;i++){jQuery.event.add(dest,type,events[type][i]);}}}
if(curData.data){curData.data=jQuery.extend({},curData.data);}}
function cloneFixAttributes(src,dest){var nodeName;if(dest.nodeType!==1){return;}
if(dest.clearAttributes){dest.clearAttributes();}
if(dest.mergeAttributes){dest.mergeAttributes(src);}
nodeName=dest.nodeName.toLowerCase();if(nodeName==="object"){if(dest.parentNode){dest.outerHTML=src.outerHTML;}
if(jQuery.support.html5Clone&&(src.innerHTML&&!jQuery.trim(dest.innerHTML))){dest.innerHTML=src.innerHTML;}}else if(nodeName==="input"&&rcheckableType.test(src.type)){dest.defaultChecked=dest.checked=src.checked;if(dest.value!==src.value){dest.value=src.value;}}else if(nodeName==="option"){dest.selected=src.defaultSelected;}else if(nodeName==="input"||nodeName==="textarea"){dest.defaultValue=src.defaultValue;}else if(nodeName==="script"&&dest.text!==src.text){dest.text=src.text;}
dest.removeAttribute(jQuery.expando);}
jQuery.buildFragment=function(args,context,scripts){var fragment,cacheable,cachehit,first=args[0];context=context||document;context=!context.nodeType&&context[0]||context;context=context.ownerDocument||context;if(args.length===1&&typeof first==="string"&&first.length<512&&context===document&&first.charAt(0)==="<"&&!rnocache.test(first)&&(jQuery.support.checkClone||!rchecked.test(first))&&(jQuery.support.html5Clone||!rnoshimcache.test(first))){cacheable=true;fragment=jQuery.fragments[first];cachehit=fragment!==undefined;}
if(!fragment){fragment=context.createDocumentFragment();jQuery.clean(args,context,fragment,scripts);if(cacheable){jQuery.fragments[first]=cachehit&&fragment;}}
return{fragment:fragment,cacheable:cacheable};};jQuery.fragments={};jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){var elems,i=0,ret=[],insert=jQuery(selector),l=insert.length,parent=this.length===1&&this[0].parentNode;if((parent==null||parent&&parent.nodeType===11&&parent.childNodes.length===1)&&l===1){insert[original](this[0]);return this;}else{for(;i<l;i++){elems=(i>0?this.clone(true):this).get();jQuery(insert[i])[original](elems);ret=ret.concat(elems);}
return this.pushStack(ret,name,insert.selector);}};});function getAll(elem){if(typeof elem.getElementsByTagName!=="undefined"){return elem.getElementsByTagName("*");}else if(typeof elem.querySelectorAll!=="undefined"){return elem.querySelectorAll("*");}else{return[];}}
function fixDefaultChecked(elem){if(rcheckableType.test(elem.type)){elem.defaultChecked=elem.checked;}}
jQuery.extend({clone:function(elem,dataAndEvents,deepDataAndEvents){var srcElements,destElements,i,clone;if(jQuery.support.html5Clone||jQuery.isXMLDoc(elem)||!rnoshimcache.test("<"+elem.nodeName+">")){clone=elem.cloneNode(true);}else{fragmentDiv.innerHTML=elem.outerHTML;fragmentDiv.removeChild(clone=fragmentDiv.firstChild);}
if((!jQuery.support.noCloneEvent||!jQuery.support.noCloneChecked)&&(elem.nodeType===1||elem.nodeType===11)&&!jQuery.isXMLDoc(elem)){cloneFixAttributes(elem,clone);srcElements=getAll(elem);destElements=getAll(clone);for(i=0;srcElements[i];++i){if(destElements[i]){cloneFixAttributes(srcElements[i],destElements[i]);}}}
if(dataAndEvents){cloneCopyEvent(elem,clone);if(deepDataAndEvents){srcElements=getAll(elem);destElements=getAll(clone);for(i=0;srcElements[i];++i){cloneCopyEvent(srcElements[i],destElements[i]);}}}
srcElements=destElements=null;return clone;},clean:function(elems,context,fragment,scripts){var i,j,elem,tag,wrap,depth,div,hasBody,tbody,len,handleScript,jsTags,safe=context===document&&safeFragment,ret=[];if(!context||typeof context.createDocumentFragment==="undefined"){context=document;}
for(i=0;(elem=elems[i])!=null;i++){if(typeof elem==="number"){elem+="";}
if(!elem){continue;}
if(typeof elem==="string"){if(!rhtml.test(elem)){elem=context.createTextNode(elem);}else{safe=safe||createSafeFragment(context);div=context.createElement("div");safe.appendChild(div);elem=elem.replace(rxhtmlTag,"<$1></$2>");tag=(rtagName.exec(elem)||["",""])[1].toLowerCase();wrap=wrapMap[tag]||wrapMap._default;depth=wrap[0];div.innerHTML=wrap[1]+elem+wrap[2];while(depth--){div=div.lastChild;}
if(!jQuery.support.tbody){hasBody=rtbody.test(elem);tbody=tag==="table"&&!hasBody?div.firstChild&&div.firstChild.childNodes:wrap[1]==="<table>"&&!hasBody?div.childNodes:[];for(j=tbody.length-1;j>=0;--j){if(jQuery.nodeName(tbody[j],"tbody")&&!tbody[j].childNodes.length){tbody[j].parentNode.removeChild(tbody[j]);}}}
if(!jQuery.support.leadingWhitespace&&rleadingWhitespace.test(elem)){div.insertBefore(context.createTextNode(rleadingWhitespace.exec(elem)[0]),div.firstChild);}
elem=div.childNodes;div.parentNode.removeChild(div);}}
if(elem.nodeType){ret.push(elem);}else{jQuery.merge(ret,elem);}}
if(div){elem=div=safe=null;}
if(!jQuery.support.appendChecked){for(i=0;(elem=ret[i])!=null;i++){if(jQuery.nodeName(elem,"input")){fixDefaultChecked(elem);}else if(typeof elem.getElementsByTagName!=="undefined"){jQuery.grep(elem.getElementsByTagName("input"),fixDefaultChecked);}}}
if(fragment){handleScript=function(elem){if(!elem.type||rscriptType.test(elem.type)){return scripts?scripts.push(elem.parentNode?elem.parentNode.removeChild(elem):elem):fragment.appendChild(elem);}};for(i=0;(elem=ret[i])!=null;i++){if(!(jQuery.nodeName(elem,"script")&&handleScript(elem))){fragment.appendChild(elem);if(typeof elem.getElementsByTagName!=="undefined"){jsTags=jQuery.grep(jQuery.merge([],elem.getElementsByTagName("script")),handleScript);ret.splice.apply(ret,[i+1,0].concat(jsTags));i+=jsTags.length;}}}}
return ret;},cleanData:function(elems,acceptData){var data,id,elem,type,i=0,internalKey=jQuery.expando,cache=jQuery.cache,deleteExpando=jQuery.support.deleteExpando,special=jQuery.event.special;for(;(elem=elems[i])!=null;i++){if(acceptData||jQuery.acceptData(elem)){id=elem[internalKey];data=id&&cache[id];if(data){if(data.events){for(type in data.events){if(special[type]){jQuery.event.remove(elem,type);}else{jQuery.removeEvent(elem,type,data.handle);}}}
if(cache[id]){delete cache[id];if(deleteExpando){delete elem[internalKey];}else if(elem.removeAttribute){elem.removeAttribute(internalKey);}else{elem[internalKey]=null;}
jQuery.deletedIds.push(id);}}}}}});(function(){var matched,browser;jQuery.uaMatch=function(ua){ua=ua.toLowerCase();var match=/(chrome)[ \/]([\w.]+)/.exec(ua)||/(webkit)[ \/]([\w.]+)/.exec(ua)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(ua)||/(msie) ([\w.]+)/.exec(ua)||ua.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(ua)||[];return{browser:match[1]||"",version:match[2]||"0"};};matched=jQuery.uaMatch(navigator.userAgent);browser={};if(matched.browser){browser[matched.browser]=true;browser.version=matched.version;}
if(browser.chrome){browser.webkit=true;}else if(browser.webkit){browser.safari=true;}
jQuery.browser=browser;jQuery.sub=function(){function jQuerySub(selector,context){return new jQuerySub.fn.init(selector,context);}
jQuery.extend(true,jQuerySub,this);jQuerySub.superclass=this;jQuerySub.fn=jQuerySub.prototype=this();jQuerySub.fn.constructor=jQuerySub;jQuerySub.sub=this.sub;jQuerySub.fn.init=function init(selector,context){if(context&&context instanceof jQuery&&!(context instanceof jQuerySub)){context=jQuerySub(context);}
return jQuery.fn.init.call(this,selector,context,rootjQuerySub);};jQuerySub.fn.init.prototype=jQuerySub.fn;var rootjQuerySub=jQuerySub(document);return jQuerySub;};})();var curCSS,iframe,iframeDoc,ralpha=/alpha\([^)]*\)/i,ropacity=/opacity=([^)]*)/,rposition=/^(top|right|bottom|left)$/,rdisplayswap=/^(none|table(?!-c[ea]).+)/,rmargin=/^margin/,rnumsplit=new RegExp("^("+core_pnum+")(.*)$","i"),rnumnonpx=new RegExp("^("+core_pnum+")(?!px)[a-z%]+$","i"),rrelNum=new RegExp("^([-+])=("+core_pnum+")","i"),elemdisplay={},cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:0,fontWeight:400},cssExpand=["Top","Right","Bottom","Left"],cssPrefixes=["Webkit","O","Moz","ms"],eventsToggle=jQuery.fn.toggle;function vendorPropName(style,name){if(name in style){return name;}
var capName=name.charAt(0).toUpperCase()+name.slice(1),origName=name,i=cssPrefixes.length;while(i--){name=cssPrefixes[i]+capName;if(name in style){return name;}}
return origName;}
function isHidden(elem,el){elem=el||elem;return jQuery.css(elem,"display")==="none"||!jQuery.contains(elem.ownerDocument,elem);}
function showHide(elements,show){var elem,display,values=[],index=0,length=elements.length;for(;index<length;index++){elem=elements[index];if(!elem.style){continue;}
values[index]=jQuery._data(elem,"olddisplay");if(show){if(!values[index]&&elem.style.display==="none"){elem.style.display="";}
if(elem.style.display===""&&isHidden(elem)){values[index]=jQuery._data(elem,"olddisplay",css_defaultDisplay(elem.nodeName));}}else{display=curCSS(elem,"display");if(!values[index]&&display!=="none"){jQuery._data(elem,"olddisplay",display);}}}
for(index=0;index<length;index++){elem=elements[index];if(!elem.style){continue;}
if(!show||elem.style.display==="none"||elem.style.display===""){elem.style.display=show?values[index]||"":"none";}}
return elements;}
jQuery.fn.extend({css:function(name,value){return jQuery.access(this,function(elem,name,value){return value!==undefined?jQuery.style(elem,name,value):jQuery.css(elem,name);},name,value,arguments.length>1);},show:function(){return showHide(this,true);},hide:function(){return showHide(this);},toggle:function(state,fn2){var bool=typeof state==="boolean";if(jQuery.isFunction(state)&&jQuery.isFunction(fn2)){return eventsToggle.apply(this,arguments);}
return this.each(function(){if(bool?state:isHidden(this)){jQuery(this).show();}else{jQuery(this).hide();}});}});jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity");return ret===""?"1":ret;}}}},cssNumber:{"fillOpacity":true,"fontWeight":true,"lineHeight":true,"opacity":true,"orphans":true,"widows":true,"zIndex":true,"zoom":true},cssProps:{"float":jQuery.support.cssFloat?"cssFloat":"styleFloat"},style:function(elem,name,value,extra){if(!elem||elem.nodeType===3||elem.nodeType===8||!elem.style){return;}
var ret,type,hooks,origName=jQuery.camelCase(name),style=elem.style;name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(style,origName));hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(value!==undefined){type=typeof value;if(type==="string"&&(ret=rrelNum.exec(value))){value=(ret[1]+1)*ret[2]+parseFloat(jQuery.css(elem,name));type="number";}
if(value==null||type==="number"&&isNaN(value)){return;}
if(type==="number"&&!jQuery.cssNumber[origName]){value+="px";}
if(!hooks||!("set"in hooks)||(value=hooks.set(elem,value,extra))!==undefined){try{style[name]=value;}catch(e){}}}else{if(hooks&&"get"in hooks&&(ret=hooks.get(elem,false,extra))!==undefined){return ret;}
return style[name];}},css:function(elem,name,numeric,extra){var val,num,hooks,origName=jQuery.camelCase(name);name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(elem.style,origName));hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(hooks&&"get"in hooks){val=hooks.get(elem,true,extra);}
if(val===undefined){val=curCSS(elem,name);}
if(val==="normal"&&name in cssNormalTransform){val=cssNormalTransform[name];}
if(numeric||extra!==undefined){num=parseFloat(val);return numeric||jQuery.isNumeric(num)?num||0:val;}
return val;},swap:function(elem,options,callback){var ret,name,old={};for(name in options){old[name]=elem.style[name];elem.style[name]=options[name];}
ret=callback.call(elem);for(name in options){elem.style[name]=old[name];}
return ret;}});if(window.getComputedStyle){curCSS=function(elem,name){var ret,width,minWidth,maxWidth,computed=window.getComputedStyle(elem,null),style=elem.style;if(computed){ret=computed[name];if(ret===""&&!jQuery.contains(elem.ownerDocument,elem)){ret=jQuery.style(elem,name);}
if(rnumnonpx.test(ret)&&rmargin.test(name)){width=style.width;minWidth=style.minWidth;maxWidth=style.maxWidth;style.minWidth=style.maxWidth=style.width=ret;ret=computed.width;style.width=width;style.minWidth=minWidth;style.maxWidth=maxWidth;}}
return ret;};}else if(document.documentElement.currentStyle){curCSS=function(elem,name){var left,rsLeft,ret=elem.currentStyle&&elem.currentStyle[name],style=elem.style;if(ret==null&&style&&style[name]){ret=style[name];}
if(rnumnonpx.test(ret)&&!rposition.test(name)){left=style.left;rsLeft=elem.runtimeStyle&&elem.runtimeStyle.left;if(rsLeft){elem.runtimeStyle.left=elem.currentStyle.left;}
style.left=name==="fontSize"?"1em":ret;ret=style.pixelLeft+"px";style.left=left;if(rsLeft){elem.runtimeStyle.left=rsLeft;}}
return ret===""?"auto":ret;};}
function setPositiveNumber(elem,value,subtract){var matches=rnumsplit.exec(value);return matches?Math.max(0,matches[1]-(subtract||0))+(matches[2]||"px"):value;}
function augmentWidthOrHeight(elem,name,extra,isBorderBox){var i=extra===(isBorderBox?"border":"content")?4:name==="width"?1:0,val=0;for(;i<4;i+=2){if(extra==="margin"){val+=jQuery.css(elem,extra+cssExpand[i],true);}
if(isBorderBox){if(extra==="content"){val-=parseFloat(curCSS(elem,"padding"+cssExpand[i]))||0;}
if(extra!=="margin"){val-=parseFloat(curCSS(elem,"border"+cssExpand[i]+"Width"))||0;}}else{val+=parseFloat(curCSS(elem,"padding"+cssExpand[i]))||0;if(extra!=="padding"){val+=parseFloat(curCSS(elem,"border"+cssExpand[i]+"Width"))||0;}}}
return val;}
function getWidthOrHeight(elem,name,extra){var val=name==="width"?elem.offsetWidth:elem.offsetHeight,valueIsBorderBox=true,isBorderBox=jQuery.support.boxSizing&&jQuery.css(elem,"boxSizing")==="border-box";if(val<=0||val==null){val=curCSS(elem,name);if(val<0||val==null){val=elem.style[name];}
if(rnumnonpx.test(val)){return val;}
valueIsBorderBox=isBorderBox&&(jQuery.support.boxSizingReliable||val===elem.style[name]);val=parseFloat(val)||0;}
return(val+
augmentWidthOrHeight(elem,name,extra||(isBorderBox?"border":"content"),valueIsBorderBox))+"px";}
function css_defaultDisplay(nodeName){if(elemdisplay[nodeName]){return elemdisplay[nodeName];}
var elem=jQuery("<"+nodeName+">").appendTo(document.body),display=elem.css("display");elem.remove();if(display==="none"||display===""){iframe=document.body.appendChild(iframe||jQuery.extend(document.createElement("iframe"),{frameBorder:0,width:0,height:0}));if(!iframeDoc||!iframe.createElement){iframeDoc=(iframe.contentWindow||iframe.contentDocument).document;iframeDoc.write("<!doctype html><html><body>");iframeDoc.close();}
elem=iframeDoc.body.appendChild(iframeDoc.createElement(nodeName));display=curCSS(elem,"display");document.body.removeChild(iframe);}
elemdisplay[nodeName]=display;return display;}
jQuery.each(["height","width"],function(i,name){jQuery.cssHooks[name]={get:function(elem,computed,extra){if(computed){if(elem.offsetWidth===0&&rdisplayswap.test(curCSS(elem,"display"))){return jQuery.swap(elem,cssShow,function(){return getWidthOrHeight(elem,name,extra);});}else{return getWidthOrHeight(elem,name,extra);}}},set:function(elem,value,extra){return setPositiveNumber(elem,value,extra?augmentWidthOrHeight(elem,name,extra,jQuery.support.boxSizing&&jQuery.css(elem,"boxSizing")==="border-box"):0);}};});if(!jQuery.support.opacity){jQuery.cssHooks.opacity={get:function(elem,computed){return ropacity.test((computed&&elem.currentStyle?elem.currentStyle.filter:elem.style.filter)||"")?(0.01*parseFloat(RegExp.$1))+"":computed?"1":"";},set:function(elem,value){var style=elem.style,currentStyle=elem.currentStyle,opacity=jQuery.isNumeric(value)?"alpha(opacity="+value*100+")":"",filter=currentStyle&&currentStyle.filter||style.filter||"";style.zoom=1;if(value>=1&&jQuery.trim(filter.replace(ralpha,""))===""&&style.removeAttribute){style.removeAttribute("filter");if(currentStyle&&!currentStyle.filter){return;}}
style.filter=ralpha.test(filter)?filter.replace(ralpha,opacity):filter+" "+opacity;}};}
jQuery(function(){if(!jQuery.support.reliableMarginRight){jQuery.cssHooks.marginRight={get:function(elem,computed){return jQuery.swap(elem,{"display":"inline-block"},function(){if(computed){return curCSS(elem,"marginRight");}});}};}
if(!jQuery.support.pixelPosition&&jQuery.fn.position){jQuery.each(["top","left"],function(i,prop){jQuery.cssHooks[prop]={get:function(elem,computed){if(computed){var ret=curCSS(elem,prop);return rnumnonpx.test(ret)?jQuery(elem).position()[prop]+"px":ret;}}};});}});if(jQuery.expr&&jQuery.expr.filters){jQuery.expr.filters.hidden=function(elem){return(elem.offsetWidth===0&&elem.offsetHeight===0)||(!jQuery.support.reliableHiddenOffsets&&((elem.style&&elem.style.display)||curCSS(elem,"display"))==="none");};jQuery.expr.filters.visible=function(elem){return!jQuery.expr.filters.hidden(elem);};}
jQuery.each({margin:"",padding:"",border:"Width"},function(prefix,suffix){jQuery.cssHooks[prefix+suffix]={expand:function(value){var i,parts=typeof value==="string"?value.split(" "):[value],expanded={};for(i=0;i<4;i++){expanded[prefix+cssExpand[i]+suffix]=parts[i]||parts[i-2]||parts[0];}
return expanded;}};if(!rmargin.test(prefix)){jQuery.cssHooks[prefix+suffix].set=setPositiveNumber;}});var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rinput=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,rselectTextarea=/^(?:select|textarea)/i;jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray());},serializeArray:function(){return this.map(function(){return this.elements?jQuery.makeArray(this.elements):this;}).filter(function(){return this.name&&!this.disabled&&(this.checked||rselectTextarea.test(this.nodeName)||rinput.test(this.type));}).map(function(i,elem){var val=jQuery(this).val();return val==null?null:jQuery.isArray(val)?jQuery.map(val,function(val,i){return{name:elem.name,value:val.replace(rCRLF,"\r\n")};}):{name:elem.name,value:val.replace(rCRLF,"\r\n")};}).get();}});jQuery.param=function(a,traditional){var prefix,s=[],add=function(key,value){value=jQuery.isFunction(value)?value():(value==null?"":value);s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(value);};if(traditional===undefined){traditional=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional;}
if(jQuery.isArray(a)||(a.jquery&&!jQuery.isPlainObject(a))){jQuery.each(a,function(){add(this.name,this.value);});}else{for(prefix in a){buildParams(prefix,a[prefix],traditional,add);}}
return s.join("&").replace(r20,"+");};function buildParams(prefix,obj,traditional,add){var name;if(jQuery.isArray(obj)){jQuery.each(obj,function(i,v){if(traditional||rbracket.test(prefix)){add(prefix,v);}else{buildParams(prefix+"["+(typeof v==="object"?i:"")+"]",v,traditional,add);}});}else if(!traditional&&jQuery.type(obj)==="object"){for(name in obj){buildParams(prefix+"["+name+"]",obj[name],traditional,add);}}else{add(prefix,obj);}}
var
ajaxLocParts,ajaxLocation,rhash=/#.*$/,rheaders=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,rlocalProtocol=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rquery=/\?/,rscript=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,rts=/([?&])_=[^&]*/,rurl=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,_load=jQuery.fn.load,prefilters={},transports={},allTypes=["*/"]+["*"];try{ajaxLocation=location.href;}catch(e){ajaxLocation=document.createElement("a");ajaxLocation.href="";ajaxLocation=ajaxLocation.href;}
ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[];function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){if(typeof dataTypeExpression!=="string"){func=dataTypeExpression;dataTypeExpression="*";}
var dataType,list,placeBefore,dataTypes=dataTypeExpression.toLowerCase().split(core_rspace),i=0,length=dataTypes.length;if(jQuery.isFunction(func)){for(;i<length;i++){dataType=dataTypes[i];placeBefore=/^\+/.test(dataType);if(placeBefore){dataType=dataType.substr(1)||"*";}
list=structure[dataType]=structure[dataType]||[];list[placeBefore?"unshift":"push"](func);}}};}
function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR,dataType,inspected){dataType=dataType||options.dataTypes[0];inspected=inspected||{};inspected[dataType]=true;var selection,list=structure[dataType],i=0,length=list?list.length:0,executeOnly=(structure===prefilters);for(;i<length&&(executeOnly||!selection);i++){selection=list[i](options,originalOptions,jqXHR);if(typeof selection==="string"){if(!executeOnly||inspected[selection]){selection=undefined;}else{options.dataTypes.unshift(selection);selection=inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR,selection,inspected);}}}
if((executeOnly||!selection)&&!inspected["*"]){selection=inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR,"*",inspected);}
return selection;}
function ajaxExtend(target,src){var key,deep,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src){if(src[key]!==undefined){(flatOptions[key]?target:(deep||(deep={})))[key]=src[key];}}
if(deep){jQuery.extend(true,target,deep);}}
jQuery.fn.load=function(url,params,callback){if(typeof url!=="string"&&_load){return _load.apply(this,arguments);}
if(!this.length){return this;}
var selector,type,response,self=this,off=url.indexOf(" ");if(off>=0){selector=url.slice(off,url.length);url=url.slice(0,off);}
if(jQuery.isFunction(params)){callback=params;params=undefined;}else if(params&&typeof params==="object"){type="POST";}
jQuery.ajax({url:url,type:type,dataType:"html",data:params,complete:function(jqXHR,status){if(callback){self.each(callback,response||[jqXHR.responseText,status,jqXHR]);}}}).done(function(responseText){response=arguments;self.html(selector?jQuery("<div>").append(responseText.replace(rscript,"")).find(selector):responseText);});return this;};jQuery.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(i,o){jQuery.fn[o]=function(f){return this.on(o,f);};});jQuery.each(["get","post"],function(i,method){jQuery[method]=function(url,data,callback,type){if(jQuery.isFunction(data)){type=type||callback;callback=data;data=undefined;}
return jQuery.ajax({type:method,url:url,data:data,success:callback,dataType:type});};});jQuery.extend({getScript:function(url,callback){return jQuery.get(url,undefined,callback,"script");},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json");},ajaxSetup:function(target,settings){if(settings){ajaxExtend(target,jQuery.ajaxSettings);}else{settings=target;target=jQuery.ajaxSettings;}
ajaxExtend(target,settings);return target;},ajaxSettings:{url:ajaxLocation,isLocal:rlocalProtocol.test(ajaxLocParts[1]),global:true,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:true,async:true,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":allTypes},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":window.String,"text html":true,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{context:true,url:true}},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){if(typeof url==="object"){options=url;url=undefined;}
options=options||{};var
ifModifiedKey,responseHeadersString,responseHeaders,transport,timeoutTimer,parts,fireGlobals,i,s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=callbackContext!==s&&(callbackContext.nodeType||callbackContext instanceof jQuery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks("once memory"),statusCode=s.statusCode||{},requestHeaders={},requestHeadersNames={},state=0,strAbort="canceled",jqXHR={readyState:0,setRequestHeader:function(name,value){if(!state){var lname=name.toLowerCase();name=requestHeadersNames[lname]=requestHeadersNames[lname]||name;requestHeaders[name]=value;}
return this;},getAllResponseHeaders:function(){return state===2?responseHeadersString:null;},getResponseHeader:function(key){var match;if(state===2){if(!responseHeaders){responseHeaders={};while((match=rheaders.exec(responseHeadersString))){responseHeaders[match[1].toLowerCase()]=match[2];}}
match=responseHeaders[key.toLowerCase()];}
return match===undefined?null:match;},overrideMimeType:function(type){if(!state){s.mimeType=type;}
return this;},abort:function(statusText){statusText=statusText||strAbort;if(transport){transport.abort(statusText);}
done(0,statusText);return this;}};function done(status,nativeStatusText,responses,headers){var isSuccess,success,error,response,modified,statusText=nativeStatusText;if(state===2){return;}
state=2;if(timeoutTimer){clearTimeout(timeoutTimer);}
transport=undefined;responseHeadersString=headers||"";jqXHR.readyState=status>0?4:0;if(responses){response=ajaxHandleResponses(s,jqXHR,responses);}
if(status>=200&&status<300||status===304){if(s.ifModified){modified=jqXHR.getResponseHeader("Last-Modified");if(modified){jQuery.lastModified[ifModifiedKey]=modified;}
modified=jqXHR.getResponseHeader("Etag");if(modified){jQuery.etag[ifModifiedKey]=modified;}}
if(status===304){statusText="notmodified";isSuccess=true;}else{isSuccess=ajaxConvert(s,response);statusText=isSuccess.state;success=isSuccess.data;error=isSuccess.error;isSuccess=!error;}}else{error=statusText;if(!statusText||status){statusText="error";if(status<0){status=0;}}}
jqXHR.status=status;jqXHR.statusText=(nativeStatusText||statusText)+"";if(isSuccess){deferred.resolveWith(callbackContext,[success,statusText,jqXHR]);}else{deferred.rejectWith(callbackContext,[jqXHR,statusText,error]);}
jqXHR.statusCode(statusCode);statusCode=undefined;if(fireGlobals){globalEventContext.trigger("ajax"+(isSuccess?"Success":"Error"),[jqXHR,s,isSuccess?success:error]);}
completeDeferred.fireWith(callbackContext,[jqXHR,statusText]);if(fireGlobals){globalEventContext.trigger("ajaxComplete",[jqXHR,s]);if(!(--jQuery.active)){jQuery.event.trigger("ajaxStop");}}}
deferred.promise(jqXHR);jqXHR.success=jqXHR.done;jqXHR.error=jqXHR.fail;jqXHR.complete=completeDeferred.add;jqXHR.statusCode=function(map){if(map){var tmp;if(state<2){for(tmp in map){statusCode[tmp]=[statusCode[tmp],map[tmp]];}}else{tmp=map[jqXHR.status];jqXHR.always(tmp);}}
return this;};s.url=((url||s.url)+"").replace(rhash,"").replace(rprotocol,ajaxLocParts[1]+"//");s.dataTypes=jQuery.trim(s.dataType||"*").toLowerCase().split(core_rspace);if(s.crossDomain==null){parts=rurl.exec(s.url.toLowerCase())||false;s.crossDomain=parts&&(parts.join(":")+(parts[3]?"":parts[1]==="http:"?80:443))!==(ajaxLocParts.join(":")+(ajaxLocParts[3]?"":ajaxLocParts[1]==="http:"?80:443));}
if(s.data&&s.processData&&typeof s.data!=="string"){s.data=jQuery.param(s.data,s.traditional);}
inspectPrefiltersOrTransports(prefilters,s,options,jqXHR);if(state===2){return jqXHR;}
fireGlobals=s.global;s.type=s.type.toUpperCase();s.hasContent=!rnoContent.test(s.type);if(fireGlobals&&jQuery.active++===0){jQuery.event.trigger("ajaxStart");}
if(!s.hasContent){if(s.data){s.url+=(rquery.test(s.url)?"&":"?")+s.data;delete s.data;}
ifModifiedKey=s.url;if(s.cache===false){var ts=jQuery.now(),ret=s.url.replace(rts,"$1_="+ts);s.url=ret+((ret===s.url)?(rquery.test(s.url)?"&":"?")+"_="+ts:"");}}
if(s.data&&s.hasContent&&s.contentType!==false||options.contentType){jqXHR.setRequestHeader("Content-Type",s.contentType);}
if(s.ifModified){ifModifiedKey=ifModifiedKey||s.url;if(jQuery.lastModified[ifModifiedKey]){jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[ifModifiedKey]);}
if(jQuery.etag[ifModifiedKey]){jqXHR.setRequestHeader("If-None-Match",jQuery.etag[ifModifiedKey]);}}
jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+(s.dataTypes[0]!=="*"?", "+allTypes+"; q=0.01":""):s.accepts["*"]);for(i in s.headers){jqXHR.setRequestHeader(i,s.headers[i]);}
if(s.beforeSend&&(s.beforeSend.call(callbackContext,jqXHR,s)===false||state===2)){return jqXHR.abort();}
strAbort="abort";for(i in{success:1,error:1,complete:1}){jqXHR[i](s[i]);}
transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR);if(!transport){done(-1,"No Transport");}else{jqXHR.readyState=1;if(fireGlobals){globalEventContext.trigger("ajaxSend",[jqXHR,s]);}
if(s.async&&s.timeout>0){timeoutTimer=setTimeout(function(){jqXHR.abort("timeout");},s.timeout);}
try{state=1;transport.send(requestHeaders,done);}catch(e){if(state<2){done(-1,e);}else{throw e;}}}
return jqXHR;},active:0,lastModified:{},etag:{}});function ajaxHandleResponses(s,jqXHR,responses){var ct,type,finalDataType,firstDataType,contents=s.contents,dataTypes=s.dataTypes,responseFields=s.responseFields;for(type in responseFields){if(type in responses){jqXHR[responseFields[type]]=responses[type];}}
while(dataTypes[0]==="*"){dataTypes.shift();if(ct===undefined){ct=s.mimeType||jqXHR.getResponseHeader("content-type");}}
if(ct){for(type in contents){if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break;}}}
if(dataTypes[0]in responses){finalDataType=dataTypes[0];}else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break;}
if(!firstDataType){firstDataType=type;}}
finalDataType=finalDataType||firstDataType;}
if(finalDataType){if(finalDataType!==dataTypes[0]){dataTypes.unshift(finalDataType);}
return responses[finalDataType];}}
function ajaxConvert(s,response){var conv,conv2,current,tmp,dataTypes=s.dataTypes.slice(),prev=dataTypes[0],converters={},i=0;if(s.dataFilter){response=s.dataFilter(response,s.dataType);}
if(dataTypes[1]){for(conv in s.converters){converters[conv.toLowerCase()]=s.converters[conv];}}
for(;(current=dataTypes[++i]);){if(current!=="*"){if(prev!=="*"&&prev!==current){conv=converters[prev+" "+current]||converters["* "+current];if(!conv){for(conv2 in converters){tmp=conv2.split(" ");if(tmp[1]===current){conv=converters[prev+" "+tmp[0]]||converters["* "+tmp[0]];if(conv){if(conv===true){conv=converters[conv2];}else if(converters[conv2]!==true){current=tmp[0];dataTypes.splice(i--,0,current);}
break;}}}}
if(conv!==true){if(conv&&s["throws"]){response=conv(response);}else{try{response=conv(response);}catch(e){return{state:"parsererror",error:conv?e:"No conversion from "+prev+" to "+current};}}}}
prev=current;}}
return{state:"success",data:response};}
var oldCallbacks=[],rquestion=/\?/,rjsonp=/(=)\?(?=&|$)|\?\?/,nonce=jQuery.now();jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var callback=oldCallbacks.pop()||(jQuery.expando+"_"+(nonce++));this[callback]=true;return callback;}});jQuery.ajaxPrefilter("json jsonp",function(s,originalSettings,jqXHR){var callbackName,overwritten,responseContainer,data=s.data,url=s.url,hasCallback=s.jsonp!==false,replaceInUrl=hasCallback&&rjsonp.test(url),replaceInData=hasCallback&&!replaceInUrl&&typeof data==="string"&&!(s.contentType||"").indexOf("application/x-www-form-urlencoded")&&rjsonp.test(data);if(s.dataTypes[0]==="jsonp"||replaceInUrl||replaceInData){callbackName=s.jsonpCallback=jQuery.isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback;overwritten=window[callbackName];if(replaceInUrl){s.url=url.replace(rjsonp,"$1"+callbackName);}else if(replaceInData){s.data=data.replace(rjsonp,"$1"+callbackName);}else if(hasCallback){s.url+=(rquestion.test(url)?"&":"?")+s.jsonp+"="+callbackName;}
s.converters["script json"]=function(){if(!responseContainer){jQuery.error(callbackName+" was not called");}
return responseContainer[0];};s.dataTypes[0]="json";window[callbackName]=function(){responseContainer=arguments;};jqXHR.always(function(){window[callbackName]=overwritten;if(s[callbackName]){s.jsonpCallback=originalSettings.jsonpCallback;oldCallbacks.push(callbackName);}
if(responseContainer&&jQuery.isFunction(overwritten)){overwritten(responseContainer[0]);}
responseContainer=overwritten=undefined;});return"script";}});jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(text){jQuery.globalEval(text);return text;}}});jQuery.ajaxPrefilter("script",function(s){if(s.cache===undefined){s.cache=false;}
if(s.crossDomain){s.type="GET";s.global=false;}});jQuery.ajaxTransport("script",function(s){if(s.crossDomain){var script,head=document.head||document.getElementsByTagName("head")[0]||document.documentElement;return{send:function(_,callback){script=document.createElement("script");script.async="async";if(s.scriptCharset){script.charset=s.scriptCharset;}
script.src=s.url;script.onload=script.onreadystatechange=function(_,isAbort){if(isAbort||!script.readyState||/loaded|complete/.test(script.readyState)){script.onload=script.onreadystatechange=null;if(head&&script.parentNode){head.removeChild(script);}
script=undefined;if(!isAbort){callback(200,"success");}}};head.insertBefore(script,head.firstChild);},abort:function(){if(script){script.onload(0,1);}}};}});var xhrCallbacks,xhrOnUnloadAbort=window.ActiveXObject?function(){for(var key in xhrCallbacks){xhrCallbacks[key](0,1);}}:false,xhrId=0;function createStandardXHR(){try{return new window.XMLHttpRequest();}catch(e){}}
function createActiveXHR(){try{return new window.ActiveXObject("Microsoft.XMLHTTP");}catch(e){}}
jQuery.ajaxSettings.xhr=window.ActiveXObject?function(){return!this.isLocal&&createStandardXHR()||createActiveXHR();}:createStandardXHR;(function(xhr){jQuery.extend(jQuery.support,{ajax:!!xhr,cors:!!xhr&&("withCredentials"in xhr)});})(jQuery.ajaxSettings.xhr());if(jQuery.support.ajax){jQuery.ajaxTransport(function(s){if(!s.crossDomain||jQuery.support.cors){var callback;return{send:function(headers,complete){var handle,i,xhr=s.xhr();if(s.username){xhr.open(s.type,s.url,s.async,s.username,s.password);}else{xhr.open(s.type,s.url,s.async);}
if(s.xhrFields){for(i in s.xhrFields){xhr[i]=s.xhrFields[i];}}
if(s.mimeType&&xhr.overrideMimeType){xhr.overrideMimeType(s.mimeType);}
if(!s.crossDomain&&!headers["X-Requested-With"]){headers["X-Requested-With"]="XMLHttpRequest";}
try{for(i in headers){xhr.setRequestHeader(i,headers[i]);}}catch(_){}
xhr.send((s.hasContent&&s.data)||null);callback=function(_,isAbort){var status,statusText,responseHeaders,responses,xml;try{if(callback&&(isAbort||xhr.readyState===4)){callback=undefined;if(handle){xhr.onreadystatechange=jQuery.noop;if(xhrOnUnloadAbort){delete xhrCallbacks[handle];}}
if(isAbort){if(xhr.readyState!==4){xhr.abort();}}else{status=xhr.status;responseHeaders=xhr.getAllResponseHeaders();responses={};xml=xhr.responseXML;if(xml&&xml.documentElement){responses.xml=xml;}
try{responses.text=xhr.responseText;}catch(_){}
try{statusText=xhr.statusText;}catch(e){statusText="";}
if(!status&&s.isLocal&&!s.crossDomain){status=responses.text?200:404;}else if(status===1223){status=204;}}}}catch(firefoxAccessException){if(!isAbort){complete(-1,firefoxAccessException);}}
if(responses){complete(status,statusText,responses,responseHeaders);}};if(!s.async){callback();}else if(xhr.readyState===4){setTimeout(callback,0);}else{handle=++xhrId;if(xhrOnUnloadAbort){if(!xhrCallbacks){xhrCallbacks={};jQuery(window).unload(xhrOnUnloadAbort);}
xhrCallbacks[handle]=callback;}
xhr.onreadystatechange=callback;}},abort:function(){if(callback){callback(0,1);}}};}});}
var fxNow,timerId,rfxtypes=/^(?:toggle|show|hide)$/,rfxnum=new RegExp("^(?:([-+])=|)("+core_pnum+")([a-z%]*)$","i"),rrun=/queueHooks$/,animationPrefilters=[defaultPrefilter],tweeners={"*":[function(prop,value){var end,unit,tween=this.createTween(prop,value),parts=rfxnum.exec(value),target=tween.cur(),start=+target||0,scale=1,maxIterations=20;if(parts){end=+parts[2];unit=parts[3]||(jQuery.cssNumber[prop]?"":"px");if(unit!=="px"&&start){start=jQuery.css(tween.elem,prop,true)||end||1;do{scale=scale||".5";start=start/scale;jQuery.style(tween.elem,prop,start+unit);}while(scale!==(scale=tween.cur()/target)&&scale!==1&&--maxIterations);}
tween.unit=unit;tween.start=start;tween.end=parts[1]?start+(parts[1]+1)*end:end;}
return tween;}]};function createFxNow(){setTimeout(function(){fxNow=undefined;},0);return(fxNow=jQuery.now());}
function createTweens(animation,props){jQuery.each(props,function(prop,value){var collection=(tweeners[prop]||[]).concat(tweeners["*"]),index=0,length=collection.length;for(;index<length;index++){if(collection[index].call(animation,prop,value)){return;}}});}
function Animation(elem,properties,options){var result,index=0,tweenerIndex=0,length=animationPrefilters.length,deferred=jQuery.Deferred().always(function(){delete tick.elem;}),tick=function(){var currentTime=fxNow||createFxNow(),remaining=Math.max(0,animation.startTime+animation.duration-currentTime),percent=1-(remaining/animation.duration||0),index=0,length=animation.tweens.length;for(;index<length;index++){animation.tweens[index].run(percent);}
deferred.notifyWith(elem,[animation,percent,remaining]);if(percent<1&&length){return remaining;}else{deferred.resolveWith(elem,[animation]);return false;}},animation=deferred.promise({elem:elem,props:jQuery.extend({},properties),opts:jQuery.extend(true,{specialEasing:{}},options),originalProperties:properties,originalOptions:options,startTime:fxNow||createFxNow(),duration:options.duration,tweens:[],createTween:function(prop,end,easing){var tween=jQuery.Tween(elem,animation.opts,prop,end,animation.opts.specialEasing[prop]||animation.opts.easing);animation.tweens.push(tween);return tween;},stop:function(gotoEnd){var index=0,length=gotoEnd?animation.tweens.length:0;for(;index<length;index++){animation.tweens[index].run(1);}
if(gotoEnd){deferred.resolveWith(elem,[animation,gotoEnd]);}else{deferred.rejectWith(elem,[animation,gotoEnd]);}
return this;}}),props=animation.props;propFilter(props,animation.opts.specialEasing);for(;index<length;index++){result=animationPrefilters[index].call(animation,elem,props,animation.opts);if(result){return result;}}
createTweens(animation,props);if(jQuery.isFunction(animation.opts.start)){animation.opts.start.call(elem,animation);}
jQuery.fx.timer(jQuery.extend(tick,{anim:animation,queue:animation.opts.queue,elem:elem}));return animation.progress(animation.opts.progress).done(animation.opts.done,animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always);}
function propFilter(props,specialEasing){var index,name,easing,value,hooks;for(index in props){name=jQuery.camelCase(index);easing=specialEasing[name];value=props[index];if(jQuery.isArray(value)){easing=value[1];value=props[index]=value[0];}
if(index!==name){props[name]=value;delete props[index];}
hooks=jQuery.cssHooks[name];if(hooks&&"expand"in hooks){value=hooks.expand(value);delete props[name];for(index in value){if(!(index in props)){props[index]=value[index];specialEasing[index]=easing;}}}else{specialEasing[name]=easing;}}}
jQuery.Animation=jQuery.extend(Animation,{tweener:function(props,callback){if(jQuery.isFunction(props)){callback=props;props=["*"];}else{props=props.split(" ");}
var prop,index=0,length=props.length;for(;index<length;index++){prop=props[index];tweeners[prop]=tweeners[prop]||[];tweeners[prop].unshift(callback);}},prefilter:function(callback,prepend){if(prepend){animationPrefilters.unshift(callback);}else{animationPrefilters.push(callback);}}});function defaultPrefilter(elem,props,opts){var index,prop,value,length,dataShow,tween,hooks,oldfire,anim=this,style=elem.style,orig={},handled=[],hidden=elem.nodeType&&isHidden(elem);if(!opts.queue){hooks=jQuery._queueHooks(elem,"fx");if(hooks.unqueued==null){hooks.unqueued=0;oldfire=hooks.empty.fire;hooks.empty.fire=function(){if(!hooks.unqueued){oldfire();}};}
hooks.unqueued++;anim.always(function(){anim.always(function(){hooks.unqueued--;if(!jQuery.queue(elem,"fx").length){hooks.empty.fire();}});});}
if(elem.nodeType===1&&("height"in props||"width"in props)){opts.overflow=[style.overflow,style.overflowX,style.overflowY];if(jQuery.css(elem,"display")==="inline"&&jQuery.css(elem,"float")==="none"){if(!jQuery.support.inlineBlockNeedsLayout||css_defaultDisplay(elem.nodeName)==="inline"){style.display="inline-block";}else{style.zoom=1;}}}
if(opts.overflow){style.overflow="hidden";if(!jQuery.support.shrinkWrapBlocks){anim.done(function(){style.overflow=opts.overflow[0];style.overflowX=opts.overflow[1];style.overflowY=opts.overflow[2];});}}
for(index in props){value=props[index];if(rfxtypes.exec(value)){delete props[index];if(value===(hidden?"hide":"show")){continue;}
handled.push(index);}}
length=handled.length;if(length){dataShow=jQuery._data(elem,"fxshow")||jQuery._data(elem,"fxshow",{});if(hidden){jQuery(elem).show();}else{anim.done(function(){jQuery(elem).hide();});}
anim.done(function(){var prop;jQuery.removeData(elem,"fxshow",true);for(prop in orig){jQuery.style(elem,prop,orig[prop]);}});for(index=0;index<length;index++){prop=handled[index];tween=anim.createTween(prop,hidden?dataShow[prop]:0);orig[prop]=dataShow[prop]||jQuery.style(elem,prop);if(!(prop in dataShow)){dataShow[prop]=tween.start;if(hidden){tween.end=tween.start;tween.start=prop==="width"||prop==="height"?1:0;}}}}}
function Tween(elem,options,prop,end,easing){return new Tween.prototype.init(elem,options,prop,end,easing);}
jQuery.Tween=Tween;Tween.prototype={constructor:Tween,init:function(elem,options,prop,end,easing,unit){this.elem=elem;this.prop=prop;this.easing=easing||"swing";this.options=options;this.start=this.now=this.cur();this.end=end;this.unit=unit||(jQuery.cssNumber[prop]?"":"px");},cur:function(){var hooks=Tween.propHooks[this.prop];return hooks&&hooks.get?hooks.get(this):Tween.propHooks._default.get(this);},run:function(percent){var eased,hooks=Tween.propHooks[this.prop];if(this.options.duration){this.pos=eased=jQuery.easing[this.easing](percent,this.options.duration*percent,0,1,this.options.duration);}else{this.pos=eased=percent;}
this.now=(this.end-this.start)*eased+this.start;if(this.options.step){this.options.step.call(this.elem,this.now,this);}
if(hooks&&hooks.set){hooks.set(this);}else{Tween.propHooks._default.set(this);}
return this;}};Tween.prototype.init.prototype=Tween.prototype;Tween.propHooks={_default:{get:function(tween){var result;if(tween.elem[tween.prop]!=null&&(!tween.elem.style||tween.elem.style[tween.prop]==null)){return tween.elem[tween.prop];}
result=jQuery.css(tween.elem,tween.prop,false,"");return!result||result==="auto"?0:result;},set:function(tween){if(jQuery.fx.step[tween.prop]){jQuery.fx.step[tween.prop](tween);}else if(tween.elem.style&&(tween.elem.style[jQuery.cssProps[tween.prop]]!=null||jQuery.cssHooks[tween.prop])){jQuery.style(tween.elem,tween.prop,tween.now+tween.unit);}else{tween.elem[tween.prop]=tween.now;}}}};Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(tween){if(tween.elem.nodeType&&tween.elem.parentNode){tween.elem[tween.prop]=tween.now;}}};jQuery.each(["toggle","show","hide"],function(i,name){var cssFn=jQuery.fn[name];jQuery.fn[name]=function(speed,easing,callback){return speed==null||typeof speed==="boolean"||(!i&&jQuery.isFunction(speed)&&jQuery.isFunction(easing))?cssFn.apply(this,arguments):this.animate(genFx(name,true),speed,easing,callback);};});jQuery.fn.extend({fadeTo:function(speed,to,easing,callback){return this.filter(isHidden).css("opacity",0).show().end().animate({opacity:to},speed,easing,callback);},animate:function(prop,speed,easing,callback){var empty=jQuery.isEmptyObject(prop),optall=jQuery.speed(speed,easing,callback),doAnimation=function(){var anim=Animation(this,jQuery.extend({},prop),optall);if(empty){anim.stop(true);}};return empty||optall.queue===false?this.each(doAnimation):this.queue(optall.queue,doAnimation);},stop:function(type,clearQueue,gotoEnd){var stopQueue=function(hooks){var stop=hooks.stop;delete hooks.stop;stop(gotoEnd);};if(typeof type!=="string"){gotoEnd=clearQueue;clearQueue=type;type=undefined;}
if(clearQueue&&type!==false){this.queue(type||"fx",[]);}
return this.each(function(){var dequeue=true,index=type!=null&&type+"queueHooks",timers=jQuery.timers,data=jQuery._data(this);if(index){if(data[index]&&data[index].stop){stopQueue(data[index]);}}else{for(index in data){if(data[index]&&data[index].stop&&rrun.test(index)){stopQueue(data[index]);}}}
for(index=timers.length;index--;){if(timers[index].elem===this&&(type==null||timers[index].queue===type)){timers[index].anim.stop(gotoEnd);dequeue=false;timers.splice(index,1);}}
if(dequeue||!gotoEnd){jQuery.dequeue(this,type);}});}});function genFx(type,includeWidth){var which,attrs={height:type},i=0;includeWidth=includeWidth?1:0;for(;i<4;i+=2-includeWidth){which=cssExpand[i];attrs["margin"+which]=attrs["padding"+which]=type;}
if(includeWidth){attrs.opacity=attrs.width=type;}
return attrs;}
jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback);};});jQuery.speed=function(speed,easing,fn){var opt=speed&&typeof speed==="object"?jQuery.extend({},speed):{complete:fn||!fn&&easing||jQuery.isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!jQuery.isFunction(easing)&&easing};opt.duration=jQuery.fx.off?0:typeof opt.duration==="number"?opt.duration:opt.duration in jQuery.fx.speeds?jQuery.fx.speeds[opt.duration]:jQuery.fx.speeds._default;if(opt.queue==null||opt.queue===true){opt.queue="fx";}
opt.old=opt.complete;opt.complete=function(){if(jQuery.isFunction(opt.old)){opt.old.call(this);}
if(opt.queue){jQuery.dequeue(this,opt.queue);}};return opt;};jQuery.easing={linear:function(p){return p;},swing:function(p){return 0.5-Math.cos(p*Math.PI)/2;}};jQuery.timers=[];jQuery.fx=Tween.prototype.init;jQuery.fx.tick=function(){var timer,timers=jQuery.timers,i=0;for(;i<timers.length;i++){timer=timers[i];if(!timer()&&timers[i]===timer){timers.splice(i--,1);}}
if(!timers.length){jQuery.fx.stop();}};jQuery.fx.timer=function(timer){if(timer()&&jQuery.timers.push(timer)&&!timerId){timerId=setInterval(jQuery.fx.tick,jQuery.fx.interval);}};jQuery.fx.interval=13;jQuery.fx.stop=function(){clearInterval(timerId);timerId=null;};jQuery.fx.speeds={slow:600,fast:200,_default:400};jQuery.fx.step={};if(jQuery.expr&&jQuery.expr.filters){jQuery.expr.filters.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem;}).length;};}
var rroot=/^(?:body|html)$/i;jQuery.fn.offset=function(options){if(arguments.length){return options===undefined?this:this.each(function(i){jQuery.offset.setOffset(this,options,i);});}
var docElem,body,win,clientTop,clientLeft,scrollTop,scrollLeft,box={top:0,left:0},elem=this[0],doc=elem&&elem.ownerDocument;if(!doc){return;}
if((body=doc.body)===elem){return jQuery.offset.bodyOffset(elem);}
docElem=doc.documentElement;if(!jQuery.contains(docElem,elem)){return box;}
if(typeof elem.getBoundingClientRect!=="undefined"){box=elem.getBoundingClientRect();}
win=getWindow(doc);clientTop=docElem.clientTop||body.clientTop||0;clientLeft=docElem.clientLeft||body.clientLeft||0;scrollTop=win.pageYOffset||docElem.scrollTop;scrollLeft=win.pageXOffset||docElem.scrollLeft;return{top:box.top+scrollTop-clientTop,left:box.left+scrollLeft-clientLeft};};jQuery.offset={bodyOffset:function(body){var top=body.offsetTop,left=body.offsetLeft;if(jQuery.support.doesNotIncludeMarginInBodyOffset){top+=parseFloat(jQuery.css(body,"marginTop"))||0;left+=parseFloat(jQuery.css(body,"marginLeft"))||0;}
return{top:top,left:left};},setOffset:function(elem,options,i){var position=jQuery.css(elem,"position");if(position==="static"){elem.style.position="relative";}
var curElem=jQuery(elem),curOffset=curElem.offset(),curCSSTop=jQuery.css(elem,"top"),curCSSLeft=jQuery.css(elem,"left"),calculatePosition=(position==="absolute"||position==="fixed")&&jQuery.inArray("auto",[curCSSTop,curCSSLeft])>-1,props={},curPosition={},curTop,curLeft;if(calculatePosition){curPosition=curElem.position();curTop=curPosition.top;curLeft=curPosition.left;}else{curTop=parseFloat(curCSSTop)||0;curLeft=parseFloat(curCSSLeft)||0;}
if(jQuery.isFunction(options)){options=options.call(elem,i,curOffset);}
if(options.top!=null){props.top=(options.top-curOffset.top)+curTop;}
if(options.left!=null){props.left=(options.left-curOffset.left)+curLeft;}
if("using"in options){options.using.call(elem,props);}else{curElem.css(props);}}};jQuery.fn.extend({position:function(){if(!this[0]){return;}
var elem=this[0],offsetParent=this.offsetParent(),offset=this.offset(),parentOffset=rroot.test(offsetParent[0].nodeName)?{top:0,left:0}:offsetParent.offset();offset.top-=parseFloat(jQuery.css(elem,"marginTop"))||0;offset.left-=parseFloat(jQuery.css(elem,"marginLeft"))||0;parentOffset.top+=parseFloat(jQuery.css(offsetParent[0],"borderTopWidth"))||0;parentOffset.left+=parseFloat(jQuery.css(offsetParent[0],"borderLeftWidth"))||0;return{top:offset.top-parentOffset.top,left:offset.left-parentOffset.left};},offsetParent:function(){return this.map(function(){var offsetParent=this.offsetParent||document.body;while(offsetParent&&(!rroot.test(offsetParent.nodeName)&&jQuery.css(offsetParent,"position")==="static")){offsetParent=offsetParent.offsetParent;}
return offsetParent||document.body;});}});jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(method,prop){var top=/Y/.test(prop);jQuery.fn[method]=function(val){return jQuery.access(this,function(elem,method,val){var win=getWindow(elem);if(val===undefined){return win?(prop in win)?win[prop]:win.document.documentElement[method]:elem[method];}
if(win){win.scrollTo(!top?val:jQuery(win).scrollLeft(),top?val:jQuery(win).scrollTop());}else{elem[method]=val;}},method,val,arguments.length,null);};});function getWindow(elem){return jQuery.isWindow(elem)?elem:elem.nodeType===9?elem.defaultView||elem.parentWindow:false;}
jQuery.each({Height:"height",Width:"width"},function(name,type){jQuery.each({padding:"inner"+name,content:type,"":"outer"+name},function(defaultExtra,funcName){jQuery.fn[funcName]=function(margin,value){var chainable=arguments.length&&(defaultExtra||typeof margin!=="boolean"),extra=defaultExtra||(margin===true||value===true?"margin":"border");return jQuery.access(this,function(elem,type,value){var doc;if(jQuery.isWindow(elem)){return elem.document.documentElement["client"+name];}
if(elem.nodeType===9){doc=elem.documentElement;return Math.max(elem.body["scroll"+name],doc["scroll"+name],elem.body["offset"+name],doc["offset"+name],doc["client"+name]);}
return value===undefined?jQuery.css(elem,type,value,extra):jQuery.style(elem,type,value,extra);},type,chainable?margin:undefined,chainable,null);};});});window.jQuery=window.$=jQuery;if(typeof define==="function"&&define.amd&&define.amd.jQuery){define("jquery",[],function(){return jQuery;});}})(window);(function($){var types=['DOMMouseScroll','mousewheel'];if($.event.fixHooks){for(var i=types.length;i;){$.event.fixHooks[types[--i]]=$.event.mouseHooks;}}
$.event.special.mousewheel={setup:function(){if(this.addEventListener){for(var i=types.length;i;){this.addEventListener(types[--i],handler,false);}}else{this.onmousewheel=handler;}},teardown:function(){if(this.removeEventListener){for(var i=types.length;i;){this.removeEventListener(types[--i],handler,false);}}else{this.onmousewheel=null;}}};$.fn.extend({mousewheel:function(fn){return fn?this.bind("mousewheel",fn):this.trigger("mousewheel");},unmousewheel:function(fn){return this.unbind("mousewheel",fn);}});function handler(event){var orgEvent=event||window.event,args=[].slice.call(arguments,1),delta=0,returnValue=true,deltaX=0,deltaY=0;event=$.event.fix(orgEvent);event.type="mousewheel";if(orgEvent.wheelDelta){delta=orgEvent.wheelDelta/120;}
if(orgEvent.detail){delta=-orgEvent.detail/3;}
deltaY=delta;if(orgEvent.axis!==undefined&&orgEvent.axis===orgEvent.HORIZONTAL_AXIS){deltaY=0;deltaX=-1*delta;}
if(orgEvent.wheelDeltaY!==undefined){deltaY=orgEvent.wheelDeltaY/120;}
if(orgEvent.wheelDeltaX!==undefined){deltaX=-1*orgEvent.wheelDeltaX/120;}
args.unshift(event,delta,deltaX,deltaY);return($.event.dispatch||$.event.handle).apply(this,args);}})(jQuery);(function(){function d3_class(ctor,properties){try{for(var key in properties){Object.defineProperty(ctor.prototype,key,{value:properties[key],enumerable:false});}}catch(e){ctor.prototype=properties;}}
function d3_arrayCopy(pseudoarray){var i=-1,n=pseudoarray.length,array=[];while(++i<n)array.push(pseudoarray[i]);return array;}
function d3_arraySlice(pseudoarray){return Array.prototype.slice.call(pseudoarray);}
function d3_Map(){}
function d3_identity(d){return d;}
function d3_this(){return this;}
function d3_true(){return true;}
function d3_functor(v){return typeof v==="function"?v:function(){return v;};}
function d3_rebind(target,source,method){return function(){var value=method.apply(source,arguments);return arguments.length?target:value;};}
function d3_number(x){return x!=null&&!isNaN(x);}
function d3_zipLength(d){return d.length;}
function d3_splitter(d){return d==null;}
function d3_collapse(s){return s.trim().replace(/\s+/g," ");}
function d3_range_integerScale(x){var k=1;while(x*k%1)k*=10;return k;}
function d3_dispatch(){}
function d3_dispatch_event(dispatch){function event(){var z=listeners,i=-1,n=z.length,l;while(++i<n)if(l=z[i].on)l.apply(this,arguments);return dispatch;}
var listeners=[],listenerByName=new d3_Map;event.on=function(name,listener){var l=listenerByName.get(name),i;if(arguments.length<2)return l&&l.on;if(l){l.on=null;listeners=listeners.slice(0,i=listeners.indexOf(l)).concat(listeners.slice(i+1));listenerByName.remove(name);}
if(listener)listeners.push(listenerByName.set(name,{on:listener}));return dispatch;};return event;}
function d3_format_precision(x,p){return p-(x?1+Math.floor(Math.log(x+Math.pow(10,1+Math.floor(Math.log(x)/Math.LN10)-p))/Math.LN10):1);}
function d3_format_typeDefault(x){return x+"";}
function d3_format_group(value){var i=value.lastIndexOf("."),f=i>=0?value.substring(i):(i=value.length,""),t=[];while(i>0)t.push(value.substring(i-=3,i+3));return t.reverse().join(",")+f;}
function d3_formatPrefix(d,i){var k=Math.pow(10,Math.abs(8-i)*3);return{scale:i>8?function(d){return d/k;}:function(d){return d*k;},symbol:d};}
function d3_ease_clamp(f){return function(t){return t<=0?0:t>=1?1:f(t);};}
function d3_ease_reverse(f){return function(t){return 1-f(1-t);};}
function d3_ease_reflect(f){return function(t){return.5*(t<.5?f(2*t):2-f(2-2*t));};}
function d3_ease_identity(t){return t;}
function d3_ease_poly(e){return function(t){return Math.pow(t,e);};}
function d3_ease_sin(t){return 1-Math.cos(t*Math.PI/2);}
function d3_ease_exp(t){return Math.pow(2,10*(t-1));}
function d3_ease_circle(t){return 1-Math.sqrt(1-t*t);}
function d3_ease_elastic(a,p){var s;if(arguments.length<2)p=.45;if(arguments.length<1){a=1;s=p/4;}else s=p/(2*Math.PI)*Math.asin(1/a);return function(t){return 1+a*Math.pow(2,10*-t)*Math.sin((t-s)*2*Math.PI/p);};}
function d3_ease_back(s){if(!s)s=1.70158;return function(t){return t*t*((s+1)*t-s);};}
function d3_ease_bounce(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375;}
function d3_eventCancel(){d3.event.stopPropagation();d3.event.preventDefault();}
function d3_eventSource(){var e=d3.event,s;while(s=e.sourceEvent)e=s;return e;}
function d3_eventDispatch(target){var dispatch=new d3_dispatch,i=0,n=arguments.length;while(++i<n)dispatch[arguments[i]]=d3_dispatch_event(dispatch);dispatch.of=function(thiz,argumentz){return function(e1){try{var e0=e1.sourceEvent=d3.event;e1.target=target;d3.event=e1;dispatch[e1.type].apply(thiz,argumentz);}finally{d3.event=e0;}};};return dispatch;}
function d3_transform(m){var r0=[m.a,m.b],r1=[m.c,m.d],kx=d3_transformNormalize(r0),kz=d3_transformDot(r0,r1),ky=d3_transformNormalize(d3_transformCombine(r1,r0,-kz))||0;if(r0[0]*r1[1]<r1[0]*r0[1]){r0[0]*=-1;r0[1]*=-1;kx*=-1;kz*=-1;}
this.rotate=(kx?Math.atan2(r0[1],r0[0]):Math.atan2(-r1[0],r1[1]))*d3_transformDegrees;this.translate=[m.e,m.f];this.scale=[kx,ky];this.skew=ky?Math.atan2(kz,ky)*d3_transformDegrees:0;}
function d3_transformDot(a,b){return a[0]*b[0]+a[1]*b[1];}
function d3_transformNormalize(a){var k=Math.sqrt(d3_transformDot(a,a));if(k){a[0]/=k;a[1]/=k;}
return k;}
function d3_transformCombine(a,b,k){a[0]+=k*b[0];a[1]+=k*b[1];return a;}
function d3_interpolateByName(name){return name=="transform"?d3.interpolateTransform:d3.interpolate;}
function d3_uninterpolateNumber(a,b){b=b-(a=+a)?1/(b-a):0;return function(x){return(x-a)*b;};}
function d3_uninterpolateClamp(a,b){b=b-(a=+a)?1/(b-a):0;return function(x){return Math.max(0,Math.min(1,(x-a)*b));};}
function d3_Color(){}
function d3_rgb(r,g,b){return new d3_Rgb(r,g,b);}
function d3_Rgb(r,g,b){this.r=r;this.g=g;this.b=b;}
function d3_rgb_hex(v){return v<16?"0"+Math.max(0,v).toString(16):Math.min(255,v).toString(16);}
function d3_rgb_parse(format,rgb,hsl){var r=0,g=0,b=0,m1,m2,name;m1=/([a-z]+)\((.*)\)/i.exec(format);if(m1){m2=m1[2].split(",");switch(m1[1]){case"hsl":{return hsl(parseFloat(m2[0]),parseFloat(m2[1])/100,parseFloat(m2[2])/100);}
case"rgb":{return rgb(d3_rgb_parseNumber(m2[0]),d3_rgb_parseNumber(m2[1]),d3_rgb_parseNumber(m2[2]));}}}
if(name=d3_rgb_names.get(format))return rgb(name.r,name.g,name.b);if(format!=null&&format.charAt(0)==="#"){if(format.length===4){r=format.charAt(1);r+=r;g=format.charAt(2);g+=g;b=format.charAt(3);b+=b;}else if(format.length===7){r=format.substring(1,3);g=format.substring(3,5);b=format.substring(5,7);}
r=parseInt(r,16);g=parseInt(g,16);b=parseInt(b,16);}
return rgb(r,g,b);}
function d3_rgb_hsl(r,g,b){var min=Math.min(r/=255,g/=255,b/=255),max=Math.max(r,g,b),d=max-min,h,s,l=(max+min)/2;if(d){s=l<.5?d/(max+min):d/(2-max-min);if(r==max)h=(g-b)/d+(g<b?6:0);else if(g==max)h=(b-r)/d+2;else h=(r-g)/d+4;h*=60;}else{s=h=0;}
return d3_hsl(h,s,l);}
function d3_rgb_lab(r,g,b){r=d3_rgb_xyz(r);g=d3_rgb_xyz(g);b=d3_rgb_xyz(b);var x=d3_xyz_lab((.4124564*r+.3575761*g+.1804375*b)/d3_lab_X),y=d3_xyz_lab((.2126729*r+.7151522*g+.072175*b)/d3_lab_Y),z=d3_xyz_lab((.0193339*r+.119192*g+.9503041*b)/d3_lab_Z);return d3_lab(116*y-16,500*(x-y),200*(y-z));}
function d3_rgb_xyz(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4);}
function d3_rgb_parseNumber(c){var f=parseFloat(c);return c.charAt(c.length-1)==="%"?Math.round(f*2.55):f;}
function d3_hsl(h,s,l){return new d3_Hsl(h,s,l);}
function d3_Hsl(h,s,l){this.h=h;this.s=s;this.l=l;}
function d3_hsl_rgb(h,s,l){function v(h){if(h>360)h-=360;else if(h<0)h+=360;if(h<60)return m1+(m2-m1)*h/60;if(h<180)return m2;if(h<240)return m1+(m2-m1)*(240-h)/60;return m1;}
function vv(h){return Math.round(v(h)*255);}
var m1,m2;h=h%360;if(h<0)h+=360;s=s<0?0:s>1?1:s;l=l<0?0:l>1?1:l;m2=l<=.5?l*(1+s):l+s-l*s;m1=2*l-m2;return d3_rgb(vv(h+120),vv(h),vv(h-120));}
function d3_hcl(h,c,l){return new d3_Hcl(h,c,l);}
function d3_Hcl(h,c,l){this.h=h;this.c=c;this.l=l;}
function d3_hcl_lab(h,c,l){return d3_lab(l,Math.cos(h*=Math.PI/180)*c,Math.sin(h)*c);}
function d3_lab(l,a,b){return new d3_Lab(l,a,b);}
function d3_Lab(l,a,b){this.l=l;this.a=a;this.b=b;}
function d3_lab_rgb(l,a,b){var y=(l+16)/116,x=y+a/500,z=y-b/200;x=d3_lab_xyz(x)*d3_lab_X;y=d3_lab_xyz(y)*d3_lab_Y;z=d3_lab_xyz(z)*d3_lab_Z;return d3_rgb(d3_xyz_rgb(3.2404542*x-1.5371385*y-.4985314*z),d3_xyz_rgb(-.969266*x+1.8760108*y+.041556*z),d3_xyz_rgb(.0556434*x-.2040259*y+1.0572252*z));}
function d3_lab_hcl(l,a,b){return d3_hcl(Math.atan2(b,a)/Math.PI*180,Math.sqrt(a*a+b*b),l);}
function d3_lab_xyz(x){return x>.206893034?x*x*x:(x-4/29)/7.787037;}
function d3_xyz_lab(x){return x>.008856?Math.pow(x,1/3):7.787037*x+4/29;}
function d3_xyz_rgb(r){return Math.round(255*(r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055));}
function d3_selection(groups){d3_arraySubclass(groups,d3_selectionPrototype);return groups;}
function d3_selection_selector(selector){return function(){return d3_select(selector,this);};}
function d3_selection_selectorAll(selector){return function(){return d3_selectAll(selector,this);};}
function d3_selection_attr(name,value){function attrNull(){this.removeAttribute(name);}
function attrNullNS(){this.removeAttributeNS(name.space,name.local);}
function attrConstant(){this.setAttribute(name,value);}
function attrConstantNS(){this.setAttributeNS(name.space,name.local,value);}
function attrFunction(){var x=value.apply(this,arguments);if(x==null)this.removeAttribute(name);else this.setAttribute(name,x);}
function attrFunctionNS(){var x=value.apply(this,arguments);if(x==null)this.removeAttributeNS(name.space,name.local);else this.setAttributeNS(name.space,name.local,x);}
name=d3.ns.qualify(name);return value==null?name.local?attrNullNS:attrNull:typeof value==="function"?name.local?attrFunctionNS:attrFunction:name.local?attrConstantNS:attrConstant;}
function d3_selection_classedRe(name){return new RegExp("(?:^|\\s+)"+d3.requote(name)+"(?:\\s+|$)","g");}
function d3_selection_classed(name,value){function classedConstant(){var i=-1;while(++i<n)name[i](this,value);}
function classedFunction(){var i=-1,x=value.apply(this,arguments);while(++i<n)name[i](this,x);}
name=name.trim().split(/\s+/).map(d3_selection_classedName);var n=name.length;return typeof value==="function"?classedFunction:classedConstant;}
function d3_selection_classedName(name){var re=d3_selection_classedRe(name);return function(node,value){if(c=node.classList)return value?c.add(name):c.remove(name);var c=node.className,cb=c.baseVal!=null,cv=cb?c.baseVal:c;if(value){re.lastIndex=0;if(!re.test(cv)){cv=d3_collapse(cv+" "+name);if(cb)c.baseVal=cv;else node.className=cv;}}else if(cv){cv=d3_collapse(cv.replace(re," "));if(cb)c.baseVal=cv;else node.className=cv;}};}
function d3_selection_style(name,value,priority){function styleNull(){this.style.removeProperty(name);}
function styleConstant(){this.style.setProperty(name,value,priority);}
function styleFunction(){var x=value.apply(this,arguments);if(x==null)this.style.removeProperty(name);else this.style.setProperty(name,x,priority);}
return value==null?styleNull:typeof value==="function"?styleFunction:styleConstant;}
function d3_selection_property(name,value){function propertyNull(){delete this[name];}
function propertyConstant(){this[name]=value;}
function propertyFunction(){var x=value.apply(this,arguments);if(x==null)delete this[name];else this[name]=x;}
return value==null?propertyNull:typeof value==="function"?propertyFunction:propertyConstant;}
function d3_selection_dataNode(data){return{__data__:data};}
function d3_selection_filter(selector){return function(){return d3_selectMatches(this,selector);};}
function d3_selection_sortComparator(comparator){if(!arguments.length)comparator=d3.ascending;return function(a,b){return comparator(a&&a.__data__,b&&b.__data__);};}
function d3_selection_on(type,listener,capture){function onRemove(){var wrapper=this[name];if(wrapper){this.removeEventListener(type,wrapper,wrapper.$);delete this[name];}}
function onAdd(){function wrapper(e){var o=d3.event;d3.event=e;args[0]=node.__data__;try{listener.apply(node,args);}finally{d3.event=o;}}
var node=this,args=arguments;onRemove.call(this);this.addEventListener(type,this[name]=wrapper,wrapper.$=capture);wrapper._=listener;}
var name="__on"+type,i=type.indexOf(".");if(i>0)type=type.substring(0,i);return listener?onAdd:onRemove;}
function d3_selection_each(groups,callback){for(var j=0,m=groups.length;j<m;j++){for(var group=groups[j],i=0,n=group.length,node;i<n;i++){if(node=group[i])callback(node,i,j);}}
return groups;}
function d3_selection_enter(selection){d3_arraySubclass(selection,d3_selection_enterPrototype);return selection;}
function d3_transition(groups,id,time){d3_arraySubclass(groups,d3_transitionPrototype);var tweens=new d3_Map,event=d3.dispatch("start","end"),ease=d3_transitionEase;groups.id=id;groups.time=time;groups.tween=function(name,tween){if(arguments.length<2)return tweens.get(name);if(tween==null)tweens.remove(name);else tweens.set(name,tween);return groups;};groups.ease=function(value){if(!arguments.length)return ease;ease=typeof value==="function"?value:d3.ease.apply(d3,arguments);return groups;};groups.each=function(type,listener){if(arguments.length<2)return d3_transition_each.call(groups,type);event.on(type,listener);return groups;};d3.timer(function(elapsed){return d3_selection_each(groups,function(node,i,j){function start(elapsed){if(lock.active>id)return stop();lock.active=id;tweens.forEach(function(key,value){if(value=value.call(node,d,i)){tweened.push(value);}});event.start.call(node,d,i);if(!tick(elapsed))d3.timer(tick,0,time);return 1;}
function tick(elapsed){if(lock.active!==id)return stop();var t=(elapsed-delay)/duration,e=ease(t),n=tweened.length;while(n>0){tweened[--n].call(node,e);}
if(t>=1){stop();d3_transitionId=id;event.end.call(node,d,i);d3_transitionId=0;return 1;}}
function stop(){if(!--lock.count)delete node.__transition__;return 1;}
var tweened=[],delay=node.delay,duration=node.duration,lock=(node=node.node).__transition__||(node.__transition__={active:0,count:0}),d=node.__data__;++lock.count;delay<=elapsed?start(elapsed):d3.timer(start,delay,time);});},0,time);return groups;}
function d3_transition_each(callback){var id=d3_transitionId,ease=d3_transitionEase,delay=d3_transitionDelay,duration=d3_transitionDuration;d3_transitionId=this.id;d3_transitionEase=this.ease();d3_selection_each(this,function(node,i,j){d3_transitionDelay=node.delay;d3_transitionDuration=node.duration;callback.call(node=node.node,node.__data__,i,j);});d3_transitionId=id;d3_transitionEase=ease;d3_transitionDelay=delay;d3_transitionDuration=duration;return this;}
function d3_tweenNull(d,i,a){return a!=""&&d3_tweenRemove;}
function d3_tweenByName(b,name){return d3.tween(b,d3_interpolateByName(name));}
function d3_timer_step(){var elapsed,now=Date.now(),t1=d3_timer_queue;while(t1){elapsed=now-t1.then;if(elapsed>=t1.delay)t1.flush=t1.callback(elapsed);t1=t1.next;}
var delay=d3_timer_flush()-now;if(delay>24){if(isFinite(delay)){clearTimeout(d3_timer_timeout);d3_timer_timeout=setTimeout(d3_timer_step,delay);}
d3_timer_interval=0;}else{d3_timer_interval=1;d3_timer_frame(d3_timer_step);}}
function d3_timer_flush(){var t0=null,t1=d3_timer_queue,then=Infinity;while(t1){if(t1.flush){delete d3_timer_byId[t1.callback.id];t1=t0?t0.next=t1.next:d3_timer_queue=t1.next;}else{then=Math.min(then,t1.then+t1.delay);t1=(t0=t1).next;}}
return then;}
function d3_mousePoint(container,e){var svg=container.ownerSVGElement||container;if(svg.createSVGPoint){var point=svg.createSVGPoint();if(d3_mouse_bug44083<0&&(window.scrollX||window.scrollY)){svg=d3.select(document.body).append("svg").style("position","absolute").style("top",0).style("left",0);var ctm=svg[0][0].getScreenCTM();d3_mouse_bug44083=!(ctm.f||ctm.e);svg.remove();}
if(d3_mouse_bug44083){point.x=e.pageX;point.y=e.pageY;}else{point.x=e.clientX;point.y=e.clientY;}
point=point.matrixTransform(container.getScreenCTM().inverse());return[point.x,point.y];}
var rect=container.getBoundingClientRect();return[e.clientX-rect.left-container.clientLeft,e.clientY-rect.top-container.clientTop];}
function d3_noop(){}
function d3_scaleExtent(domain){var start=domain[0],stop=domain[domain.length-1];return start<stop?[start,stop]:[stop,start];}
function d3_scaleRange(scale){return scale.rangeExtent?scale.rangeExtent():d3_scaleExtent(scale.range());}
function d3_scale_nice(domain,nice){var i0=0,i1=domain.length-1,x0=domain[i0],x1=domain[i1],dx;if(x1<x0){dx=i0,i0=i1,i1=dx;dx=x0,x0=x1,x1=dx;}
if(nice=nice(x1-x0)){domain[i0]=nice.floor(x0);domain[i1]=nice.ceil(x1);}
return domain;}
function d3_scale_niceDefault(){return Math;}
function d3_scale_linear(domain,range,interpolate,clamp){function rescale(){var linear=Math.min(domain.length,range.length)>2?d3_scale_polylinear:d3_scale_bilinear,uninterpolate=clamp?d3_uninterpolateClamp:d3_uninterpolateNumber;output=linear(domain,range,uninterpolate,interpolate);input=linear(range,domain,uninterpolate,d3.interpolate);return scale;}
function scale(x){return output(x);}
var output,input;scale.invert=function(y){return input(y);};scale.domain=function(x){if(!arguments.length)return domain;domain=x.map(Number);return rescale();};scale.range=function(x){if(!arguments.length)return range;range=x;return rescale();};scale.rangeRound=function(x){return scale.range(x).interpolate(d3.interpolateRound);};scale.clamp=function(x){if(!arguments.length)return clamp;clamp=x;return rescale();};scale.interpolate=function(x){if(!arguments.length)return interpolate;interpolate=x;return rescale();};scale.ticks=function(m){return d3_scale_linearTicks(domain,m);};scale.tickFormat=function(m){return d3_scale_linearTickFormat(domain,m);};scale.nice=function(){d3_scale_nice(domain,d3_scale_linearNice);return rescale();};scale.copy=function(){return d3_scale_linear(domain,range,interpolate,clamp);};return rescale();}
function d3_scale_linearRebind(scale,linear){return d3.rebind(scale,linear,"range","rangeRound","interpolate","clamp");}
function d3_scale_linearNice(dx){dx=Math.pow(10,Math.round(Math.log(dx)/Math.LN10)-1);return dx&&{floor:function(x){return Math.floor(x/dx)*dx;},ceil:function(x){return Math.ceil(x/dx)*dx;}};}
function d3_scale_linearTickRange(domain,m){var extent=d3_scaleExtent(domain),span=extent[1]-extent[0],step=Math.pow(10,Math.floor(Math.log(span/m)/Math.LN10)),err=m/span*step;if(err<=.15)step*=10;else if(err<=.35)step*=5;else if(err<=.75)step*=2;extent[0]=Math.ceil(extent[0]/step)*step;extent[1]=Math.floor(extent[1]/step)*step+step*.5;extent[2]=step;return extent;}
function d3_scale_linearTicks(domain,m){return d3.range.apply(d3,d3_scale_linearTickRange(domain,m));}
function d3_scale_linearTickFormat(domain,m){return d3.format(",."+Math.max(0,-Math.floor(Math.log(d3_scale_linearTickRange(domain,m)[2])/Math.LN10+.01))+"f");}
function d3_scale_bilinear(domain,range,uninterpolate,interpolate){var u=uninterpolate(domain[0],domain[1]),i=interpolate(range[0],range[1]);return function(x){return i(u(x));};}
function d3_scale_polylinear(domain,range,uninterpolate,interpolate){var u=[],i=[],j=0,k=Math.min(domain.length,range.length)-1;if(domain[k]<domain[0]){domain=domain.slice().reverse();range=range.slice().reverse();}
while(++j<=k){u.push(uninterpolate(domain[j-1],domain[j]));i.push(interpolate(range[j-1],range[j]));}
return function(x){var j=d3.bisect(domain,x,1,k)-1;return i[j](u[j](x));};}
function d3_scale_log(linear,log){function scale(x){return linear(log(x));}
var pow=log.pow;scale.invert=function(x){return pow(linear.invert(x));};scale.domain=function(x){if(!arguments.length)return linear.domain().map(pow);log=x[0]<0?d3_scale_logn:d3_scale_logp;pow=log.pow;linear.domain(x.map(log));return scale;};scale.nice=function(){linear.domain(d3_scale_nice(linear.domain(),d3_scale_niceDefault));return scale;};scale.ticks=function(){var extent=d3_scaleExtent(linear.domain()),ticks=[];if(extent.every(isFinite)){var i=Math.floor(extent[0]),j=Math.ceil(extent[1]),u=pow(extent[0]),v=pow(extent[1]);if(log===d3_scale_logn){ticks.push(pow(i));for(;i++<j;)for(var k=9;k>0;k--)ticks.push(pow(i)*k);}else{for(;i<j;i++)for(var k=1;k<10;k++)ticks.push(pow(i)*k);ticks.push(pow(i));}
for(i=0;ticks[i]<u;i++){}
for(j=ticks.length;ticks[j-1]>v;j--){}
ticks=ticks.slice(i,j);}
return ticks;};scale.tickFormat=function(n,format){if(arguments.length<2)format=d3_scale_logFormat;if(arguments.length<1)return format;var k=Math.max(.1,n/scale.ticks().length),f=log===d3_scale_logn?(e=-1e-12,Math.floor):(e=1e-12,Math.ceil),e;return function(d){return d/pow(f(log(d)+e))<=k?format(d):"";};};scale.copy=function(){return d3_scale_log(linear.copy(),log);};return d3_scale_linearRebind(scale,linear);}
function d3_scale_logp(x){return Math.log(x<0?0:x)/Math.LN10;}
function d3_scale_logn(x){return-Math.log(x>0?0:-x)/Math.LN10;}
function d3_scale_pow(linear,exponent){function scale(x){return linear(powp(x));}
var powp=d3_scale_powPow(exponent),powb=d3_scale_powPow(1/exponent);scale.invert=function(x){return powb(linear.invert(x));};scale.domain=function(x){if(!arguments.length)return linear.domain().map(powb);linear.domain(x.map(powp));return scale;};scale.ticks=function(m){return d3_scale_linearTicks(scale.domain(),m);};scale.tickFormat=function(m){return d3_scale_linearTickFormat(scale.domain(),m);};scale.nice=function(){return scale.domain(d3_scale_nice(scale.domain(),d3_scale_linearNice));};scale.exponent=function(x){if(!arguments.length)return exponent;var domain=scale.domain();powp=d3_scale_powPow(exponent=x);powb=d3_scale_powPow(1/exponent);return scale.domain(domain);};scale.copy=function(){return d3_scale_pow(linear.copy(),exponent);};return d3_scale_linearRebind(scale,linear);}
function d3_scale_powPow(e){return function(x){return x<0?-Math.pow(-x,e):Math.pow(x,e);};}
function d3_scale_ordinal(domain,ranger){function scale(x){return range[((index.get(x)||index.set(x,domain.push(x)))-1)%range.length];}
function steps(start,step){return d3.range(domain.length).map(function(i){return start+step*i;});}
var index,range,rangeBand;scale.domain=function(x){if(!arguments.length)return domain;domain=[];index=new d3_Map;var i=-1,n=x.length,xi;while(++i<n)if(!index.has(xi=x[i]))index.set(xi,domain.push(xi));return scale[ranger.t].apply(scale,ranger.a);};scale.range=function(x){if(!arguments.length)return range;range=x;rangeBand=0;ranger={t:"range",a:arguments};return scale;};scale.rangePoints=function(x,padding){if(arguments.length<2)padding=0;var start=x[0],stop=x[1],step=(stop-start)/(Math.max(1,domain.length-1)+padding);range=steps(domain.length<2?(start+stop)/2:start+step*padding/2,step);rangeBand=0;ranger={t:"rangePoints",a:arguments};return scale;};scale.rangeBands=function(x,padding,outerPadding){if(arguments.length<2)padding=0;if(arguments.length<3)outerPadding=padding;var reverse=x[1]<x[0],start=x[reverse-0],stop=x[1-reverse],step=(stop-start)/(domain.length-padding+2*outerPadding);range=steps(start+step*outerPadding,step);if(reverse)range.reverse();rangeBand=step*(1-padding);ranger={t:"rangeBands",a:arguments};return scale;};scale.rangeRoundBands=function(x,padding,outerPadding){if(arguments.length<2)padding=0;if(arguments.length<3)outerPadding=padding;var reverse=x[1]<x[0],start=x[reverse-0],stop=x[1-reverse],step=Math.floor((stop-start)/(domain.length-padding+2*outerPadding)),error=stop-start-(domain.length-padding)*step;range=steps(start+Math.round(error/2),step);if(reverse)range.reverse();rangeBand=Math.round(step*(1-padding));ranger={t:"rangeRoundBands",a:arguments};return scale;};scale.rangeBand=function(){return rangeBand;};scale.rangeExtent=function(){return d3_scaleExtent(ranger.a[0]);};scale.copy=function(){return d3_scale_ordinal(domain,ranger);};return scale.domain(domain);}
function d3_scale_quantile(domain,range){function rescale(){var k=0,n=domain.length,q=range.length;thresholds=[];while(++k<q)thresholds[k-1]=d3.quantile(domain,k/q);return scale;}
function scale(x){if(isNaN(x=+x))return NaN;return range[d3.bisect(thresholds,x)];}
var thresholds;scale.domain=function(x){if(!arguments.length)return domain;domain=x.filter(function(d){return!isNaN(d);}).sort(d3.ascending);return rescale();};scale.range=function(x){if(!arguments.length)return range;range=x;return rescale();};scale.quantiles=function(){return thresholds;};scale.copy=function(){return d3_scale_quantile(domain,range);};return rescale();}
function d3_scale_quantize(x0,x1,range){function scale(x){return range[Math.max(0,Math.min(i,Math.floor(kx*(x-x0))))];}
function rescale(){kx=range.length/(x1-x0);i=range.length-1;return scale;}
var kx,i;scale.domain=function(x){if(!arguments.length)return[x0,x1];x0=+x[0];x1=+x[x.length-1];return rescale();};scale.range=function(x){if(!arguments.length)return range;range=x;return rescale();};scale.copy=function(){return d3_scale_quantize(x0,x1,range);};return rescale();}
function d3_scale_threshold(domain,range){function scale(x){return range[d3.bisect(domain,x)];}
scale.domain=function(_){if(!arguments.length)return domain;domain=_;return scale;};scale.range=function(_){if(!arguments.length)return range;range=_;return scale;};scale.copy=function(){return d3_scale_threshold(domain,range);};return scale;}
function d3_scale_identity(domain){function identity(x){return+x;}
identity.invert=identity;identity.domain=identity.range=function(x){if(!arguments.length)return domain;domain=x.map(identity);return identity;};identity.ticks=function(m){return d3_scale_linearTicks(domain,m);};identity.tickFormat=function(m){return d3_scale_linearTickFormat(domain,m);};identity.copy=function(){return d3_scale_identity(domain);};return identity;}
function d3_svg_arcInnerRadius(d){return d.innerRadius;}
function d3_svg_arcOuterRadius(d){return d.outerRadius;}
function d3_svg_arcStartAngle(d){return d.startAngle;}
function d3_svg_arcEndAngle(d){return d.endAngle;}
function d3_svg_line(projection){function line(data){function segment(){segments.push("M",interpolate(projection(points),tension));}
var segments=[],points=[],i=-1,n=data.length,d,fx=d3_functor(x),fy=d3_functor(y);while(++i<n){if(defined.call(this,d=data[i],i)){points.push([+fx.call(this,d,i),+fy.call(this,d,i)]);}else if(points.length){segment();points=[];}}
if(points.length)segment();return segments.length?segments.join(""):null;}
var x=d3_svg_lineX,y=d3_svg_lineY,defined=d3_true,interpolate=d3_svg_lineLinear,interpolateKey=interpolate.key,tension=.7;line.x=function(_){if(!arguments.length)return x;x=_;return line;};line.y=function(_){if(!arguments.length)return y;y=_;return line;};line.defined=function(_){if(!arguments.length)return defined;defined=_;return line;};line.interpolate=function(_){if(!arguments.length)return interpolateKey;if(typeof _==="function")interpolateKey=interpolate=_;else interpolateKey=(interpolate=d3_svg_lineInterpolators.get(_)||d3_svg_lineLinear).key;return line;};line.tension=function(_){if(!arguments.length)return tension;tension=_;return line;};return line;}
function d3_svg_lineX(d){return d[0];}
function d3_svg_lineY(d){return d[1];}
function d3_svg_lineLinear(points){return points.join("L");}
function d3_svg_lineLinearClosed(points){return d3_svg_lineLinear(points)+"Z";}
function d3_svg_lineStepBefore(points){var i=0,n=points.length,p=points[0],path=[p[0],",",p[1]];while(++i<n)path.push("V",(p=points[i])[1],"H",p[0]);return path.join("");}
function d3_svg_lineStepAfter(points){var i=0,n=points.length,p=points[0],path=[p[0],",",p[1]];while(++i<n)path.push("H",(p=points[i])[0],"V",p[1]);return path.join("");}
function d3_svg_lineCardinalOpen(points,tension){return points.length<4?d3_svg_lineLinear(points):points[1]+d3_svg_lineHermite(points.slice(1,points.length-1),d3_svg_lineCardinalTangents(points,tension));}
function d3_svg_lineCardinalClosed(points,tension){return points.length<3?d3_svg_lineLinear(points):points[0]+d3_svg_lineHermite((points.push(points[0]),points),d3_svg_lineCardinalTangents([points[points.length-2]].concat(points,[points[1]]),tension));}
function d3_svg_lineCardinal(points,tension,closed){return points.length<3?d3_svg_lineLinear(points):points[0]+d3_svg_lineHermite(points,d3_svg_lineCardinalTangents(points,tension));}
function d3_svg_lineHermite(points,tangents){if(tangents.length<1||points.length!=tangents.length&&points.length!=tangents.length+2){return d3_svg_lineLinear(points);}
var quad=points.length!=tangents.length,path="",p0=points[0],p=points[1],t0=tangents[0],t=t0,pi=1;if(quad){path+="Q"+(p[0]-t0[0]*2/3)+","+(p[1]-t0[1]*2/3)+","+p[0]+","+p[1];p0=points[1];pi=2;}
if(tangents.length>1){t=tangents[1];p=points[pi];pi++;path+="C"+(p0[0]+t0[0])+","+(p0[1]+t0[1])+","+(p[0]-t[0])+","+(p[1]-t[1])+","+p[0]+","+p[1];for(var i=2;i<tangents.length;i++,pi++){p=points[pi];t=tangents[i];path+="S"+(p[0]-t[0])+","+(p[1]-t[1])+","+p[0]+","+p[1];}}
if(quad){var lp=points[pi];path+="Q"+(p[0]+t[0]*2/3)+","+(p[1]+t[1]*2/3)+","+lp[0]+","+lp[1];}
return path;}
function d3_svg_lineCardinalTangents(points,tension){var tangents=[],a=(1-tension)/2,p0,p1=points[0],p2=points[1],i=1,n=points.length;while(++i<n){p0=p1;p1=p2;p2=points[i];tangents.push([a*(p2[0]-p0[0]),a*(p2[1]-p0[1])]);}
return tangents;}
function d3_svg_lineBasis(points){if(points.length<3)return d3_svg_lineLinear(points);var i=1,n=points.length,pi=points[0],x0=pi[0],y0=pi[1],px=[x0,x0,x0,(pi=points[1])[0]],py=[y0,y0,y0,pi[1]],path=[x0,",",y0];d3_svg_lineBasisBezier(path,px,py);while(++i<n){pi=points[i];px.shift();px.push(pi[0]);py.shift();py.push(pi[1]);d3_svg_lineBasisBezier(path,px,py);}
i=-1;while(++i<2){px.shift();px.push(pi[0]);py.shift();py.push(pi[1]);d3_svg_lineBasisBezier(path,px,py);}
return path.join("");}
function d3_svg_lineBasisOpen(points){if(points.length<4)return d3_svg_lineLinear(points);var path=[],i=-1,n=points.length,pi,px=[0],py=[0];while(++i<3){pi=points[i];px.push(pi[0]);py.push(pi[1]);}
path.push(d3_svg_lineDot4(d3_svg_lineBasisBezier3,px)+","+d3_svg_lineDot4(d3_svg_lineBasisBezier3,py));--i;while(++i<n){pi=points[i];px.shift();px.push(pi[0]);py.shift();py.push(pi[1]);d3_svg_lineBasisBezier(path,px,py);}
return path.join("");}
function d3_svg_lineBasisClosed(points){var path,i=-1,n=points.length,m=n+4,pi,px=[],py=[];while(++i<4){pi=points[i%n];px.push(pi[0]);py.push(pi[1]);}
path=[d3_svg_lineDot4(d3_svg_lineBasisBezier3,px),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,py)];--i;while(++i<m){pi=points[i%n];px.shift();px.push(pi[0]);py.shift();py.push(pi[1]);d3_svg_lineBasisBezier(path,px,py);}
return path.join("");}
function d3_svg_lineBundle(points,tension){var n=points.length-1;if(n){var x0=points[0][0],y0=points[0][1],dx=points[n][0]-x0,dy=points[n][1]-y0,i=-1,p,t;while(++i<=n){p=points[i];t=i/n;p[0]=tension*p[0]+(1-tension)*(x0+t*dx);p[1]=tension*p[1]+(1-tension)*(y0+t*dy);}}
return d3_svg_lineBasis(points);}
function d3_svg_lineDot4(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3];}
function d3_svg_lineBasisBezier(path,x,y){path.push("C",d3_svg_lineDot4(d3_svg_lineBasisBezier1,x),",",d3_svg_lineDot4(d3_svg_lineBasisBezier1,y),",",d3_svg_lineDot4(d3_svg_lineBasisBezier2,x),",",d3_svg_lineDot4(d3_svg_lineBasisBezier2,y),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,x),",",d3_svg_lineDot4(d3_svg_lineBasisBezier3,y));}
function d3_svg_lineSlope(p0,p1){return(p1[1]-p0[1])/(p1[0]-p0[0]);}
function d3_svg_lineFiniteDifferences(points){var i=0,j=points.length-1,m=[],p0=points[0],p1=points[1],d=m[0]=d3_svg_lineSlope(p0,p1);while(++i<j){m[i]=(d+(d=d3_svg_lineSlope(p0=p1,p1=points[i+1])))/2;}
m[i]=d;return m;}
function d3_svg_lineMonotoneTangents(points){var tangents=[],d,a,b,s,m=d3_svg_lineFiniteDifferences(points),i=-1,j=points.length-1;while(++i<j){d=d3_svg_lineSlope(points[i],points[i+1]);if(Math.abs(d)<1e-6){m[i]=m[i+1]=0;}else{a=m[i]/d;b=m[i+1]/d;s=a*a+b*b;if(s>9){s=d*3/Math.sqrt(s);m[i]=s*a;m[i+1]=s*b;}}}
i=-1;while(++i<=j){s=(points[Math.min(j,i+1)][0]-points[Math.max(0,i-1)][0])/(6*(1+m[i]*m[i]));tangents.push([s||0,m[i]*s||0]);}
return tangents;}
function d3_svg_lineMonotone(points){return points.length<3?d3_svg_lineLinear(points):points[0]+d3_svg_lineHermite(points,d3_svg_lineMonotoneTangents(points));}
function d3_svg_lineRadial(points){var point,i=-1,n=points.length,r,a;while(++i<n){point=points[i];r=point[0];a=point[1]+d3_svg_arcOffset;point[0]=r*Math.cos(a);point[1]=r*Math.sin(a);}
return points;}
function d3_svg_area(projection){function area(data){function segment(){segments.push("M",interpolate(projection(points1),tension),L,interpolateReverse(projection(points0.reverse()),tension),"Z");}
var segments=[],points0=[],points1=[],i=-1,n=data.length,d,fx0=d3_functor(x0),fy0=d3_functor(y0),fx1=x0===x1?function(){return x;}:d3_functor(x1),fy1=y0===y1?function(){return y;}:d3_functor(y1),x,y;while(++i<n){if(defined.call(this,d=data[i],i)){points0.push([x=+fx0.call(this,d,i),y=+fy0.call(this,d,i)]);points1.push([+fx1.call(this,d,i),+fy1.call(this,d,i)]);}else if(points0.length){segment();points0=[];points1=[];}}
if(points0.length)segment();return segments.length?segments.join(""):null;}
var x0=d3_svg_lineX,x1=d3_svg_lineX,y0=0,y1=d3_svg_lineY,defined=d3_true,interpolate=d3_svg_lineLinear,interpolateKey=interpolate.key,interpolateReverse=interpolate,L="L",tension=.7;area.x=function(_){if(!arguments.length)return x1;x0=x1=_;return area;};area.x0=function(_){if(!arguments.length)return x0;x0=_;return area;};area.x1=function(_){if(!arguments.length)return x1;x1=_;return area;};area.y=function(_){if(!arguments.length)return y1;y0=y1=_;return area;};area.y0=function(_){if(!arguments.length)return y0;y0=_;return area;};area.y1=function(_){if(!arguments.length)return y1;y1=_;return area;};area.defined=function(_){if(!arguments.length)return defined;defined=_;return area;};area.interpolate=function(_){if(!arguments.length)return interpolateKey;if(typeof _==="function")interpolateKey=interpolate=_;else interpolateKey=(interpolate=d3_svg_lineInterpolators.get(_)||d3_svg_lineLinear).key;interpolateReverse=interpolate.reverse||interpolate;L=interpolate.closed?"M":"L";return area;};area.tension=function(_){if(!arguments.length)return tension;tension=_;return area;};return area;}
function d3_svg_chordSource(d){return d.source;}
function d3_svg_chordTarget(d){return d.target;}
function d3_svg_chordRadius(d){return d.radius;}
function d3_svg_chordStartAngle(d){return d.startAngle;}
function d3_svg_chordEndAngle(d){return d.endAngle;}
function d3_svg_diagonalProjection(d){return[d.x,d.y];}
function d3_svg_diagonalRadialProjection(projection){return function(){var d=projection.apply(this,arguments),r=d[0],a=d[1]+d3_svg_arcOffset;return[r*Math.cos(a),r*Math.sin(a)];};}
function d3_svg_symbolSize(){return 64;}
function d3_svg_symbolType(){return"circle";}
function d3_svg_symbolCircle(size){var r=Math.sqrt(size/Math.PI);return"M0,"+r+"A"+r+","+r+" 0 1,1 0,"+-r+"A"+r+","+r+" 0 1,1 0,"+r+"Z";}
function d3_svg_axisX(selection,x){selection.attr("transform",function(d){return"translate("+x(d)+",0)";});}
function d3_svg_axisY(selection,y){selection.attr("transform",function(d){return"translate(0,"+y(d)+")";});}
function d3_svg_axisSubdivide(scale,ticks,m){subticks=[];if(m&&ticks.length>1){var extent=d3_scaleExtent(scale.domain()),subticks,i=-1,n=ticks.length,d=(ticks[1]-ticks[0])/++m,j,v;while(++i<n){for(j=m;--j>0;){if((v=+ticks[i]-j*d)>=extent[0]){subticks.push(v);}}}
for(--i,j=0;++j<m&&(v=+ticks[i]+j*d)<extent[1];){subticks.push(v);}}
return subticks;}
function d3_behavior_zoomDelta(){if(!d3_behavior_zoomDiv){d3_behavior_zoomDiv=d3.select("body").append("div").style("visibility","hidden").style("top",0).style("height",0).style("width",0).style("overflow-y","scroll").append("div").style("height","2000px").node().parentNode;}
var e=d3.event,delta;try{d3_behavior_zoomDiv.scrollTop=1e3;d3_behavior_zoomDiv.dispatchEvent(e);delta=1e3-d3_behavior_zoomDiv.scrollTop;}catch(error){delta=e.wheelDelta||-e.detail*5;}
return delta;}
function d3_layout_bundlePath(link){var start=link.source,end=link.target,lca=d3_layout_bundleLeastCommonAncestor(start,end),points=[start];while(start!==lca){start=start.parent;points.push(start);}
var k=points.length;while(end!==lca){points.splice(k,0,end);end=end.parent;}
return points;}
function d3_layout_bundleAncestors(node){var ancestors=[],parent=node.parent;while(parent!=null){ancestors.push(node);node=parent;parent=parent.parent;}
ancestors.push(node);return ancestors;}
function d3_layout_bundleLeastCommonAncestor(a,b){if(a===b)return a;var aNodes=d3_layout_bundleAncestors(a),bNodes=d3_layout_bundleAncestors(b),aNode=aNodes.pop(),bNode=bNodes.pop(),sharedNode=null;while(aNode===bNode){sharedNode=aNode;aNode=aNodes.pop();bNode=bNodes.pop();}
return sharedNode;}
function d3_layout_forceDragstart(d){d.fixed|=2;}
function d3_layout_forceDragend(d){d.fixed&=1;}
function d3_layout_forceMouseover(d){d.fixed|=4;}
function d3_layout_forceMouseout(d){d.fixed&=3;}
function d3_layout_forceAccumulate(quad,alpha,charges){var cx=0,cy=0;quad.charge=0;if(!quad.leaf){var nodes=quad.nodes,n=nodes.length,i=-1,c;while(++i<n){c=nodes[i];if(c==null)continue;d3_layout_forceAccumulate(c,alpha,charges);quad.charge+=c.charge;cx+=c.charge*c.cx;cy+=c.charge*c.cy;}}
if(quad.point){if(!quad.leaf){quad.point.x+=Math.random()-.5;quad.point.y+=Math.random()-.5;}
var k=alpha*charges[quad.point.index];quad.charge+=quad.pointCharge=k;cx+=k*quad.point.x;cy+=k*quad.point.y;}
quad.cx=cx/quad.charge;quad.cy=cy/quad.charge;}
function d3_layout_forceLinkDistance(link){return 20;}
function d3_layout_forceLinkStrength(link){return 1;}
function d3_layout_stackX(d){return d.x;}
function d3_layout_stackY(d){return d.y;}
function d3_layout_stackOut(d,y0,y){d.y0=y0;d.y=y;}
function d3_layout_stackOrderDefault(data){return d3.range(data.length);}
function d3_layout_stackOffsetZero(data){var j=-1,m=data[0].length,y0=[];while(++j<m)y0[j]=0;return y0;}
function d3_layout_stackMaxIndex(array){var i=1,j=0,v=array[0][1],k,n=array.length;for(;i<n;++i){if((k=array[i][1])>v){j=i;v=k;}}
return j;}
function d3_layout_stackReduceSum(d){return d.reduce(d3_layout_stackSum,0);}
function d3_layout_stackSum(p,d){return p+d[1];}
function d3_layout_histogramBinSturges(range,values){return d3_layout_histogramBinFixed(range,Math.ceil(Math.log(values.length)/Math.LN2+1));}
function d3_layout_histogramBinFixed(range,n){var x=-1,b=+range[0],m=(range[1]-b)/n,f=[];while(++x<=n)f[x]=m*x+b;return f;}
function d3_layout_histogramRange(values){return[d3.min(values),d3.max(values)];}
function d3_layout_hierarchyRebind(object,hierarchy){d3.rebind(object,hierarchy,"sort","children","value");object.links=d3_layout_hierarchyLinks;object.nodes=function(d){d3_layout_hierarchyInline=true;return(object.nodes=object)(d);};return object;}
function d3_layout_hierarchyChildren(d){return d.children;}
function d3_layout_hierarchyValue(d){return d.value;}
function d3_layout_hierarchySort(a,b){return b.value-a.value;}
function d3_layout_hierarchyLinks(nodes){return d3.merge(nodes.map(function(parent){return(parent.children||[]).map(function(child){return{source:parent,target:child};});}));}
function d3_layout_packSort(a,b){return a.value-b.value;}
function d3_layout_packInsert(a,b){var c=a._pack_next;a._pack_next=b;b._pack_prev=a;b._pack_next=c;c._pack_prev=b;}
function d3_layout_packSplice(a,b){a._pack_next=b;b._pack_prev=a;}
function d3_layout_packIntersects(a,b){var dx=b.x-a.x,dy=b.y-a.y,dr=a.r+b.r;return dr*dr-dx*dx-dy*dy>.001;}
function d3_layout_packSiblings(node){function bound(node){xMin=Math.min(node.x-node.r,xMin);xMax=Math.max(node.x+node.r,xMax);yMin=Math.min(node.y-node.r,yMin);yMax=Math.max(node.y+node.r,yMax);}
if(!(nodes=node.children)||!(n=nodes.length))return;var nodes,xMin=Infinity,xMax=-Infinity,yMin=Infinity,yMax=-Infinity,a,b,c,i,j,k,n;nodes.forEach(d3_layout_packLink);a=nodes[0];a.x=-a.r;a.y=0;bound(a);if(n>1){b=nodes[1];b.x=b.r;b.y=0;bound(b);if(n>2){c=nodes[2];d3_layout_packPlace(a,b,c);bound(c);d3_layout_packInsert(a,c);a._pack_prev=c;d3_layout_packInsert(c,b);b=a._pack_next;for(i=3;i<n;i++){d3_layout_packPlace(a,b,c=nodes[i]);var isect=0,s1=1,s2=1;for(j=b._pack_next;j!==b;j=j._pack_next,s1++){if(d3_layout_packIntersects(j,c)){isect=1;break;}}
if(isect==1){for(k=a._pack_prev;k!==j._pack_prev;k=k._pack_prev,s2++){if(d3_layout_packIntersects(k,c)){break;}}}
if(isect){if(s1<s2||s1==s2&&b.r<a.r)d3_layout_packSplice(a,b=j);else d3_layout_packSplice(a=k,b);i--;}else{d3_layout_packInsert(a,c);b=c;bound(c);}}}}
var cx=(xMin+xMax)/2,cy=(yMin+yMax)/2,cr=0;for(i=0;i<n;i++){c=nodes[i];c.x-=cx;c.y-=cy;cr=Math.max(cr,c.r+Math.sqrt(c.x*c.x+c.y*c.y));}
node.r=cr;nodes.forEach(d3_layout_packUnlink);}
function d3_layout_packLink(node){node._pack_next=node._pack_prev=node;}
function d3_layout_packUnlink(node){delete node._pack_next;delete node._pack_prev;}
function d3_layout_packTransform(node,x,y,k){var children=node.children;node.x=x+=k*node.x;node.y=y+=k*node.y;node.r*=k;if(children){var i=-1,n=children.length;while(++i<n)d3_layout_packTransform(children[i],x,y,k);}}
function d3_layout_packPlace(a,b,c){var db=a.r+c.r,dx=b.x-a.x,dy=b.y-a.y;if(db&&(dx||dy)){var da=b.r+c.r,dc=dx*dx+dy*dy;da*=da;db*=db;var x=.5+(db-da)/(2*dc),y=Math.sqrt(Math.max(0,2*da*(db+dc)-(db-=dc)*db-da*da))/(2*dc);c.x=a.x+x*dx+y*dy;c.y=a.y+x*dy-y*dx;}else{c.x=a.x+db;c.y=a.y;}}
function d3_layout_clusterY(children){return 1+d3.max(children,function(child){return child.y;});}
function d3_layout_clusterX(children){return children.reduce(function(x,child){return x+child.x;},0)/children.length;}
function d3_layout_clusterLeft(node){var children=node.children;return children&&children.length?d3_layout_clusterLeft(children[0]):node;}
function d3_layout_clusterRight(node){var children=node.children,n;return children&&(n=children.length)?d3_layout_clusterRight(children[n-1]):node;}
function d3_layout_treeSeparation(a,b){return a.parent==b.parent?1:2;}
function d3_layout_treeLeft(node){var children=node.children;return children&&children.length?children[0]:node._tree.thread;}
function d3_layout_treeRight(node){var children=node.children,n;return children&&(n=children.length)?children[n-1]:node._tree.thread;}
function d3_layout_treeSearch(node,compare){var children=node.children;if(children&&(n=children.length)){var child,n,i=-1;while(++i<n){if(compare(child=d3_layout_treeSearch(children[i],compare),node)>0){node=child;}}}
return node;}
function d3_layout_treeRightmost(a,b){return a.x-b.x;}
function d3_layout_treeLeftmost(a,b){return b.x-a.x;}
function d3_layout_treeDeepest(a,b){return a.depth-b.depth;}
function d3_layout_treeVisitAfter(node,callback){function visit(node,previousSibling){var children=node.children;if(children&&(n=children.length)){var child,previousChild=null,i=-1,n;while(++i<n){child=children[i];visit(child,previousChild);previousChild=child;}}
callback(node,previousSibling);}
visit(node,null);}
function d3_layout_treeShift(node){var shift=0,change=0,children=node.children,i=children.length,child;while(--i>=0){child=children[i]._tree;child.prelim+=shift;child.mod+=shift;shift+=child.shift+(change+=child.change);}}
function d3_layout_treeMove(ancestor,node,shift){ancestor=ancestor._tree;node=node._tree;var change=shift/(node.number-ancestor.number);ancestor.change+=change;node.change-=change;node.shift+=shift;node.prelim+=shift;node.mod+=shift;}
function d3_layout_treeAncestor(vim,node,ancestor){return vim._tree.ancestor.parent==node.parent?vim._tree.ancestor:ancestor;}
function d3_layout_treemapPadNull(node){return{x:node.x,y:node.y,dx:node.dx,dy:node.dy};}
function d3_layout_treemapPad(node,padding){var x=node.x+padding[3],y=node.y+padding[0],dx=node.dx-padding[1]-padding[3],dy=node.dy-padding[0]-padding[2];if(dx<0){x+=dx/2;dx=0;}
if(dy<0){y+=dy/2;dy=0;}
return{x:x,y:y,dx:dx,dy:dy};}
function d3_dsv(delimiter,mimeType){function dsv(url,callback){d3.text(url,mimeType,function(text){callback(text&&dsv.parse(text));});}
function formatRow(row){return row.map(formatValue).join(delimiter);}
function formatValue(text){return reFormat.test(text)?'"'+text.replace(/\"/g,'""')+'"':text;}
var reParse=new RegExp("\r\n|["+delimiter+"\r\n]","g"),reFormat=new RegExp('["'+delimiter+"\n]"),delimiterCode=delimiter.charCodeAt(0);dsv.parse=function(text){var header;return dsv.parseRows(text,function(row,i){if(i){var o={},j=-1,m=header.length;while(++j<m)o[header[j]]=row[j];return o;}else{header=row;return null;}});};dsv.parseRows=function(text,f){function token(){if(reParse.lastIndex>=text.length)return EOF;if(eol){eol=false;return EOL;}
var j=reParse.lastIndex;if(text.charCodeAt(j)===34){var i=j;while(i++<text.length){if(text.charCodeAt(i)===34){if(text.charCodeAt(i+1)!==34)break;i++;}}
reParse.lastIndex=i+2;var c=text.charCodeAt(i+1);if(c===13){eol=true;if(text.charCodeAt(i+2)===10)reParse.lastIndex++;}else if(c===10){eol=true;}
return text.substring(j+1,i).replace(/""/g,'"');}
var m=reParse.exec(text);if(m){eol=m[0].charCodeAt(0)!==delimiterCode;return text.substring(j,m.index);}
reParse.lastIndex=text.length;return text.substring(j);}
var EOL={},EOF={},rows=[],n=0,t,eol;reParse.lastIndex=0;while((t=token())!==EOF){var a=[];while(t!==EOL&&t!==EOF){a.push(t);t=token();}
if(f&&!(a=f(a,n++)))continue;rows.push(a);}
return rows;};dsv.format=function(rows){return rows.map(formatRow).join("\n");};return dsv;}
function d3_geo_type(types,defaultValue){return function(object){return object&&types.hasOwnProperty(object.type)?types[object.type](object):defaultValue;};}
function d3_path_circle(radius){return"m0,"+radius+"a"+radius+","+radius+" 0 1,1 0,"+-2*radius+"a"+radius+","+radius+" 0 1,1 0,"+ +2*radius+"z";}
function d3_geo_bounds(o,f){if(d3_geo_boundsTypes.hasOwnProperty(o.type))d3_geo_boundsTypes[o.type](o,f);}
function d3_geo_boundsFeature(o,f){d3_geo_bounds(o.geometry,f);}
function d3_geo_boundsFeatureCollection(o,f){for(var a=o.features,i=0,n=a.length;i<n;i++){d3_geo_bounds(a[i].geometry,f);}}
function d3_geo_boundsGeometryCollection(o,f){for(var a=o.geometries,i=0,n=a.length;i<n;i++){d3_geo_bounds(a[i],f);}}
function d3_geo_boundsLineString(o,f){for(var a=o.coordinates,i=0,n=a.length;i<n;i++){f.apply(null,a[i]);}}
function d3_geo_boundsMultiLineString(o,f){for(var a=o.coordinates,i=0,n=a.length;i<n;i++){for(var b=a[i],j=0,m=b.length;j<m;j++){f.apply(null,b[j]);}}}
function d3_geo_boundsMultiPolygon(o,f){for(var a=o.coordinates,i=0,n=a.length;i<n;i++){for(var b=a[i][0],j=0,m=b.length;j<m;j++){f.apply(null,b[j]);}}}
function d3_geo_boundsPoint(o,f){f.apply(null,o.coordinates);}
function d3_geo_boundsPolygon(o,f){for(var a=o.coordinates[0],i=0,n=a.length;i<n;i++){f.apply(null,a[i]);}}
function d3_geo_greatArcSource(d){return d.source;}
function d3_geo_greatArcTarget(d){return d.target;}
function d3_geo_greatArcInterpolator(){function interpolate(t){var B=Math.sin(t*=d)*k,A=Math.sin(d-t)*k,x=A*kx0+B*kx1,y=A*ky0+B*ky1,z=A*sy0+B*sy1;return[Math.atan2(y,x)/d3_geo_radians,Math.atan2(z,Math.sqrt(x*x+y*y))/d3_geo_radians];}
var x0,y0,cy0,sy0,kx0,ky0,x1,y1,cy1,sy1,kx1,ky1,d,k;interpolate.distance=function(){if(d==null)k=1/Math.sin(d=Math.acos(Math.max(-1,Math.min(1,sy0*sy1+cy0*cy1*Math.cos(x1-x0)))));return d;};interpolate.source=function(_){var cx0=Math.cos(x0=_[0]*d3_geo_radians),sx0=Math.sin(x0);cy0=Math.cos(y0=_[1]*d3_geo_radians);sy0=Math.sin(y0);kx0=cy0*cx0;ky0=cy0*sx0;d=null;return interpolate;};interpolate.target=function(_){var cx1=Math.cos(x1=_[0]*d3_geo_radians),sx1=Math.sin(x1);cy1=Math.cos(y1=_[1]*d3_geo_radians);sy1=Math.sin(y1);kx1=cy1*cx1;ky1=cy1*sx1;d=null;return interpolate;};return interpolate;}
function d3_geo_greatArcInterpolate(a,b){var i=d3_geo_greatArcInterpolator().source(a).target(b);i.distance();return i;}
function d3_geom_contourStart(grid){var x=0,y=0;while(true){if(grid(x,y)){return[x,y];}
if(x===0){x=y+1;y=0;}else{x=x-1;y=y+1;}}}
function d3_geom_hullCCW(i1,i2,i3,v){var t,a,b,c,d,e,f;t=v[i1];a=t[0];b=t[1];t=v[i2];c=t[0];d=t[1];t=v[i3];e=t[0];f=t[1];return(f-b)*(c-a)-(d-b)*(e-a)>0;}
function d3_geom_polygonInside(p,a,b){return(b[0]-a[0])*(p[1]-a[1])<(b[1]-a[1])*(p[0]-a[0]);}
function d3_geom_polygonIntersect(c,d,a,b){var x1=c[0],x2=d[0],x3=a[0],x4=b[0],y1=c[1],y2=d[1],y3=a[1],y4=b[1],x13=x1-x3,x21=x2-x1,x43=x4-x3,y13=y1-y3,y21=y2-y1,y43=y4-y3,ua=(x43*y13-y43*x13)/(y43*x21-x43*y21);return[x1+ua*x21,y1+ua*y21];}
function d3_voronoi_tessellate(vertices,callback){var Sites={list:vertices.map(function(v,i){return{index:i,x:v[0],y:v[1]};}).sort(function(a,b){return a.y<b.y?-1:a.y>b.y?1:a.x<b.x?-1:a.x>b.x?1:0;}),bottomSite:null};var EdgeList={list:[],leftEnd:null,rightEnd:null,init:function(){EdgeList.leftEnd=EdgeList.createHalfEdge(null,"l");EdgeList.rightEnd=EdgeList.createHalfEdge(null,"l");EdgeList.leftEnd.r=EdgeList.rightEnd;EdgeList.rightEnd.l=EdgeList.leftEnd;EdgeList.list.unshift(EdgeList.leftEnd,EdgeList.rightEnd);},createHalfEdge:function(edge,side){return{edge:edge,side:side,vertex:null,l:null,r:null};},insert:function(lb,he){he.l=lb;he.r=lb.r;lb.r.l=he;lb.r=he;},leftBound:function(p){var he=EdgeList.leftEnd;do{he=he.r;}while(he!=EdgeList.rightEnd&&Geom.rightOf(he,p));he=he.l;return he;},del:function(he){he.l.r=he.r;he.r.l=he.l;he.edge=null;},right:function(he){return he.r;},left:function(he){return he.l;},leftRegion:function(he){return he.edge==null?Sites.bottomSite:he.edge.region[he.side];},rightRegion:function(he){return he.edge==null?Sites.bottomSite:he.edge.region[d3_voronoi_opposite[he.side]];}};var Geom={bisect:function(s1,s2){var newEdge={region:{l:s1,r:s2},ep:{l:null,r:null}};var dx=s2.x-s1.x,dy=s2.y-s1.y,adx=dx>0?dx:-dx,ady=dy>0?dy:-dy;newEdge.c=s1.x*dx+s1.y*dy+(dx*dx+dy*dy)*.5;if(adx>ady){newEdge.a=1;newEdge.b=dy/dx;newEdge.c/=dx;}else{newEdge.b=1;newEdge.a=dx/dy;newEdge.c/=dy;}
return newEdge;},intersect:function(el1,el2){var e1=el1.edge,e2=el2.edge;if(!e1||!e2||e1.region.r==e2.region.r){return null;}
var d=e1.a*e2.b-e1.b*e2.a;if(Math.abs(d)<1e-10){return null;}
var xint=(e1.c*e2.b-e2.c*e1.b)/d,yint=(e2.c*e1.a-e1.c*e2.a)/d,e1r=e1.region.r,e2r=e2.region.r,el,e;if(e1r.y<e2r.y||e1r.y==e2r.y&&e1r.x<e2r.x){el=el1;e=e1;}else{el=el2;e=e2;}
var rightOfSite=xint>=e.region.r.x;if(rightOfSite&&el.side==="l"||!rightOfSite&&el.side==="r"){return null;}
return{x:xint,y:yint};},rightOf:function(he,p){var e=he.edge,topsite=e.region.r,rightOfSite=p.x>topsite.x;if(rightOfSite&&he.side==="l"){return 1;}
if(!rightOfSite&&he.side==="r"){return 0;}
if(e.a===1){var dyp=p.y-topsite.y,dxp=p.x-topsite.x,fast=0,above=0;if(!rightOfSite&&e.b<0||rightOfSite&&e.b>=0){above=fast=dyp>=e.b*dxp;}else{above=p.x+p.y*e.b>e.c;if(e.b<0){above=!above;}
if(!above){fast=1;}}
if(!fast){var dxs=topsite.x-e.region.l.x;above=e.b*(dxp*dxp-dyp*dyp)<dxs*dyp*(1+2*dxp/dxs+e.b*e.b);if(e.b<0){above=!above;}}}else{var yl=e.c-e.a*p.x,t1=p.y-yl,t2=p.x-topsite.x,t3=yl-topsite.y;above=t1*t1>t2*t2+t3*t3;}
return he.side==="l"?above:!above;},endPoint:function(edge,side,site){edge.ep[side]=site;if(!edge.ep[d3_voronoi_opposite[side]])return;callback(edge);},distance:function(s,t){var dx=s.x-t.x,dy=s.y-t.y;return Math.sqrt(dx*dx+dy*dy);}};var EventQueue={list:[],insert:function(he,site,offset){he.vertex=site;he.ystar=site.y+offset;for(var i=0,list=EventQueue.list,l=list.length;i<l;i++){var next=list[i];if(he.ystar>next.ystar||he.ystar==next.ystar&&site.x>next.vertex.x){continue;}else{break;}}
list.splice(i,0,he);},del:function(he){for(var i=0,ls=EventQueue.list,l=ls.length;i<l&&ls[i]!=he;++i){}
ls.splice(i,1);},empty:function(){return EventQueue.list.length===0;},nextEvent:function(he){for(var i=0,ls=EventQueue.list,l=ls.length;i<l;++i){if(ls[i]==he)return ls[i+1];}
return null;},min:function(){var elem=EventQueue.list[0];return{x:elem.vertex.x,y:elem.ystar};},extractMin:function(){return EventQueue.list.shift();}};EdgeList.init();Sites.bottomSite=Sites.list.shift();var newSite=Sites.list.shift(),newIntStar;var lbnd,rbnd,llbnd,rrbnd,bisector;var bot,top,temp,p,v;var e,pm;while(true){if(!EventQueue.empty()){newIntStar=EventQueue.min();}
if(newSite&&(EventQueue.empty()||newSite.y<newIntStar.y||newSite.y==newIntStar.y&&newSite.x<newIntStar.x)){lbnd=EdgeList.leftBound(newSite);rbnd=EdgeList.right(lbnd);bot=EdgeList.rightRegion(lbnd);e=Geom.bisect(bot,newSite);bisector=EdgeList.createHalfEdge(e,"l");EdgeList.insert(lbnd,bisector);p=Geom.intersect(lbnd,bisector);if(p){EventQueue.del(lbnd);EventQueue.insert(lbnd,p,Geom.distance(p,newSite));}
lbnd=bisector;bisector=EdgeList.createHalfEdge(e,"r");EdgeList.insert(lbnd,bisector);p=Geom.intersect(bisector,rbnd);if(p){EventQueue.insert(bisector,p,Geom.distance(p,newSite));}
newSite=Sites.list.shift();}else if(!EventQueue.empty()){lbnd=EventQueue.extractMin();llbnd=EdgeList.left(lbnd);rbnd=EdgeList.right(lbnd);rrbnd=EdgeList.right(rbnd);bot=EdgeList.leftRegion(lbnd);top=EdgeList.rightRegion(rbnd);v=lbnd.vertex;Geom.endPoint(lbnd.edge,lbnd.side,v);Geom.endPoint(rbnd.edge,rbnd.side,v);EdgeList.del(lbnd);EventQueue.del(rbnd);EdgeList.del(rbnd);pm="l";if(bot.y>top.y){temp=bot;bot=top;top=temp;pm="r";}
e=Geom.bisect(bot,top);bisector=EdgeList.createHalfEdge(e,pm);EdgeList.insert(llbnd,bisector);Geom.endPoint(e,d3_voronoi_opposite[pm],v);p=Geom.intersect(llbnd,bisector);if(p){EventQueue.del(llbnd);EventQueue.insert(llbnd,p,Geom.distance(p,bot));}
p=Geom.intersect(bisector,rrbnd);if(p){EventQueue.insert(bisector,p,Geom.distance(p,bot));}}else{break;}}
for(lbnd=EdgeList.right(EdgeList.leftEnd);lbnd!=EdgeList.rightEnd;lbnd=EdgeList.right(lbnd)){callback(lbnd.edge);}}
function d3_geom_quadtreeNode(){return{leaf:true,nodes:[],point:null};}
function d3_geom_quadtreeVisit(f,node,x1,y1,x2,y2){if(!f(node,x1,y1,x2,y2)){var sx=(x1+x2)*.5,sy=(y1+y2)*.5,children=node.nodes;if(children[0])d3_geom_quadtreeVisit(f,children[0],x1,y1,sx,sy);if(children[1])d3_geom_quadtreeVisit(f,children[1],sx,y1,x2,sy);if(children[2])d3_geom_quadtreeVisit(f,children[2],x1,sy,sx,y2);if(children[3])d3_geom_quadtreeVisit(f,children[3],sx,sy,x2,y2);}}
function d3_geom_quadtreePoint(p){return{x:p[0],y:p[1]};}
function d3_time_utc(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0]);}
function d3_time_formatAbbreviate(name){return name.substring(0,3);}
function d3_time_parse(date,template,string,j){var c,p,i=0,n=template.length,m=string.length;while(i<n){if(j>=m)return-1;c=template.charCodeAt(i++);if(c==37){p=d3_time_parsers[template.charAt(i++)];if(!p||(j=p(date,string,j))<0)return-1;}else if(c!=string.charCodeAt(j++)){return-1;}}
return j;}
function d3_time_formatRe(names){return new RegExp("^(?:"+names.map(d3.requote).join("|")+")","i");}
function d3_time_formatLookup(names){var map=new d3_Map,i=-1,n=names.length;while(++i<n)map.set(names[i].toLowerCase(),i);return map;}
function d3_time_parseWeekdayAbbrev(date,string,i){d3_time_dayAbbrevRe.lastIndex=0;var n=d3_time_dayAbbrevRe.exec(string.substring(i));return n?i+=n[0].length:-1;}
function d3_time_parseWeekday(date,string,i){d3_time_dayRe.lastIndex=0;var n=d3_time_dayRe.exec(string.substring(i));return n?i+=n[0].length:-1;}
function d3_time_parseMonthAbbrev(date,string,i){d3_time_monthAbbrevRe.lastIndex=0;var n=d3_time_monthAbbrevRe.exec(string.substring(i));return n?(date.m=d3_time_monthAbbrevLookup.get(n[0].toLowerCase()),i+=n[0].length):-1;}
function d3_time_parseMonth(date,string,i){d3_time_monthRe.lastIndex=0;var n=d3_time_monthRe.exec(string.substring(i));return n?(date.m=d3_time_monthLookup.get(n[0].toLowerCase()),i+=n[0].length):-1;}
function d3_time_parseLocaleFull(date,string,i){return d3_time_parse(date,d3_time_formats.c.toString(),string,i);}
function d3_time_parseLocaleDate(date,string,i){return d3_time_parse(date,d3_time_formats.x.toString(),string,i);}
function d3_time_parseLocaleTime(date,string,i){return d3_time_parse(date,d3_time_formats.X.toString(),string,i);}
function d3_time_parseFullYear(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.substring(i,i+4));return n?(date.y=+n[0],i+=n[0].length):-1;}
function d3_time_parseYear(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.substring(i,i+2));return n?(date.y=d3_time_expandYear(+n[0]),i+=n[0].length):-1;}
function d3_time_expandYear(d){return d+(d>68?1900:2e3);}
function d3_time_parseMonthNumber(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.substring(i,i+2));return n?(date.m=n[0]-1,i+=n[0].length):-1;}
function d3_time_parseDay(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.substring(i,i+2));return n?(date.d=+n[0],i+=n[0].length):-1;}
function d3_time_parseHour24(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.substring(i,i+2));return n?(date.H=+n[0],i+=n[0].length):-1;}
function d3_time_parseMinutes(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.substring(i,i+2));return n?(date.M=+n[0],i+=n[0].length):-1;}
function d3_time_parseSeconds(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.substring(i,i+2));return n?(date.S=+n[0],i+=n[0].length):-1;}
function d3_time_parseMilliseconds(date,string,i){d3_time_numberRe.lastIndex=0;var n=d3_time_numberRe.exec(string.substring(i,i+3));return n?(date.L=+n[0],i+=n[0].length):-1;}
function d3_time_parseAmPm(date,string,i){var n=d3_time_amPmLookup.get(string.substring(i,i+=2).toLowerCase());return n==null?-1:(date.p=n,i);}
function d3_time_zone(d){var z=d.getTimezoneOffset(),zs=z>0?"-":"+",zh=~~(Math.abs(z)/60),zm=Math.abs(z)%60;return zs+d3_time_zfill2(zh)+d3_time_zfill2(zm);}
function d3_time_formatIsoNative(date){return date.toISOString();}
function d3_time_interval(local,step,number){function round(date){var d0=local(date),d1=offset(d0,1);return date-d0<d1-date?d0:d1;}
function ceil(date){step(date=local(new d3_time(date-1)),1);return date;}
function offset(date,k){step(date=new d3_time(+date),k);return date;}
function range(t0,t1,dt){var time=ceil(t0),times=[];if(dt>1){while(time<t1){if(!(number(time)%dt))times.push(new Date(+time));step(time,1);}}else{while(time<t1)times.push(new Date(+time)),step(time,1);}
return times;}
function range_utc(t0,t1,dt){try{d3_time=d3_time_utc;var utc=new d3_time_utc;utc._=t0;return range(utc,t1,dt);}finally{d3_time=Date;}}
local.floor=local;local.round=round;local.ceil=ceil;local.offset=offset;local.range=range;var utc=local.utc=d3_time_interval_utc(local);utc.floor=utc;utc.round=d3_time_interval_utc(round);utc.ceil=d3_time_interval_utc(ceil);utc.offset=d3_time_interval_utc(offset);utc.range=range_utc;return local;}
function d3_time_interval_utc(method){return function(date,k){try{d3_time=d3_time_utc;var utc=new d3_time_utc;utc._=date;return method(utc,k)._;}finally{d3_time=Date;}};}
function d3_time_scale(linear,methods,format){function scale(x){return linear(x);}
scale.invert=function(x){return d3_time_scaleDate(linear.invert(x));};scale.domain=function(x){if(!arguments.length)return linear.domain().map(d3_time_scaleDate);linear.domain(x);return scale;};scale.nice=function(m){return scale.domain(d3_scale_nice(scale.domain(),function(){return m;}));};scale.ticks=function(m,k){var extent=d3_time_scaleExtent(scale.domain());if(typeof m!=="function"){var span=extent[1]-extent[0],target=span/m,i=d3.bisect(d3_time_scaleSteps,target);if(i==d3_time_scaleSteps.length)return methods.year(extent,m);if(!i)return linear.ticks(m).map(d3_time_scaleDate);if(Math.log(target/d3_time_scaleSteps[i-1])<Math.log(d3_time_scaleSteps[i]/target))--i;m=methods[i];k=m[1];m=m[0].range;}
return m(extent[0],new Date(+extent[1]+1),k);};scale.tickFormat=function(){return format;};scale.copy=function(){return d3_time_scale(linear.copy(),methods,format);};return d3.rebind(scale,linear,"range","rangeRound","interpolate","clamp");}
function d3_time_scaleExtent(domain){var start=domain[0],stop=domain[domain.length-1];return start<stop?[start,stop]:[stop,start];}
function d3_time_scaleDate(t){return new Date(t);}
function d3_time_scaleFormat(formats){return function(date){var i=formats.length-1,f=formats[i];while(!f[1](date))f=formats[--i];return f[0](date);};}
function d3_time_scaleSetYear(y){var d=new Date(y,0,1);d.setFullYear(y);return d;}
function d3_time_scaleGetYear(d){var y=d.getFullYear(),d0=d3_time_scaleSetYear(y),d1=d3_time_scaleSetYear(y+1);return y+(d-d0)/(d1-d0);}
function d3_time_scaleUTCSetYear(y){var d=new Date(Date.UTC(y,0,1));d.setUTCFullYear(y);return d;}
function d3_time_scaleUTCGetYear(d){var y=d.getUTCFullYear(),d0=d3_time_scaleUTCSetYear(y),d1=d3_time_scaleUTCSetYear(y+1);return y+(d-d0)/(d1-d0);}
if(!Date.now)Date.now=function(){return+(new Date);};try{document.createElement("div").style.setProperty("opacity",0,"");}catch(error){var d3_style_prototype=CSSStyleDeclaration.prototype,d3_style_setProperty=d3_style_prototype.setProperty;d3_style_prototype.setProperty=function(name,value,priority){d3_style_setProperty.call(this,name,value+"",priority);};}
d3={version:"2.10.3"};var d3_array=d3_arraySlice;try{d3_array(document.documentElement.childNodes)[0].nodeType;}catch(e){d3_array=d3_arrayCopy;}
var d3_arraySubclass=[].__proto__?function(array,prototype){array.__proto__=prototype;}:function(array,prototype){for(var property in prototype)array[property]=prototype[property];};d3.map=function(object){var map=new d3_Map;for(var key in object)map.set(key,object[key]);return map;};d3_class(d3_Map,{has:function(key){return d3_map_prefix+key in this;},get:function(key){return this[d3_map_prefix+key];},set:function(key,value){return this[d3_map_prefix+key]=value;},remove:function(key){key=d3_map_prefix+key;return key in this&&delete this[key];},keys:function(){var keys=[];this.forEach(function(key){keys.push(key);});return keys;},values:function(){var values=[];this.forEach(function(key,value){values.push(value);});return values;},entries:function(){var entries=[];this.forEach(function(key,value){entries.push({key:key,value:value});});return entries;},forEach:function(f){for(var key in this){if(key.charCodeAt(0)===d3_map_prefixCode){f.call(this,key.substring(1),this[key]);}}}});var d3_map_prefix="\0",d3_map_prefixCode=d3_map_prefix.charCodeAt(0);d3.functor=d3_functor;d3.rebind=function(target,source){var i=1,n=arguments.length,method;while(++i<n)target[method=arguments[i]]=d3_rebind(target,source,source[method]);return target;};d3.ascending=function(a,b){return a<b?-1:a>b?1:a>=b?0:NaN;};d3.descending=function(a,b){return b<a?-1:b>a?1:b>=a?0:NaN;};d3.mean=function(array,f){var n=array.length,a,m=0,i=-1,j=0;if(arguments.length===1){while(++i<n)if(d3_number(a=array[i]))m+=(a-m)/++j;}else{while(++i<n)if(d3_number(a=f.call(array,array[i],i)))m+=(a-m)/++j;}
return j?m:undefined;};d3.median=function(array,f){if(arguments.length>1)array=array.map(f);array=array.filter(d3_number);return array.length?d3.quantile(array.sort(d3.ascending),.5):undefined;};d3.min=function(array,f){var i=-1,n=array.length,a,b;if(arguments.length===1){while(++i<n&&((a=array[i])==null||a!=a))a=undefined;while(++i<n)if((b=array[i])!=null&&a>b)a=b;}else{while(++i<n&&((a=f.call(array,array[i],i))==null||a!=a))a=undefined;while(++i<n)if((b=f.call(array,array[i],i))!=null&&a>b)a=b;}
return a;};d3.max=function(array,f){var i=-1,n=array.length,a,b;if(arguments.length===1){while(++i<n&&((a=array[i])==null||a!=a))a=undefined;while(++i<n)if((b=array[i])!=null&&b>a)a=b;}else{while(++i<n&&((a=f.call(array,array[i],i))==null||a!=a))a=undefined;while(++i<n)if((b=f.call(array,array[i],i))!=null&&b>a)a=b;}
return a;};d3.extent=function(array,f){var i=-1,n=array.length,a,b,c;if(arguments.length===1){while(++i<n&&((a=c=array[i])==null||a!=a))a=c=undefined;while(++i<n)if((b=array[i])!=null){if(a>b)a=b;if(c<b)c=b;}}else{while(++i<n&&((a=c=f.call(array,array[i],i))==null||a!=a))a=undefined;while(++i<n)if((b=f.call(array,array[i],i))!=null){if(a>b)a=b;if(c<b)c=b;}}
return[a,c];};d3.random={normal:function(µ,σ){var n=arguments.length;if(n<2)σ=1;if(n<1)µ=0;return function(){var x,y,r;do{x=Math.random()*2-1;y=Math.random()*2-1;r=x*x+y*y;}while(!r||r>1);return µ+σ*x*Math.sqrt(-2*Math.log(r)/r);};},logNormal:function(µ,σ){var n=arguments.length;if(n<2)σ=1;if(n<1)µ=0;var random=d3.random.normal();return function(){return Math.exp(µ+σ*random());};},irwinHall:function(m){return function(){for(var s=0,j=0;j<m;j++)s+=Math.random();return s/m;};}};d3.sum=function(array,f){var s=0,n=array.length,a,i=-1;if(arguments.length===1){while(++i<n)if(!isNaN(a=+array[i]))s+=a;}else{while(++i<n)if(!isNaN(a=+f.call(array,array[i],i)))s+=a;}
return s;};d3.quantile=function(values,p){var H=(values.length-1)*p+1,h=Math.floor(H),v=values[h-1],e=H-h;return e?v+e*(values[h]-v):v;};d3.transpose=function(matrix){return d3.zip.apply(d3,matrix);};d3.zip=function(){if(!(n=arguments.length))return[];for(var i=-1,m=d3.min(arguments,d3_zipLength),zips=new Array(m);++i<m;){for(var j=-1,n,zip=zips[i]=new Array(n);++j<n;){zip[j]=arguments[j][i];}}
return zips;};d3.bisector=function(f){return{left:function(a,x,lo,hi){if(arguments.length<3)lo=0;if(arguments.length<4)hi=a.length;while(lo<hi){var mid=lo+hi>>>1;if(f.call(a,a[mid],mid)<x)lo=mid+1;else hi=mid;}
return lo;},right:function(a,x,lo,hi){if(arguments.length<3)lo=0;if(arguments.length<4)hi=a.length;while(lo<hi){var mid=lo+hi>>>1;if(x<f.call(a,a[mid],mid))hi=mid;else lo=mid+1;}
return lo;}};};var d3_bisector=d3.bisector(function(d){return d;});d3.bisectLeft=d3_bisector.left;d3.bisect=d3.bisectRight=d3_bisector.right;d3.first=function(array,f){var i=0,n=array.length,a=array[0],b;if(arguments.length===1)f=d3.ascending;while(++i<n){if(f.call(array,a,b=array[i])>0){a=b;}}
return a;};d3.last=function(array,f){var i=0,n=array.length,a=array[0],b;if(arguments.length===1)f=d3.ascending;while(++i<n){if(f.call(array,a,b=array[i])<=0){a=b;}}
return a;};d3.nest=function(){function map(array,depth){if(depth>=keys.length)return rollup?rollup.call(nest,array):sortValues?array.sort(sortValues):array;var i=-1,n=array.length,key=keys[depth++],keyValue,object,valuesByKey=new d3_Map,values,o={};while(++i<n){if(values=valuesByKey.get(keyValue=key(object=array[i]))){values.push(object);}else{valuesByKey.set(keyValue,[object]);}}
valuesByKey.forEach(function(keyValue,values){o[keyValue]=map(values,depth);});return o;}
function entries(map,depth){if(depth>=keys.length)return map;var a=[],sortKey=sortKeys[depth++],key;for(key in map){a.push({key:key,values:entries(map[key],depth)});}
if(sortKey)a.sort(function(a,b){return sortKey(a.key,b.key);});return a;}
var nest={},keys=[],sortKeys=[],sortValues,rollup;nest.map=function(array){return map(array,0);};nest.entries=function(array){return entries(map(array,0),0);};nest.key=function(d){keys.push(d);return nest;};nest.sortKeys=function(order){sortKeys[keys.length-1]=order;return nest;};nest.sortValues=function(order){sortValues=order;return nest;};nest.rollup=function(f){rollup=f;return nest;};return nest;};d3.keys=function(map){var keys=[];for(var key in map)keys.push(key);return keys;};d3.values=function(map){var values=[];for(var key in map)values.push(map[key]);return values;};d3.entries=function(map){var entries=[];for(var key in map)entries.push({key:key,value:map[key]});return entries;};d3.permute=function(array,indexes){var permutes=[],i=-1,n=indexes.length;while(++i<n)permutes[i]=array[indexes[i]];return permutes;};d3.merge=function(arrays){return Array.prototype.concat.apply([],arrays);};d3.split=function(array,f){var arrays=[],values=[],value,i=-1,n=array.length;if(arguments.length<2)f=d3_splitter;while(++i<n){if(f.call(values,value=array[i],i)){values=[];}else{if(!values.length)arrays.push(values);values.push(value);}}
return arrays;};d3.range=function(start,stop,step){if(arguments.length<3){step=1;if(arguments.length<2){stop=start;start=0;}}
if((stop-start)/step===Infinity)throw new Error("infinite range");var range=[],k=d3_range_integerScale(Math.abs(step)),i=-1,j;start*=k,stop*=k,step*=k;if(step<0)while((j=start+step*++i)>stop)range.push(j/k);else while((j=start+step*++i)<stop)range.push(j/k);return range;};d3.requote=function(s){return s.replace(d3_requote_re,"\\$&");};var d3_requote_re=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g;d3.round=function(x,n){return n?Math.round(x*(n=Math.pow(10,n)))/n:Math.round(x);};d3.xhr=function(url,mime,callback){var req=new XMLHttpRequest;if(arguments.length<3)callback=mime,mime=null;else if(mime&&req.overrideMimeType)req.overrideMimeType(mime);req.open("GET",url,true);if(mime)req.setRequestHeader("Accept",mime);req.onreadystatechange=function(){if(req.readyState===4){var s=req.status;callback(!s&&req.response||s>=200&&s<300||s===304?req:null);}};req.send(null);};d3.text=function(url,mime,callback){function ready(req){callback(req&&req.responseText);}
if(arguments.length<3){callback=mime;mime=null;}
d3.xhr(url,mime,ready);};d3.json=function(url,callback){d3.text(url,"application/json",function(text){callback(text?JSON.parse(text):null);});};d3.html=function(url,callback){d3.text(url,"text/html",function(text){if(text!=null){var range=document.createRange();range.selectNode(document.body);text=range.createContextualFragment(text);}
callback(text);});};d3.xml=function(url,mime,callback){function ready(req){callback(req&&req.responseXML);}
if(arguments.length<3){callback=mime;mime=null;}
d3.xhr(url,mime,ready);};var d3_nsPrefix={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};d3.ns={prefix:d3_nsPrefix,qualify:function(name){var i=name.indexOf(":"),prefix=name;if(i>=0){prefix=name.substring(0,i);name=name.substring(i+1);}
return d3_nsPrefix.hasOwnProperty(prefix)?{space:d3_nsPrefix[prefix],local:name}:name;}};d3.dispatch=function(){var dispatch=new d3_dispatch,i=-1,n=arguments.length;while(++i<n)dispatch[arguments[i]]=d3_dispatch_event(dispatch);return dispatch;};d3_dispatch.prototype.on=function(type,listener){var i=type.indexOf("."),name="";if(i>0){name=type.substring(i+1);type=type.substring(0,i);}
return arguments.length<2?this[type].on(name):this[type].on(name,listener);};d3.format=function(specifier){var match=d3_format_re.exec(specifier),fill=match[1]||" ",sign=match[3]||"",zfill=match[5],width=+match[6],comma=match[7],precision=match[8],type=match[9],scale=1,suffix="",integer=false;if(precision)precision=+precision.substring(1);if(zfill){fill="0";if(comma)width-=Math.floor((width-1)/4);}
switch(type){case"n":comma=true;type="g";break;case"%":scale=100;suffix="%";type="f";break;case"p":scale=100;suffix="%";type="r";break;case"d":integer=true;precision=0;break;case"s":scale=-1;type="r";break;}
if(type=="r"&&!precision)type="g";type=d3_format_types.get(type)||d3_format_typeDefault;return function(value){if(integer&&value%1)return"";var negative=value<0&&(value=-value)?"-":sign;if(scale<0){var prefix=d3.formatPrefix(value,precision);value=prefix.scale(value);suffix=prefix.symbol;}else{value*=scale;}
value=type(value,precision);if(zfill){var length=value.length+negative.length;if(length<width)value=(new Array(width-length+1)).join(fill)+value;if(comma)value=d3_format_group(value);value=negative+value;}else{if(comma)value=d3_format_group(value);value=negative+value;var length=value.length;if(length<width)value=(new Array(width-length+1)).join(fill)+value;}
return value+suffix;};};var d3_format_re=/(?:([^{])?([<>=^]))?([+\- ])?(#)?(0)?([0-9]+)?(,)?(\.[0-9]+)?([a-zA-Z%])?/;var d3_format_types=d3.map({g:function(x,p){return x.toPrecision(p);},e:function(x,p){return x.toExponential(p);},f:function(x,p){return x.toFixed(p);},r:function(x,p){return d3.round(x,p=d3_format_precision(x,p)).toFixed(Math.max(0,Math.min(20,p)));}});var d3_formatPrefixes=["y","z","a","f","p","n","μ","m","","k","M","G","T","P","E","Z","Y"].map(d3_formatPrefix);d3.formatPrefix=function(value,precision){var i=0;if(value){if(value<0)value*=-1;if(precision)value=d3.round(value,d3_format_precision(value,precision));i=1+Math.floor(1e-12+Math.log(value)/Math.LN10);i=Math.max(-24,Math.min(24,Math.floor((i<=0?i+1:i-1)/3)*3));}
return d3_formatPrefixes[8+i/3];};var d3_ease_quad=d3_ease_poly(2),d3_ease_cubic=d3_ease_poly(3),d3_ease_default=function(){return d3_ease_identity;};var d3_ease=d3.map({linear:d3_ease_default,poly:d3_ease_poly,quad:function(){return d3_ease_quad;},cubic:function(){return d3_ease_cubic;},sin:function(){return d3_ease_sin;},exp:function(){return d3_ease_exp;},circle:function(){return d3_ease_circle;},elastic:d3_ease_elastic,back:d3_ease_back,bounce:function(){return d3_ease_bounce;}});var d3_ease_mode=d3.map({"in":d3_ease_identity,out:d3_ease_reverse,"in-out":d3_ease_reflect,"out-in":function(f){return d3_ease_reflect(d3_ease_reverse(f));}});d3.ease=function(name){var i=name.indexOf("-"),t=i>=0?name.substring(0,i):name,m=i>=0?name.substring(i+1):"in";t=d3_ease.get(t)||d3_ease_default;m=d3_ease_mode.get(m)||d3_ease_identity;return d3_ease_clamp(m(t.apply(null,Array.prototype.slice.call(arguments,1))));};d3.event=null;d3.transform=function(string){var g=document.createElementNS(d3.ns.prefix.svg,"g");return(d3.transform=function(string){g.setAttribute("transform",string);var t=g.transform.baseVal.consolidate();return new d3_transform(t?t.matrix:d3_transformIdentity);})(string);};d3_transform.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")";};var d3_transformDegrees=180/Math.PI,d3_transformIdentity={a:1,b:0,c:0,d:1,e:0,f:0};d3.interpolate=function(a,b){var i=d3.interpolators.length,f;while(--i>=0&&!(f=d3.interpolators[i](a,b)));return f;};d3.interpolateNumber=function(a,b){b-=a;return function(t){return a+b*t;};};d3.interpolateRound=function(a,b){b-=a;return function(t){return Math.round(a+b*t);};};d3.interpolateString=function(a,b){var m,i,j,s0=0,s1=0,s=[],q=[],n,o;d3_interpolate_number.lastIndex=0;for(i=0;m=d3_interpolate_number.exec(b);++i){if(m.index)s.push(b.substring(s0,s1=m.index));q.push({i:s.length,x:m[0]});s.push(null);s0=d3_interpolate_number.lastIndex;}
if(s0<b.length)s.push(b.substring(s0));for(i=0,n=q.length;(m=d3_interpolate_number.exec(a))&&i<n;++i){o=q[i];if(o.x==m[0]){if(o.i){if(s[o.i+1]==null){s[o.i-1]+=o.x;s.splice(o.i,1);for(j=i+1;j<n;++j)q[j].i--;}else{s[o.i-1]+=o.x+s[o.i+1];s.splice(o.i,2);for(j=i+1;j<n;++j)q[j].i-=2;}}else{if(s[o.i+1]==null){s[o.i]=o.x;}else{s[o.i]=o.x+s[o.i+1];s.splice(o.i+1,1);for(j=i+1;j<n;++j)q[j].i--;}}
q.splice(i,1);n--;i--;}else{o.x=d3.interpolateNumber(parseFloat(m[0]),parseFloat(o.x));}}
while(i<n){o=q.pop();if(s[o.i+1]==null){s[o.i]=o.x;}else{s[o.i]=o.x+s[o.i+1];s.splice(o.i+1,1);}
n--;}
if(s.length===1){return s[0]==null?q[0].x:function(){return b;};}
return function(t){for(i=0;i<n;++i)s[(o=q[i]).i]=o.x(t);return s.join("");};};d3.interpolateTransform=function(a,b){var s=[],q=[],n,A=d3.transform(a),B=d3.transform(b),ta=A.translate,tb=B.translate,ra=A.rotate,rb=B.rotate,wa=A.skew,wb=B.skew,ka=A.scale,kb=B.scale;if(ta[0]!=tb[0]||ta[1]!=tb[1]){s.push("translate(",null,",",null,")");q.push({i:1,x:d3.interpolateNumber(ta[0],tb[0])},{i:3,x:d3.interpolateNumber(ta[1],tb[1])});}else if(tb[0]||tb[1]){s.push("translate("+tb+")");}else{s.push("");}
if(ra!=rb){if(ra-rb>180)rb+=360;else if(rb-ra>180)ra+=360;q.push({i:s.push(s.pop()+"rotate(",null,")")-2,x:d3.interpolateNumber(ra,rb)});}else if(rb){s.push(s.pop()+"rotate("+rb+")");}
if(wa!=wb){q.push({i:s.push(s.pop()+"skewX(",null,")")-2,x:d3.interpolateNumber(wa,wb)});}else if(wb){s.push(s.pop()+"skewX("+wb+")");}
if(ka[0]!=kb[0]||ka[1]!=kb[1]){n=s.push(s.pop()+"scale(",null,",",null,")");q.push({i:n-4,x:d3.interpolateNumber(ka[0],kb[0])},{i:n-2,x:d3.interpolateNumber(ka[1],kb[1])});}else if(kb[0]!=1||kb[1]!=1){s.push(s.pop()+"scale("+kb+")");}
n=q.length;return function(t){var i=-1,o;while(++i<n)s[(o=q[i]).i]=o.x(t);return s.join("");};};d3.interpolateRgb=function(a,b){a=d3.rgb(a);b=d3.rgb(b);var ar=a.r,ag=a.g,ab=a.b,br=b.r-ar,bg=b.g-ag,bb=b.b-ab;return function(t){return"#"+d3_rgb_hex(Math.round(ar+br*t))+d3_rgb_hex(Math.round(ag+bg*t))+d3_rgb_hex(Math.round(ab+bb*t));};};d3.interpolateHsl=function(a,b){a=d3.hsl(a);b=d3.hsl(b);var h0=a.h,s0=a.s,l0=a.l,h1=b.h-h0,s1=b.s-s0,l1=b.l-l0;if(h1>180)h1-=360;else if(h1<-180)h1+=360;return function(t){return d3_hsl_rgb(h0+h1*t,s0+s1*t,l0+l1*t)+"";};};d3.interpolateLab=function(a,b){a=d3.lab(a);b=d3.lab(b);var al=a.l,aa=a.a,ab=a.b,bl=b.l-al,ba=b.a-aa,bb=b.b-ab;return function(t){return d3_lab_rgb(al+bl*t,aa+ba*t,ab+bb*t)+"";};};d3.interpolateHcl=function(a,b){a=d3.hcl(a);b=d3.hcl(b);var ah=a.h,ac=a.c,al=a.l,bh=b.h-ah,bc=b.c-ac,bl=b.l-al;if(bh>180)bh-=360;else if(bh<-180)bh+=360;return function(t){return d3_hcl_lab(ah+bh*t,ac+bc*t,al+bl*t)+"";};};d3.interpolateArray=function(a,b){var x=[],c=[],na=a.length,nb=b.length,n0=Math.min(a.length,b.length),i;for(i=0;i<n0;++i)x.push(d3.interpolate(a[i],b[i]));for(;i<na;++i)c[i]=a[i];for(;i<nb;++i)c[i]=b[i];return function(t){for(i=0;i<n0;++i)c[i]=x[i](t);return c;};};d3.interpolateObject=function(a,b){var i={},c={},k;for(k in a){if(k in b){i[k]=d3_interpolateByName(k)(a[k],b[k]);}else{c[k]=a[k];}}
for(k in b){if(!(k in a)){c[k]=b[k];}}
return function(t){for(k in i)c[k]=i[k](t);return c;};};var d3_interpolate_number=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g;d3.interpolators=[d3.interpolateObject,function(a,b){return b instanceof Array&&d3.interpolateArray(a,b);},function(a,b){return(typeof a==="string"||typeof b==="string")&&d3.interpolateString(a+"",b+"");},function(a,b){return(typeof b==="string"?d3_rgb_names.has(b)||/^(#|rgb\(|hsl\()/.test(b):b instanceof d3_Color)&&d3.interpolateRgb(a,b);},function(a,b){return!isNaN(a=+a)&&!isNaN(b=+b)&&d3.interpolateNumber(a,b);}];d3_Color.prototype.toString=function(){return this.rgb()+"";};d3.rgb=function(r,g,b){return arguments.length===1?r instanceof d3_Rgb?d3_rgb(r.r,r.g,r.b):d3_rgb_parse(""+r,d3_rgb,d3_hsl_rgb):d3_rgb(~~r,~~g,~~b);};var d3_rgbPrototype=d3_Rgb.prototype=new d3_Color;d3_rgbPrototype.brighter=function(k){k=Math.pow(.7,arguments.length?k:1);var r=this.r,g=this.g,b=this.b,i=30;if(!r&&!g&&!b)return d3_rgb(i,i,i);if(r&&r<i)r=i;if(g&&g<i)g=i;if(b&&b<i)b=i;return d3_rgb(Math.min(255,Math.floor(r/k)),Math.min(255,Math.floor(g/k)),Math.min(255,Math.floor(b/k)));};d3_rgbPrototype.darker=function(k){k=Math.pow(.7,arguments.length?k:1);return d3_rgb(Math.floor(k*this.r),Math.floor(k*this.g),Math.floor(k*this.b));};d3_rgbPrototype.hsl=function(){return d3_rgb_hsl(this.r,this.g,this.b);};d3_rgbPrototype.toString=function(){return"#"+d3_rgb_hex(this.r)+d3_rgb_hex(this.g)+d3_rgb_hex(this.b);};var d3_rgb_names=d3.map({aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"});d3_rgb_names.forEach(function(key,value){d3_rgb_names.set(key,d3_rgb_parse(value,d3_rgb,d3_hsl_rgb));});d3.hsl=function(h,s,l){return arguments.length===1?h instanceof d3_Hsl?d3_hsl(h.h,h.s,h.l):d3_rgb_parse(""+h,d3_rgb_hsl,d3_hsl):d3_hsl(+h,+s,+l);};var d3_hslPrototype=d3_Hsl.prototype=new d3_Color;d3_hslPrototype.brighter=function(k){k=Math.pow(.7,arguments.length?k:1);return d3_hsl(this.h,this.s,this.l/k);};d3_hslPrototype.darker=function(k){k=Math.pow(.7,arguments.length?k:1);return d3_hsl(this.h,this.s,k*this.l);};d3_hslPrototype.rgb=function(){return d3_hsl_rgb(this.h,this.s,this.l);};d3.hcl=function(h,c,l){return arguments.length===1?h instanceof d3_Hcl?d3_hcl(h.h,h.c,h.l):h instanceof d3_Lab?d3_lab_hcl(h.l,h.a,h.b):d3_lab_hcl((h=d3_rgb_lab((h=d3.rgb(h)).r,h.g,h.b)).l,h.a,h.b):d3_hcl(+h,+c,+l);};var d3_hclPrototype=d3_Hcl.prototype=new d3_Color;d3_hclPrototype.brighter=function(k){return d3_hcl(this.h,this.c,Math.min(100,this.l+d3_lab_K*(arguments.length?k:1)));};d3_hclPrototype.darker=function(k){return d3_hcl(this.h,this.c,Math.max(0,this.l-d3_lab_K*(arguments.length?k:1)));};d3_hclPrototype.rgb=function(){return d3_hcl_lab(this.h,this.c,this.l).rgb();};d3.lab=function(l,a,b){return arguments.length===1?l instanceof d3_Lab?d3_lab(l.l,l.a,l.b):l instanceof d3_Hcl?d3_hcl_lab(l.l,l.c,l.h):d3_rgb_lab((l=d3.rgb(l)).r,l.g,l.b):d3_lab(+l,+a,+b);};var d3_lab_K=18;var d3_lab_X=.95047,d3_lab_Y=1,d3_lab_Z=1.08883;var d3_labPrototype=d3_Lab.prototype=new d3_Color;d3_labPrototype.brighter=function(k){return d3_lab(Math.min(100,this.l+d3_lab_K*(arguments.length?k:1)),this.a,this.b);};d3_labPrototype.darker=function(k){return d3_lab(Math.max(0,this.l-d3_lab_K*(arguments.length?k:1)),this.a,this.b);};d3_labPrototype.rgb=function(){return d3_lab_rgb(this.l,this.a,this.b);};var d3_select=function(s,n){return n.querySelector(s);},d3_selectAll=function(s,n){return n.querySelectorAll(s);},d3_selectRoot=document.documentElement,d3_selectMatcher=d3_selectRoot.matchesSelector||d3_selectRoot.webkitMatchesSelector||d3_selectRoot.mozMatchesSelector||d3_selectRoot.msMatchesSelector||d3_selectRoot.oMatchesSelector,d3_selectMatches=function(n,s){return d3_selectMatcher.call(n,s);};if(typeof Sizzle==="function"){d3_select=function(s,n){return Sizzle(s,n)[0]||null;};d3_selectAll=function(s,n){return Sizzle.uniqueSort(Sizzle(s,n));};d3_selectMatches=Sizzle.matchesSelector;}
var d3_selectionPrototype=[];d3.selection=function(){return d3_selectionRoot;};d3.selection.prototype=d3_selectionPrototype;d3_selectionPrototype.select=function(selector){var subgroups=[],subgroup,subnode,group,node;if(typeof selector!=="function")selector=d3_selection_selector(selector);for(var j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]);subgroup.parentNode=(group=this[j]).parentNode;for(var i=-1,n=group.length;++i<n;){if(node=group[i]){subgroup.push(subnode=selector.call(node,node.__data__,i));if(subnode&&"__data__"in node)subnode.__data__=node.__data__;}else{subgroup.push(null);}}}
return d3_selection(subgroups);};d3_selectionPrototype.selectAll=function(selector){var subgroups=[],subgroup,node;if(typeof selector!=="function")selector=d3_selection_selectorAll(selector);for(var j=-1,m=this.length;++j<m;){for(var group=this[j],i=-1,n=group.length;++i<n;){if(node=group[i]){subgroups.push(subgroup=d3_array(selector.call(node,node.__data__,i)));subgroup.parentNode=node;}}}
return d3_selection(subgroups);};d3_selectionPrototype.attr=function(name,value){if(arguments.length<2){if(typeof name==="string"){var node=this.node();name=d3.ns.qualify(name);return name.local?node.getAttributeNS(name.space,name.local):node.getAttribute(name);}
for(value in name)this.each(d3_selection_attr(value,name[value]));return this;}
return this.each(d3_selection_attr(name,value));};d3_selectionPrototype.classed=function(name,value){if(arguments.length<2){if(typeof name==="string"){var node=this.node(),n=(name=name.trim().split(/^|\s+/g)).length,i=-1;if(value=node.classList){while(++i<n)if(!value.contains(name[i]))return false;}else{value=node.className;if(value.baseVal!=null)value=value.baseVal;while(++i<n)if(!d3_selection_classedRe(name[i]).test(value))return false;}
return true;}
for(value in name)this.each(d3_selection_classed(value,name[value]));return this;}
return this.each(d3_selection_classed(name,value));};d3_selectionPrototype.style=function(name,value,priority){var n=arguments.length;if(n<3){if(typeof name!=="string"){if(n<2)value="";for(priority in name)this.each(d3_selection_style(priority,name[priority],value));return this;}
if(n<2)return window.getComputedStyle(this.node(),null).getPropertyValue(name);priority="";}
return this.each(d3_selection_style(name,value,priority));};d3_selectionPrototype.property=function(name,value){if(arguments.length<2){if(typeof name==="string")return this.node()[name];for(value in name)this.each(d3_selection_property(value,name[value]));return this;}
return this.each(d3_selection_property(name,value));};d3_selectionPrototype.text=function(value){return arguments.length<1?this.node().textContent:this.each(typeof value==="function"?function(){var v=value.apply(this,arguments);this.textContent=v==null?"":v;}:value==null?function(){this.textContent="";}:function(){this.textContent=value;});};d3_selectionPrototype.html=function(value){return arguments.length<1?this.node().innerHTML:this.each(typeof value==="function"?function(){var v=value.apply(this,arguments);this.innerHTML=v==null?"":v;}:value==null?function(){this.innerHTML="";}:function(){this.innerHTML=value;});};d3_selectionPrototype.append=function(name){function append(){return this.appendChild(document.createElementNS(this.namespaceURI,name));}
function appendNS(){return this.appendChild(document.createElementNS(name.space,name.local));}
name=d3.ns.qualify(name);return this.select(name.local?appendNS:append);};d3_selectionPrototype.insert=function(name,before){function insert(){return this.insertBefore(document.createElementNS(this.namespaceURI,name),d3_select(before,this));}
function insertNS(){return this.insertBefore(document.createElementNS(name.space,name.local),d3_select(before,this));}
name=d3.ns.qualify(name);return this.select(name.local?insertNS:insert);};d3_selectionPrototype.remove=function(){return this.each(function(){var parent=this.parentNode;if(parent)parent.removeChild(this);});};d3_selectionPrototype.data=function(value,key){function bind(group,groupData){var i,n=group.length,m=groupData.length,n0=Math.min(n,m),n1=Math.max(n,m),updateNodes=[],enterNodes=[],exitNodes=[],node,nodeData;if(key){var nodeByKeyValue=new d3_Map,keyValues=[],keyValue,j=groupData.length;for(i=-1;++i<n;){keyValue=key.call(node=group[i],node.__data__,i);if(nodeByKeyValue.has(keyValue)){exitNodes[j++]=node;}else{nodeByKeyValue.set(keyValue,node);}
keyValues.push(keyValue);}
for(i=-1;++i<m;){keyValue=key.call(groupData,nodeData=groupData[i],i);if(nodeByKeyValue.has(keyValue)){updateNodes[i]=node=nodeByKeyValue.get(keyValue);node.__data__=nodeData;enterNodes[i]=exitNodes[i]=null;}else{enterNodes[i]=d3_selection_dataNode(nodeData);updateNodes[i]=exitNodes[i]=null;}
nodeByKeyValue.remove(keyValue);}
for(i=-1;++i<n;){if(nodeByKeyValue.has(keyValues[i])){exitNodes[i]=group[i];}}}else{for(i=-1;++i<n0;){node=group[i];nodeData=groupData[i];if(node){node.__data__=nodeData;updateNodes[i]=node;enterNodes[i]=exitNodes[i]=null;}else{enterNodes[i]=d3_selection_dataNode(nodeData);updateNodes[i]=exitNodes[i]=null;}}
for(;i<m;++i){enterNodes[i]=d3_selection_dataNode(groupData[i]);updateNodes[i]=exitNodes[i]=null;}
for(;i<n1;++i){exitNodes[i]=group[i];enterNodes[i]=updateNodes[i]=null;}}
enterNodes.update=updateNodes;enterNodes.parentNode=updateNodes.parentNode=exitNodes.parentNode=group.parentNode;enter.push(enterNodes);update.push(updateNodes);exit.push(exitNodes);}
var i=-1,n=this.length,group,node;if(!arguments.length){value=new Array(n=(group=this[0]).length);while(++i<n){if(node=group[i]){value[i]=node.__data__;}}
return value;}
var enter=d3_selection_enter([]),update=d3_selection([]),exit=d3_selection([]);if(typeof value==="function"){while(++i<n){bind(group=this[i],value.call(group,group.parentNode.__data__,i));}}else{while(++i<n){bind(group=this[i],value);}}
update.enter=function(){return enter;};update.exit=function(){return exit;};return update;};d3_selectionPrototype.datum=d3_selectionPrototype.map=function(value){return arguments.length<1?this.property("__data__"):this.property("__data__",value);};d3_selectionPrototype.filter=function(filter){var subgroups=[],subgroup,group,node;if(typeof filter!=="function")filter=d3_selection_filter(filter);for(var j=0,m=this.length;j<m;j++){subgroups.push(subgroup=[]);subgroup.parentNode=(group=this[j]).parentNode;for(var i=0,n=group.length;i<n;i++){if((node=group[i])&&filter.call(node,node.__data__,i)){subgroup.push(node);}}}
return d3_selection(subgroups);};d3_selectionPrototype.order=function(){for(var j=-1,m=this.length;++j<m;){for(var group=this[j],i=group.length-1,next=group[i],node;--i>=0;){if(node=group[i]){if(next&&next!==node.nextSibling)next.parentNode.insertBefore(node,next);next=node;}}}
return this;};d3_selectionPrototype.sort=function(comparator){comparator=d3_selection_sortComparator.apply(this,arguments);for(var j=-1,m=this.length;++j<m;)this[j].sort(comparator);return this.order();};d3_selectionPrototype.on=function(type,listener,capture){var n=arguments.length;if(n<3){if(typeof type!=="string"){if(n<2)listener=false;for(capture in type)this.each(d3_selection_on(capture,type[capture],listener));return this;}
if(n<2)return(n=this.node()["__on"+type])&&n._;capture=false;}
return this.each(d3_selection_on(type,listener,capture));};d3_selectionPrototype.each=function(callback){return d3_selection_each(this,function(node,i,j){callback.call(node,node.__data__,i,j);});};d3_selectionPrototype.call=function(callback){callback.apply(this,(arguments[0]=this,arguments));return this;};d3_selectionPrototype.empty=function(){return!this.node();};d3_selectionPrototype.node=function(callback){for(var j=0,m=this.length;j<m;j++){for(var group=this[j],i=0,n=group.length;i<n;i++){var node=group[i];if(node)return node;}}
return null;};d3_selectionPrototype.transition=function(){var subgroups=[],subgroup,node;for(var j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]);for(var group=this[j],i=-1,n=group.length;++i<n;){subgroup.push((node=group[i])?{node:node,delay:d3_transitionDelay,duration:d3_transitionDuration}:null);}}
return d3_transition(subgroups,d3_transitionId||++d3_transitionNextId,Date.now());};var d3_selectionRoot=d3_selection([[document]]);d3_selectionRoot[0].parentNode=d3_selectRoot;d3.select=function(selector){return typeof selector==="string"?d3_selectionRoot.select(selector):d3_selection([[selector]]);};d3.selectAll=function(selector){return typeof selector==="string"?d3_selectionRoot.selectAll(selector):d3_selection([d3_array(selector)]);};var d3_selection_enterPrototype=[];d3.selection.enter=d3_selection_enter;d3.selection.enter.prototype=d3_selection_enterPrototype;d3_selection_enterPrototype.append=d3_selectionPrototype.append;d3_selection_enterPrototype.insert=d3_selectionPrototype.insert;d3_selection_enterPrototype.empty=d3_selectionPrototype.empty;d3_selection_enterPrototype.node=d3_selectionPrototype.node;d3_selection_enterPrototype.select=function(selector){var subgroups=[],subgroup,subnode,upgroup,group,node;for(var j=-1,m=this.length;++j<m;){upgroup=(group=this[j]).update;subgroups.push(subgroup=[]);subgroup.parentNode=group.parentNode;for(var i=-1,n=group.length;++i<n;){if(node=group[i]){subgroup.push(upgroup[i]=subnode=selector.call(group.parentNode,node.__data__,i));subnode.__data__=node.__data__;}else{subgroup.push(null);}}}
return d3_selection(subgroups);};var d3_transitionPrototype=[],d3_transitionNextId=0,d3_transitionId=0,d3_transitionDefaultDelay=0,d3_transitionDefaultDuration=250,d3_transitionDefaultEase=d3.ease("cubic-in-out"),d3_transitionDelay=d3_transitionDefaultDelay,d3_transitionDuration=d3_transitionDefaultDuration,d3_transitionEase=d3_transitionDefaultEase;d3_transitionPrototype.call=d3_selectionPrototype.call;d3.transition=function(selection){return arguments.length?d3_transitionId?selection.transition():selection:d3_selectionRoot.transition();};d3.transition.prototype=d3_transitionPrototype;d3_transitionPrototype.select=function(selector){var subgroups=[],subgroup,subnode,node;if(typeof selector!=="function")selector=d3_selection_selector(selector);for(var j=-1,m=this.length;++j<m;){subgroups.push(subgroup=[]);for(var group=this[j],i=-1,n=group.length;++i<n;){if((node=group[i])&&(subnode=selector.call(node.node,node.node.__data__,i))){if("__data__"in node.node)subnode.__data__=node.node.__data__;subgroup.push({node:subnode,delay:node.delay,duration:node.duration});}else{subgroup.push(null);}}}
return d3_transition(subgroups,this.id,this.time).ease(this.ease());};d3_transitionPrototype.selectAll=function(selector){var subgroups=[],subgroup,subnodes,node;if(typeof selector!=="function")selector=d3_selection_selectorAll(selector);for(var j=-1,m=this.length;++j<m;){for(var group=this[j],i=-1,n=group.length;++i<n;){if(node=group[i]){subnodes=selector.call(node.node,node.node.__data__,i);subgroups.push(subgroup=[]);for(var k=-1,o=subnodes.length;++k<o;){subgroup.push({node:subnodes[k],delay:node.delay,duration:node.duration});}}}}
return d3_transition(subgroups,this.id,this.time).ease(this.ease());};d3_transitionPrototype.filter=function(filter){var subgroups=[],subgroup,group,node;if(typeof filter!=="function")filter=d3_selection_filter(filter);for(var j=0,m=this.length;j<m;j++){subgroups.push(subgroup=[]);for(var group=this[j],i=0,n=group.length;i<n;i++){if((node=group[i])&&filter.call(node.node,node.node.__data__,i)){subgroup.push(node);}}}
return d3_transition(subgroups,this.id,this.time).ease(this.ease());};d3_transitionPrototype.attr=function(name,value){if(arguments.length<2){for(value in name)this.attrTween(value,d3_tweenByName(name[value],value));return this;}
return this.attrTween(name,d3_tweenByName(value,name));};d3_transitionPrototype.attrTween=function(nameNS,tween){function attrTween(d,i){var f=tween.call(this,d,i,this.getAttribute(name));return f===d3_tweenRemove?(this.removeAttribute(name),null):f&&function(t){this.setAttribute(name,f(t));};}
function attrTweenNS(d,i){var f=tween.call(this,d,i,this.getAttributeNS(name.space,name.local));return f===d3_tweenRemove?(this.removeAttributeNS(name.space,name.local),null):f&&function(t){this.setAttributeNS(name.space,name.local,f(t));};}
var name=d3.ns.qualify(nameNS);return this.tween("attr."+nameNS,name.local?attrTweenNS:attrTween);};d3_transitionPrototype.style=function(name,value,priority){var n=arguments.length;if(n<3){if(typeof name!=="string"){if(n<2)value="";for(priority in name)this.styleTween(priority,d3_tweenByName(name[priority],priority),value);return this;}
priority="";}
return this.styleTween(name,d3_tweenByName(value,name),priority);};d3_transitionPrototype.styleTween=function(name,tween,priority){if(arguments.length<3)priority="";return this.tween("style."+name,function(d,i){var f=tween.call(this,d,i,window.getComputedStyle(this,null).getPropertyValue(name));return f===d3_tweenRemove?(this.style.removeProperty(name),null):f&&function(t){this.style.setProperty(name,f(t),priority);};});};d3_transitionPrototype.text=function(value){return this.tween("text",function(d,i){this.textContent=typeof value==="function"?value.call(this,d,i):value;});};d3_transitionPrototype.remove=function(){return this.each("end.transition",function(){var p;if(!this.__transition__&&(p=this.parentNode))p.removeChild(this);});};d3_transitionPrototype.delay=function(value){return d3_selection_each(this,typeof value==="function"?function(node,i,j){node.delay=value.call(node=node.node,node.__data__,i,j)|0;}:(value=value|0,function(node){node.delay=value;}));};d3_transitionPrototype.duration=function(value){return d3_selection_each(this,typeof value==="function"?function(node,i,j){node.duration=Math.max(1,value.call(node=node.node,node.__data__,i,j)|0);}:(value=Math.max(1,value|0),function(node){node.duration=value;}));};d3_transitionPrototype.transition=function(){return this.select(d3_this);};d3.tween=function(b,interpolate){function tweenFunction(d,i,a){var v=b.call(this,d,i);return v==null?a!=""&&d3_tweenRemove:a!=v&&interpolate(a,v+"");}
function tweenString(d,i,a){return a!=b&&interpolate(a,b);}
return typeof b==="function"?tweenFunction:b==null?d3_tweenNull:(b+="",tweenString);};var d3_tweenRemove={};var d3_timer_id=0,d3_timer_byId={},d3_timer_queue=null,d3_timer_interval,d3_timer_timeout;d3.timer=function(callback,delay,then){if(arguments.length<3){if(arguments.length<2)delay=0;else if(!isFinite(delay))return;then=Date.now();}
var timer=d3_timer_byId[callback.id];if(timer&&timer.callback===callback){timer.then=then;timer.delay=delay;}else d3_timer_byId[callback.id=++d3_timer_id]=d3_timer_queue={callback:callback,then:then,delay:delay,next:d3_timer_queue};if(!d3_timer_interval){d3_timer_timeout=clearTimeout(d3_timer_timeout);d3_timer_interval=1;d3_timer_frame(d3_timer_step);}};d3.timer.flush=function(){var elapsed,now=Date.now(),t1=d3_timer_queue;while(t1){elapsed=now-t1.then;if(!t1.delay)t1.flush=t1.callback(elapsed);t1=t1.next;}
d3_timer_flush();};var d3_timer_frame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){setTimeout(callback,17);};d3.mouse=function(container){return d3_mousePoint(container,d3_eventSource());};var d3_mouse_bug44083=/WebKit/.test(navigator.userAgent)?-1:0;d3.touches=function(container,touches){if(arguments.length<2)touches=d3_eventSource().touches;return touches?d3_array(touches).map(function(touch){var point=d3_mousePoint(container,touch);point.identifier=touch.identifier;return point;}):[];};d3.scale={};d3.scale.linear=function(){return d3_scale_linear([0,1],[0,1],d3.interpolate,false);};d3.scale.log=function(){return d3_scale_log(d3.scale.linear(),d3_scale_logp);};var d3_scale_logFormat=d3.format(".0e");d3_scale_logp.pow=function(x){return Math.pow(10,x);};d3_scale_logn.pow=function(x){return-Math.pow(10,-x);};d3.scale.pow=function(){return d3_scale_pow(d3.scale.linear(),1);};d3.scale.sqrt=function(){return d3.scale.pow().exponent(.5);};d3.scale.ordinal=function(){return d3_scale_ordinal([],{t:"range",a:[[]]});};d3.scale.category10=function(){return d3.scale.ordinal().range(d3_category10);};d3.scale.category20=function(){return d3.scale.ordinal().range(d3_category20);};d3.scale.category20b=function(){return d3.scale.ordinal().range(d3_category20b);};d3.scale.category20c=function(){return d3.scale.ordinal().range(d3_category20c);};var d3_category10=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"];var d3_category20=["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"];var d3_category20b=["#393b79","#5254a3","#6b6ecf","#9c9ede","#637939","#8ca252","#b5cf6b","#cedb9c","#8c6d31","#bd9e39","#e7ba52","#e7cb94","#843c39","#ad494a","#d6616b","#e7969c","#7b4173","#a55194","#ce6dbd","#de9ed6"];var d3_category20c=["#3182bd","#6baed6","#9ecae1","#c6dbef","#e6550d","#fd8d3c","#fdae6b","#fdd0a2","#31a354","#74c476","#a1d99b","#c7e9c0","#756bb1","#9e9ac8","#bcbddc","#dadaeb","#636363","#969696","#bdbdbd","#d9d9d9"];d3.scale.quantile=function(){return d3_scale_quantile([],[]);};d3.scale.quantize=function(){return d3_scale_quantize(0,1,[0,1]);};d3.scale.threshold=function(){return d3_scale_threshold([.5],[0,1]);};d3.scale.identity=function(){return d3_scale_identity([0,1]);};d3.svg={};d3.svg.arc=function(){function arc(){var r0=innerRadius.apply(this,arguments),r1=outerRadius.apply(this,arguments),a0=startAngle.apply(this,arguments)+d3_svg_arcOffset,a1=endAngle.apply(this,arguments)+d3_svg_arcOffset,da=(a1<a0&&(da=a0,a0=a1,a1=da),a1-a0),df=da<Math.PI?"0":"1",c0=Math.cos(a0),s0=Math.sin(a0),c1=Math.cos(a1),s1=Math.sin(a1);return da>=d3_svg_arcMax?r0?"M0,"+r1+"A"+r1+","+r1+" 0 1,1 0,"+-r1+"A"+r1+","+r1+" 0 1,1 0,"+r1+"M0,"+r0+"A"+r0+","+r0+" 0 1,0 0,"+-r0+"A"+r0+","+r0+" 0 1,0 0,"+r0+"Z":"M0,"+r1+"A"+r1+","+r1+" 0 1,1 0,"+-r1+"A"+r1+","+r1+" 0 1,1 0,"+r1+"Z":r0?"M"+r1*c0+","+r1*s0+"A"+r1+","+r1+" 0 "+df+",1 "+r1*c1+","+r1*s1+"L"+r0*c1+","+r0*s1+"A"+r0+","+r0+" 0 "+df+",0 "+r0*c0+","+r0*s0+"Z":"M"+r1*c0+","+r1*s0+"A"+r1+","+r1+" 0 "+df+",1 "+r1*c1+","+r1*s1+"L0,0"+"Z";}
var innerRadius=d3_svg_arcInnerRadius,outerRadius=d3_svg_arcOuterRadius,startAngle=d3_svg_arcStartAngle,endAngle=d3_svg_arcEndAngle;arc.innerRadius=function(v){if(!arguments.length)return innerRadius;innerRadius=d3_functor(v);return arc;};arc.outerRadius=function(v){if(!arguments.length)return outerRadius;outerRadius=d3_functor(v);return arc;};arc.startAngle=function(v){if(!arguments.length)return startAngle;startAngle=d3_functor(v);return arc;};arc.endAngle=function(v){if(!arguments.length)return endAngle;endAngle=d3_functor(v);return arc;};arc.centroid=function(){var r=(innerRadius.apply(this,arguments)+outerRadius.apply(this,arguments))/2,a=(startAngle.apply(this,arguments)+endAngle.apply(this,arguments))/2+d3_svg_arcOffset;return[Math.cos(a)*r,Math.sin(a)*r];};return arc;};var d3_svg_arcOffset=-Math.PI/2,d3_svg_arcMax=2*Math.PI-1e-6;d3.svg.line=function(){return d3_svg_line(d3_identity);};var d3_svg_lineInterpolators=d3.map({linear:d3_svg_lineLinear,"linear-closed":d3_svg_lineLinearClosed,"step-before":d3_svg_lineStepBefore,"step-after":d3_svg_lineStepAfter,basis:d3_svg_lineBasis,"basis-open":d3_svg_lineBasisOpen,"basis-closed":d3_svg_lineBasisClosed,bundle:d3_svg_lineBundle,cardinal:d3_svg_lineCardinal,"cardinal-open":d3_svg_lineCardinalOpen,"cardinal-closed":d3_svg_lineCardinalClosed,monotone:d3_svg_lineMonotone});d3_svg_lineInterpolators.forEach(function(key,value){value.key=key;value.closed=/-closed$/.test(key);});var d3_svg_lineBasisBezier1=[0,2/3,1/3,0],d3_svg_lineBasisBezier2=[0,1/3,2/3,0],d3_svg_lineBasisBezier3=[0,1/6,2/3,1/6];d3.svg.line.radial=function(){var line=d3_svg_line(d3_svg_lineRadial);line.radius=line.x,delete line.x;line.angle=line.y,delete line.y;return line;};d3_svg_lineStepBefore.reverse=d3_svg_lineStepAfter;d3_svg_lineStepAfter.reverse=d3_svg_lineStepBefore;d3.svg.area=function(){return d3_svg_area(d3_identity);};d3.svg.area.radial=function(){var area=d3_svg_area(d3_svg_lineRadial);area.radius=area.x,delete area.x;area.innerRadius=area.x0,delete area.x0;area.outerRadius=area.x1,delete area.x1;area.angle=area.y,delete area.y;area.startAngle=area.y0,delete area.y0;area.endAngle=area.y1,delete area.y1;return area;};d3.svg.chord=function(){function chord(d,i){var s=subgroup(this,source,d,i),t=subgroup(this,target,d,i);return"M"+s.p0+arc(s.r,s.p1,s.a1-s.a0)+(equals(s,t)?curve(s.r,s.p1,s.r,s.p0):curve(s.r,s.p1,t.r,t.p0)+arc(t.r,t.p1,t.a1-t.a0)+curve(t.r,t.p1,s.r,s.p0))+"Z";}
function subgroup(self,f,d,i){var subgroup=f.call(self,d,i),r=radius.call(self,subgroup,i),a0=startAngle.call(self,subgroup,i)+d3_svg_arcOffset,a1=endAngle.call(self,subgroup,i)+d3_svg_arcOffset;return{r:r,a0:a0,a1:a1,p0:[r*Math.cos(a0),r*Math.sin(a0)],p1:[r*Math.cos(a1),r*Math.sin(a1)]};}
function equals(a,b){return a.a0==b.a0&&a.a1==b.a1;}
function arc(r,p,a){return"A"+r+","+r+" 0 "+ +(a>Math.PI)+",1 "+p;}
function curve(r0,p0,r1,p1){return"Q 0,0 "+p1;}
var source=d3_svg_chordSource,target=d3_svg_chordTarget,radius=d3_svg_chordRadius,startAngle=d3_svg_arcStartAngle,endAngle=d3_svg_arcEndAngle;chord.radius=function(v){if(!arguments.length)return radius;radius=d3_functor(v);return chord;};chord.source=function(v){if(!arguments.length)return source;source=d3_functor(v);return chord;};chord.target=function(v){if(!arguments.length)return target;target=d3_functor(v);return chord;};chord.startAngle=function(v){if(!arguments.length)return startAngle;startAngle=d3_functor(v);return chord;};chord.endAngle=function(v){if(!arguments.length)return endAngle;endAngle=d3_functor(v);return chord;};return chord;};d3.svg.diagonal=function(){function diagonal(d,i){var p0=source.call(this,d,i),p3=target.call(this,d,i),m=(p0.y+p3.y)/2,p=[p0,{x:p0.x,y:m},{x:p3.x,y:m},p3];p=p.map(projection);return"M"+p[0]+"C"+p[1]+" "+p[2]+" "+p[3];}
var source=d3_svg_chordSource,target=d3_svg_chordTarget,projection=d3_svg_diagonalProjection;diagonal.source=function(x){if(!arguments.length)return source;source=d3_functor(x);return diagonal;};diagonal.target=function(x){if(!arguments.length)return target;target=d3_functor(x);return diagonal;};diagonal.projection=function(x){if(!arguments.length)return projection;projection=x;return diagonal;};return diagonal;};d3.svg.diagonal.radial=function(){var diagonal=d3.svg.diagonal(),projection=d3_svg_diagonalProjection,projection_=diagonal.projection;diagonal.projection=function(x){return arguments.length?projection_(d3_svg_diagonalRadialProjection(projection=x)):projection;};return diagonal;};d3.svg.mouse=d3.mouse;d3.svg.touches=d3.touches;d3.svg.symbol=function(){function symbol(d,i){return(d3_svg_symbols.get(type.call(this,d,i))||d3_svg_symbolCircle)(size.call(this,d,i));}
var type=d3_svg_symbolType,size=d3_svg_symbolSize;symbol.type=function(x){if(!arguments.length)return type;type=d3_functor(x);return symbol;};symbol.size=function(x){if(!arguments.length)return size;size=d3_functor(x);return symbol;};return symbol;};var d3_svg_symbols=d3.map({circle:d3_svg_symbolCircle,cross:function(size){var r=Math.sqrt(size/5)/2;return"M"+-3*r+","+-r+"H"+-r+"V"+-3*r+"H"+r+"V"+-r+"H"+3*r+"V"+r+"H"+r+"V"+3*r+"H"+-r+"V"+r+"H"+-3*r+"Z";},diamond:function(size){var ry=Math.sqrt(size/(2*d3_svg_symbolTan30)),rx=ry*d3_svg_symbolTan30;return"M0,"+-ry+"L"+rx+",0"+" 0,"+ry+" "+-rx+",0"+"Z";},square:function(size){var r=Math.sqrt(size)/2;return"M"+-r+","+-r+"L"+r+","+-r+" "+r+","+r+" "+-r+","+r+"Z";},"triangle-down":function(size){var rx=Math.sqrt(size/d3_svg_symbolSqrt3),ry=rx*d3_svg_symbolSqrt3/2;return"M0,"+ry+"L"+rx+","+-ry+" "+-rx+","+-ry+"Z";},"triangle-up":function(size){var rx=Math.sqrt(size/d3_svg_symbolSqrt3),ry=rx*d3_svg_symbolSqrt3/2;return"M0,"+-ry+"L"+rx+","+ry+" "+-rx+","+ry+"Z";}});d3.svg.symbolTypes=d3_svg_symbols.keys();var d3_svg_symbolSqrt3=Math.sqrt(3),d3_svg_symbolTan30=Math.tan(30*Math.PI/180);d3.svg.axis=function(){function axis(g){g.each(function(){var g=d3.select(this);var ticks=tickValues==null?scale.ticks?scale.ticks.apply(scale,tickArguments_):scale.domain():tickValues,tickFormat=tickFormat_==null?scale.tickFormat?scale.tickFormat.apply(scale,tickArguments_):String:tickFormat_;var subticks=d3_svg_axisSubdivide(scale,ticks,tickSubdivide),subtick=g.selectAll(".minor").data(subticks,String),subtickEnter=subtick.enter().insert("line","g").attr("class","tick minor").style("opacity",1e-6),subtickExit=d3.transition(subtick.exit()).style("opacity",1e-6).remove(),subtickUpdate=d3.transition(subtick).style("opacity",1);var tick=g.selectAll("g").data(ticks,String),tickEnter=tick.enter().insert("g","path").style("opacity",1e-6),tickExit=d3.transition(tick.exit()).style("opacity",1e-6).remove(),tickUpdate=d3.transition(tick).style("opacity",1),tickTransform;var range=d3_scaleRange(scale),path=g.selectAll(".domain").data([0]),pathEnter=path.enter().append("path").attr("class","domain"),pathUpdate=d3.transition(path);var scale1=scale.copy(),scale0=this.__chart__||scale1;this.__chart__=scale1;tickEnter.append("line").attr("class","tick");tickEnter.append("text");var lineEnter=tickEnter.select("line"),lineUpdate=tickUpdate.select("line"),text=tick.select("text").text(tickFormat),textEnter=tickEnter.select("text"),textUpdate=tickUpdate.select("text");switch(orient){case"bottom":{tickTransform=d3_svg_axisX;subtickEnter.attr("y2",tickMinorSize);subtickUpdate.attr("x2",0).attr("y2",tickMinorSize);lineEnter.attr("y2",tickMajorSize);textEnter.attr("y",Math.max(tickMajorSize,0)+tickPadding);lineUpdate.attr("x2",0).attr("y2",tickMajorSize);textUpdate.attr("x",0).attr("y",Math.max(tickMajorSize,0)+tickPadding);text.attr("dy",".71em").attr("text-anchor","middle");pathUpdate.attr("d","M"+range[0]+","+tickEndSize+"V0H"+range[1]+"V"+tickEndSize);break;}
case"top":{tickTransform=d3_svg_axisX;subtickEnter.attr("y2",-tickMinorSize);subtickUpdate.attr("x2",0).attr("y2",-tickMinorSize);lineEnter.attr("y2",-tickMajorSize);textEnter.attr("y",-(Math.max(tickMajorSize,0)+tickPadding));lineUpdate.attr("x2",0).attr("y2",-tickMajorSize);textUpdate.attr("x",0).attr("y",-(Math.max(tickMajorSize,0)+tickPadding));text.attr("dy","0em").attr("text-anchor","middle");pathUpdate.attr("d","M"+range[0]+","+-tickEndSize+"V0H"+range[1]+"V"+-tickEndSize);break;}
case"left":{tickTransform=d3_svg_axisY;subtickEnter.attr("x2",-tickMinorSize);subtickUpdate.attr("x2",-tickMinorSize).attr("y2",0);lineEnter.attr("x2",-tickMajorSize);textEnter.attr("x",-(Math.max(tickMajorSize,0)+tickPadding));lineUpdate.attr("x2",-tickMajorSize).attr("y2",0);textUpdate.attr("x",-(Math.max(tickMajorSize,0)+tickPadding)).attr("y",0);text.attr("dy",".32em").attr("text-anchor","end");pathUpdate.attr("d","M"+-tickEndSize+","+range[0]+"H0V"+range[1]+"H"+-tickEndSize);break;}
case"right":{tickTransform=d3_svg_axisY;subtickEnter.attr("x2",tickMinorSize);subtickUpdate.attr("x2",tickMinorSize).attr("y2",0);lineEnter.attr("x2",tickMajorSize);textEnter.attr("x",Math.max(tickMajorSize,0)+tickPadding);lineUpdate.attr("x2",tickMajorSize).attr("y2",0);textUpdate.attr("x",Math.max(tickMajorSize,0)+tickPadding).attr("y",0);text.attr("dy",".32em").attr("text-anchor","start");pathUpdate.attr("d","M"+tickEndSize+","+range[0]+"H0V"+range[1]+"H"+tickEndSize);break;}}
if(scale.ticks){tickEnter.call(tickTransform,scale0);tickUpdate.call(tickTransform,scale1);tickExit.call(tickTransform,scale1);subtickEnter.call(tickTransform,scale0);subtickUpdate.call(tickTransform,scale1);subtickExit.call(tickTransform,scale1);}else{var dx=scale1.rangeBand()/2,x=function(d){return scale1(d)+dx;};tickEnter.call(tickTransform,x);tickUpdate.call(tickTransform,x);}});}
var scale=d3.scale.linear(),orient="bottom",tickMajorSize=6,tickMinorSize=6,tickEndSize=6,tickPadding=3,tickArguments_=[10],tickValues=null,tickFormat_,tickSubdivide=0;axis.scale=function(x){if(!arguments.length)return scale;scale=x;return axis;};axis.orient=function(x){if(!arguments.length)return orient;orient=x;return axis;};axis.ticks=function(){if(!arguments.length)return tickArguments_;tickArguments_=arguments;return axis;};axis.tickValues=function(x){if(!arguments.length)return tickValues;tickValues=x;return axis;};axis.tickFormat=function(x){if(!arguments.length)return tickFormat_;tickFormat_=x;return axis;};axis.tickSize=function(x,y,z){if(!arguments.length)return tickMajorSize;var n=arguments.length-1;tickMajorSize=+x;tickMinorSize=n>1?+y:tickMajorSize;tickEndSize=n>0?+arguments[n]:tickMajorSize;return axis;};axis.tickPadding=function(x){if(!arguments.length)return tickPadding;tickPadding=+x;return axis;};axis.tickSubdivide=function(x){if(!arguments.length)return tickSubdivide;tickSubdivide=+x;return axis;};return axis;};d3.svg.brush=function(){function brush(g){g.each(function(){var g=d3.select(this),bg=g.selectAll(".background").data([0]),fg=g.selectAll(".extent").data([0]),tz=g.selectAll(".resize").data(resizes,String),e;g.style("pointer-events","all").on("mousedown.brush",brushstart).on("touchstart.brush",brushstart);bg.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair");fg.enter().append("rect").attr("class","extent").style("cursor","move");tz.enter().append("g").attr("class",function(d){return"resize "+d;}).style("cursor",function(d){return d3_svg_brushCursor[d];}).append("rect").attr("x",function(d){return/[ew]$/.test(d)?-3:null;}).attr("y",function(d){return/^[ns]/.test(d)?-3:null;}).attr("width",6).attr("height",6).style("visibility","hidden");tz.style("display",brush.empty()?"none":null);tz.exit().remove();if(x){e=d3_scaleRange(x);bg.attr("x",e[0]).attr("width",e[1]-e[0]);redrawX(g);}
if(y){e=d3_scaleRange(y);bg.attr("y",e[0]).attr("height",e[1]-e[0]);redrawY(g);}
redraw(g);});}
function redraw(g){g.selectAll(".resize").attr("transform",function(d){return"translate("+extent[+/e$/.test(d)][0]+","+extent[+/^s/.test(d)][1]+")";});}
function redrawX(g){g.select(".extent").attr("x",extent[0][0]);g.selectAll(".extent,.n>rect,.s>rect").attr("width",extent[1][0]-extent[0][0]);}
function redrawY(g){g.select(".extent").attr("y",extent[0][1]);g.selectAll(".extent,.e>rect,.w>rect").attr("height",extent[1][1]-extent[0][1]);}
function brushstart(){function mouse(){var touches=d3.event.changedTouches;return touches?d3.touches(target,touches)[0]:d3.mouse(target);}
function keydown(){if(d3.event.keyCode==32){if(!dragging){center=null;origin[0]-=extent[1][0];origin[1]-=extent[1][1];dragging=2;}
d3_eventCancel();}}
function keyup(){if(d3.event.keyCode==32&&dragging==2){origin[0]+=extent[1][0];origin[1]+=extent[1][1];dragging=0;d3_eventCancel();}}
function brushmove(){var point=mouse(),moved=false;if(offset){point[0]+=offset[0];point[1]+=offset[1];}
if(!dragging){if(d3.event.altKey){if(!center)center=[(extent[0][0]+extent[1][0])/2,(extent[0][1]+extent[1][1])/2];origin[0]=extent[+(point[0]<center[0])][0];origin[1]=extent[+(point[1]<center[1])][1];}else center=null;}
if(resizingX&&move1(point,x,0)){redrawX(g);moved=true;}
if(resizingY&&move1(point,y,1)){redrawY(g);moved=true;}
if(moved){redraw(g);event_({type:"brush",mode:dragging?"move":"resize"});}}
function move1(point,scale,i){var range=d3_scaleRange(scale),r0=range[0],r1=range[1],position=origin[i],size=extent[1][i]-extent[0][i],min,max;if(dragging){r0-=position;r1-=size+position;}
min=Math.max(r0,Math.min(r1,point[i]));if(dragging){max=(min+=position)+size;}else{if(center)position=Math.max(r0,Math.min(r1,2*center[i]-min));if(position<min){max=min;min=position;}else{max=position;}}
if(extent[0][i]!==min||extent[1][i]!==max){extentDomain=null;extent[0][i]=min;extent[1][i]=max;return true;}}
function brushend(){brushmove();g.style("pointer-events","all").selectAll(".resize").style("display",brush.empty()?"none":null);d3.select("body").style("cursor",null);w.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null);event_({type:"brushend"});d3_eventCancel();}
var target=this,eventTarget=d3.select(d3.event.target),event_=event.of(target,arguments),g=d3.select(target),resizing=eventTarget.datum(),resizingX=!/^(n|s)$/.test(resizing)&&x,resizingY=!/^(e|w)$/.test(resizing)&&y,dragging=eventTarget.classed("extent"),center,origin=mouse(),offset;var w=d3.select(window).on("mousemove.brush",brushmove).on("mouseup.brush",brushend).on("touchmove.brush",brushmove).on("touchend.brush",brushend).on("keydown.brush",keydown).on("keyup.brush",keyup);if(dragging){origin[0]=extent[0][0]-origin[0];origin[1]=extent[0][1]-origin[1];}else if(resizing){var ex=+/w$/.test(resizing),ey=+/^n/.test(resizing);offset=[extent[1-ex][0]-origin[0],extent[1-ey][1]-origin[1]];origin[0]=extent[ex][0];origin[1]=extent[ey][1];}else if(d3.event.altKey)center=origin.slice();g.style("pointer-events","none").selectAll(".resize").style("display",null);d3.select("body").style("cursor",eventTarget.style("cursor"));event_({type:"brushstart"});brushmove();d3_eventCancel();}
var event=d3_eventDispatch(brush,"brushstart","brush","brushend"),x=null,y=null,resizes=d3_svg_brushResizes[0],extent=[[0,0],[0,0]],extentDomain;brush.x=function(z){if(!arguments.length)return x;x=z;resizes=d3_svg_brushResizes[!x<<1|!y];return brush;};brush.y=function(z){if(!arguments.length)return y;y=z;resizes=d3_svg_brushResizes[!x<<1|!y];return brush;};brush.extent=function(z){var x0,x1,y0,y1,t;if(!arguments.length){z=extentDomain||extent;if(x){x0=z[0][0],x1=z[1][0];if(!extentDomain){x0=extent[0][0],x1=extent[1][0];if(x.invert)x0=x.invert(x0),x1=x.invert(x1);if(x1<x0)t=x0,x0=x1,x1=t;}}
if(y){y0=z[0][1],y1=z[1][1];if(!extentDomain){y0=extent[0][1],y1=extent[1][1];if(y.invert)y0=y.invert(y0),y1=y.invert(y1);if(y1<y0)t=y0,y0=y1,y1=t;}}
return x&&y?[[x0,y0],[x1,y1]]:x?[x0,x1]:y&&[y0,y1];}
extentDomain=[[0,0],[0,0]];if(x){x0=z[0],x1=z[1];if(y)x0=x0[0],x1=x1[0];extentDomain[0][0]=x0,extentDomain[1][0]=x1;if(x.invert)x0=x(x0),x1=x(x1);if(x1<x0)t=x0,x0=x1,x1=t;extent[0][0]=x0|0,extent[1][0]=x1|0;}
if(y){y0=z[0],y1=z[1];if(x)y0=y0[1],y1=y1[1];extentDomain[0][1]=y0,extentDomain[1][1]=y1;if(y.invert)y0=y(y0),y1=y(y1);if(y1<y0)t=y0,y0=y1,y1=t;extent[0][1]=y0|0,extent[1][1]=y1|0;}
return brush;};brush.clear=function(){extentDomain=null;extent[0][0]=extent[0][1]=extent[1][0]=extent[1][1]=0;return brush;};brush.empty=function(){return x&&extent[0][0]===extent[1][0]||y&&extent[0][1]===extent[1][1];};return d3.rebind(brush,event,"on");};var d3_svg_brushCursor={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"};var d3_svg_brushResizes=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]];d3.behavior={};d3.behavior.drag=function(){function drag(){this.on("mousedown.drag",mousedown).on("touchstart.drag",mousedown);}
function mousedown(){function point(){var p=target.parentNode;return touchId?d3.touches(p).filter(function(p){return p.identifier===touchId;})[0]:d3.mouse(p);}
function dragmove(){if(!target.parentNode)return dragend();var p=point(),dx=p[0]-origin_[0],dy=p[1]-origin_[1];moved|=dx|dy;origin_=p;d3_eventCancel();event_({type:"drag",x:p[0]+offset[0],y:p[1]+offset[1],dx:dx,dy:dy});}
function dragend(){event_({type:"dragend"});if(moved){d3_eventCancel();if(d3.event.target===eventTarget)w.on("click.drag",click,true);}
w.on(touchId?"touchmove.drag-"+touchId:"mousemove.drag",null).on(touchId?"touchend.drag-"+touchId:"mouseup.drag",null);}
function click(){d3_eventCancel();w.on("click.drag",null);}
var target=this,event_=event.of(target,arguments),eventTarget=d3.event.target,touchId=d3.event.touches&&d3.event.changedTouches[0].identifier,offset,origin_=point(),moved=0;var w=d3.select(window).on(touchId?"touchmove.drag-"+touchId:"mousemove.drag",dragmove).on(touchId?"touchend.drag-"+touchId:"mouseup.drag",dragend,true);if(origin){offset=origin.apply(target,arguments);offset=[offset.x-origin_[0],offset.y-origin_[1]];}else{offset=[0,0];}
if(!touchId)d3_eventCancel();event_({type:"dragstart"});}
var event=d3_eventDispatch(drag,"drag","dragstart","dragend"),origin=null;drag.origin=function(x){if(!arguments.length)return origin;origin=x;return drag;};return d3.rebind(drag,event,"on");};d3.behavior.zoom=function(){function zoom(){this.on("mousedown.zoom",mousedown).on("mousewheel.zoom",mousewheel).on("mousemove.zoom",mousemove).on("DOMMouseScroll.zoom",mousewheel).on("dblclick.zoom",dblclick).on("touchstart.zoom",touchstart).on("touchmove.zoom",touchmove).on("touchend.zoom",touchstart);}
function location(p){return[(p[0]-translate[0])/scale,(p[1]-translate[1])/scale];}
function point(l){return[l[0]*scale+translate[0],l[1]*scale+translate[1]];}
function scaleTo(s){scale=Math.max(scaleExtent[0],Math.min(scaleExtent[1],s));}
function translateTo(p,l){l=point(l);translate[0]+=p[0]-l[0];translate[1]+=p[1]-l[1];}
function dispatch(event){if(x1)x1.domain(x0.range().map(function(x){return(x-translate[0])/scale;}).map(x0.invert));if(y1)y1.domain(y0.range().map(function(y){return(y-translate[1])/scale;}).map(y0.invert));d3.event.preventDefault();event({type:"zoom",scale:scale,translate:translate});}
function mousedown(){function mousemove(){moved=1;translateTo(d3.mouse(target),l);dispatch(event_);}
function mouseup(){if(moved)d3_eventCancel();w.on("mousemove.zoom",null).on("mouseup.zoom",null);if(moved&&d3.event.target===eventTarget)w.on("click.zoom",click,true);}
function click(){d3_eventCancel();w.on("click.zoom",null);}
var target=this,event_=event.of(target,arguments),eventTarget=d3.event.target,moved=0,w=d3.select(window).on("mousemove.zoom",mousemove).on("mouseup.zoom",mouseup),l=location(d3.mouse(target));window.focus();d3_eventCancel();}
function mousewheel(){if(!translate0)translate0=location(d3.mouse(this));scaleTo(Math.pow(2,d3_behavior_zoomDelta()*.002)*scale);translateTo(d3.mouse(this),translate0);dispatch(event.of(this,arguments));}
function mousemove(){translate0=null;}
function dblclick(){var p=d3.mouse(this),l=location(p);scaleTo(d3.event.shiftKey?scale/2:scale*2);translateTo(p,l);dispatch(event.of(this,arguments));}
function touchstart(){var touches=d3.touches(this),now=Date.now();scale0=scale;translate0={};touches.forEach(function(t){translate0[t.identifier]=location(t);});d3_eventCancel();if(touches.length===1){if(now-touchtime<500){var p=touches[0],l=location(touches[0]);scaleTo(scale*2);translateTo(p,l);dispatch(event.of(this,arguments));}
touchtime=now;}}
function touchmove(){var touches=d3.touches(this),p0=touches[0],l0=translate0[p0.identifier];if(p1=touches[1]){var p1,l1=translate0[p1.identifier];p0=[(p0[0]+p1[0])/2,(p0[1]+p1[1])/2];l0=[(l0[0]+l1[0])/2,(l0[1]+l1[1])/2];scaleTo(d3.event.scale*scale0);}
translateTo(p0,l0);touchtime=null;dispatch(event.of(this,arguments));}
var translate=[0,0],translate0,scale=1,scale0,scaleExtent=d3_behavior_zoomInfinity,event=d3_eventDispatch(zoom,"zoom"),x0,x1,y0,y1,touchtime;zoom.translate=function(x){if(!arguments.length)return translate;translate=x.map(Number);return zoom;};zoom.scale=function(x){if(!arguments.length)return scale;scale=+x;return zoom;};zoom.scaleExtent=function(x){if(!arguments.length)return scaleExtent;scaleExtent=x==null?d3_behavior_zoomInfinity:x.map(Number);return zoom;};zoom.x=function(z){if(!arguments.length)return x1;x1=z;x0=z.copy();return zoom;};zoom.y=function(z){if(!arguments.length)return y1;y1=z;y0=z.copy();return zoom;};return d3.rebind(zoom,event,"on");};var d3_behavior_zoomDiv,d3_behavior_zoomInfinity=[0,Infinity];d3.layout={};d3.layout.bundle=function(){return function(links){var paths=[],i=-1,n=links.length;while(++i<n)paths.push(d3_layout_bundlePath(links[i]));return paths;};};d3.layout.chord=function(){function relayout(){var subgroups={},groupSums=[],groupIndex=d3.range(n),subgroupIndex=[],k,x,x0,i,j;chords=[];groups=[];k=0,i=-1;while(++i<n){x=0,j=-1;while(++j<n){x+=matrix[i][j];}
groupSums.push(x);subgroupIndex.push(d3.range(n));k+=x;}
if(sortGroups){groupIndex.sort(function(a,b){return sortGroups(groupSums[a],groupSums[b]);});}
if(sortSubgroups){subgroupIndex.forEach(function(d,i){d.sort(function(a,b){return sortSubgroups(matrix[i][a],matrix[i][b]);});});}
k=(2*Math.PI-padding*n)/k;x=0,i=-1;while(++i<n){x0=x,j=-1;while(++j<n){var di=groupIndex[i],dj=subgroupIndex[di][j],v=matrix[di][dj],a0=x,a1=x+=v*k;subgroups[di+"-"+dj]={index:di,subindex:dj,startAngle:a0,endAngle:a1,value:v};}
groups[di]={index:di,startAngle:x0,endAngle:x,value:(x-x0)/k};x+=padding;}
i=-1;while(++i<n){j=i-1;while(++j<n){var source=subgroups[i+"-"+j],target=subgroups[j+"-"+i];if(source.value||target.value){chords.push(source.value<target.value?{source:target,target:source}:{source:source,target:target});}}}
if(sortChords)resort();}
function resort(){chords.sort(function(a,b){return sortChords((a.source.value+a.target.value)/2,(b.source.value+b.target.value)/2);});}
var chord={},chords,groups,matrix,n,padding=0,sortGroups,sortSubgroups,sortChords;chord.matrix=function(x){if(!arguments.length)return matrix;n=(matrix=x)&&matrix.length;chords=groups=null;return chord;};chord.padding=function(x){if(!arguments.length)return padding;padding=x;chords=groups=null;return chord;};chord.sortGroups=function(x){if(!arguments.length)return sortGroups;sortGroups=x;chords=groups=null;return chord;};chord.sortSubgroups=function(x){if(!arguments.length)return sortSubgroups;sortSubgroups=x;chords=null;return chord;};chord.sortChords=function(x){if(!arguments.length)return sortChords;sortChords=x;if(chords)resort();return chord;};chord.chords=function(){if(!chords)relayout();return chords;};chord.groups=function(){if(!groups)relayout();return groups;};return chord;};d3.layout.force=function(){function repulse(node){return function(quad,x1,y1,x2,y2){if(quad.point!==node){var dx=quad.cx-node.x,dy=quad.cy-node.y,dn=1/Math.sqrt(dx*dx+dy*dy);if((x2-x1)*dn<theta){var k=quad.charge*dn*dn;node.px-=dx*k;node.py-=dy*k;return true;}
if(quad.point&&isFinite(dn)){var k=quad.pointCharge*dn*dn;node.px-=dx*k;node.py-=dy*k;}}
return!quad.charge;};}
function dragmove(d){d.px=d3.event.x;d.py=d3.event.y;force.resume();}
var force={},event=d3.dispatch("start","tick","end"),size=[1,1],drag,alpha,friction=.9,linkDistance=d3_layout_forceLinkDistance,linkStrength=d3_layout_forceLinkStrength,charge=-30,gravity=.1,theta=.8,interval,nodes=[],links=[],distances,strengths,charges;force.tick=function(){if((alpha*=.99)<.005){event.end({type:"end",alpha:alpha=0});return true;}
var n=nodes.length,m=links.length,q,i,o,s,t,l,k,x,y;for(i=0;i<m;++i){o=links[i];s=o.source;t=o.target;x=t.x-s.x;y=t.y-s.y;if(l=x*x+y*y){l=alpha*strengths[i]*((l=Math.sqrt(l))-distances[i])/l;x*=l;y*=l;t.x-=x*(k=s.weight/(t.weight+s.weight));t.y-=y*k;s.x+=x*(k=1-k);s.y+=y*k;}}
if(k=alpha*gravity){x=size[0]/2;y=size[1]/2;i=-1;if(k)while(++i<n){o=nodes[i];o.x+=(x-o.x)*k;o.y+=(y-o.y)*k;}}
if(charge){d3_layout_forceAccumulate(q=d3.geom.quadtree(nodes),alpha,charges);i=-1;while(++i<n){if(!(o=nodes[i]).fixed){q.visit(repulse(o));}}}
i=-1;while(++i<n){o=nodes[i];if(o.fixed){o.x=o.px;o.y=o.py;}else{o.x-=(o.px-(o.px=o.x))*friction;o.y-=(o.py-(o.py=o.y))*friction;}}
event.tick({type:"tick",alpha:alpha});};force.nodes=function(x){if(!arguments.length)return nodes;nodes=x;return force;};force.links=function(x){if(!arguments.length)return links;links=x;return force;};force.size=function(x){if(!arguments.length)return size;size=x;return force;};force.linkDistance=function(x){if(!arguments.length)return linkDistance;linkDistance=d3_functor(x);return force;};force.distance=force.linkDistance;force.linkStrength=function(x){if(!arguments.length)return linkStrength;linkStrength=d3_functor(x);return force;};force.friction=function(x){if(!arguments.length)return friction;friction=x;return force;};force.charge=function(x){if(!arguments.length)return charge;charge=typeof x==="function"?x:+x;return force;};force.gravity=function(x){if(!arguments.length)return gravity;gravity=x;return force;};force.theta=function(x){if(!arguments.length)return theta;theta=x;return force;};force.alpha=function(x){if(!arguments.length)return alpha;if(alpha){if(x>0)alpha=x;else alpha=0;}else if(x>0){event.start({type:"start",alpha:alpha=x});d3.timer(force.tick);}
return force;};force.start=function(){function position(dimension,size){var neighbors=neighbor(i),j=-1,m=neighbors.length,x;while(++j<m)if(!isNaN(x=neighbors[j][dimension]))return x;return Math.random()*size;}
function neighbor(){if(!neighbors){neighbors=[];for(j=0;j<n;++j){neighbors[j]=[];}
for(j=0;j<m;++j){var o=links[j];neighbors[o.source.index].push(o.target);neighbors[o.target.index].push(o.source);}}
return neighbors[i];}
var i,j,n=nodes.length,m=links.length,w=size[0],h=size[1],neighbors,o;for(i=0;i<n;++i){(o=nodes[i]).index=i;o.weight=0;}
distances=[];strengths=[];for(i=0;i<m;++i){o=links[i];if(typeof o.source=="number")o.source=nodes[o.source];if(typeof o.target=="number")o.target=nodes[o.target];distances[i]=linkDistance.call(this,o,i);strengths[i]=linkStrength.call(this,o,i);++o.source.weight;++o.target.weight;}
for(i=0;i<n;++i){o=nodes[i];if(isNaN(o.x))o.x=position("x",w);if(isNaN(o.y))o.y=position("y",h);if(isNaN(o.px))o.px=o.x;if(isNaN(o.py))o.py=o.y;}
charges=[];if(typeof charge==="function"){for(i=0;i<n;++i){charges[i]=+charge.call(this,nodes[i],i);}}else{for(i=0;i<n;++i){charges[i]=charge;}}
return force.resume();};force.resume=function(){return force.alpha(.1);};force.stop=function(){return force.alpha(0);};force.drag=function(){if(!drag)drag=d3.behavior.drag().origin(d3_identity).on("dragstart",d3_layout_forceDragstart).on("drag",dragmove).on("dragend",d3_layout_forceDragend);this.on("mouseover.force",d3_layout_forceMouseover).on("mouseout.force",d3_layout_forceMouseout).call(drag);};return d3.rebind(force,event,"on");};d3.layout.partition=function(){function position(node,x,dx,dy){var children=node.children;node.x=x;node.y=node.depth*dy;node.dx=dx;node.dy=dy;if(children&&(n=children.length)){var i=-1,n,c,d;dx=node.value?dx/node.value:0;while(++i<n){position(c=children[i],x,d=c.value*dx,dy);x+=d;}}}
function depth(node){var children=node.children,d=0;if(children&&(n=children.length)){var i=-1,n;while(++i<n)d=Math.max(d,depth(children[i]));}
return 1+d;}
function partition(d,i){var nodes=hierarchy.call(this,d,i);position(nodes[0],0,size[0],size[1]/depth(nodes[0]));return nodes;}
var hierarchy=d3.layout.hierarchy(),size=[1,1];partition.size=function(x){if(!arguments.length)return size;size=x;return partition;};return d3_layout_hierarchyRebind(partition,hierarchy);};d3.layout.pie=function(){function pie(data,i){var values=data.map(function(d,i){return+value.call(pie,d,i);});var a=+(typeof startAngle==="function"?startAngle.apply(this,arguments):startAngle);var k=((typeof endAngle==="function"?endAngle.apply(this,arguments):endAngle)-startAngle)/d3.sum(values);var index=d3.range(data.length);if(sort!=null)index.sort(sort===d3_layout_pieSortByValue?function(i,j){return values[j]-values[i];}:function(i,j){return sort(data[i],data[j]);});var arcs=[];index.forEach(function(i){var d;arcs[i]={data:data[i],value:d=values[i],startAngle:a,endAngle:a+=d*k};});return arcs;}
var value=Number,sort=d3_layout_pieSortByValue,startAngle=0,endAngle=2*Math.PI;pie.value=function(x){if(!arguments.length)return value;value=x;return pie;};pie.sort=function(x){if(!arguments.length)return sort;sort=x;return pie;};pie.startAngle=function(x){if(!arguments.length)return startAngle;startAngle=x;return pie;};pie.endAngle=function(x){if(!arguments.length)return endAngle;endAngle=x;return pie;};return pie;};var d3_layout_pieSortByValue={};d3.layout.stack=function(){function stack(data,index){var series=data.map(function(d,i){return values.call(stack,d,i);});var points=series.map(function(d,i){return d.map(function(v,i){return[x.call(stack,v,i),y.call(stack,v,i)];});});var orders=order.call(stack,points,index);series=d3.permute(series,orders);points=d3.permute(points,orders);var offsets=offset.call(stack,points,index);var n=series.length,m=series[0].length,i,j,o;for(j=0;j<m;++j){out.call(stack,series[0][j],o=offsets[j],points[0][j][1]);for(i=1;i<n;++i){out.call(stack,series[i][j],o+=points[i-1][j][1],points[i][j][1]);}}
return data;}
var values=d3_identity,order=d3_layout_stackOrderDefault,offset=d3_layout_stackOffsetZero,out=d3_layout_stackOut,x=d3_layout_stackX,y=d3_layout_stackY;stack.values=function(x){if(!arguments.length)return values;values=x;return stack;};stack.order=function(x){if(!arguments.length)return order;order=typeof x==="function"?x:d3_layout_stackOrders.get(x)||d3_layout_stackOrderDefault;return stack;};stack.offset=function(x){if(!arguments.length)return offset;offset=typeof x==="function"?x:d3_layout_stackOffsets.get(x)||d3_layout_stackOffsetZero;return stack;};stack.x=function(z){if(!arguments.length)return x;x=z;return stack;};stack.y=function(z){if(!arguments.length)return y;y=z;return stack;};stack.out=function(z){if(!arguments.length)return out;out=z;return stack;};return stack;};var d3_layout_stackOrders=d3.map({"inside-out":function(data){var n=data.length,i,j,max=data.map(d3_layout_stackMaxIndex),sums=data.map(d3_layout_stackReduceSum),index=d3.range(n).sort(function(a,b){return max[a]-max[b];}),top=0,bottom=0,tops=[],bottoms=[];for(i=0;i<n;++i){j=index[i];if(top<bottom){top+=sums[j];tops.push(j);}else{bottom+=sums[j];bottoms.push(j);}}
return bottoms.reverse().concat(tops);},reverse:function(data){return d3.range(data.length).reverse();},"default":d3_layout_stackOrderDefault});var d3_layout_stackOffsets=d3.map({silhouette:function(data){var n=data.length,m=data[0].length,sums=[],max=0,i,j,o,y0=[];for(j=0;j<m;++j){for(i=0,o=0;i<n;i++)o+=data[i][j][1];if(o>max)max=o;sums.push(o);}
for(j=0;j<m;++j){y0[j]=(max-sums[j])/2;}
return y0;},wiggle:function(data){var n=data.length,x=data[0],m=x.length,max=0,i,j,k,s1,s2,s3,dx,o,o0,y0=[];y0[0]=o=o0=0;for(j=1;j<m;++j){for(i=0,s1=0;i<n;++i)s1+=data[i][j][1];for(i=0,s2=0,dx=x[j][0]-x[j-1][0];i<n;++i){for(k=0,s3=(data[i][j][1]-data[i][j-1][1])/(2*dx);k<i;++k){s3+=(data[k][j][1]-data[k][j-1][1])/dx;}
s2+=s3*data[i][j][1];}
y0[j]=o-=s1?s2/s1*dx:0;if(o<o0)o0=o;}
for(j=0;j<m;++j)y0[j]-=o0;return y0;},expand:function(data){var n=data.length,m=data[0].length,k=1/n,i,j,o,y0=[];for(j=0;j<m;++j){for(i=0,o=0;i<n;i++)o+=data[i][j][1];if(o)for(i=0;i<n;i++)data[i][j][1]/=o;else for(i=0;i<n;i++)data[i][j][1]=k;}
for(j=0;j<m;++j)y0[j]=0;return y0;},zero:d3_layout_stackOffsetZero});d3.layout.histogram=function(){function histogram(data,i){var bins=[],values=data.map(valuer,this),range=ranger.call(this,values,i),thresholds=binner.call(this,range,values,i),bin,i=-1,n=values.length,m=thresholds.length-1,k=frequency?1:1/n,x;while(++i<m){bin=bins[i]=[];bin.dx=thresholds[i+1]-(bin.x=thresholds[i]);bin.y=0;}
if(m>0){i=-1;while(++i<n){x=values[i];if(x>=range[0]&&x<=range[1]){bin=bins[d3.bisect(thresholds,x,1,m)-1];bin.y+=k;bin.push(data[i]);}}}
return bins;}
var frequency=true,valuer=Number,ranger=d3_layout_histogramRange,binner=d3_layout_histogramBinSturges;histogram.value=function(x){if(!arguments.length)return valuer;valuer=x;return histogram;};histogram.range=function(x){if(!arguments.length)return ranger;ranger=d3_functor(x);return histogram;};histogram.bins=function(x){if(!arguments.length)return binner;binner=typeof x==="number"?function(range){return d3_layout_histogramBinFixed(range,x);}:d3_functor(x);return histogram;};histogram.frequency=function(x){if(!arguments.length)return frequency;frequency=!!x;return histogram;};return histogram;};d3.layout.hierarchy=function(){function recurse(data,depth,nodes){var childs=children.call(hierarchy,data,depth),node=d3_layout_hierarchyInline?data:{data:data};node.depth=depth;nodes.push(node);if(childs&&(n=childs.length)){var i=-1,n,c=node.children=[],v=0,j=depth+1,d;while(++i<n){d=recurse(childs[i],j,nodes);d.parent=node;c.push(d);v+=d.value;}
if(sort)c.sort(sort);if(value)node.value=v;}else if(value){node.value=+value.call(hierarchy,data,depth)||0;}
return node;}
function revalue(node,depth){var children=node.children,v=0;if(children&&(n=children.length)){var i=-1,n,j=depth+1;while(++i<n)v+=revalue(children[i],j);}else if(value){v=+value.call(hierarchy,d3_layout_hierarchyInline?node:node.data,depth)||0;}
if(value)node.value=v;return v;}
function hierarchy(d){var nodes=[];recurse(d,0,nodes);return nodes;}
var sort=d3_layout_hierarchySort,children=d3_layout_hierarchyChildren,value=d3_layout_hierarchyValue;hierarchy.sort=function(x){if(!arguments.length)return sort;sort=x;return hierarchy;};hierarchy.children=function(x){if(!arguments.length)return children;children=x;return hierarchy;};hierarchy.value=function(x){if(!arguments.length)return value;value=x;return hierarchy;};hierarchy.revalue=function(root){revalue(root,0);return root;};return hierarchy;};var d3_layout_hierarchyInline=false;d3.layout.pack=function(){function pack(d,i){var nodes=hierarchy.call(this,d,i),root=nodes[0];root.x=0;root.y=0;d3_layout_treeVisitAfter(root,function(d){d.r=Math.sqrt(d.value);});d3_layout_treeVisitAfter(root,d3_layout_packSiblings);var w=size[0],h=size[1],k=Math.max(2*root.r/w,2*root.r/h);if(padding>0){var dr=padding*k/2;d3_layout_treeVisitAfter(root,function(d){d.r+=dr;});d3_layout_treeVisitAfter(root,d3_layout_packSiblings);d3_layout_treeVisitAfter(root,function(d){d.r-=dr;});k=Math.max(2*root.r/w,2*root.r/h);}
d3_layout_packTransform(root,w/2,h/2,1/k);return nodes;}
var hierarchy=d3.layout.hierarchy().sort(d3_layout_packSort),padding=0,size=[1,1];pack.size=function(x){if(!arguments.length)return size;size=x;return pack;};pack.padding=function(_){if(!arguments.length)return padding;padding=+_;return pack;};return d3_layout_hierarchyRebind(pack,hierarchy);};d3.layout.cluster=function(){function cluster(d,i){var nodes=hierarchy.call(this,d,i),root=nodes[0],previousNode,x=0,kx,ky;d3_layout_treeVisitAfter(root,function(node){var children=node.children;if(children&&children.length){node.x=d3_layout_clusterX(children);node.y=d3_layout_clusterY(children);}else{node.x=previousNode?x+=separation(node,previousNode):0;node.y=0;previousNode=node;}});var left=d3_layout_clusterLeft(root),right=d3_layout_clusterRight(root),x0=left.x-separation(left,right)/2,x1=right.x+separation(right,left)/2;d3_layout_treeVisitAfter(root,function(node){node.x=(node.x-x0)/(x1-x0)*size[0];node.y=(1-(root.y?node.y/root.y:1))*size[1];});return nodes;}
var hierarchy=d3.layout.hierarchy().sort(null).value(null),separation=d3_layout_treeSeparation,size=[1,1];cluster.separation=function(x){if(!arguments.length)return separation;separation=x;return cluster;};cluster.size=function(x){if(!arguments.length)return size;size=x;return cluster;};return d3_layout_hierarchyRebind(cluster,hierarchy);};d3.layout.tree=function(){function tree(d,i){function firstWalk(node,previousSibling){var children=node.children,layout=node._tree;if(children&&(n=children.length)){var n,firstChild=children[0],previousChild,ancestor=firstChild,child,i=-1;while(++i<n){child=children[i];firstWalk(child,previousChild);ancestor=apportion(child,previousChild,ancestor);previousChild=child;}
d3_layout_treeShift(node);var midpoint=.5*(firstChild._tree.prelim+child._tree.prelim);if(previousSibling){layout.prelim=previousSibling._tree.prelim+separation(node,previousSibling);layout.mod=layout.prelim-midpoint;}else{layout.prelim=midpoint;}}else{if(previousSibling){layout.prelim=previousSibling._tree.prelim+separation(node,previousSibling);}}}
function secondWalk(node,x){node.x=node._tree.prelim+x;var children=node.children;if(children&&(n=children.length)){var i=-1,n;x+=node._tree.mod;while(++i<n){secondWalk(children[i],x);}}}
function apportion(node,previousSibling,ancestor){if(previousSibling){var vip=node,vop=node,vim=previousSibling,vom=node.parent.children[0],sip=vip._tree.mod,sop=vop._tree.mod,sim=vim._tree.mod,som=vom._tree.mod,shift;while(vim=d3_layout_treeRight(vim),vip=d3_layout_treeLeft(vip),vim&&vip){vom=d3_layout_treeLeft(vom);vop=d3_layout_treeRight(vop);vop._tree.ancestor=node;shift=vim._tree.prelim+sim-vip._tree.prelim-sip+separation(vim,vip);if(shift>0){d3_layout_treeMove(d3_layout_treeAncestor(vim,node,ancestor),node,shift);sip+=shift;sop+=shift;}
sim+=vim._tree.mod;sip+=vip._tree.mod;som+=vom._tree.mod;sop+=vop._tree.mod;}
if(vim&&!d3_layout_treeRight(vop)){vop._tree.thread=vim;vop._tree.mod+=sim-sop;}
if(vip&&!d3_layout_treeLeft(vom)){vom._tree.thread=vip;vom._tree.mod+=sip-som;ancestor=node;}}
return ancestor;}
var nodes=hierarchy.call(this,d,i),root=nodes[0];d3_layout_treeVisitAfter(root,function(node,previousSibling){node._tree={ancestor:node,prelim:0,mod:0,change:0,shift:0,number:previousSibling?previousSibling._tree.number+1:0};});firstWalk(root);secondWalk(root,-root._tree.prelim);var left=d3_layout_treeSearch(root,d3_layout_treeLeftmost),right=d3_layout_treeSearch(root,d3_layout_treeRightmost),deep=d3_layout_treeSearch(root,d3_layout_treeDeepest),x0=left.x-separation(left,right)/2,x1=right.x+separation(right,left)/2,y1=deep.depth||1;d3_layout_treeVisitAfter(root,function(node){node.x=(node.x-x0)/(x1-x0)*size[0];node.y=node.depth/y1*size[1];delete node._tree;});return nodes;}
var hierarchy=d3.layout.hierarchy().sort(null).value(null),separation=d3_layout_treeSeparation,size=[1,1];tree.separation=function(x){if(!arguments.length)return separation;separation=x;return tree;};tree.size=function(x){if(!arguments.length)return size;size=x;return tree;};return d3_layout_hierarchyRebind(tree,hierarchy);};d3.layout.treemap=function(){function scale(children,k){var i=-1,n=children.length,child,area;while(++i<n){area=(child=children[i]).value*(k<0?0:k);child.area=isNaN(area)||area<=0?0:area;}}
function squarify(node){var children=node.children;if(children&&children.length){var rect=pad(node),row=[],remaining=children.slice(),child,best=Infinity,score,u=Math.min(rect.dx,rect.dy),n;scale(remaining,rect.dx*rect.dy/node.value);row.area=0;while((n=remaining.length)>0){row.push(child=remaining[n-1]);row.area+=child.area;if((score=worst(row,u))<=best){remaining.pop();best=score;}else{row.area-=row.pop().area;position(row,u,rect,false);u=Math.min(rect.dx,rect.dy);row.length=row.area=0;best=Infinity;}}
if(row.length){position(row,u,rect,true);row.length=row.area=0;}
children.forEach(squarify);}}
function stickify(node){var children=node.children;if(children&&children.length){var rect=pad(node),remaining=children.slice(),child,row=[];scale(remaining,rect.dx*rect.dy/node.value);row.area=0;while(child=remaining.pop()){row.push(child);row.area+=child.area;if(child.z!=null){position(row,child.z?rect.dx:rect.dy,rect,!remaining.length);row.length=row.area=0;}}
children.forEach(stickify);}}
function worst(row,u){var s=row.area,r,rmax=0,rmin=Infinity,i=-1,n=row.length;while(++i<n){if(!(r=row[i].area))continue;if(r<rmin)rmin=r;if(r>rmax)rmax=r;}
s*=s;u*=u;return s?Math.max(u*rmax*ratio/s,s/(u*rmin*ratio)):Infinity;}
function position(row,u,rect,flush){var i=-1,n=row.length,x=rect.x,y=rect.y,v=u?round(row.area/u):0,o;if(u==rect.dx){if(flush||v>rect.dy)v=rect.dy;while(++i<n){o=row[i];o.x=x;o.y=y;o.dy=v;x+=o.dx=Math.min(rect.x+rect.dx-x,v?round(o.area/v):0);}
o.z=true;o.dx+=rect.x+rect.dx-x;rect.y+=v;rect.dy-=v;}else{if(flush||v>rect.dx)v=rect.dx;while(++i<n){o=row[i];o.x=x;o.y=y;o.dx=v;y+=o.dy=Math.min(rect.y+rect.dy-y,v?round(o.area/v):0);}
o.z=false;o.dy+=rect.y+rect.dy-y;rect.x+=v;rect.dx-=v;}}
function treemap(d){var nodes=stickies||hierarchy(d),root=nodes[0];root.x=0;root.y=0;root.dx=size[0];root.dy=size[1];if(stickies)hierarchy.revalue(root);scale([root],root.dx*root.dy/root.value);(stickies?stickify:squarify)(root);if(sticky)stickies=nodes;return nodes;}
var hierarchy=d3.layout.hierarchy(),round=Math.round,size=[1,1],padding=null,pad=d3_layout_treemapPadNull,sticky=false,stickies,ratio=.5*(1+Math.sqrt(5));treemap.size=function(x){if(!arguments.length)return size;size=x;return treemap;};treemap.padding=function(x){function padFunction(node){var p=x.call(treemap,node,node.depth);return p==null?d3_layout_treemapPadNull(node):d3_layout_treemapPad(node,typeof p==="number"?[p,p,p,p]:p);}
function padConstant(node){return d3_layout_treemapPad(node,x);}
if(!arguments.length)return padding;var type;pad=(padding=x)==null?d3_layout_treemapPadNull:(type=typeof x)==="function"?padFunction:type==="number"?(x=[x,x,x,x],padConstant):padConstant;return treemap;};treemap.round=function(x){if(!arguments.length)return round!=Number;round=x?Math.round:Number;return treemap;};treemap.sticky=function(x){if(!arguments.length)return sticky;sticky=x;stickies=null;return treemap;};treemap.ratio=function(x){if(!arguments.length)return ratio;ratio=x;return treemap;};return d3_layout_hierarchyRebind(treemap,hierarchy);};d3.csv=d3_dsv(",","text/csv");d3.tsv=d3_dsv(" ","text/tab-separated-values");d3.geo={};var d3_geo_radians=Math.PI/180;d3.geo.azimuthal=function(){function azimuthal(coordinates){var x1=coordinates[0]*d3_geo_radians-x0,y1=coordinates[1]*d3_geo_radians,cx1=Math.cos(x1),sx1=Math.sin(x1),cy1=Math.cos(y1),sy1=Math.sin(y1),cc=mode!=="orthographic"?sy0*sy1+cy0*cy1*cx1:null,c,k=mode==="stereographic"?1/(1+cc):mode==="gnomonic"?1/cc:mode==="equidistant"?(c=Math.acos(cc),c?c/Math.sin(c):0):mode==="equalarea"?Math.sqrt(2/(1+cc)):1,x=k*cy1*sx1,y=k*(sy0*cy1*cx1-cy0*sy1);return[scale*x+translate[0],scale*y+translate[1]];}
var mode="orthographic",origin,scale=200,translate=[480,250],x0,y0,cy0,sy0;azimuthal.invert=function(coordinates){var x=(coordinates[0]-translate[0])/scale,y=(coordinates[1]-translate[1])/scale,p=Math.sqrt(x*x+y*y),c=mode==="stereographic"?2*Math.atan(p):mode==="gnomonic"?Math.atan(p):mode==="equidistant"?p:mode==="equalarea"?2*Math.asin(.5*p):Math.asin(p),sc=Math.sin(c),cc=Math.cos(c);return[(x0+Math.atan2(x*sc,p*cy0*cc+y*sy0*sc))/d3_geo_radians,Math.asin(cc*sy0-(p?y*sc*cy0/p:0))/d3_geo_radians];};azimuthal.mode=function(x){if(!arguments.length)return mode;mode=x+"";return azimuthal;};azimuthal.origin=function(x){if(!arguments.length)return origin;origin=x;x0=origin[0]*d3_geo_radians;y0=origin[1]*d3_geo_radians;cy0=Math.cos(y0);sy0=Math.sin(y0);return azimuthal;};azimuthal.scale=function(x){if(!arguments.length)return scale;scale=+x;return azimuthal;};azimuthal.translate=function(x){if(!arguments.length)return translate;translate=[+x[0],+x[1]];return azimuthal;};return azimuthal.origin([0,0]);};d3.geo.albers=function(){function albers(coordinates){var t=n*(d3_geo_radians*coordinates[0]-lng0),p=Math.sqrt(C-2*n*Math.sin(d3_geo_radians*coordinates[1]))/n;return[scale*p*Math.sin(t)+translate[0],scale*(p*Math.cos(t)-p0)+translate[1]];}
function reload(){var phi1=d3_geo_radians*parallels[0],phi2=d3_geo_radians*parallels[1],lat0=d3_geo_radians*origin[1],s=Math.sin(phi1),c=Math.cos(phi1);lng0=d3_geo_radians*origin[0];n=.5*(s+Math.sin(phi2));C=c*c+2*n*s;p0=Math.sqrt(C-2*n*Math.sin(lat0))/n;return albers;}
var origin=[-98,38],parallels=[29.5,45.5],scale=1e3,translate=[480,250],lng0,n,C,p0;albers.invert=function(coordinates){var x=(coordinates[0]-translate[0])/scale,y=(coordinates[1]-translate[1])/scale,p0y=p0+y,t=Math.atan2(x,p0y),p=Math.sqrt(x*x+p0y*p0y);return[(lng0+t/n)/d3_geo_radians,Math.asin((C-p*p*n*n)/(2*n))/d3_geo_radians];};albers.origin=function(x){if(!arguments.length)return origin;origin=[+x[0],+x[1]];return reload();};albers.parallels=function(x){if(!arguments.length)return parallels;parallels=[+x[0],+x[1]];return reload();};albers.scale=function(x){if(!arguments.length)return scale;scale=+x;return albers;};albers.translate=function(x){if(!arguments.length)return translate;translate=[+x[0],+x[1]];return albers;};return reload();};d3.geo.albersUsa=function(){function albersUsa(coordinates){var lon=coordinates[0],lat=coordinates[1];return(lat>50?alaska:lon<-140?hawaii:lat<21?puertoRico:lower48)(coordinates);}
var lower48=d3.geo.albers();var alaska=d3.geo.albers().origin([-160,60]).parallels([55,65]);var hawaii=d3.geo.albers().origin([-160,20]).parallels([8,18]);var puertoRico=d3.geo.albers().origin([-60,10]).parallels([8,18]);albersUsa.scale=function(x){if(!arguments.length)return lower48.scale();lower48.scale(x);alaska.scale(x*.6);hawaii.scale(x);puertoRico.scale(x*1.5);return albersUsa.translate(lower48.translate());};albersUsa.translate=function(x){if(!arguments.length)return lower48.translate();var dz=lower48.scale()/1e3,dx=x[0],dy=x[1];lower48.translate(x);alaska.translate([dx-400*dz,dy+170*dz]);hawaii.translate([dx-190*dz,dy+200*dz]);puertoRico.translate([dx+580*dz,dy+430*dz]);return albersUsa;};return albersUsa.scale(lower48.scale());};d3.geo.bonne=function(){function bonne(coordinates){var x=coordinates[0]*d3_geo_radians-x0,y=coordinates[1]*d3_geo_radians-y0;if(y1){var p=c1+y1-y,E=x*Math.cos(y)/p;x=p*Math.sin(E);y=p*Math.cos(E)-c1;}else{x*=Math.cos(y);y*=-1;}
return[scale*x+translate[0],scale*y+translate[1]];}
var scale=200,translate=[480,250],x0,y0,y1,c1;bonne.invert=function(coordinates){var x=(coordinates[0]-translate[0])/scale,y=(coordinates[1]-translate[1])/scale;if(y1){var c=c1+y,p=Math.sqrt(x*x+c*c);y=c1+y1-p;x=x0+p*Math.atan2(x,c)/Math.cos(y);}else{y*=-1;x/=Math.cos(y);}
return[x/d3_geo_radians,y/d3_geo_radians];};bonne.parallel=function(x){if(!arguments.length)return y1/d3_geo_radians;c1=1/Math.tan(y1=x*d3_geo_radians);return bonne;};bonne.origin=function(x){if(!arguments.length)return[x0/d3_geo_radians,y0/d3_geo_radians];x0=x[0]*d3_geo_radians;y0=x[1]*d3_geo_radians;return bonne;};bonne.scale=function(x){if(!arguments.length)return scale;scale=+x;return bonne;};bonne.translate=function(x){if(!arguments.length)return translate;translate=[+x[0],+x[1]];return bonne;};return bonne.origin([0,0]).parallel(45);};d3.geo.equirectangular=function(){function equirectangular(coordinates){var x=coordinates[0]/360,y=-coordinates[1]/360;return[scale*x+translate[0],scale*y+translate[1]];}
var scale=500,translate=[480,250];equirectangular.invert=function(coordinates){var x=(coordinates[0]-translate[0])/scale,y=(coordinates[1]-translate[1])/scale;return[360*x,-360*y];};equirectangular.scale=function(x){if(!arguments.length)return scale;scale=+x;return equirectangular;};equirectangular.translate=function(x){if(!arguments.length)return translate;translate=[+x[0],+x[1]];return equirectangular;};return equirectangular;};d3.geo.mercator=function(){function mercator(coordinates){var x=coordinates[0]/360,y=-(Math.log(Math.tan(Math.PI/4+coordinates[1]*d3_geo_radians/2))/d3_geo_radians)/360;return[scale*x+translate[0],scale*Math.max(-.5,Math.min(.5,y))+translate[1]];}
var scale=500,translate=[480,250];mercator.invert=function(coordinates){var x=(coordinates[0]-translate[0])/scale,y=(coordinates[1]-translate[1])/scale;return[360*x,2*Math.atan(Math.exp(-360*y*d3_geo_radians))/d3_geo_radians-90];};mercator.scale=function(x){if(!arguments.length)return scale;scale=+x;return mercator;};mercator.translate=function(x){if(!arguments.length)return translate;translate=[+x[0],+x[1]];return mercator;};return mercator;};d3.geo.path=function(){function path(d,i){if(typeof pointRadius==="function")pointCircle=d3_path_circle(pointRadius.apply(this,arguments));pathType(d);var result=buffer.length?buffer.join(""):null;buffer=[];return result;}
function project(coordinates){return projection(coordinates).join(",");}
function polygonArea(coordinates){var sum=area(coordinates[0]),i=0,n=coordinates.length;while(++i<n)sum-=area(coordinates[i]);return sum;}
function polygonCentroid(coordinates){var polygon=d3.geom.polygon(coordinates[0].map(projection)),area=polygon.area(),centroid=polygon.centroid(area<0?(area*=-1,1):-1),x=centroid[0],y=centroid[1],z=area,i=0,n=coordinates.length;while(++i<n){polygon=d3.geom.polygon(coordinates[i].map(projection));area=polygon.area();centroid=polygon.centroid(area<0?(area*=-1,1):-1);x-=centroid[0];y-=centroid[1];z-=area;}
return[x,y,6*z];}
function area(coordinates){return Math.abs(d3.geom.polygon(coordinates.map(projection)).area());}
var pointRadius=4.5,pointCircle=d3_path_circle(pointRadius),projection=d3.geo.albersUsa(),buffer=[];var pathType=d3_geo_type({FeatureCollection:function(o){var features=o.features,i=-1,n=features.length;while(++i<n)buffer.push(pathType(features[i].geometry));},Feature:function(o){pathType(o.geometry);},Point:function(o){buffer.push("M",project(o.coordinates),pointCircle);},MultiPoint:function(o){var coordinates=o.coordinates,i=-1,n=coordinates.length;while(++i<n)buffer.push("M",project(coordinates[i]),pointCircle);},LineString:function(o){var coordinates=o.coordinates,i=-1,n=coordinates.length;buffer.push("M");while(++i<n)buffer.push(project(coordinates[i]),"L");buffer.pop();},MultiLineString:function(o){var coordinates=o.coordinates,i=-1,n=coordinates.length,subcoordinates,j,m;while(++i<n){subcoordinates=coordinates[i];j=-1;m=subcoordinates.length;buffer.push("M");while(++j<m)buffer.push(project(subcoordinates[j]),"L");buffer.pop();}},Polygon:function(o){var coordinates=o.coordinates,i=-1,n=coordinates.length,subcoordinates,j,m;while(++i<n){subcoordinates=coordinates[i];j=-1;if((m=subcoordinates.length-1)>0){buffer.push("M");while(++j<m)buffer.push(project(subcoordinates[j]),"L");buffer[buffer.length-1]="Z";}}},MultiPolygon:function(o){var coordinates=o.coordinates,i=-1,n=coordinates.length,subcoordinates,j,m,subsubcoordinates,k,p;while(++i<n){subcoordinates=coordinates[i];j=-1;m=subcoordinates.length;while(++j<m){subsubcoordinates=subcoordinates[j];k=-1;if((p=subsubcoordinates.length-1)>0){buffer.push("M");while(++k<p)buffer.push(project(subsubcoordinates[k]),"L");buffer[buffer.length-1]="Z";}}}},GeometryCollection:function(o){var geometries=o.geometries,i=-1,n=geometries.length;while(++i<n)buffer.push(pathType(geometries[i]));}});var areaType=path.area=d3_geo_type({FeatureCollection:function(o){var area=0,features=o.features,i=-1,n=features.length;while(++i<n)area+=areaType(features[i]);return area;},Feature:function(o){return areaType(o.geometry);},Polygon:function(o){return polygonArea(o.coordinates);},MultiPolygon:function(o){var sum=0,coordinates=o.coordinates,i=-1,n=coordinates.length;while(++i<n)sum+=polygonArea(coordinates[i]);return sum;},GeometryCollection:function(o){var sum=0,geometries=o.geometries,i=-1,n=geometries.length;while(++i<n)sum+=areaType(geometries[i]);return sum;}},0);var centroidType=path.centroid=d3_geo_type({Feature:function(o){return centroidType(o.geometry);},Polygon:function(o){var centroid=polygonCentroid(o.coordinates);return[centroid[0]/centroid[2],centroid[1]/centroid[2]];},MultiPolygon:function(o){var area=0,coordinates=o.coordinates,centroid,x=0,y=0,z=0,i=-1,n=coordinates.length;while(++i<n){centroid=polygonCentroid(coordinates[i]);x+=centroid[0];y+=centroid[1];z+=centroid[2];}
return[x/z,y/z];}});path.projection=function(x){projection=x;return path;};path.pointRadius=function(x){if(typeof x==="function")pointRadius=x;else{pointRadius=+x;pointCircle=d3_path_circle(pointRadius);}
return path;};return path;};d3.geo.bounds=function(feature){var left=Infinity,bottom=Infinity,right=-Infinity,top=-Infinity;d3_geo_bounds(feature,function(x,y){if(x<left)left=x;if(x>right)right=x;if(y<bottom)bottom=y;if(y>top)top=y;});return[[left,bottom],[right,top]];};var d3_geo_boundsTypes={Feature:d3_geo_boundsFeature,FeatureCollection:d3_geo_boundsFeatureCollection,GeometryCollection:d3_geo_boundsGeometryCollection,LineString:d3_geo_boundsLineString,MultiLineString:d3_geo_boundsMultiLineString,MultiPoint:d3_geo_boundsLineString,MultiPolygon:d3_geo_boundsMultiPolygon,Point:d3_geo_boundsPoint,Polygon:d3_geo_boundsPolygon};d3.geo.circle=function(){function circle(){}
function visible(point){return arc.distance(point)<radians;}
function clip(coordinates){var i=-1,n=coordinates.length,clipped=[],p0,p1,p2,d0,d1;while(++i<n){d1=arc.distance(p2=coordinates[i]);if(d1<radians){if(p1)clipped.push(d3_geo_greatArcInterpolate(p1,p2)((d0-radians)/(d0-d1)));clipped.push(p2);p0=p1=null;}else{p1=p2;if(!p0&&clipped.length){clipped.push(d3_geo_greatArcInterpolate(clipped[clipped.length-1],p1)((radians-d0)/(d1-d0)));p0=p1;}}
d0=d1;}
p0=coordinates[0];p1=clipped[0];if(p1&&p2[0]===p0[0]&&p2[1]===p0[1]&&!(p2[0]===p1[0]&&p2[1]===p1[1])){clipped.push(p1);}
return resample(clipped);}
function resample(coordinates){var i=0,n=coordinates.length,j,m,resampled=n?[coordinates[0]]:coordinates,resamples,origin=arc.source();while(++i<n){resamples=arc.source(coordinates[i-1])(coordinates[i]).coordinates;for(j=0,m=resamples.length;++j<m;)resampled.push(resamples[j]);}
arc.source(origin);return resampled;}
var origin=[0,0],degrees=90-.01,radians=degrees*d3_geo_radians,arc=d3.geo.greatArc().source(origin).target(d3_identity);circle.clip=function(d){if(typeof origin==="function")arc.source(origin.apply(this,arguments));return clipType(d)||null;};var clipType=d3_geo_type({FeatureCollection:function(o){var features=o.features.map(clipType).filter(d3_identity);return features&&(o=Object.create(o),o.features=features,o);},Feature:function(o){var geometry=clipType(o.geometry);return geometry&&(o=Object.create(o),o.geometry=geometry,o);},Point:function(o){return visible(o.coordinates)&&o;},MultiPoint:function(o){var coordinates=o.coordinates.filter(visible);return coordinates.length&&{type:o.type,coordinates:coordinates};},LineString:function(o){var coordinates=clip(o.coordinates);return coordinates.length&&(o=Object.create(o),o.coordinates=coordinates,o);},MultiLineString:function(o){var coordinates=o.coordinates.map(clip).filter(function(d){return d.length;});return coordinates.length&&(o=Object.create(o),o.coordinates=coordinates,o);},Polygon:function(o){var coordinates=o.coordinates.map(clip);return coordinates[0].length&&(o=Object.create(o),o.coordinates=coordinates,o);},MultiPolygon:function(o){var coordinates=o.coordinates.map(function(d){return d.map(clip);}).filter(function(d){return d[0].length;});return coordinates.length&&(o=Object.create(o),o.coordinates=coordinates,o);},GeometryCollection:function(o){var geometries=o.geometries.map(clipType).filter(d3_identity);return geometries.length&&(o=Object.create(o),o.geometries=geometries,o);}});circle.origin=function(x){if(!arguments.length)return origin;origin=x;if(typeof origin!=="function")arc.source(origin);return circle;};circle.angle=function(x){if(!arguments.length)return degrees;radians=(degrees=+x)*d3_geo_radians;return circle;};return d3.rebind(circle,arc,"precision");};d3.geo.greatArc=function(){function greatArc(){var d=greatArc.distance.apply(this,arguments),t=0,dt=precision/d,coordinates=[p0];while((t+=dt)<1)coordinates.push(interpolate(t));coordinates.push(p1);return{type:"LineString",coordinates:coordinates};}
var source=d3_geo_greatArcSource,p0,target=d3_geo_greatArcTarget,p1,precision=6*d3_geo_radians,interpolate=d3_geo_greatArcInterpolator();greatArc.distance=function(){if(typeof source==="function")interpolate.source(p0=source.apply(this,arguments));if(typeof target==="function")interpolate.target(p1=target.apply(this,arguments));return interpolate.distance();};greatArc.source=function(_){if(!arguments.length)return source;source=_;if(typeof source!=="function")interpolate.source(p0=source);return greatArc;};greatArc.target=function(_){if(!arguments.length)return target;target=_;if(typeof target!=="function")interpolate.target(p1=target);return greatArc;};greatArc.precision=function(_){if(!arguments.length)return precision/d3_geo_radians;precision=_*d3_geo_radians;return greatArc;};return greatArc;};d3.geo.greatCircle=d3.geo.circle;d3.geom={};d3.geom.contour=function(grid,start){var s=start||d3_geom_contourStart(grid),c=[],x=s[0],y=s[1],dx=0,dy=0,pdx=NaN,pdy=NaN,i=0;do{i=0;if(grid(x-1,y-1))i+=1;if(grid(x,y-1))i+=2;if(grid(x-1,y))i+=4;if(grid(x,y))i+=8;if(i===6){dx=pdy===-1?-1:1;dy=0;}else if(i===9){dx=0;dy=pdx===1?-1:1;}else{dx=d3_geom_contourDx[i];dy=d3_geom_contourDy[i];}
if(dx!=pdx&&dy!=pdy){c.push([x,y]);pdx=dx;pdy=dy;}
x+=dx;y+=dy;}while(s[0]!=x||s[1]!=y);return c;};var d3_geom_contourDx=[1,0,1,1,-1,0,-1,1,0,0,0,0,-1,0,-1,NaN],d3_geom_contourDy=[0,-1,0,0,0,-1,0,0,1,-1,1,1,0,-1,0,NaN];d3.geom.hull=function(vertices){if(vertices.length<3)return[];var len=vertices.length,plen=len-1,points=[],stack=[],i,j,h=0,x1,y1,x2,y2,u,v,a,sp;for(i=1;i<len;++i){if(vertices[i][1]<vertices[h][1]){h=i;}else if(vertices[i][1]==vertices[h][1]){h=vertices[i][0]<vertices[h][0]?i:h;}}
for(i=0;i<len;++i){if(i===h)continue;y1=vertices[i][1]-vertices[h][1];x1=vertices[i][0]-vertices[h][0];points.push({angle:Math.atan2(y1,x1),index:i});}
points.sort(function(a,b){return a.angle-b.angle;});a=points[0].angle;v=points[0].index;u=0;for(i=1;i<plen;++i){j=points[i].index;if(a==points[i].angle){x1=vertices[v][0]-vertices[h][0];y1=vertices[v][1]-vertices[h][1];x2=vertices[j][0]-vertices[h][0];y2=vertices[j][1]-vertices[h][1];if(x1*x1+y1*y1>=x2*x2+y2*y2){points[i].index=-1;}else{points[u].index=-1;a=points[i].angle;u=i;v=j;}}else{a=points[i].angle;u=i;v=j;}}
stack.push(h);for(i=0,j=0;i<2;++j){if(points[j].index!==-1){stack.push(points[j].index);i++;}}
sp=stack.length;for(;j<plen;++j){if(points[j].index===-1)continue;while(!d3_geom_hullCCW(stack[sp-2],stack[sp-1],points[j].index,vertices)){--sp;}
stack[sp++]=points[j].index;}
var poly=[];for(i=0;i<sp;++i){poly.push(vertices[stack[i]]);}
return poly;};d3.geom.polygon=function(coordinates){coordinates.area=function(){var i=0,n=coordinates.length,a=coordinates[n-1][0]*coordinates[0][1],b=coordinates[n-1][1]*coordinates[0][0];while(++i<n){a+=coordinates[i-1][0]*coordinates[i][1];b+=coordinates[i-1][1]*coordinates[i][0];}
return(b-a)*.5;};coordinates.centroid=function(k){var i=-1,n=coordinates.length,x=0,y=0,a,b=coordinates[n-1],c;if(!arguments.length)k=-1/(6*coordinates.area());while(++i<n){a=b;b=coordinates[i];c=a[0]*b[1]-b[0]*a[1];x+=(a[0]+b[0])*c;y+=(a[1]+b[1])*c;}
return[x*k,y*k];};coordinates.clip=function(subject){var input,i=-1,n=coordinates.length,j,m,a=coordinates[n-1],b,c,d;while(++i<n){input=subject.slice();subject.length=0;b=coordinates[i];c=input[(m=input.length)-1];j=-1;while(++j<m){d=input[j];if(d3_geom_polygonInside(d,a,b)){if(!d3_geom_polygonInside(c,a,b)){subject.push(d3_geom_polygonIntersect(c,d,a,b));}
subject.push(d);}else if(d3_geom_polygonInside(c,a,b)){subject.push(d3_geom_polygonIntersect(c,d,a,b));}
c=d;}
a=b;}
return subject;};return coordinates;};d3.geom.voronoi=function(vertices){var polygons=vertices.map(function(){return[];});d3_voronoi_tessellate(vertices,function(e){var s1,s2,x1,x2,y1,y2;if(e.a===1&&e.b>=0){s1=e.ep.r;s2=e.ep.l;}else{s1=e.ep.l;s2=e.ep.r;}
if(e.a===1){y1=s1?s1.y:-1e6;x1=e.c-e.b*y1;y2=s2?s2.y:1e6;x2=e.c-e.b*y2;}else{x1=s1?s1.x:-1e6;y1=e.c-e.a*x1;x2=s2?s2.x:1e6;y2=e.c-e.a*x2;}
var v1=[x1,y1],v2=[x2,y2];polygons[e.region.l.index].push(v1,v2);polygons[e.region.r.index].push(v1,v2);});return polygons.map(function(polygon,i){var cx=vertices[i][0],cy=vertices[i][1];polygon.forEach(function(v){v.angle=Math.atan2(v[0]-cx,v[1]-cy);});return polygon.sort(function(a,b){return a.angle-b.angle;}).filter(function(d,i){return!i||d.angle-polygon[i-1].angle>1e-10;});});};var d3_voronoi_opposite={l:"r",r:"l"};d3.geom.delaunay=function(vertices){var edges=vertices.map(function(){return[];}),triangles=[];d3_voronoi_tessellate(vertices,function(e){edges[e.region.l.index].push(vertices[e.region.r.index]);});edges.forEach(function(edge,i){var v=vertices[i],cx=v[0],cy=v[1];edge.forEach(function(v){v.angle=Math.atan2(v[0]-cx,v[1]-cy);});edge.sort(function(a,b){return a.angle-b.angle;});for(var j=0,m=edge.length-1;j<m;j++){triangles.push([v,edge[j],edge[j+1]]);}});return triangles;};d3.geom.quadtree=function(points,x1,y1,x2,y2){function insert(n,p,x1,y1,x2,y2){if(isNaN(p.x)||isNaN(p.y))return;if(n.leaf){var v=n.point;if(v){if(Math.abs(v.x-p.x)+Math.abs(v.y-p.y)<.01){insertChild(n,p,x1,y1,x2,y2);}else{n.point=null;insertChild(n,v,x1,y1,x2,y2);insertChild(n,p,x1,y1,x2,y2);}}else{n.point=p;}}else{insertChild(n,p,x1,y1,x2,y2);}}
function insertChild(n,p,x1,y1,x2,y2){var sx=(x1+x2)*.5,sy=(y1+y2)*.5,right=p.x>=sx,bottom=p.y>=sy,i=(bottom<<1)+right;n.leaf=false;n=n.nodes[i]||(n.nodes[i]=d3_geom_quadtreeNode());if(right)x1=sx;else x2=sx;if(bottom)y1=sy;else y2=sy;insert(n,p,x1,y1,x2,y2);}
var p,i=-1,n=points.length;if(n&&isNaN(points[0].x))points=points.map(d3_geom_quadtreePoint);if(arguments.length<5){if(arguments.length===3){y2=x2=y1;y1=x1;}else{x1=y1=Infinity;x2=y2=-Infinity;while(++i<n){p=points[i];if(p.x<x1)x1=p.x;if(p.y<y1)y1=p.y;if(p.x>x2)x2=p.x;if(p.y>y2)y2=p.y;}
var dx=x2-x1,dy=y2-y1;if(dx>dy)y2=y1+dx;else x2=x1+dy;}}
var root=d3_geom_quadtreeNode();root.add=function(p){insert(root,p,x1,y1,x2,y2);};root.visit=function(f){d3_geom_quadtreeVisit(f,root,x1,y1,x2,y2);};points.forEach(root.add);return root;};d3.time={};var d3_time=Date,d3_time_daySymbols=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];d3_time_utc.prototype={getDate:function(){return this._.getUTCDate();},getDay:function(){return this._.getUTCDay();},getFullYear:function(){return this._.getUTCFullYear();},getHours:function(){return this._.getUTCHours();},getMilliseconds:function(){return this._.getUTCMilliseconds();},getMinutes:function(){return this._.getUTCMinutes();},getMonth:function(){return this._.getUTCMonth();},getSeconds:function(){return this._.getUTCSeconds();},getTime:function(){return this._.getTime();},getTimezoneOffset:function(){return 0;},valueOf:function(){return this._.valueOf();},setDate:function(){d3_time_prototype.setUTCDate.apply(this._,arguments);},setDay:function(){d3_time_prototype.setUTCDay.apply(this._,arguments);},setFullYear:function(){d3_time_prototype.setUTCFullYear.apply(this._,arguments);},setHours:function(){d3_time_prototype.setUTCHours.apply(this._,arguments);},setMilliseconds:function(){d3_time_prototype.setUTCMilliseconds.apply(this._,arguments);},setMinutes:function(){d3_time_prototype.setUTCMinutes.apply(this._,arguments);},setMonth:function(){d3_time_prototype.setUTCMonth.apply(this._,arguments);},setSeconds:function(){d3_time_prototype.setUTCSeconds.apply(this._,arguments);},setTime:function(){d3_time_prototype.setTime.apply(this._,arguments);}};var d3_time_prototype=Date.prototype;var d3_time_formatDateTime="%a %b %e %H:%M:%S %Y",d3_time_formatDate="%m/%d/%y",d3_time_formatTime="%H:%M:%S";var d3_time_days=d3_time_daySymbols,d3_time_dayAbbreviations=d3_time_days.map(d3_time_formatAbbreviate),d3_time_months=["January","February","March","April","May","June","July","August","September","October","November","December"],d3_time_monthAbbreviations=d3_time_months.map(d3_time_formatAbbreviate);d3.time.format=function(template){function format(date){var string=[],i=-1,j=0,c,f;while(++i<n){if(template.charCodeAt(i)==37){string.push(template.substring(j,i),(f=d3_time_formats[c=template.charAt(++i)])?f(date):c);j=i+1;}}
string.push(template.substring(j,i));return string.join("");}
var n=template.length;format.parse=function(string){var d={y:1900,m:0,d:1,H:0,M:0,S:0,L:0},i=d3_time_parse(d,template,string,0);if(i!=string.length)return null;if("p"in d)d.H=d.H%12+d.p*12;var date=new d3_time;date.setFullYear(d.y,d.m,d.d);date.setHours(d.H,d.M,d.S,d.L);return date;};format.toString=function(){return template;};return format;};var d3_time_zfill2=d3.format("02d"),d3_time_zfill3=d3.format("03d"),d3_time_zfill4=d3.format("04d"),d3_time_sfill2=d3.format("2d");var d3_time_dayRe=d3_time_formatRe(d3_time_days),d3_time_dayAbbrevRe=d3_time_formatRe(d3_time_dayAbbreviations),d3_time_monthRe=d3_time_formatRe(d3_time_months),d3_time_monthLookup=d3_time_formatLookup(d3_time_months),d3_time_monthAbbrevRe=d3_time_formatRe(d3_time_monthAbbreviations),d3_time_monthAbbrevLookup=d3_time_formatLookup(d3_time_monthAbbreviations);var d3_time_formats={a:function(d){return d3_time_dayAbbreviations[d.getDay()];},A:function(d){return d3_time_days[d.getDay()];},b:function(d){return d3_time_monthAbbreviations[d.getMonth()];},B:function(d){return d3_time_months[d.getMonth()];},c:d3.time.format(d3_time_formatDateTime),d:function(d){return d3_time_zfill2(d.getDate());},e:function(d){return d3_time_sfill2(d.getDate());},H:function(d){return d3_time_zfill2(d.getHours());},I:function(d){return d3_time_zfill2(d.getHours()%12||12);},j:function(d){return d3_time_zfill3(1+d3.time.dayOfYear(d));},L:function(d){return d3_time_zfill3(d.getMilliseconds());},m:function(d){return d3_time_zfill2(d.getMonth()+1);},M:function(d){return d3_time_zfill2(d.getMinutes());},p:function(d){return d.getHours()>=12?"PM":"AM";},S:function(d){return d3_time_zfill2(d.getSeconds());},U:function(d){return d3_time_zfill2(d3.time.sundayOfYear(d));},w:function(d){return d.getDay();},W:function(d){return d3_time_zfill2(d3.time.mondayOfYear(d));},x:d3.time.format(d3_time_formatDate),X:d3.time.format(d3_time_formatTime),y:function(d){return d3_time_zfill2(d.getFullYear()%100);},Y:function(d){return d3_time_zfill4(d.getFullYear()%1e4);},Z:d3_time_zone,"%":function(d){return"%";}};var d3_time_parsers={a:d3_time_parseWeekdayAbbrev,A:d3_time_parseWeekday,b:d3_time_parseMonthAbbrev,B:d3_time_parseMonth,c:d3_time_parseLocaleFull,d:d3_time_parseDay,e:d3_time_parseDay,H:d3_time_parseHour24,I:d3_time_parseHour24,L:d3_time_parseMilliseconds,m:d3_time_parseMonthNumber,M:d3_time_parseMinutes,p:d3_time_parseAmPm,S:d3_time_parseSeconds,x:d3_time_parseLocaleDate,X:d3_time_parseLocaleTime,y:d3_time_parseYear,Y:d3_time_parseFullYear};var d3_time_numberRe=/^\s*\d+/;var d3_time_amPmLookup=d3.map({am:0,pm:1});d3.time.format.utc=function(template){function format(date){try{d3_time=d3_time_utc;var utc=new d3_time;utc._=date;return local(utc);}finally{d3_time=Date;}}
var local=d3.time.format(template);format.parse=function(string){try{d3_time=d3_time_utc;var date=local.parse(string);return date&&date._;}finally{d3_time=Date;}};format.toString=local.toString;return format;};var d3_time_formatIso=d3.time.format.utc("%Y-%m-%dT%H:%M:%S.%LZ");d3.time.format.iso=Date.prototype.toISOString?d3_time_formatIsoNative:d3_time_formatIso;d3_time_formatIsoNative.parse=function(string){var date=new Date(string);return isNaN(date)?null:date;};d3_time_formatIsoNative.toString=d3_time_formatIso.toString;d3.time.second=d3_time_interval(function(date){return new d3_time(Math.floor(date/1e3)*1e3);},function(date,offset){date.setTime(date.getTime()+Math.floor(offset)*1e3);},function(date){return date.getSeconds();});d3.time.seconds=d3.time.second.range;d3.time.seconds.utc=d3.time.second.utc.range;d3.time.minute=d3_time_interval(function(date){return new d3_time(Math.floor(date/6e4)*6e4);},function(date,offset){date.setTime(date.getTime()+Math.floor(offset)*6e4);},function(date){return date.getMinutes();});d3.time.minutes=d3.time.minute.range;d3.time.minutes.utc=d3.time.minute.utc.range;d3.time.hour=d3_time_interval(function(date){var timezone=date.getTimezoneOffset()/60;return new d3_time((Math.floor(date/36e5-timezone)+timezone)*36e5);},function(date,offset){date.setTime(date.getTime()+Math.floor(offset)*36e5);},function(date){return date.getHours();});d3.time.hours=d3.time.hour.range;d3.time.hours.utc=d3.time.hour.utc.range;d3.time.day=d3_time_interval(function(date){var day=new d3_time(1970,0);day.setFullYear(date.getFullYear(),date.getMonth(),date.getDate());return day;},function(date,offset){date.setDate(date.getDate()+offset);},function(date){return date.getDate()-1;});d3.time.days=d3.time.day.range;d3.time.days.utc=d3.time.day.utc.range;d3.time.dayOfYear=function(date){var year=d3.time.year(date);return Math.floor((date-year-(date.getTimezoneOffset()-year.getTimezoneOffset())*6e4)/864e5);};d3_time_daySymbols.forEach(function(day,i){day=day.toLowerCase();i=7-i;var interval=d3.time[day]=d3_time_interval(function(date){(date=d3.time.day(date)).setDate(date.getDate()-(date.getDay()+i)%7);return date;},function(date,offset){date.setDate(date.getDate()+Math.floor(offset)*7);},function(date){var day=d3.time.year(date).getDay();return Math.floor((d3.time.dayOfYear(date)+(day+i)%7)/7)-(day!==i);});d3.time[day+"s"]=interval.range;d3.time[day+"s"].utc=interval.utc.range;d3.time[day+"OfYear"]=function(date){var day=d3.time.year(date).getDay();return Math.floor((d3.time.dayOfYear(date)+(day+i)%7)/7);};});d3.time.week=d3.time.sunday;d3.time.weeks=d3.time.sunday.range;d3.time.weeks.utc=d3.time.sunday.utc.range;d3.time.weekOfYear=d3.time.sundayOfYear;d3.time.month=d3_time_interval(function(date){date=d3.time.day(date);date.setDate(1);return date;},function(date,offset){date.setMonth(date.getMonth()+offset);},function(date){return date.getMonth();});d3.time.months=d3.time.month.range;d3.time.months.utc=d3.time.month.utc.range;d3.time.year=d3_time_interval(function(date){date=d3.time.day(date);date.setMonth(0,1);return date;},function(date,offset){date.setFullYear(date.getFullYear()+offset);},function(date){return date.getFullYear();});d3.time.years=d3.time.year.range;d3.time.years.utc=d3.time.year.utc.range;var d3_time_scaleSteps=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6];var d3_time_scaleLocalMethods=[[d3.time.second,1],[d3.time.second,5],[d3.time.second,15],[d3.time.second,30],[d3.time.minute,1],[d3.time.minute,5],[d3.time.minute,15],[d3.time.minute,30],[d3.time.hour,1],[d3.time.hour,3],[d3.time.hour,6],[d3.time.hour,12],[d3.time.day,1],[d3.time.day,2],[d3.time.week,1],[d3.time.month,1],[d3.time.month,3],[d3.time.year,1]];var d3_time_scaleLocalFormats=[[d3.time.format("%Y"),function(d){return true;}],[d3.time.format("%B"),function(d){return d.getMonth();}],[d3.time.format("%b %d"),function(d){return d.getDate()!=1;}],[d3.time.format("%a %d"),function(d){return d.getDay()&&d.getDate()!=1;}],[d3.time.format("%I %p"),function(d){return d.getHours();}],[d3.time.format("%I:%M"),function(d){return d.getMinutes();}],[d3.time.format(":%S"),function(d){return d.getSeconds();}],[d3.time.format(".%L"),function(d){return d.getMilliseconds();}]];var d3_time_scaleLinear=d3.scale.linear(),d3_time_scaleLocalFormat=d3_time_scaleFormat(d3_time_scaleLocalFormats);d3_time_scaleLocalMethods.year=function(extent,m){return d3_time_scaleLinear.domain(extent.map(d3_time_scaleGetYear)).ticks(m).map(d3_time_scaleSetYear);};d3.time.scale=function(){return d3_time_scale(d3.scale.linear(),d3_time_scaleLocalMethods,d3_time_scaleLocalFormat);};var d3_time_scaleUTCMethods=d3_time_scaleLocalMethods.map(function(m){return[m[0].utc,m[1]];});var d3_time_scaleUTCFormats=[[d3.time.format.utc("%Y"),function(d){return true;}],[d3.time.format.utc("%B"),function(d){return d.getUTCMonth();}],[d3.time.format.utc("%b %d"),function(d){return d.getUTCDate()!=1;}],[d3.time.format.utc("%a %d"),function(d){return d.getUTCDay()&&d.getUTCDate()!=1;}],[d3.time.format.utc("%I %p"),function(d){return d.getUTCHours();}],[d3.time.format.utc("%I:%M"),function(d){return d.getUTCMinutes();}],[d3.time.format.utc(":%S"),function(d){return d.getUTCSeconds();}],[d3.time.format.utc(".%L"),function(d){return d.getUTCMilliseconds();}]];var d3_time_scaleUTCFormat=d3_time_scaleFormat(d3_time_scaleUTCFormats);d3_time_scaleUTCMethods.year=function(extent,m){return d3_time_scaleLinear.domain(extent.map(d3_time_scaleUTCGetYear)).ticks(m).map(d3_time_scaleUTCSetYear);};d3.time.scale.utc=function(){return d3_time_scale(d3.scale.linear(),d3_time_scaleUTCMethods,d3_time_scaleUTCFormat);};})();var THREE=THREE||{REVISION:'52'};self.console=self.console||{info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}};self.Int32Array=self.Int32Array||Array;self.Float32Array=self.Float32Array||Array;String.prototype.startsWith=String.prototype.startsWith||function(str){return this.slice(0,str.length)===str;};String.prototype.endsWith=String.prototype.endsWith||function(str){var t=String(str);var index=this.lastIndexOf(t);return(-1<index&&index)===(this.length-t.length);};String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,'');};(function(){var lastTime=0;var vendors=['ms','moz','webkit','o'];for(var x=0;x<vendors.length&&!window.requestAnimationFrame;++x){window.requestAnimationFrame=window[vendors[x]+'RequestAnimationFrame'];window.cancelAnimationFrame=window[vendors[x]+'CancelAnimationFrame']||window[vendors[x]+'CancelRequestAnimationFrame'];}
if(window.requestAnimationFrame===undefined){window.requestAnimationFrame=function(callback,element){var currTime=Date.now(),timeToCall=Math.max(0,16-(currTime-lastTime));var id=window.setTimeout(function(){callback(currTime+timeToCall);},timeToCall);lastTime=currTime+timeToCall;return id;};}
window.cancelAnimationFrame=window.cancelAnimationFrame||function(id){window.clearTimeout(id)};}());THREE.FrontSide=0;THREE.BackSide=1;THREE.DoubleSide=2;THREE.NoShading=0;THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NoBlending=0;THREE.NormalBlending=1;THREE.AdditiveBlending=2;THREE.SubtractiveBlending=3;THREE.MultiplyBlending=4;THREE.CustomBlending=5;THREE.AddEquation=100;THREE.SubtractEquation=101;THREE.ReverseSubtractEquation=102;THREE.ZeroFactor=200;THREE.OneFactor=201;THREE.SrcColorFactor=202;THREE.OneMinusSrcColorFactor=203;THREE.SrcAlphaFactor=204;THREE.OneMinusSrcAlphaFactor=205;THREE.DstAlphaFactor=206;THREE.OneMinusDstAlphaFactor=207;THREE.DstColorFactor=208;THREE.OneMinusDstColorFactor=209;THREE.SrcAlphaSaturateFactor=210;THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.UVMapping=function(){};THREE.CubeReflectionMapping=function(){};THREE.CubeRefractionMapping=function(){};THREE.SphericalReflectionMapping=function(){};THREE.SphericalRefractionMapping=function(){};THREE.RepeatWrapping=1000;THREE.ClampToEdgeWrapping=1001;THREE.MirroredRepeatWrapping=1002;THREE.NearestFilter=1003;THREE.NearestMipMapNearestFilter=1004;THREE.NearestMipMapLinearFilter=1005;THREE.LinearFilter=1006;THREE.LinearMipMapNearestFilter=1007;THREE.LinearMipMapLinearFilter=1008;THREE.UnsignedByteType=1009;THREE.ByteType=1010;THREE.ShortType=1011;THREE.UnsignedShortType=1012;THREE.IntType=1013;THREE.UnsignedIntType=1014;THREE.FloatType=1015;THREE.UnsignedShort4444Type=1016;THREE.UnsignedShort5551Type=1017;THREE.UnsignedShort565Type=1018;THREE.AlphaFormat=1019;THREE.RGBFormat=1020;THREE.RGBAFormat=1021;THREE.LuminanceFormat=1022;THREE.LuminanceAlphaFormat=1023;THREE.RGB_S3TC_DXT1_Format=2001;THREE.RGBA_S3TC_DXT1_Format=2002;THREE.RGBA_S3TC_DXT3_Format=2003;THREE.RGBA_S3TC_DXT5_Format=2004;THREE.Clock=function(autoStart){this.autoStart=(autoStart!==undefined)?autoStart:true;this.startTime=0;this.oldTime=0;this.elapsedTime=0;this.running=false;};THREE.Clock.prototype.start=function(){this.startTime=Date.now();this.oldTime=this.startTime;this.running=true;};THREE.Clock.prototype.stop=function(){this.getElapsedTime();this.running=false;};THREE.Clock.prototype.getElapsedTime=function(){this.elapsedTime+=this.getDelta();return this.elapsedTime;};THREE.Clock.prototype.getDelta=function(){var diff=0;if(this.autoStart&&!this.running){this.start();}
if(this.running){var newTime=Date.now();diff=0.001*(newTime-this.oldTime);this.oldTime=newTime;this.elapsedTime+=diff;}
return diff;};THREE.Color=function(hex){if(hex!==undefined)this.setHex(hex);return this;};THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,copy:function(color){this.r=color.r;this.g=color.g;this.b=color.b;return this;},copyGammaToLinear:function(color){this.r=color.r*color.r;this.g=color.g*color.g;this.b=color.b*color.b;return this;},copyLinearToGamma:function(color){this.r=Math.sqrt(color.r);this.g=Math.sqrt(color.g);this.b=Math.sqrt(color.b);return this;},convertGammaToLinear:function(){var r=this.r,g=this.g,b=this.b;this.r=r*r;this.g=g*g;this.b=b*b;return this;},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this;},setRGB:function(r,g,b){this.r=r;this.g=g;this.b=b;return this;},setHSV:function(h,s,v){var i,f,p,q,t;if(v===0){this.r=this.g=this.b=0;}else{i=Math.floor(h*6);f=(h*6)-i;p=v*(1-s);q=v*(1-(s*f));t=v*(1-(s*(1-f)));if(i===0){this.r=v;this.g=t;this.b=p;}else if(i===1){this.r=q;this.g=v;this.b=p;}else if(i===2){this.r=p;this.g=v;this.b=t;}else if(i===3){this.r=p;this.g=q;this.b=v;}else if(i===4){this.r=t;this.g=p;this.b=v;}else if(i===5){this.r=v;this.g=p;this.b=q;}}
return this;},setHex:function(hex){hex=Math.floor(hex);this.r=(hex>>16&255)/255;this.g=(hex>>8&255)/255;this.b=(hex&255)/255;return this;},lerpSelf:function(color,alpha){this.r+=(color.r-this.r)*alpha;this.g+=(color.g-this.g)*alpha;this.b+=(color.b-this.b)*alpha;return this;},getHex:function(){return(this.r*255)<<16^(this.g*255)<<8^(this.b*255)<<0;},getContextStyle:function(){return'rgb('+((this.r*255)|0)+','+((this.g*255)|0)+','+((this.b*255)|0)+')';},clone:function(){return new THREE.Color().setRGB(this.r,this.g,this.b);}};THREE.Vector2=function(x,y){this.x=x||0;this.y=y||0;};THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(x,y){this.x=x;this.y=y;return this;},copy:function(v){this.x=v.x;this.y=v.y;return this;},add:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this;},addSelf:function(v){this.x+=v.x;this.y+=v.y;return this;},sub:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this;},subSelf:function(v){this.x-=v.x;this.y-=v.y;return this;},multiplyScalar:function(s){this.x*=s;this.y*=s;return this;},divideScalar:function(s){if(s){this.x/=s;this.y/=s;}else{this.set(0,0);}
return this;},negate:function(){return this.multiplyScalar(-1);},dot:function(v){return this.x*v.x+this.y*v.y;},lengthSq:function(){return this.x*this.x+this.y*this.y;},length:function(){return Math.sqrt(this.lengthSq());},normalize:function(){return this.divideScalar(this.length());},distanceTo:function(v){return Math.sqrt(this.distanceToSquared(v));},distanceToSquared:function(v){var dx=this.x-v.x,dy=this.y-v.y;return dx*dx+dy*dy;},setLength:function(l){return this.normalize().multiplyScalar(l);},lerpSelf:function(v,alpha){this.x+=(v.x-this.x)*alpha;this.y+=(v.y-this.y)*alpha;return this;},equals:function(v){return((v.x===this.x)&&(v.y===this.y));},isZero:function(v){return this.lengthSq()<(v!==undefined?v:0.0001);},clone:function(){return new THREE.Vector2(this.x,this.y);}};THREE.Vector3=function(x,y,z){this.x=x||0;this.y=y||0;this.z=z||0;};THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(x,y,z){this.x=x;this.y=y;this.z=z;return this;},setX:function(x){this.x=x;return this;},setY:function(y){this.y=y;return this;},setZ:function(z){this.z=z;return this;},copy:function(v){this.x=v.x;this.y=v.y;this.z=v.z;return this;},add:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this;},addSelf:function(v){this.x+=v.x;this.y+=v.y;this.z+=v.z;return this;},addScalar:function(s){this.x+=s;this.y+=s;this.z+=s;return this;},sub:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this;},subSelf:function(v){this.x-=v.x;this.y-=v.y;this.z-=v.z;return this;},multiply:function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this;},multiplySelf:function(v){this.x*=v.x;this.y*=v.y;this.z*=v.z;return this;},multiplyScalar:function(s){this.x*=s;this.y*=s;this.z*=s;return this;},divideSelf:function(v){this.x/=v.x;this.y/=v.y;this.z/=v.z;return this;},divideScalar:function(s){if(s){this.x/=s;this.y/=s;this.z/=s;}else{this.x=0;this.y=0;this.z=0;}
return this;},negate:function(){return this.multiplyScalar(-1);},dot:function(v){return this.x*v.x+this.y*v.y+this.z*v.z;},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z;},length:function(){return Math.sqrt(this.lengthSq());},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z);},normalize:function(){return this.divideScalar(this.length());},setLength:function(l){return this.normalize().multiplyScalar(l);},lerpSelf:function(v,alpha){this.x+=(v.x-this.x)*alpha;this.y+=(v.y-this.y)*alpha;this.z+=(v.z-this.z)*alpha;return this;},cross:function(a,b){this.x=a.y*b.z-a.z*b.y;this.y=a.z*b.x-a.x*b.z;this.z=a.x*b.y-a.y*b.x;return this;},crossSelf:function(v){var x=this.x,y=this.y,z=this.z;this.x=y*v.z-z*v.y;this.y=z*v.x-x*v.z;this.z=x*v.y-y*v.x;return this;},angleTo:function(v){return Math.acos(this.dot(v)/this.length()/v.length());},distanceTo:function(v){return Math.sqrt(this.distanceToSquared(v));},distanceToSquared:function(v){return new THREE.Vector3().sub(this,v).lengthSq();},getPositionFromMatrix:function(m){this.x=m.elements[12];this.y=m.elements[13];this.z=m.elements[14];return this;},setEulerFromRotationMatrix:function(m,order){function clamp(x){return Math.min(Math.max(x,-1),1);}
var te=m.elements;var m11=te[0],m12=te[4],m13=te[8];var m21=te[1],m22=te[5],m23=te[9];var m31=te[2],m32=te[6],m33=te[10];if(order===undefined||order==='XYZ'){this.y=Math.asin(clamp(m13));if(Math.abs(m13)<0.99999){this.x=Math.atan2(-m23,m33);this.z=Math.atan2(-m12,m11);}else{this.x=Math.atan2(m32,m22);this.z=0;}}else if(order==='YXZ'){this.x=Math.asin(-clamp(m23));if(Math.abs(m23)<0.99999){this.y=Math.atan2(m13,m33);this.z=Math.atan2(m21,m22);}else{this.y=Math.atan2(-m31,m11);this.z=0;}}else if(order==='ZXY'){this.x=Math.asin(clamp(m32));if(Math.abs(m32)<0.99999){this.y=Math.atan2(-m31,m33);this.z=Math.atan2(-m12,m22);}else{this.y=0;this.z=Math.atan2(m21,m11);}}else if(order==='ZYX'){this.y=Math.asin(-clamp(m31));if(Math.abs(m31)<0.99999){this.x=Math.atan2(m32,m33);this.z=Math.atan2(m21,m11);}else{this.x=0;this.z=Math.atan2(-m12,m22);}}else if(order==='YZX'){this.z=Math.asin(clamp(m21));if(Math.abs(m21)<0.99999){this.x=Math.atan2(-m23,m22);this.y=Math.atan2(-m31,m11);}else{this.x=0;this.y=Math.atan2(m13,m33);}}else if(order==='XZY'){this.z=Math.asin(-clamp(m12));if(Math.abs(m12)<0.99999){this.x=Math.atan2(m32,m22);this.y=Math.atan2(m13,m11);}else{this.x=Math.atan2(-m23,m33);this.y=0;}}
return this;},setEulerFromQuaternion:function(q,order){function clamp(x){return Math.min(Math.max(x,-1),1);}
var sqx=q.x*q.x;var sqy=q.y*q.y;var sqz=q.z*q.z;var sqw=q.w*q.w;if(order===undefined||order==='XYZ'){this.x=Math.atan2(2*(q.x*q.w-q.y*q.z),(sqw-sqx-sqy+sqz));this.y=Math.asin(clamp(2*(q.x*q.z+q.y*q.w)));this.z=Math.atan2(2*(q.z*q.w-q.x*q.y),(sqw+sqx-sqy-sqz));}else if(order==='YXZ'){this.x=Math.asin(clamp(2*(q.x*q.w-q.y*q.z)));this.y=Math.atan2(2*(q.x*q.z+q.y*q.w),(sqw-sqx-sqy+sqz));this.z=Math.atan2(2*(q.x*q.y+q.z*q.w),(sqw-sqx+sqy-sqz));}else if(order==='ZXY'){this.x=Math.asin(clamp(2*(q.x*q.w+q.y*q.z)));this.y=Math.atan2(2*(q.y*q.w-q.z*q.x),(sqw-sqx-sqy+sqz));this.z=Math.atan2(2*(q.z*q.w-q.x*q.y),(sqw-sqx+sqy-sqz));}else if(order==='ZYX'){this.x=Math.atan2(2*(q.x*q.w+q.z*q.y),(sqw-sqx-sqy+sqz));this.y=Math.asin(clamp(2*(q.y*q.w-q.x*q.z)));this.z=Math.atan2(2*(q.x*q.y+q.z*q.w),(sqw+sqx-sqy-sqz));}else if(order==='YZX'){this.x=Math.atan2(2*(q.x*q.w-q.z*q.y),(sqw-sqx+sqy-sqz));this.y=Math.atan2(2*(q.y*q.w-q.x*q.z),(sqw+sqx-sqy-sqz));this.z=Math.asin(clamp(2*(q.x*q.y+q.z*q.w)));}else if(order==='XZY'){this.x=Math.atan2(2*(q.x*q.w+q.y*q.z),(sqw-sqx+sqy-sqz));this.y=Math.atan2(2*(q.x*q.z+q.y*q.w),(sqw+sqx-sqy-sqz));this.z=Math.asin(clamp(2*(q.z*q.w-q.x*q.y)));}
return this;},getScaleFromMatrix:function(m){var sx=this.set(m.elements[0],m.elements[1],m.elements[2]).length();var sy=this.set(m.elements[4],m.elements[5],m.elements[6]).length();var sz=this.set(m.elements[8],m.elements[9],m.elements[10]).length();this.x=sx;this.y=sy;this.z=sz;return this;},equals:function(v){return((v.x===this.x)&&(v.y===this.y)&&(v.z===this.z));},isZero:function(v){return this.lengthSq()<(v!==undefined?v:0.0001);},clone:function(){return new THREE.Vector3(this.x,this.y,this.z);}};THREE.Vector4=function(x,y,z,w){this.x=x||0;this.y=y||0;this.z=z||0;this.w=(w!==undefined)?w:1;};THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(x,y,z,w){this.x=x;this.y=y;this.z=z;this.w=w;return this;},copy:function(v){this.x=v.x;this.y=v.y;this.z=v.z;this.w=(v.w!==undefined)?v.w:1;return this;},add:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;this.w=a.w+b.w;return this;},addSelf:function(v){this.x+=v.x;this.y+=v.y;this.z+=v.z;this.w+=v.w;return this;},sub:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;this.w=a.w-b.w;return this;},subSelf:function(v){this.x-=v.x;this.y-=v.y;this.z-=v.z;this.w-=v.w;return this;},multiplyScalar:function(s){this.x*=s;this.y*=s;this.z*=s;this.w*=s;return this;},divideScalar:function(s){if(s){this.x/=s;this.y/=s;this.z/=s;this.w/=s;}else{this.x=0;this.y=0;this.z=0;this.w=1;}
return this;},negate:function(){return this.multiplyScalar(-1);},dot:function(v){return this.x*v.x+this.y*v.y+this.z*v.z+this.w*v.w;},lengthSq:function(){return this.dot(this);},length:function(){return Math.sqrt(this.lengthSq());},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w);},normalize:function(){return this.divideScalar(this.length());},setLength:function(l){return this.normalize().multiplyScalar(l);},lerpSelf:function(v,alpha){this.x+=(v.x-this.x)*alpha;this.y+=(v.y-this.y)*alpha;this.z+=(v.z-this.z)*alpha;this.w+=(v.w-this.w)*alpha;return this;},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w);},setAxisAngleFromQuaternion:function(q){this.w=2*Math.acos(q.w);var s=Math.sqrt(1-q.w*q.w);if(s<0.0001){this.x=1;this.y=0;this.z=0;}else{this.x=q.x/s;this.y=q.y/s;this.z=q.z/s;}
return this;},setAxisAngleFromRotationMatrix:function(m){var angle,x,y,z,epsilon=0.01,epsilon2=0.1,te=m.elements,m11=te[0],m12=te[4],m13=te[8],m21=te[1],m22=te[5],m23=te[9],m31=te[2],m32=te[6],m33=te[10];if((Math.abs(m12-m21)<epsilon)&&(Math.abs(m13-m31)<epsilon)&&(Math.abs(m23-m32)<epsilon)){if((Math.abs(m12+m21)<epsilon2)&&(Math.abs(m13+m31)<epsilon2)&&(Math.abs(m23+m32)<epsilon2)&&(Math.abs(m11+m22+m33-3)<epsilon2)){this.set(1,0,0,0);return this;}
angle=Math.PI;var xx=(m11+1)/2;var yy=(m22+1)/2;var zz=(m33+1)/2;var xy=(m12+m21)/4;var xz=(m13+m31)/4;var yz=(m23+m32)/4;if((xx>yy)&&(xx>zz)){if(xx<epsilon){x=0;y=0.707106781;z=0.707106781;}else{x=Math.sqrt(xx);y=xy/x;z=xz/x;}}else if(yy>zz){if(yy<epsilon){x=0.707106781;y=0;z=0.707106781;}else{y=Math.sqrt(yy);x=xy/y;z=yz/y;}}else{if(zz<epsilon){x=0.707106781;y=0.707106781;z=0;}else{z=Math.sqrt(zz);x=xz/z;y=yz/z;}}
this.set(x,y,z,angle);return this;}
var s=Math.sqrt((m32-m23)*(m32-m23)
+(m13-m31)*(m13-m31)
+(m21-m12)*(m21-m12));if(Math.abs(s)<0.001)s=1;this.x=(m32-m23)/s;this.y=(m13-m31)/s;this.z=(m21-m12)/s;this.w=Math.acos((m11+m22+m33-1)/2);return this;}};THREE.Matrix3=function(){this.elements=new Float32Array(9);};THREE.Matrix3.prototype={constructor:THREE.Matrix3,getInverse:function(matrix){var me=matrix.elements;var a11=me[10]*me[5]-me[6]*me[9];var a21=-me[10]*me[1]+me[2]*me[9];var a31=me[6]*me[1]-me[2]*me[5];var a12=-me[10]*me[4]+me[6]*me[8];var a22=me[10]*me[0]-me[2]*me[8];var a32=-me[6]*me[0]+me[2]*me[4];var a13=me[9]*me[4]-me[5]*me[8];var a23=-me[9]*me[0]+me[1]*me[8];var a33=me[5]*me[0]-me[1]*me[4];var det=me[0]*a11+me[1]*a12+me[2]*a13;if(det===0){console.warn("Matrix3.getInverse(): determinant == 0");}
var idet=1.0/det;var m=this.elements;m[0]=idet*a11;m[1]=idet*a21;m[2]=idet*a31;m[3]=idet*a12;m[4]=idet*a22;m[5]=idet*a32;m[6]=idet*a13;m[7]=idet*a23;m[8]=idet*a33;return this;},transpose:function(){var tmp,m=this.elements;tmp=m[1];m[1]=m[3];m[3]=tmp;tmp=m[2];m[2]=m[6];m[6]=tmp;tmp=m[5];m[5]=m[7];m[7]=tmp;return this;},transposeIntoArray:function(r){var m=this.m;r[0]=m[0];r[1]=m[3];r[2]=m[6];r[3]=m[1];r[4]=m[4];r[5]=m[7];r[6]=m[2];r[7]=m[5];r[8]=m[8];return this;}};THREE.Matrix4=function(n11,n12,n13,n14,n21,n22,n23,n24,n31,n32,n33,n34,n41,n42,n43,n44){this.elements=new Float32Array(16);this.set((n11!==undefined)?n11:1,n12||0,n13||0,n14||0,n21||0,(n22!==undefined)?n22:1,n23||0,n24||0,n31||0,n32||0,(n33!==undefined)?n33:1,n34||0,n41||0,n42||0,n43||0,(n44!==undefined)?n44:1);};THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(n11,n12,n13,n14,n21,n22,n23,n24,n31,n32,n33,n34,n41,n42,n43,n44){var te=this.elements;te[0]=n11;te[4]=n12;te[8]=n13;te[12]=n14;te[1]=n21;te[5]=n22;te[9]=n23;te[13]=n24;te[2]=n31;te[6]=n32;te[10]=n33;te[14]=n34;te[3]=n41;te[7]=n42;te[11]=n43;te[15]=n44;return this;},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this;},copy:function(m){var me=m.elements;this.set(me[0],me[4],me[8],me[12],me[1],me[5],me[9],me[13],me[2],me[6],me[10],me[14],me[3],me[7],me[11],me[15]);return this;},lookAt:function(eye,target,up){var te=this.elements;var x=THREE.Matrix4.__v1;var y=THREE.Matrix4.__v2;var z=THREE.Matrix4.__v3;z.sub(eye,target).normalize();if(z.length()===0){z.z=1;}
x.cross(up,z).normalize();if(x.length()===0){z.x+=0.0001;x.cross(up,z).normalize();}
y.cross(z,x);te[0]=x.x;te[4]=y.x;te[8]=z.x;te[1]=x.y;te[5]=y.y;te[9]=z.y;te[2]=x.z;te[6]=y.z;te[10]=z.z;return this;},multiply:function(a,b){var ae=a.elements;var be=b.elements;var te=this.elements;var a11=ae[0],a12=ae[4],a13=ae[8],a14=ae[12];var a21=ae[1],a22=ae[5],a23=ae[9],a24=ae[13];var a31=ae[2],a32=ae[6],a33=ae[10],a34=ae[14];var a41=ae[3],a42=ae[7],a43=ae[11],a44=ae[15];var b11=be[0],b12=be[4],b13=be[8],b14=be[12];var b21=be[1],b22=be[5],b23=be[9],b24=be[13];var b31=be[2],b32=be[6],b33=be[10],b34=be[14];var b41=be[3],b42=be[7],b43=be[11],b44=be[15];te[0]=a11*b11+a12*b21+a13*b31+a14*b41;te[4]=a11*b12+a12*b22+a13*b32+a14*b42;te[8]=a11*b13+a12*b23+a13*b33+a14*b43;te[12]=a11*b14+a12*b24+a13*b34+a14*b44;te[1]=a21*b11+a22*b21+a23*b31+a24*b41;te[5]=a21*b12+a22*b22+a23*b32+a24*b42;te[9]=a21*b13+a22*b23+a23*b33+a24*b43;te[13]=a21*b14+a22*b24+a23*b34+a24*b44;te[2]=a31*b11+a32*b21+a33*b31+a34*b41;te[6]=a31*b12+a32*b22+a33*b32+a34*b42;te[10]=a31*b13+a32*b23+a33*b33+a34*b43;te[14]=a31*b14+a32*b24+a33*b34+a34*b44;te[3]=a41*b11+a42*b21+a43*b31+a44*b41;te[7]=a41*b12+a42*b22+a43*b32+a44*b42;te[11]=a41*b13+a42*b23+a43*b33+a44*b43;te[15]=a41*b14+a42*b24+a43*b34+a44*b44;return this;},multiplySelf:function(m){return this.multiply(this,m);},multiplyToArray:function(a,b,r){var te=this.elements;this.multiply(a,b);r[0]=te[0];r[1]=te[1];r[2]=te[2];r[3]=te[3];r[4]=te[4];r[5]=te[5];r[6]=te[6];r[7]=te[7];r[8]=te[8];r[9]=te[9];r[10]=te[10];r[11]=te[11];r[12]=te[12];r[13]=te[13];r[14]=te[14];r[15]=te[15];return this;},multiplyScalar:function(s){var te=this.elements;te[0]*=s;te[4]*=s;te[8]*=s;te[12]*=s;te[1]*=s;te[5]*=s;te[9]*=s;te[13]*=s;te[2]*=s;te[6]*=s;te[10]*=s;te[14]*=s;te[3]*=s;te[7]*=s;te[11]*=s;te[15]*=s;return this;},multiplyVector3:function(v){var te=this.elements;var vx=v.x,vy=v.y,vz=v.z;var d=1/(te[3]*vx+te[7]*vy+te[11]*vz+te[15]);v.x=(te[0]*vx+te[4]*vy+te[8]*vz+te[12])*d;v.y=(te[1]*vx+te[5]*vy+te[9]*vz+te[13])*d;v.z=(te[2]*vx+te[6]*vy+te[10]*vz+te[14])*d;return v;},multiplyVector4:function(v){var te=this.elements;var vx=v.x,vy=v.y,vz=v.z,vw=v.w;v.x=te[0]*vx+te[4]*vy+te[8]*vz+te[12]*vw;v.y=te[1]*vx+te[5]*vy+te[9]*vz+te[13]*vw;v.z=te[2]*vx+te[6]*vy+te[10]*vz+te[14]*vw;v.w=te[3]*vx+te[7]*vy+te[11]*vz+te[15]*vw;return v;},multiplyVector3Array:function(a){var tmp=THREE.Matrix4.__v1;for(var i=0,il=a.length;i<il;i+=3){tmp.x=a[i];tmp.y=a[i+1];tmp.z=a[i+2];this.multiplyVector3(tmp);a[i]=tmp.x;a[i+1]=tmp.y;a[i+2]=tmp.z;}
return a;},rotateAxis:function(v){var te=this.elements;var vx=v.x,vy=v.y,vz=v.z;v.x=vx*te[0]+vy*te[4]+vz*te[8];v.y=vx*te[1]+vy*te[5]+vz*te[9];v.z=vx*te[2]+vy*te[6]+vz*te[10];v.normalize();return v;},crossVector:function(a){var te=this.elements;var v=new THREE.Vector4();v.x=te[0]*a.x+te[4]*a.y+te[8]*a.z+te[12]*a.w;v.y=te[1]*a.x+te[5]*a.y+te[9]*a.z+te[13]*a.w;v.z=te[2]*a.x+te[6]*a.y+te[10]*a.z+te[14]*a.w;v.w=(a.w)?te[3]*a.x+te[7]*a.y+te[11]*a.z+te[15]*a.w:1;return v;},determinant:function(){var te=this.elements;var n11=te[0],n12=te[4],n13=te[8],n14=te[12];var n21=te[1],n22=te[5],n23=te[9],n24=te[13];var n31=te[2],n32=te[6],n33=te[10],n34=te[14];var n41=te[3],n42=te[7],n43=te[11],n44=te[15];return(n14*n23*n32*n41-
n13*n24*n32*n41-
n14*n22*n33*n41+
n12*n24*n33*n41+
n13*n22*n34*n41-
n12*n23*n34*n41-
n14*n23*n31*n42+
n13*n24*n31*n42+
n14*n21*n33*n42-
n11*n24*n33*n42-
n13*n21*n34*n42+
n11*n23*n34*n42+
n14*n22*n31*n43-
n12*n24*n31*n43-
n14*n21*n32*n43+
n11*n24*n32*n43+
n12*n21*n34*n43-
n11*n22*n34*n43-
n13*n22*n31*n44+
n12*n23*n31*n44+
n13*n21*n32*n44-
n11*n23*n32*n44-
n12*n21*n33*n44+
n11*n22*n33*n44);},transpose:function(){var te=this.elements;var tmp;tmp=te[1];te[1]=te[4];te[4]=tmp;tmp=te[2];te[2]=te[8];te[8]=tmp;tmp=te[6];te[6]=te[9];te[9]=tmp;tmp=te[3];te[3]=te[12];te[12]=tmp;tmp=te[7];te[7]=te[13];te[13]=tmp;tmp=te[11];te[11]=te[14];te[14]=tmp;return this;},flattenToArray:function(flat){var te=this.elements;flat[0]=te[0];flat[1]=te[1];flat[2]=te[2];flat[3]=te[3];flat[4]=te[4];flat[5]=te[5];flat[6]=te[6];flat[7]=te[7];flat[8]=te[8];flat[9]=te[9];flat[10]=te[10];flat[11]=te[11];flat[12]=te[12];flat[13]=te[13];flat[14]=te[14];flat[15]=te[15];return flat;},flattenToArrayOffset:function(flat,offset){var te=this.elements;flat[offset]=te[0];flat[offset+1]=te[1];flat[offset+2]=te[2];flat[offset+3]=te[3];flat[offset+4]=te[4];flat[offset+5]=te[5];flat[offset+6]=te[6];flat[offset+7]=te[7];flat[offset+8]=te[8];flat[offset+9]=te[9];flat[offset+10]=te[10];flat[offset+11]=te[11];flat[offset+12]=te[12];flat[offset+13]=te[13];flat[offset+14]=te[14];flat[offset+15]=te[15];return flat;},getPosition:function(){var te=this.elements;return THREE.Matrix4.__v1.set(te[12],te[13],te[14]);},setPosition:function(v){var te=this.elements;te[12]=v.x;te[13]=v.y;te[14]=v.z;return this;},getColumnX:function(){var te=this.elements;return THREE.Matrix4.__v1.set(te[0],te[1],te[2]);},getColumnY:function(){var te=this.elements;return THREE.Matrix4.__v1.set(te[4],te[5],te[6]);},getColumnZ:function(){var te=this.elements;return THREE.Matrix4.__v1.set(te[8],te[9],te[10]);},getInverse:function(m){var te=this.elements;var me=m.elements;var n11=me[0],n12=me[4],n13=me[8],n14=me[12];var n21=me[1],n22=me[5],n23=me[9],n24=me[13];var n31=me[2],n32=me[6],n33=me[10],n34=me[14];var n41=me[3],n42=me[7],n43=me[11],n44=me[15];te[0]=n23*n34*n42-n24*n33*n42+n24*n32*n43-n22*n34*n43-n23*n32*n44+n22*n33*n44;te[4]=n14*n33*n42-n13*n34*n42-n14*n32*n43+n12*n34*n43+n13*n32*n44-n12*n33*n44;te[8]=n13*n24*n42-n14*n23*n42+n14*n22*n43-n12*n24*n43-n13*n22*n44+n12*n23*n44;te[12]=n14*n23*n32-n13*n24*n32-n14*n22*n33+n12*n24*n33+n13*n22*n34-n12*n23*n34;te[1]=n24*n33*n41-n23*n34*n41-n24*n31*n43+n21*n34*n43+n23*n31*n44-n21*n33*n44;te[5]=n13*n34*n41-n14*n33*n41+n14*n31*n43-n11*n34*n43-n13*n31*n44+n11*n33*n44;te[9]=n14*n23*n41-n13*n24*n41-n14*n21*n43+n11*n24*n43+n13*n21*n44-n11*n23*n44;te[13]=n13*n24*n31-n14*n23*n31+n14*n21*n33-n11*n24*n33-n13*n21*n34+n11*n23*n34;te[2]=n22*n34*n41-n24*n32*n41+n24*n31*n42-n21*n34*n42-n22*n31*n44+n21*n32*n44;te[6]=n14*n32*n41-n12*n34*n41-n14*n31*n42+n11*n34*n42+n12*n31*n44-n11*n32*n44;te[10]=n12*n24*n41-n14*n22*n41+n14*n21*n42-n11*n24*n42-n12*n21*n44+n11*n22*n44;te[14]=n14*n22*n31-n12*n24*n31-n14*n21*n32+n11*n24*n32+n12*n21*n34-n11*n22*n34;te[3]=n23*n32*n41-n22*n33*n41-n23*n31*n42+n21*n33*n42+n22*n31*n43-n21*n32*n43;te[7]=n12*n33*n41-n13*n32*n41+n13*n31*n42-n11*n33*n42-n12*n31*n43+n11*n32*n43;te[11]=n13*n22*n41-n12*n23*n41-n13*n21*n42+n11*n23*n42+n12*n21*n43-n11*n22*n43;te[15]=n12*n23*n31-n13*n22*n31+n13*n21*n32-n11*n23*n32-n12*n21*n33+n11*n22*n33;this.multiplyScalar(1/m.determinant());return this;},setRotationFromEuler:function(v,order){var te=this.elements;var x=v.x,y=v.y,z=v.z;var a=Math.cos(x),b=Math.sin(x);var c=Math.cos(y),d=Math.sin(y);var e=Math.cos(z),f=Math.sin(z);if(order===undefined||order==='XYZ'){var ae=a*e,af=a*f,be=b*e,bf=b*f;te[0]=c*e;te[4]=-c*f;te[8]=d;te[1]=af+be*d;te[5]=ae-bf*d;te[9]=-b*c;te[2]=bf-ae*d;te[6]=be+af*d;te[10]=a*c;}else if(order==='YXZ'){var ce=c*e,cf=c*f,de=d*e,df=d*f;te[0]=ce+df*b;te[4]=de*b-cf;te[8]=a*d;te[1]=a*f;te[5]=a*e;te[9]=-b;te[2]=cf*b-de;te[6]=df+ce*b;te[10]=a*c;}else if(order==='ZXY'){var ce=c*e,cf=c*f,de=d*e,df=d*f;te[0]=ce-df*b;te[4]=-a*f;te[8]=de+cf*b;te[1]=cf+de*b;te[5]=a*e;te[9]=df-ce*b;te[2]=-a*d;te[6]=b;te[10]=a*c;}else if(order==='ZYX'){var ae=a*e,af=a*f,be=b*e,bf=b*f;te[0]=c*e;te[4]=be*d-af;te[8]=ae*d+bf;te[1]=c*f;te[5]=bf*d+ae;te[9]=af*d-be;te[2]=-d;te[6]=b*c;te[10]=a*c;}else if(order==='YZX'){var ac=a*c,ad=a*d,bc=b*c,bd=b*d;te[0]=c*e;te[4]=bd-ac*f;te[8]=bc*f+ad;te[1]=f;te[5]=a*e;te[9]=-b*e;te[2]=-d*e;te[6]=ad*f+bc;te[10]=ac-bd*f;}else if(order==='XZY'){var ac=a*c,ad=a*d,bc=b*c,bd=b*d;te[0]=c*e;te[4]=-f;te[8]=d*e;te[1]=ac*f+bd;te[5]=a*e;te[9]=ad*f-bc;te[2]=bc*f-ad;te[6]=b*e;te[10]=bd*f+ac;}
return this;},setRotationFromQuaternion:function(q){var te=this.elements;var x=q.x,y=q.y,z=q.z,w=q.w;var x2=x+x,y2=y+y,z2=z+z;var xx=x*x2,xy=x*y2,xz=x*z2;var yy=y*y2,yz=y*z2,zz=z*z2;var wx=w*x2,wy=w*y2,wz=w*z2;te[0]=1-(yy+zz);te[4]=xy-wz;te[8]=xz+wy;te[1]=xy+wz;te[5]=1-(xx+zz);te[9]=yz-wx;te[2]=xz-wy;te[6]=yz+wx;te[10]=1-(xx+yy);return this;},compose:function(translation,rotation,scale){var te=this.elements;var mRotation=THREE.Matrix4.__m1;var mScale=THREE.Matrix4.__m2;mRotation.identity();mRotation.setRotationFromQuaternion(rotation);mScale.makeScale(scale.x,scale.y,scale.z);this.multiply(mRotation,mScale);te[12]=translation.x;te[13]=translation.y;te[14]=translation.z;return this;},decompose:function(translation,rotation,scale){var te=this.elements;var x=THREE.Matrix4.__v1;var y=THREE.Matrix4.__v2;var z=THREE.Matrix4.__v3;x.set(te[0],te[1],te[2]);y.set(te[4],te[5],te[6]);z.set(te[8],te[9],te[10]);translation=(translation instanceof THREE.Vector3)?translation:new THREE.Vector3();rotation=(rotation instanceof THREE.Quaternion)?rotation:new THREE.Quaternion();scale=(scale instanceof THREE.Vector3)?scale:new THREE.Vector3();scale.x=x.length();scale.y=y.length();scale.z=z.length();translation.x=te[12];translation.y=te[13];translation.z=te[14];var matrix=THREE.Matrix4.__m1;matrix.copy(this);matrix.elements[0]/=scale.x;matrix.elements[1]/=scale.x;matrix.elements[2]/=scale.x;matrix.elements[4]/=scale.y;matrix.elements[5]/=scale.y;matrix.elements[6]/=scale.y;matrix.elements[8]/=scale.z;matrix.elements[9]/=scale.z;matrix.elements[10]/=scale.z;rotation.setFromRotationMatrix(matrix);return[translation,rotation,scale];},extractPosition:function(m){var te=this.elements;var me=m.elements;te[12]=me[12];te[13]=me[13];te[14]=me[14];return this;},extractRotation:function(m){var te=this.elements;var me=m.elements;var vector=THREE.Matrix4.__v1;var scaleX=1/vector.set(me[0],me[1],me[2]).length();var scaleY=1/vector.set(me[4],me[5],me[6]).length();var scaleZ=1/vector.set(me[8],me[9],me[10]).length();te[0]=me[0]*scaleX;te[1]=me[1]*scaleX;te[2]=me[2]*scaleX;te[4]=me[4]*scaleY;te[5]=me[5]*scaleY;te[6]=me[6]*scaleY;te[8]=me[8]*scaleZ;te[9]=me[9]*scaleZ;te[10]=me[10]*scaleZ;return this;},translate:function(v){var te=this.elements;var x=v.x,y=v.y,z=v.z;te[12]=te[0]*x+te[4]*y+te[8]*z+te[12];te[13]=te[1]*x+te[5]*y+te[9]*z+te[13];te[14]=te[2]*x+te[6]*y+te[10]*z+te[14];te[15]=te[3]*x+te[7]*y+te[11]*z+te[15];return this;},rotateX:function(angle){var te=this.elements;var m12=te[4];var m22=te[5];var m32=te[6];var m42=te[7];var m13=te[8];var m23=te[9];var m33=te[10];var m43=te[11];var c=Math.cos(angle);var s=Math.sin(angle);te[4]=c*m12+s*m13;te[5]=c*m22+s*m23;te[6]=c*m32+s*m33;te[7]=c*m42+s*m43;te[8]=c*m13-s*m12;te[9]=c*m23-s*m22;te[10]=c*m33-s*m32;te[11]=c*m43-s*m42;return this;},rotateY:function(angle){var te=this.elements;var m11=te[0];var m21=te[1];var m31=te[2];var m41=te[3];var m13=te[8];var m23=te[9];var m33=te[10];var m43=te[11];var c=Math.cos(angle);var s=Math.sin(angle);te[0]=c*m11-s*m13;te[1]=c*m21-s*m23;te[2]=c*m31-s*m33;te[3]=c*m41-s*m43;te[8]=c*m13+s*m11;te[9]=c*m23+s*m21;te[10]=c*m33+s*m31;te[11]=c*m43+s*m41;return this;},rotateZ:function(angle){var te=this.elements;var m11=te[0];var m21=te[1];var m31=te[2];var m41=te[3];var m12=te[4];var m22=te[5];var m32=te[6];var m42=te[7];var c=Math.cos(angle);var s=Math.sin(angle);te[0]=c*m11+s*m12;te[1]=c*m21+s*m22;te[2]=c*m31+s*m32;te[3]=c*m41+s*m42;te[4]=c*m12-s*m11;te[5]=c*m22-s*m21;te[6]=c*m32-s*m31;te[7]=c*m42-s*m41;return this;},rotateByAxis:function(axis,angle){var te=this.elements;if(axis.x===1&&axis.y===0&&axis.z===0){return this.rotateX(angle);}else if(axis.x===0&&axis.y===1&&axis.z===0){return this.rotateY(angle);}else if(axis.x===0&&axis.y===0&&axis.z===1){return this.rotateZ(angle);}
var x=axis.x,y=axis.y,z=axis.z;var n=Math.sqrt(x*x+y*y+z*z);x/=n;y/=n;z/=n;var xx=x*x,yy=y*y,zz=z*z;var c=Math.cos(angle);var s=Math.sin(angle);var oneMinusCosine=1-c;var xy=x*y*oneMinusCosine;var xz=x*z*oneMinusCosine;var yz=y*z*oneMinusCosine;var xs=x*s;var ys=y*s;var zs=z*s;var r11=xx+(1-xx)*c;var r21=xy+zs;var r31=xz-ys;var r12=xy-zs;var r22=yy+(1-yy)*c;var r32=yz+xs;var r13=xz+ys;var r23=yz-xs;var r33=zz+(1-zz)*c;var m11=te[0],m21=te[1],m31=te[2],m41=te[3];var m12=te[4],m22=te[5],m32=te[6],m42=te[7];var m13=te[8],m23=te[9],m33=te[10],m43=te[11];var m14=te[12],m24=te[13],m34=te[14],m44=te[15];te[0]=r11*m11+r21*m12+r31*m13;te[1]=r11*m21+r21*m22+r31*m23;te[2]=r11*m31+r21*m32+r31*m33;te[3]=r11*m41+r21*m42+r31*m43;te[4]=r12*m11+r22*m12+r32*m13;te[5]=r12*m21+r22*m22+r32*m23;te[6]=r12*m31+r22*m32+r32*m33;te[7]=r12*m41+r22*m42+r32*m43;te[8]=r13*m11+r23*m12+r33*m13;te[9]=r13*m21+r23*m22+r33*m23;te[10]=r13*m31+r23*m32+r33*m33;te[11]=r13*m41+r23*m42+r33*m43;return this;},scale:function(v){var te=this.elements;var x=v.x,y=v.y,z=v.z;te[0]*=x;te[4]*=y;te[8]*=z;te[1]*=x;te[5]*=y;te[9]*=z;te[2]*=x;te[6]*=y;te[10]*=z;te[3]*=x;te[7]*=y;te[11]*=z;return this;},getMaxScaleOnAxis:function(){var te=this.elements;var scaleXSq=te[0]*te[0]+te[1]*te[1]+te[2]*te[2];var scaleYSq=te[4]*te[4]+te[5]*te[5]+te[6]*te[6];var scaleZSq=te[8]*te[8]+te[9]*te[9]+te[10]*te[10];return Math.sqrt(Math.max(scaleXSq,Math.max(scaleYSq,scaleZSq)));},makeTranslation:function(x,y,z){this.set(1,0,0,x,0,1,0,y,0,0,1,z,0,0,0,1);return this;},makeRotationX:function(theta){var c=Math.cos(theta),s=Math.sin(theta);this.set(1,0,0,0,0,c,-s,0,0,s,c,0,0,0,0,1);return this;},makeRotationY:function(theta){var c=Math.cos(theta),s=Math.sin(theta);this.set(c,0,s,0,0,1,0,0,-s,0,c,0,0,0,0,1);return this;},makeRotationZ:function(theta){var c=Math.cos(theta),s=Math.sin(theta);this.set(c,-s,0,0,s,c,0,0,0,0,1,0,0,0,0,1);return this;},makeRotationAxis:function(axis,angle){var c=Math.cos(angle);var s=Math.sin(angle);var t=1-c;var x=axis.x,y=axis.y,z=axis.z;var tx=t*x,ty=t*y;this.set(tx*x+c,tx*y-s*z,tx*z+s*y,0,tx*y+s*z,ty*y+c,ty*z-s*x,0,tx*z-s*y,ty*z+s*x,t*z*z+c,0,0,0,0,1);return this;},makeScale:function(x,y,z){this.set(x,0,0,0,0,y,0,0,0,0,z,0,0,0,0,1);return this;},makeFrustum:function(left,right,bottom,top,near,far){var te=this.elements;var x=2*near/(right-left);var y=2*near/(top-bottom);var a=(right+left)/(right-left);var b=(top+bottom)/(top-bottom);var c=-(far+near)/(far-near);var d=-2*far*near/(far-near);te[0]=x;te[4]=0;te[8]=a;te[12]=0;te[1]=0;te[5]=y;te[9]=b;te[13]=0;te[2]=0;te[6]=0;te[10]=c;te[14]=d;te[3]=0;te[7]=0;te[11]=-1;te[15]=0;return this;},makePerspective:function(fov,aspect,near,far){var ymax=near*Math.tan(fov*Math.PI/360);var ymin=-ymax;var xmin=ymin*aspect;var xmax=ymax*aspect;return this.makeFrustum(xmin,xmax,ymin,ymax,near,far);},makeOrthographic:function(left,right,top,bottom,near,far){var te=this.elements;var w=right-left;var h=top-bottom;var p=far-near;var x=(right+left)/w;var y=(top+bottom)/h;var z=(far+near)/p;te[0]=2/w;te[4]=0;te[8]=0;te[12]=-x;te[1]=0;te[5]=2/h;te[9]=0;te[13]=-y;te[2]=0;te[6]=0;te[10]=-2/p;te[14]=-z;te[3]=0;te[7]=0;te[11]=0;te[15]=1;return this;},clone:function(){var te=this.elements;return new THREE.Matrix4(te[0],te[4],te[8],te[12],te[1],te[5],te[9],te[13],te[2],te[6],te[10],te[14],te[3],te[7],te[11],te[15]);}};THREE.Matrix4.__v1=new THREE.Vector3();THREE.Matrix4.__v2=new THREE.Vector3();THREE.Matrix4.__v3=new THREE.Vector3();THREE.Matrix4.__m1=new THREE.Matrix4();THREE.Matrix4.__m2=new THREE.Matrix4();THREE.EventTarget=function(){var listeners={};this.addEventListener=function(type,listener){if(listeners[type]===undefined){listeners[type]=[];}
if(listeners[type].indexOf(listener)===-1){listeners[type].push(listener);}};this.dispatchEvent=function(event){for(var listener in listeners[event.type]){listeners[event.type][listener](event);}};this.removeEventListener=function(type,listener){var index=listeners[type].indexOf(listener);if(index!==-1){listeners[type].splice(index,1);}};};THREE.Frustum=function(){this.planes=[new THREE.Vector4(),new THREE.Vector4(),new THREE.Vector4(),new THREE.Vector4(),new THREE.Vector4(),new THREE.Vector4()];};THREE.Frustum.prototype.setFromMatrix=function(m){var plane;var planes=this.planes;var me=m.elements;var me0=me[0],me1=me[1],me2=me[2],me3=me[3];var me4=me[4],me5=me[5],me6=me[6],me7=me[7];var me8=me[8],me9=me[9],me10=me[10],me11=me[11];var me12=me[12],me13=me[13],me14=me[14],me15=me[15];planes[0].set(me3-me0,me7-me4,me11-me8,me15-me12);planes[1].set(me3+me0,me7+me4,me11+me8,me15+me12);planes[2].set(me3+me1,me7+me5,me11+me9,me15+me13);planes[3].set(me3-me1,me7-me5,me11-me9,me15-me13);planes[4].set(me3-me2,me7-me6,me11-me10,me15-me14);planes[5].set(me3+me2,me7+me6,me11+me10,me15+me14);for(var i=0;i<6;i++){plane=planes[i];plane.divideScalar(Math.sqrt(plane.x*plane.x+plane.y*plane.y+plane.z*plane.z));}};THREE.Frustum.prototype.contains=function(object){var distance=0.0;var planes=this.planes;var matrix=object.matrixWorld;var me=matrix.elements;var radius=-object.geometry.boundingSphere.radius*matrix.getMaxScaleOnAxis();for(var i=0;i<6;i++){distance=planes[i].x*me[12]+planes[i].y*me[13]+planes[i].z*me[14]+planes[i].w;if(distance<=radius)return false;}
return true;};THREE.Frustum.__v1=new THREE.Vector3();(function(THREE){THREE.Ray=function(origin,direction,near,far){this.origin=origin||new THREE.Vector3();this.direction=direction||new THREE.Vector3();this.near=near||0;this.far=far||Infinity;};var originCopy=new THREE.Vector3();var localOriginCopy=new THREE.Vector3();var localDirectionCopy=new THREE.Vector3();var vector=new THREE.Vector3();var normal=new THREE.Vector3();var intersectPoint=new THREE.Vector3();var inverseMatrix=new THREE.Matrix4();var descSort=function(a,b){return a.distance-b.distance;};var v0=new THREE.Vector3(),v1=new THREE.Vector3(),v2=new THREE.Vector3();var distanceFromIntersection=function(origin,direction,position){v0.sub(position,origin);var dot=v0.dot(direction);var intersect=v1.add(origin,v2.copy(direction).multiplyScalar(dot));var distance=position.distanceTo(intersect);return distance;};var pointInFace3=function(p,a,b,c){v0.sub(c,a);v1.sub(b,a);v2.sub(p,a);var dot00=v0.dot(v0);var dot01=v0.dot(v1);var dot02=v0.dot(v2);var dot11=v1.dot(v1);var dot12=v1.dot(v2);var invDenom=1/(dot00*dot11-dot01*dot01);var u=(dot11*dot02-dot01*dot12)*invDenom;var v=(dot00*dot12-dot01*dot02)*invDenom;return(u>=0)&&(v>=0)&&(u+v<1);};var intersectObject=function(object,ray,intersects){var distance,intersect;if(object instanceof THREE.Particle){distance=distanceFromIntersection(ray.origin,ray.direction,object.matrixWorld.getPosition());if(distance>object.scale.x){return intersects;}
intersect={distance:distance,point:object.position,face:null,object:object};intersects.push(intersect);}else if(object instanceof THREE.Mesh){var scaledRadius=object.geometry.boundingSphere.radius*object.matrixWorld.getMaxScaleOnAxis();distance=distanceFromIntersection(ray.origin,ray.direction,object.matrixWorld.getPosition());if(distance>scaledRadius){return intersects;}
var f,fl,face,dot,scalar,geometry=object.geometry,vertices=geometry.vertices,objMatrix,geometryMaterials,isFaceMaterial,material,side,point;geometryMaterials=object.geometry.materials;isFaceMaterial=object.material instanceof THREE.MeshFaceMaterial;side=object.material.side;var a,b,c,d;var precision=ray.precision;object.matrixRotationWorld.extractRotation(object.matrixWorld);originCopy.copy(ray.origin);objMatrix=object.matrixWorld;inverseMatrix.getInverse(objMatrix);localOriginCopy.copy(originCopy);inverseMatrix.multiplyVector3(localOriginCopy);localDirectionCopy.copy(ray.direction);inverseMatrix.rotateAxis(localDirectionCopy).normalize();for(f=0,fl=geometry.faces.length;f<fl;f++){face=geometry.faces[f];material=isFaceMaterial===true?geometryMaterials[face.materialIndex]:object.material;if(material===undefined)continue;side=material.side;vector.sub(face.centroid,localOriginCopy);normal=face.normal;dot=localDirectionCopy.dot(normal);if(Math.abs(dot)<precision)continue;scalar=normal.dot(vector)/dot;if(scalar<0)continue;if(side===THREE.DoubleSide||(side===THREE.FrontSide?dot<0:dot>0)){intersectPoint.add(localOriginCopy,localDirectionCopy.multiplyScalar(scalar));if(face instanceof THREE.Face3){a=vertices[face.a];b=vertices[face.b];c=vertices[face.c];if(pointInFace3(intersectPoint,a,b,c)){point=object.matrixWorld.multiplyVector3(intersectPoint.clone());distance=originCopy.distanceTo(point);if(distance<ray.near||distance>ray.far)continue;intersect={distance:distance,point:point,face:face,faceIndex:f,object:object};intersects.push(intersect);}}else if(face instanceof THREE.Face4){a=vertices[face.a];b=vertices[face.b];c=vertices[face.c];d=vertices[face.d];if(pointInFace3(intersectPoint,a,b,d)||pointInFace3(intersectPoint,b,c,d)){point=object.matrixWorld.multiplyVector3(intersectPoint.clone());distance=originCopy.distanceTo(point);if(distance<ray.near||distance>ray.far)continue;intersect={distance:distance,point:point,face:face,faceIndex:f,object:object};intersects.push(intersect);}}}}}};var intersectDescendants=function(object,ray,intersects){var descendants=object.getDescendants();for(var i=0,l=descendants.length;i<l;i++){intersectObject(descendants[i],ray,intersects);}};THREE.Ray.prototype.precision=0.0001;THREE.Ray.prototype.set=function(origin,direction){this.origin=origin;this.direction=direction;};THREE.Ray.prototype.intersectObject=function(object,recursive){var intersects=[];if(recursive===true){intersectDescendants(object,this,intersects);}
intersectObject(object,this,intersects);intersects.sort(descSort);return intersects;};THREE.Ray.prototype.intersectObjects=function(objects,recursive){var intersects=[];for(var i=0,l=objects.length;i<l;i++){intersectObject(objects[i],this,intersects);if(recursive===true){intersectDescendants(objects[i],this,intersects);}}
intersects.sort(descSort);return intersects;};}(THREE));THREE.Rectangle=function(){var _left=0;var _top=0;var _right=0;var _bottom=0;var _width=0;var _height=0;var _isEmpty=true;function resize(){_width=_right-_left;_height=_bottom-_top;}
this.getX=function(){return _left;};this.getY=function(){return _top;};this.getWidth=function(){return _width;};this.getHeight=function(){return _height;};this.getLeft=function(){return _left;};this.getTop=function(){return _top;};this.getRight=function(){return _right;};this.getBottom=function(){return _bottom;};this.set=function(left,top,right,bottom){_isEmpty=false;_left=left;_top=top;_right=right;_bottom=bottom;resize();};this.addPoint=function(x,y){if(_isEmpty===true){_isEmpty=false;_left=x;_top=y;_right=x;_bottom=y;resize();}else{_left=_left<x?_left:x;_top=_top<y?_top:y;_right=_right>x?_right:x;_bottom=_bottom>y?_bottom:y;resize();}};this.add3Points=function(x1,y1,x2,y2,x3,y3){if(_isEmpty===true){_isEmpty=false;_left=x1<x2?(x1<x3?x1:x3):(x2<x3?x2:x3);_top=y1<y2?(y1<y3?y1:y3):(y2<y3?y2:y3);_right=x1>x2?(x1>x3?x1:x3):(x2>x3?x2:x3);_bottom=y1>y2?(y1>y3?y1:y3):(y2>y3?y2:y3);resize();}else{_left=x1<x2?(x1<x3?(x1<_left?x1:_left):(x3<_left?x3:_left)):(x2<x3?(x2<_left?x2:_left):(x3<_left?x3:_left));_top=y1<y2?(y1<y3?(y1<_top?y1:_top):(y3<_top?y3:_top)):(y2<y3?(y2<_top?y2:_top):(y3<_top?y3:_top));_right=x1>x2?(x1>x3?(x1>_right?x1:_right):(x3>_right?x3:_right)):(x2>x3?(x2>_right?x2:_right):(x3>_right?x3:_right));_bottom=y1>y2?(y1>y3?(y1>_bottom?y1:_bottom):(y3>_bottom?y3:_bottom)):(y2>y3?(y2>_bottom?y2:_bottom):(y3>_bottom?y3:_bottom));resize();};};this.addRectangle=function(r){if(_isEmpty===true){_isEmpty=false;_left=r.getLeft();_top=r.getTop();_right=r.getRight();_bottom=r.getBottom();resize();}else{_left=_left<r.getLeft()?_left:r.getLeft();_top=_top<r.getTop()?_top:r.getTop();_right=_right>r.getRight()?_right:r.getRight();_bottom=_bottom>r.getBottom()?_bottom:r.getBottom();resize();}};this.inflate=function(v){_left-=v;_top-=v;_right+=v;_bottom+=v;resize();};this.minSelf=function(r){_left=_left>r.getLeft()?_left:r.getLeft();_top=_top>r.getTop()?_top:r.getTop();_right=_right<r.getRight()?_right:r.getRight();_bottom=_bottom<r.getBottom()?_bottom:r.getBottom();resize();};this.intersects=function(r){if(_right<r.getLeft())return false;if(_left>r.getRight())return false;if(_bottom<r.getTop())return false;if(_top>r.getBottom())return false;return true;};this.empty=function(){_isEmpty=true;_left=0;_top=0;_right=0;_bottom=0;resize();};this.isEmpty=function(){return _isEmpty;};};THREE.Math={clamp:function(x,a,b){return(x<a)?a:((x>b)?b:x);},clampBottom:function(x,a){return x<a?a:x;},mapLinear:function(x,a1,a2,b1,b2){return b1+(x-a1)*(b2-b1)/(a2-a1);},random16:function(){return(65280*Math.random()+255*Math.random())/65535;},randInt:function(low,high){return low+Math.floor(Math.random()*(high-low+1));},randFloat:function(low,high){return low+Math.random()*(high-low);},randFloatSpread:function(range){return range*(0.5-Math.random());},sign:function(x){return(x<0)?-1:((x>0)?1:0);}};THREE.Object3D=function(){THREE.Object3DLibrary.push(this);this.id=THREE.Object3DIdCount++;this.name='';this.properties={};this.parent=undefined;this.children=[];this.up=new THREE.Vector3(0,1,0);this.position=new THREE.Vector3();this.rotation=new THREE.Vector3();this.eulerOrder=THREE.Object3D.defaultEulerOrder;this.scale=new THREE.Vector3(1,1,1);this.renderDepth=null;this.rotationAutoUpdate=true;this.matrix=new THREE.Matrix4();this.matrixWorld=new THREE.Matrix4();this.matrixRotationWorld=new THREE.Matrix4();this.matrixAutoUpdate=true;this.matrixWorldNeedsUpdate=true;this.quaternion=new THREE.Quaternion();this.useQuaternion=false;this.boundRadius=0.0;this.boundRadiusScale=1.0;this.visible=true;this.castShadow=false;this.receiveShadow=false;this.frustumCulled=true;this._vector=new THREE.Vector3();};THREE.Object3D.prototype={constructor:THREE.Object3D,applyMatrix:function(matrix){this.matrix.multiply(matrix,this.matrix);this.scale.getScaleFromMatrix(this.matrix);var mat=new THREE.Matrix4().extractRotation(this.matrix);this.rotation.setEulerFromRotationMatrix(mat,this.eulerOrder);this.position.getPositionFromMatrix(this.matrix);},translate:function(distance,axis){this.matrix.rotateAxis(axis);this.position.addSelf(axis.multiplyScalar(distance));},translateX:function(distance){this.translate(distance,this._vector.set(1,0,0));},translateY:function(distance){this.translate(distance,this._vector.set(0,1,0));},translateZ:function(distance){this.translate(distance,this._vector.set(0,0,1));},localToWorld:function(vector){return this.matrixWorld.multiplyVector3(vector);},worldToLocal:function(vector){return THREE.Object3D.__m1.getInverse(this.matrixWorld).multiplyVector3(vector);},lookAt:function(vector){this.matrix.lookAt(vector,this.position,this.up);if(this.rotationAutoUpdate){this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder);}},add:function(object){if(object===this){console.warn('THREE.Object3D.add: An object can\'t be added as a child of itself.');return;}
if(object instanceof THREE.Object3D){if(object.parent!==undefined){object.parent.remove(object);}
object.parent=this;this.children.push(object);var scene=this;while(scene.parent!==undefined){scene=scene.parent;}
if(scene!==undefined&&scene instanceof THREE.Scene){scene.__addObject(object);}}},remove:function(object){var index=this.children.indexOf(object);if(index!==-1){object.parent=undefined;this.children.splice(index,1);var scene=this;while(scene.parent!==undefined){scene=scene.parent;}
if(scene!==undefined&&scene instanceof THREE.Scene){scene.__removeObject(object);}}},traverse:function(callback){callback(this);for(var i=0,l=this.children.length;i<l;i++){this.children[i].traverse(callback);}},getChildByName:function(name,recursive){for(var i=0,l=this.children.length;i<l;i++){var child=this.children[i];if(child.name===name){return child;}
if(recursive===true){child=child.getChildByName(name,recursive);if(child!==undefined){return child;}}}
return undefined;},getDescendants:function(array){if(array===undefined)array=[];Array.prototype.push.apply(array,this.children);for(var i=0,l=this.children.length;i<l;i++){this.children[i].getDescendants(array);}
return array;},updateMatrix:function(){this.matrix.setPosition(this.position);if(this.useQuaternion===false){this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder);}else{this.matrix.setRotationFromQuaternion(this.quaternion);}
if(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1){this.matrix.scale(this.scale);this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z));}
this.matrixWorldNeedsUpdate=true;},updateMatrixWorld:function(force){if(this.matrixAutoUpdate===true)this.updateMatrix();if(this.matrixWorldNeedsUpdate===true||force===true){if(this.parent===undefined){this.matrixWorld.copy(this.matrix);}else{this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix);}
this.matrixWorldNeedsUpdate=false;force=true;}
for(var i=0,l=this.children.length;i<l;i++){this.children[i].updateMatrixWorld(force);}},clone:function(object){if(object===undefined)object=new THREE.Object3D();object.name=this.name;object.up.copy(this.up);object.position.copy(this.position);if(object.rotation instanceof THREE.Vector3)object.rotation.copy(this.rotation);object.eulerOrder=this.eulerOrder;object.scale.copy(this.scale);object.renderDepth=this.renderDepth;object.rotationAutoUpdate=this.rotationAutoUpdate;object.matrix.copy(this.matrix);object.matrixWorld.copy(this.matrixWorld);object.matrixRotationWorld.copy(this.matrixRotationWorld);object.matrixAutoUpdate=this.matrixAutoUpdate;object.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate;object.quaternion.copy(this.quaternion);object.useQuaternion=this.useQuaternion;object.boundRadius=this.boundRadius;object.boundRadiusScale=this.boundRadiusScale;object.visible=this.visible;object.castShadow=this.castShadow;object.receiveShadow=this.receiveShadow;object.frustumCulled=this.frustumCulled;return object;},deallocate:function(){var index=THREE.Object3DLibrary.indexOf(this);if(index!==-1)THREE.Object3DLibrary.splice(index,1);}};THREE.Object3D.__m1=new THREE.Matrix4();THREE.Object3D.defaultEulerOrder='XYZ',THREE.Object3DIdCount=0;THREE.Object3DLibrary=[];THREE.Projector=function(){var _object,_objectCount,_objectPool=[],_objectPoolLength=0,_vertex,_vertexCount,_vertexPool=[],_vertexPoolLength=0,_face,_face3Count,_face3Pool=[],_face3PoolLength=0,_face4Count,_face4Pool=[],_face4PoolLength=0,_line,_lineCount,_linePool=[],_linePoolLength=0,_particle,_particleCount,_particlePool=[],_particlePoolLength=0,_renderData={objects:[],sprites:[],lights:[],elements:[]},_vector3=new THREE.Vector3(),_vector4=new THREE.Vector4(),_viewProjectionMatrix=new THREE.Matrix4(),_modelViewProjectionMatrix=new THREE.Matrix4(),_frustum=new THREE.Frustum(),_clippedVertex1PositionScreen=new THREE.Vector4(),_clippedVertex2PositionScreen=new THREE.Vector4(),_face3VertexNormals;this.projectVector=function(vector,camera){camera.matrixWorldInverse.getInverse(camera.matrixWorld);_viewProjectionMatrix.multiply(camera.projectionMatrix,camera.matrixWorldInverse);_viewProjectionMatrix.multiplyVector3(vector);return vector;};this.unprojectVector=function(vector,camera){camera.projectionMatrixInverse.getInverse(camera.projectionMatrix);_viewProjectionMatrix.multiply(camera.matrixWorld,camera.projectionMatrixInverse);_viewProjectionMatrix.multiplyVector3(vector);return vector;};this.pickingRay=function(vector,camera){var end,ray,t;vector.z=-1.0;end=new THREE.Vector3(vector.x,vector.y,1.0);this.unprojectVector(vector,camera);this.unprojectVector(end,camera);end.subSelf(vector).normalize();return new THREE.Ray(vector,end);};var projectGraph=function(root,sortObjects){_objectCount=0;_renderData.objects.length=0;_renderData.sprites.length=0;_renderData.lights.length=0;var projectObject=function(parent){for(var c=0,cl=parent.children.length;c<cl;c++){var object=parent.children[c];if(object.visible===false)continue;if(object instanceof THREE.Light){_renderData.lights.push(object);}else if(object instanceof THREE.Mesh||object instanceof THREE.Line){if(object.frustumCulled===false||_frustum.contains(object)===true){_object=getNextObjectInPool();_object.object=object;if(object.renderDepth!==null){_object.z=object.renderDepth;}else{_vector3.copy(object.matrixWorld.getPosition());_viewProjectionMatrix.multiplyVector3(_vector3);_object.z=_vector3.z;}
_renderData.objects.push(_object);}}else if(object instanceof THREE.Sprite||object instanceof THREE.Particle){_object=getNextObjectInPool();_object.object=object;if(object.renderDepth!==null){_object.z=object.renderDepth;}else{_vector3.copy(object.matrixWorld.getPosition());_viewProjectionMatrix.multiplyVector3(_vector3);_object.z=_vector3.z;}
_renderData.sprites.push(_object);}else{_object=getNextObjectInPool();_object.object=object;if(object.renderDepth!==null){_object.z=object.renderDepth;}else{_vector3.copy(object.matrixWorld.getPosition());_viewProjectionMatrix.multiplyVector3(_vector3);_object.z=_vector3.z;}
_renderData.objects.push(_object);}
projectObject(object);}};projectObject(root);if(sortObjects===true)_renderData.objects.sort(painterSort);return _renderData;};this.projectScene=function(scene,camera,sortObjects,sortElements){var near=camera.near,far=camera.far,visible=false,o,ol,v,vl,f,fl,n,nl,c,cl,u,ul,object,modelMatrix,rotationMatrix,geometry,geometryMaterials,vertices,vertex,vertexPositionScreen,faces,face,faceVertexNormals,normal,faceVertexUvs,uvs,v1,v2,v3,v4,isFaceMaterial,material,side;_face3Count=0;_face4Count=0;_lineCount=0;_particleCount=0;_renderData.elements.length=0;scene.updateMatrixWorld();if(camera.parent===undefined)camera.updateMatrixWorld();camera.matrixWorldInverse.getInverse(camera.matrixWorld);_viewProjectionMatrix.multiply(camera.projectionMatrix,camera.matrixWorldInverse);_frustum.setFromMatrix(_viewProjectionMatrix);_renderData=projectGraph(scene,sortObjects);for(o=0,ol=_renderData.objects.length;o<ol;o++){object=_renderData.objects[o].object;modelMatrix=object.matrixWorld;_vertexCount=0;if(object instanceof THREE.Mesh){geometry=object.geometry;geometryMaterials=object.geometry.materials;vertices=geometry.vertices;faces=geometry.faces;faceVertexUvs=geometry.faceVertexUvs;rotationMatrix=object.matrixRotationWorld.extractRotation(modelMatrix);isFaceMaterial=object.material instanceof THREE.MeshFaceMaterial;side=object.material.side;for(v=0,vl=vertices.length;v<vl;v++){_vertex=getNextVertexInPool();_vertex.positionWorld.copy(vertices[v]);modelMatrix.multiplyVector3(_vertex.positionWorld);_vertex.positionScreen.copy(_vertex.positionWorld);_viewProjectionMatrix.multiplyVector4(_vertex.positionScreen);_vertex.positionScreen.x/=_vertex.positionScreen.w;_vertex.positionScreen.y/=_vertex.positionScreen.w;_vertex.visible=_vertex.positionScreen.z>near&&_vertex.positionScreen.z<far;}
for(f=0,fl=faces.length;f<fl;f++){face=faces[f];material=isFaceMaterial===true?geometryMaterials[face.materialIndex]:object.material;if(material===undefined)continue;side=material.side;if(face instanceof THREE.Face3){v1=_vertexPool[face.a];v2=_vertexPool[face.b];v3=_vertexPool[face.c];if(v1.visible===true&&v2.visible===true&&v3.visible===true){visible=((v3.positionScreen.x-v1.positionScreen.x)*(v2.positionScreen.y-v1.positionScreen.y)-
(v3.positionScreen.y-v1.positionScreen.y)*(v2.positionScreen.x-v1.positionScreen.x))<0;if(side===THREE.DoubleSide||visible===(side===THREE.FrontSide)){_face=getNextFace3InPool();_face.v1.copy(v1);_face.v2.copy(v2);_face.v3.copy(v3);}else{continue;}}else{continue;}}else if(face instanceof THREE.Face4){v1=_vertexPool[face.a];v2=_vertexPool[face.b];v3=_vertexPool[face.c];v4=_vertexPool[face.d];if(v1.visible===true&&v2.visible===true&&v3.visible===true&&v4.visible===true){visible=(v4.positionScreen.x-v1.positionScreen.x)*(v2.positionScreen.y-v1.positionScreen.y)-
(v4.positionScreen.y-v1.positionScreen.y)*(v2.positionScreen.x-v1.positionScreen.x)<0||(v2.positionScreen.x-v3.positionScreen.x)*(v4.positionScreen.y-v3.positionScreen.y)-
(v2.positionScreen.y-v3.positionScreen.y)*(v4.positionScreen.x-v3.positionScreen.x)<0;if(side===THREE.DoubleSide||visible===(side===THREE.FrontSide)){_face=getNextFace4InPool();_face.v1.copy(v1);_face.v2.copy(v2);_face.v3.copy(v3);_face.v4.copy(v4);}else{continue;}}else{continue;}}
_face.normalWorld.copy(face.normal);if(visible===false&&(side===THREE.BackSide||side===THREE.DoubleSide))_face.normalWorld.negate();rotationMatrix.multiplyVector3(_face.normalWorld);_face.centroidWorld.copy(face.centroid);modelMatrix.multiplyVector3(_face.centroidWorld);_face.centroidScreen.copy(_face.centroidWorld);_viewProjectionMatrix.multiplyVector3(_face.centroidScreen);faceVertexNormals=face.vertexNormals;for(n=0,nl=faceVertexNormals.length;n<nl;n++){normal=_face.vertexNormalsWorld[n];normal.copy(faceVertexNormals[n]);if(visible===false&&(side===THREE.BackSide||side===THREE.DoubleSide))normal.negate();rotationMatrix.multiplyVector3(normal);}
_face.vertexNormalsLength=faceVertexNormals.length;for(c=0,cl=faceVertexUvs.length;c<cl;c++){uvs=faceVertexUvs[c][f];if(uvs===undefined)continue;for(u=0,ul=uvs.length;u<ul;u++){_face.uvs[c][u]=uvs[u];}}
_face.color=face.color;_face.material=material;_face.z=_face.centroidScreen.z;_renderData.elements.push(_face);}}else if(object instanceof THREE.Line){_modelViewProjectionMatrix.multiply(_viewProjectionMatrix,modelMatrix);vertices=object.geometry.vertices;v1=getNextVertexInPool();v1.positionScreen.copy(vertices[0]);_modelViewProjectionMatrix.multiplyVector4(v1.positionScreen);var step=object.type===THREE.LinePieces?2:1;for(v=1,vl=vertices.length;v<vl;v++){v1=getNextVertexInPool();v1.positionScreen.copy(vertices[v]);_modelViewProjectionMatrix.multiplyVector4(v1.positionScreen);if((v+1)%step>0)continue;v2=_vertexPool[_vertexCount-2];_clippedVertex1PositionScreen.copy(v1.positionScreen);_clippedVertex2PositionScreen.copy(v2.positionScreen);if(clipLine(_clippedVertex1PositionScreen,_clippedVertex2PositionScreen)===true){_clippedVertex1PositionScreen.multiplyScalar(1/_clippedVertex1PositionScreen.w);_clippedVertex2PositionScreen.multiplyScalar(1/_clippedVertex2PositionScreen.w);_line=getNextLineInPool();_line.v1.positionScreen.copy(_clippedVertex1PositionScreen);_line.v2.positionScreen.copy(_clippedVertex2PositionScreen);_line.z=Math.max(_clippedVertex1PositionScreen.z,_clippedVertex2PositionScreen.z);_line.material=object.material;_renderData.elements.push(_line);}}}}
for(o=0,ol=_renderData.sprites.length;o<ol;o++){object=_renderData.sprites[o].object;modelMatrix=object.matrixWorld;if(object instanceof THREE.Particle){_vector4.set(modelMatrix.elements[12],modelMatrix.elements[13],modelMatrix.elements[14],1);_viewProjectionMatrix.multiplyVector4(_vector4);_vector4.z/=_vector4.w;if(_vector4.z>0&&_vector4.z<1){_particle=getNextParticleInPool();_particle.object=object;_particle.x=_vector4.x/_vector4.w;_particle.y=_vector4.y/_vector4.w;_particle.z=_vector4.z;_particle.rotation=object.rotation.z;_particle.scale.x=object.scale.x*Math.abs(_particle.x-(_vector4.x+camera.projectionMatrix.elements[0])/(_vector4.w+camera.projectionMatrix.elements[12]));_particle.scale.y=object.scale.y*Math.abs(_particle.y-(_vector4.y+camera.projectionMatrix.elements[5])/(_vector4.w+camera.projectionMatrix.elements[13]));_particle.material=object.material;_renderData.elements.push(_particle);}}}
if(sortElements===true)_renderData.elements.sort(painterSort);return _renderData;};function getNextObjectInPool(){if(_objectCount===_objectPoolLength){var object=new THREE.RenderableObject();_objectPool.push(object);_objectPoolLength++;_objectCount++;return object;}
return _objectPool[_objectCount++];}
function getNextVertexInPool(){if(_vertexCount===_vertexPoolLength){var vertex=new THREE.RenderableVertex();_vertexPool.push(vertex);_vertexPoolLength++;_vertexCount++;return vertex;}
return _vertexPool[_vertexCount++];}
function getNextFace3InPool(){if(_face3Count===_face3PoolLength){var face=new THREE.RenderableFace3();_face3Pool.push(face);_face3PoolLength++;_face3Count++;return face;}
return _face3Pool[_face3Count++];}
function getNextFace4InPool(){if(_face4Count===_face4PoolLength){var face=new THREE.RenderableFace4();_face4Pool.push(face);_face4PoolLength++;_face4Count++;return face;}
return _face4Pool[_face4Count++];}
function getNextLineInPool(){if(_lineCount===_linePoolLength){var line=new THREE.RenderableLine();_linePool.push(line);_linePoolLength++;_lineCount++
return line;}
return _linePool[_lineCount++];}
function getNextParticleInPool(){if(_particleCount===_particlePoolLength){var particle=new THREE.RenderableParticle();_particlePool.push(particle);_particlePoolLength++;_particleCount++
return particle;}
return _particlePool[_particleCount++];}
function painterSort(a,b){return b.z-a.z;}
function clipLine(s1,s2){var alpha1=0,alpha2=1,bc1near=s1.z+s1.w,bc2near=s2.z+s2.w,bc1far=-s1.z+s1.w,bc2far=-s2.z+s2.w;if(bc1near>=0&&bc2near>=0&&bc1far>=0&&bc2far>=0){return true;}else if((bc1near<0&&bc2near<0)||(bc1far<0&&bc2far<0)){return false;}else{if(bc1near<0){alpha1=Math.max(alpha1,bc1near/(bc1near-bc2near));}else if(bc2near<0){alpha2=Math.min(alpha2,bc1near/(bc1near-bc2near));}
if(bc1far<0){alpha1=Math.max(alpha1,bc1far/(bc1far-bc2far));}else if(bc2far<0){alpha2=Math.min(alpha2,bc1far/(bc1far-bc2far));}
if(alpha2<alpha1){return false;}else{s1.lerpSelf(s2,alpha1);s2.lerpSelf(s1,1-alpha2);return true;}}}};THREE.Quaternion=function(x,y,z,w){this.x=x||0;this.y=y||0;this.z=z||0;this.w=(w!==undefined)?w:1;};THREE.Quaternion.prototype={constructor:THREE.Quaternion,set:function(x,y,z,w){this.x=x;this.y=y;this.z=z;this.w=w;return this;},copy:function(q){this.x=q.x;this.y=q.y;this.z=q.z;this.w=q.w;return this;},setFromEuler:function(v,order){var c1=Math.cos(v.x/2);var c2=Math.cos(v.y/2);var c3=Math.cos(v.z/2);var s1=Math.sin(v.x/2);var s2=Math.sin(v.y/2);var s3=Math.sin(v.z/2);if(order===undefined||order==='XYZ'){this.x=s1*c2*c3+c1*s2*s3;this.y=c1*s2*c3-s1*c2*s3;this.z=c1*c2*s3+s1*s2*c3;this.w=c1*c2*c3-s1*s2*s3;}else if(order==='YXZ'){this.x=s1*c2*c3+c1*s2*s3;this.y=c1*s2*c3-s1*c2*s3;this.z=c1*c2*s3-s1*s2*c3;this.w=c1*c2*c3+s1*s2*s3;}else if(order==='ZXY'){this.x=s1*c2*c3-c1*s2*s3;this.y=c1*s2*c3+s1*c2*s3;this.z=c1*c2*s3+s1*s2*c3;this.w=c1*c2*c3-s1*s2*s3;}else if(order==='ZYX'){this.x=s1*c2*c3-c1*s2*s3;this.y=c1*s2*c3+s1*c2*s3;this.z=c1*c2*s3-s1*s2*c3;this.w=c1*c2*c3+s1*s2*s3;}else if(order==='YZX'){this.x=s1*c2*c3+c1*s2*s3;this.y=c1*s2*c3+s1*c2*s3;this.z=c1*c2*s3-s1*s2*c3;this.w=c1*c2*c3-s1*s2*s3;}else if(order==='XZY'){this.x=s1*c2*c3-c1*s2*s3;this.y=c1*s2*c3-s1*c2*s3;this.z=c1*c2*s3+s1*s2*c3;this.w=c1*c2*c3+s1*s2*s3;}
return this;},setFromAxisAngle:function(axis,angle){var halfAngle=angle/2,s=Math.sin(halfAngle);this.x=axis.x*s;this.y=axis.y*s;this.z=axis.z*s;this.w=Math.cos(halfAngle);return this;},setFromRotationMatrix:function(m){var te=m.elements,m11=te[0],m12=te[4],m13=te[8],m21=te[1],m22=te[5],m23=te[9],m31=te[2],m32=te[6],m33=te[10],trace=m11+m22+m33,s;if(trace>0){s=0.5/Math.sqrt(trace+1.0);this.w=0.25/s;this.x=(m32-m23)*s;this.y=(m13-m31)*s;this.z=(m21-m12)*s;}else if(m11>m22&&m11>m33){s=2.0*Math.sqrt(1.0+m11-m22-m33);this.w=(m32-m23)/s;this.x=0.25*s;this.y=(m12+m21)/s;this.z=(m13+m31)/s;}else if(m22>m33){s=2.0*Math.sqrt(1.0+m22-m11-m33);this.w=(m13-m31)/s;this.x=(m12+m21)/s;this.y=0.25*s;this.z=(m23+m32)/s;}else{s=2.0*Math.sqrt(1.0+m33-m11-m22);this.w=(m21-m12)/s;this.x=(m13+m31)/s;this.y=(m23+m32)/s;this.z=0.25*s;}
return this;},calculateW:function(){this.w=-Math.sqrt(Math.abs(1.0-this.x*this.x-this.y*this.y-this.z*this.z));return this;},inverse:function(){this.x*=-1;this.y*=-1;this.z*=-1;return this;},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);},normalize:function(){var l=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);if(l===0){this.x=0;this.y=0;this.z=0;this.w=0;}else{l=1/l;this.x=this.x*l;this.y=this.y*l;this.z=this.z*l;this.w=this.w*l;}
return this;},multiply:function(a,b){var qax=a.x,qay=a.y,qaz=a.z,qaw=a.w,qbx=b.x,qby=b.y,qbz=b.z,qbw=b.w;this.x=qax*qbw+qay*qbz-qaz*qby+qaw*qbx;this.y=-qax*qbz+qay*qbw+qaz*qbx+qaw*qby;this.z=qax*qby-qay*qbx+qaz*qbw+qaw*qbz;this.w=-qax*qbx-qay*qby-qaz*qbz+qaw*qbw;return this;},multiplySelf:function(b){var qax=this.x,qay=this.y,qaz=this.z,qaw=this.w,qbx=b.x,qby=b.y,qbz=b.z,qbw=b.w;this.x=qax*qbw+qaw*qbx+qay*qbz-qaz*qby;this.y=qay*qbw+qaw*qby+qaz*qbx-qax*qbz;this.z=qaz*qbw+qaw*qbz+qax*qby-qay*qbx;this.w=qaw*qbw-qax*qbx-qay*qby-qaz*qbz;return this;},multiplyVector3:function(vector,dest){if(!dest){dest=vector;}
var x=vector.x,y=vector.y,z=vector.z,qx=this.x,qy=this.y,qz=this.z,qw=this.w;var ix=qw*x+qy*z-qz*y,iy=qw*y+qz*x-qx*z,iz=qw*z+qx*y-qy*x,iw=-qx*x-qy*y-qz*z;dest.x=ix*qw+iw*-qx+iy*-qz-iz*-qy;dest.y=iy*qw+iw*-qy+iz*-qx-ix*-qz;dest.z=iz*qw+iw*-qz+ix*-qy-iy*-qx;return dest;},slerpSelf:function(qb,t){var x=this.x,y=this.y,z=this.z,w=this.w;var cosHalfTheta=w*qb.w+x*qb.x+y*qb.y+z*qb.z;if(cosHalfTheta<0){this.w=-qb.w;this.x=-qb.x;this.y=-qb.y;this.z=-qb.z;cosHalfTheta=-cosHalfTheta;}else{this.copy(qb);}
if(cosHalfTheta>=1.0){this.w=w;this.x=x;this.y=y;this.z=z;return this;}
var halfTheta=Math.acos(cosHalfTheta);var sinHalfTheta=Math.sqrt(1.0-cosHalfTheta*cosHalfTheta);if(Math.abs(sinHalfTheta)<0.001){this.w=0.5*(w+this.w);this.x=0.5*(x+this.x);this.y=0.5*(y+this.y);this.z=0.5*(z+this.z);return this;}
var ratioA=Math.sin((1-t)*halfTheta)/sinHalfTheta,ratioB=Math.sin(t*halfTheta)/sinHalfTheta;this.w=(w*ratioA+this.w*ratioB);this.x=(x*ratioA+this.x*ratioB);this.y=(y*ratioA+this.y*ratioB);this.z=(z*ratioA+this.z*ratioB);return this;},clone:function(){return new THREE.Quaternion(this.x,this.y,this.z,this.w);}}
THREE.Quaternion.slerp=function(qa,qb,qm,t){var cosHalfTheta=qa.w*qb.w+qa.x*qb.x+qa.y*qb.y+qa.z*qb.z;if(cosHalfTheta<0){qm.w=-qb.w;qm.x=-qb.x;qm.y=-qb.y;qm.z=-qb.z;cosHalfTheta=-cosHalfTheta;}else{qm.copy(qb);}
if(Math.abs(cosHalfTheta)>=1.0){qm.w=qa.w;qm.x=qa.x;qm.y=qa.y;qm.z=qa.z;return qm;}
var halfTheta=Math.acos(cosHalfTheta);var sinHalfTheta=Math.sqrt(1.0-cosHalfTheta*cosHalfTheta);if(Math.abs(sinHalfTheta)<0.001){qm.w=0.5*(qa.w+qm.w);qm.x=0.5*(qa.x+qm.x);qm.y=0.5*(qa.y+qm.y);qm.z=0.5*(qa.z+qm.z);return qm;}
var ratioA=Math.sin((1-t)*halfTheta)/sinHalfTheta;var ratioB=Math.sin(t*halfTheta)/sinHalfTheta;qm.w=(qa.w*ratioA+qm.w*ratioB);qm.x=(qa.x*ratioA+qm.x*ratioB);qm.y=(qa.y*ratioA+qm.y*ratioB);qm.z=(qa.z*ratioA+qm.z*ratioB);return qm;}
THREE.Vertex=function(v){console.warn('THREE.Vertex has been DEPRECATED. Use THREE.Vector3 instead.')
return v;};THREE.Face3=function(a,b,c,normal,color,materialIndex){this.a=a;this.b=b;this.c=c;this.normal=normal instanceof THREE.Vector3?normal:new THREE.Vector3();this.vertexNormals=normal instanceof Array?normal:[];this.color=color instanceof THREE.Color?color:new THREE.Color();this.vertexColors=color instanceof Array?color:[];this.vertexTangents=[];this.materialIndex=materialIndex;this.centroid=new THREE.Vector3();};THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var face=new THREE.Face3(this.a,this.b,this.c);face.normal.copy(this.normal);face.color.copy(this.color);face.centroid.copy(this.centroid);face.materialIndex=this.materialIndex;var i,il;for(i=0,il=this.vertexNormals.length;i<il;i++)face.vertexNormals[i]=this.vertexNormals[i].clone();for(i=0,il=this.vertexColors.length;i<il;i++)face.vertexColors[i]=this.vertexColors[i].clone();for(i=0,il=this.vertexTangents.length;i<il;i++)face.vertexTangents[i]=this.vertexTangents[i].clone();return face;}};THREE.Face4=function(a,b,c,d,normal,color,materialIndex){this.a=a;this.b=b;this.c=c;this.d=d;this.normal=normal instanceof THREE.Vector3?normal:new THREE.Vector3();this.vertexNormals=normal instanceof Array?normal:[];this.color=color instanceof THREE.Color?color:new THREE.Color();this.vertexColors=color instanceof Array?color:[];this.vertexTangents=[];this.materialIndex=materialIndex;this.centroid=new THREE.Vector3();};THREE.Face4.prototype={constructor:THREE.Face4,clone:function(){var face=new THREE.Face4(this.a,this.b,this.c,this.d);face.normal.copy(this.normal);face.color.copy(this.color);face.centroid.copy(this.centroid);face.materialIndex=this.materialIndex;var i,il;for(i=0,il=this.vertexNormals.length;i<il;i++)face.vertexNormals[i]=this.vertexNormals[i].clone();for(i=0,il=this.vertexColors.length;i<il;i++)face.vertexColors[i]=this.vertexColors[i].clone();for(i=0,il=this.vertexTangents.length;i<il;i++)face.vertexTangents[i]=this.vertexTangents[i].clone();return face;}};THREE.UV=function(u,v){this.u=u||0;this.v=v||0;};THREE.UV.prototype={constructor:THREE.UV,set:function(u,v){this.u=u;this.v=v;return this;},copy:function(uv){this.u=uv.u;this.v=uv.v;return this;},lerpSelf:function(uv,alpha){this.u+=(uv.u-this.u)*alpha;this.v+=(uv.v-this.v)*alpha;return this;},clone:function(){return new THREE.UV(this.u,this.v);}};THREE.Geometry=function(){THREE.GeometryLibrary.push(this);this.id=THREE.GeometryIdCount++;this.name='';this.vertices=[];this.colors=[];this.materials=[];this.faces=[];this.faceUvs=[[]];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.boundingBox=null;this.boundingSphere=null;this.hasTangents=false;this.dynamic=true;this.verticesNeedUpdate=false;this.elementsNeedUpdate=false;this.uvsNeedUpdate=false;this.normalsNeedUpdate=false;this.tangentsNeedUpdate=false;this.colorsNeedUpdate=false;};THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(matrix){var matrixRotation=new THREE.Matrix4();matrixRotation.extractRotation(matrix);for(var i=0,il=this.vertices.length;i<il;i++){var vertex=this.vertices[i];matrix.multiplyVector3(vertex);}
for(var i=0,il=this.faces.length;i<il;i++){var face=this.faces[i];matrixRotation.multiplyVector3(face.normal);for(var j=0,jl=face.vertexNormals.length;j<jl;j++){matrixRotation.multiplyVector3(face.vertexNormals[j]);}
matrix.multiplyVector3(face.centroid);}},computeCentroids:function(){var f,fl,face;for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];face.centroid.set(0,0,0);if(face instanceof THREE.Face3){face.centroid.addSelf(this.vertices[face.a]);face.centroid.addSelf(this.vertices[face.b]);face.centroid.addSelf(this.vertices[face.c]);face.centroid.divideScalar(3);}else if(face instanceof THREE.Face4){face.centroid.addSelf(this.vertices[face.a]);face.centroid.addSelf(this.vertices[face.b]);face.centroid.addSelf(this.vertices[face.c]);face.centroid.addSelf(this.vertices[face.d]);face.centroid.divideScalar(4);}}},computeFaceNormals:function(){var n,nl,v,vl,vertex,f,fl,face,vA,vB,vC,cb=new THREE.Vector3(),ab=new THREE.Vector3();for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];vA=this.vertices[face.a];vB=this.vertices[face.b];vC=this.vertices[face.c];cb.sub(vC,vB);ab.sub(vA,vB);cb.crossSelf(ab);if(!cb.isZero()){cb.normalize();}
face.normal.copy(cb);}},computeVertexNormals:function(){var v,vl,f,fl,face,vertices;if(this.__tmpVertices===undefined){this.__tmpVertices=new Array(this.vertices.length);vertices=this.__tmpVertices;for(v=0,vl=this.vertices.length;v<vl;v++){vertices[v]=new THREE.Vector3();}
for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];if(face instanceof THREE.Face3){face.vertexNormals=[new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3()];}else if(face instanceof THREE.Face4){face.vertexNormals=[new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3()];}}}else{vertices=this.__tmpVertices;for(v=0,vl=this.vertices.length;v<vl;v++){vertices[v].set(0,0,0);}}
for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];if(face instanceof THREE.Face3){vertices[face.a].addSelf(face.normal);vertices[face.b].addSelf(face.normal);vertices[face.c].addSelf(face.normal);}else if(face instanceof THREE.Face4){vertices[face.a].addSelf(face.normal);vertices[face.b].addSelf(face.normal);vertices[face.c].addSelf(face.normal);vertices[face.d].addSelf(face.normal);}}
for(v=0,vl=this.vertices.length;v<vl;v++){vertices[v].normalize();}
for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];if(face instanceof THREE.Face3){face.vertexNormals[0].copy(vertices[face.a]);face.vertexNormals[1].copy(vertices[face.b]);face.vertexNormals[2].copy(vertices[face.c]);}else if(face instanceof THREE.Face4){face.vertexNormals[0].copy(vertices[face.a]);face.vertexNormals[1].copy(vertices[face.b]);face.vertexNormals[2].copy(vertices[face.c]);face.vertexNormals[3].copy(vertices[face.d]);}}},computeMorphNormals:function(){var i,il,f,fl,face;for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];if(!face.__originalFaceNormal){face.__originalFaceNormal=face.normal.clone();}else{face.__originalFaceNormal.copy(face.normal);}
if(!face.__originalVertexNormals)face.__originalVertexNormals=[];for(i=0,il=face.vertexNormals.length;i<il;i++){if(!face.__originalVertexNormals[i]){face.__originalVertexNormals[i]=face.vertexNormals[i].clone();}else{face.__originalVertexNormals[i].copy(face.vertexNormals[i]);}}}
var tmpGeo=new THREE.Geometry();tmpGeo.faces=this.faces;for(i=0,il=this.morphTargets.length;i<il;i++){if(!this.morphNormals[i]){this.morphNormals[i]={};this.morphNormals[i].faceNormals=[];this.morphNormals[i].vertexNormals=[];var dstNormalsFace=this.morphNormals[i].faceNormals;var dstNormalsVertex=this.morphNormals[i].vertexNormals;var faceNormal,vertexNormals;for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];faceNormal=new THREE.Vector3();if(face instanceof THREE.Face3){vertexNormals={a:new THREE.Vector3(),b:new THREE.Vector3(),c:new THREE.Vector3()};}else{vertexNormals={a:new THREE.Vector3(),b:new THREE.Vector3(),c:new THREE.Vector3(),d:new THREE.Vector3()};}
dstNormalsFace.push(faceNormal);dstNormalsVertex.push(vertexNormals);}}
var morphNormals=this.morphNormals[i];tmpGeo.vertices=this.morphTargets[i].vertices;tmpGeo.computeFaceNormals();tmpGeo.computeVertexNormals();var faceNormal,vertexNormals;for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];faceNormal=morphNormals.faceNormals[f];vertexNormals=morphNormals.vertexNormals[f];faceNormal.copy(face.normal);if(face instanceof THREE.Face3){vertexNormals.a.copy(face.vertexNormals[0]);vertexNormals.b.copy(face.vertexNormals[1]);vertexNormals.c.copy(face.vertexNormals[2]);}else{vertexNormals.a.copy(face.vertexNormals[0]);vertexNormals.b.copy(face.vertexNormals[1]);vertexNormals.c.copy(face.vertexNormals[2]);vertexNormals.d.copy(face.vertexNormals[3]);}}}
for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];face.normal=face.__originalFaceNormal;face.vertexNormals=face.__originalVertexNormals;}},computeTangents:function(){var f,fl,v,vl,i,il,vertexIndex,face,uv,vA,vB,vC,uvA,uvB,uvC,x1,x2,y1,y2,z1,z2,s1,s2,t1,t2,r,t,test,tan1=[],tan2=[],sdir=new THREE.Vector3(),tdir=new THREE.Vector3(),tmp=new THREE.Vector3(),tmp2=new THREE.Vector3(),n=new THREE.Vector3(),w;for(v=0,vl=this.vertices.length;v<vl;v++){tan1[v]=new THREE.Vector3();tan2[v]=new THREE.Vector3();}
function handleTriangle(context,a,b,c,ua,ub,uc){vA=context.vertices[a];vB=context.vertices[b];vC=context.vertices[c];uvA=uv[ua];uvB=uv[ub];uvC=uv[uc];x1=vB.x-vA.x;x2=vC.x-vA.x;y1=vB.y-vA.y;y2=vC.y-vA.y;z1=vB.z-vA.z;z2=vC.z-vA.z;s1=uvB.u-uvA.u;s2=uvC.u-uvA.u;t1=uvB.v-uvA.v;t2=uvC.v-uvA.v;r=1.0/(s1*t2-s2*t1);sdir.set((t2*x1-t1*x2)*r,(t2*y1-t1*y2)*r,(t2*z1-t1*z2)*r);tdir.set((s1*x2-s2*x1)*r,(s1*y2-s2*y1)*r,(s1*z2-s2*z1)*r);tan1[a].addSelf(sdir);tan1[b].addSelf(sdir);tan1[c].addSelf(sdir);tan2[a].addSelf(tdir);tan2[b].addSelf(tdir);tan2[c].addSelf(tdir);}
for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];uv=this.faceVertexUvs[0][f];if(face instanceof THREE.Face3){handleTriangle(this,face.a,face.b,face.c,0,1,2);}else if(face instanceof THREE.Face4){handleTriangle(this,face.a,face.b,face.d,0,1,3);handleTriangle(this,face.b,face.c,face.d,1,2,3);}}
var faceIndex=['a','b','c','d'];for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];for(i=0;i<face.vertexNormals.length;i++){n.copy(face.vertexNormals[i]);vertexIndex=face[faceIndex[i]];t=tan1[vertexIndex];tmp.copy(t);tmp.subSelf(n.multiplyScalar(n.dot(t))).normalize();tmp2.cross(face.vertexNormals[i],t);test=tmp2.dot(tan2[vertexIndex]);w=(test<0.0)?-1.0:1.0;face.vertexTangents[i]=new THREE.Vector4(tmp.x,tmp.y,tmp.z,w);}}
this.hasTangents=true;},computeBoundingBox:function(){if(!this.boundingBox){this.boundingBox={min:new THREE.Vector3(),max:new THREE.Vector3()};}
if(this.vertices.length>0){var position,firstPosition=this.vertices[0];this.boundingBox.min.copy(firstPosition);this.boundingBox.max.copy(firstPosition);var min=this.boundingBox.min,max=this.boundingBox.max;for(var v=1,vl=this.vertices.length;v<vl;v++){position=this.vertices[v];if(position.x<min.x){min.x=position.x;}else if(position.x>max.x){max.x=position.x;}
if(position.y<min.y){min.y=position.y;}else if(position.y>max.y){max.y=position.y;}
if(position.z<min.z){min.z=position.z;}else if(position.z>max.z){max.z=position.z;}}}else{this.boundingBox.min.set(0,0,0);this.boundingBox.max.set(0,0,0);}},computeBoundingSphere:function(){var maxRadiusSq=0;if(this.boundingSphere===null)this.boundingSphere={radius:0};for(var i=0,l=this.vertices.length;i<l;i++){var radiusSq=this.vertices[i].lengthSq();if(radiusSq>maxRadiusSq)maxRadiusSq=radiusSq;}
this.boundingSphere.radius=Math.sqrt(maxRadiusSq);},mergeVertices:function(){var verticesMap={};var unique=[],changes=[];var v,key;var precisionPoints=4;var precision=Math.pow(10,precisionPoints);var i,il,face;var abcd='abcd',o,k,j,jl,u;for(i=0,il=this.vertices.length;i<il;i++){v=this.vertices[i];key=[Math.round(v.x*precision),Math.round(v.y*precision),Math.round(v.z*precision)].join('_');if(verticesMap[key]===undefined){verticesMap[key]=i;unique.push(this.vertices[i]);changes[i]=unique.length-1;}else{changes[i]=changes[verticesMap[key]];}};for(i=0,il=this.faces.length;i<il;i++){face=this.faces[i];if(face instanceof THREE.Face3){face.a=changes[face.a];face.b=changes[face.b];face.c=changes[face.c];}else if(face instanceof THREE.Face4){face.a=changes[face.a];face.b=changes[face.b];face.c=changes[face.c];face.d=changes[face.d];o=[face.a,face.b,face.c,face.d];for(k=3;k>0;k--){if(o.indexOf(face[abcd[k]])!==k){o.splice(k,1);this.faces[i]=new THREE.Face3(o[0],o[1],o[2],face.normal,face.color,face.materialIndex);for(j=0,jl=this.faceVertexUvs.length;j<jl;j++){u=this.faceVertexUvs[j][i];if(u)u.splice(k,1);}
this.faces[i].vertexColors=face.vertexColors;break;}}}}
var diff=this.vertices.length-unique.length;this.vertices=unique;return diff;},clone:function(){},deallocate:function(){var index=THREE.GeometryLibrary.indexOf(this);if(index!==-1)THREE.GeometryLibrary.splice(index,1);}};THREE.GeometryIdCount=0;THREE.GeometryLibrary=[];THREE.BufferGeometry=function(){THREE.GeometryLibrary.push(this);this.id=THREE.GeometryIdCount++;this.attributes={};this.dynamic=false;this.boundingBox=null;this.boundingSphere=null;this.hasTangents=false;this.morphTargets=[];};THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,applyMatrix:function(matrix){var positionArray;var normalArray;if(this.attributes["position"])positionArray=this.attributes["position"].array;if(this.attributes["normal"])normalArray=this.attributes["normal"].array;if(positionArray!==undefined){matrix.multiplyVector3Array(positionArray);this.verticesNeedUpdate=true;}
if(normalArray!==undefined){var matrixRotation=new THREE.Matrix4();matrixRotation.extractRotation(matrix);matrixRotation.multiplyVector3Array(normalArray);this.normalsNeedUpdate=true;}},computeBoundingBox:function(){if(!this.boundingBox){this.boundingBox={min:new THREE.Vector3(Infinity,Infinity,Infinity),max:new THREE.Vector3(-Infinity,-Infinity,-Infinity)};}
var positions=this.attributes["position"].array;if(positions){var bb=this.boundingBox;var x,y,z;for(var i=0,il=positions.length;i<il;i+=3){x=positions[i];y=positions[i+1];z=positions[i+2];if(x<bb.min.x){bb.min.x=x;}else if(x>bb.max.x){bb.max.x=x;}
if(y<bb.min.y){bb.min.y=y;}else if(y>bb.max.y){bb.max.y=y;}
if(z<bb.min.z){bb.min.z=z;}else if(z>bb.max.z){bb.max.z=z;}}}
if(positions===undefined||positions.length===0){this.boundingBox.min.set(0,0,0);this.boundingBox.max.set(0,0,0);}},computeBoundingSphere:function(){if(!this.boundingSphere)this.boundingSphere={radius:0};var positions=this.attributes["position"].array;if(positions){var radiusSq,maxRadiusSq=0;var x,y,z;for(var i=0,il=positions.length;i<il;i+=3){x=positions[i];y=positions[i+1];z=positions[i+2];radiusSq=x*x+y*y+z*z;if(radiusSq>maxRadiusSq)maxRadiusSq=radiusSq;}
this.boundingSphere.radius=Math.sqrt(maxRadiusSq);}},computeVertexNormals:function(){if(this.attributes["position"]&&this.attributes["index"]){var i,il;var j,jl;var nVertexElements=this.attributes["position"].array.length;if(this.attributes["normal"]===undefined){this.attributes["normal"]={itemSize:3,array:new Float32Array(nVertexElements),numItems:nVertexElements};}else{for(i=0,il=this.attributes["normal"].array.length;i<il;i++){this.attributes["normal"].array[i]=0;}}
var offsets=this.offsets;var indices=this.attributes["index"].array;var positions=this.attributes["position"].array;var normals=this.attributes["normal"].array;var vA,vB,vC,x,y,z,pA=new THREE.Vector3(),pB=new THREE.Vector3(),pC=new THREE.Vector3(),cb=new THREE.Vector3(),ab=new THREE.Vector3();for(j=0,jl=offsets.length;j<jl;++j){var start=offsets[j].start;var count=offsets[j].count;var index=offsets[j].index;for(i=start,il=start+count;i<il;i+=3){vA=index+indices[i];vB=index+indices[i+1];vC=index+indices[i+2];x=positions[vA*3];y=positions[vA*3+1];z=positions[vA*3+2];pA.set(x,y,z);x=positions[vB*3];y=positions[vB*3+1];z=positions[vB*3+2];pB.set(x,y,z);x=positions[vC*3];y=positions[vC*3+1];z=positions[vC*3+2];pC.set(x,y,z);cb.sub(pC,pB);ab.sub(pA,pB);cb.crossSelf(ab);normals[vA*3]+=cb.x;normals[vA*3+1]+=cb.y;normals[vA*3+2]+=cb.z;normals[vB*3]+=cb.x;normals[vB*3+1]+=cb.y;normals[vB*3+2]+=cb.z;normals[vC*3]+=cb.x;normals[vC*3+1]+=cb.y;normals[vC*3+2]+=cb.z;}}
for(i=0,il=normals.length;i<il;i+=3){x=normals[i];y=normals[i+1];z=normals[i+2];var n=1.0/Math.sqrt(x*x+y*y+z*z);normals[i]*=n;normals[i+1]*=n;normals[i+2]*=n;}
this.normalsNeedUpdate=true;}},computeTangents:function(){if(this.attributes["index"]===undefined||this.attributes["position"]===undefined||this.attributes["normal"]===undefined||this.attributes["uv"]===undefined){console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");return;}
var indices=this.attributes["index"].array;var positions=this.attributes["position"].array;var normals=this.attributes["normal"].array;var uvs=this.attributes["uv"].array;var nVertices=positions.length/3;if(this.attributes["tangent"]===undefined){var nTangentElements=4*nVertices;this.attributes["tangent"]={itemSize:4,array:new Float32Array(nTangentElements),numItems:nTangentElements};}
var tangents=this.attributes["tangent"].array;var tan1=[],tan2=[];for(var k=0;k<nVertices;k++){tan1[k]=new THREE.Vector3();tan2[k]=new THREE.Vector3();}
var xA,yA,zA,xB,yB,zB,xC,yC,zC,uA,vA,uB,vB,uC,vC,x1,x2,y1,y2,z1,z2,s1,s2,t1,t2,r;var sdir=new THREE.Vector3(),tdir=new THREE.Vector3();function handleTriangle(a,b,c){xA=positions[a*3];yA=positions[a*3+1];zA=positions[a*3+2];xB=positions[b*3];yB=positions[b*3+1];zB=positions[b*3+2];xC=positions[c*3];yC=positions[c*3+1];zC=positions[c*3+2];uA=uvs[a*2];vA=uvs[a*2+1];uB=uvs[b*2];vB=uvs[b*2+1];uC=uvs[c*2];vC=uvs[c*2+1];x1=xB-xA;x2=xC-xA;y1=yB-yA;y2=yC-yA;z1=zB-zA;z2=zC-zA;s1=uB-uA;s2=uC-uA;t1=vB-vA;t2=vC-vA;r=1.0/(s1*t2-s2*t1);sdir.set((t2*x1-t1*x2)*r,(t2*y1-t1*y2)*r,(t2*z1-t1*z2)*r);tdir.set((s1*x2-s2*x1)*r,(s1*y2-s2*y1)*r,(s1*z2-s2*z1)*r);tan1[a].addSelf(sdir);tan1[b].addSelf(sdir);tan1[c].addSelf(sdir);tan2[a].addSelf(tdir);tan2[b].addSelf(tdir);tan2[c].addSelf(tdir);}
var i,il;var j,jl;var iA,iB,iC;var offsets=this.offsets;for(j=0,jl=offsets.length;j<jl;++j){var start=offsets[j].start;var count=offsets[j].count;var index=offsets[j].index;for(i=start,il=start+count;i<il;i+=3){iA=index+indices[i];iB=index+indices[i+1];iC=index+indices[i+2];handleTriangle(iA,iB,iC);}}
var tmp=new THREE.Vector3(),tmp2=new THREE.Vector3();var n=new THREE.Vector3(),n2=new THREE.Vector3();var w,t,test;var nx,ny,nz;function handleVertex(v){n.x=normals[v*3];n.y=normals[v*3+1];n.z=normals[v*3+2];n2.copy(n);t=tan1[v];tmp.copy(t);tmp.subSelf(n.multiplyScalar(n.dot(t))).normalize();tmp2.cross(n2,t);test=tmp2.dot(tan2[v]);w=(test<0.0)?-1.0:1.0;tangents[v*4]=tmp.x;tangents[v*4+1]=tmp.y;tangents[v*4+2]=tmp.z;tangents[v*4+3]=w;}
for(j=0,jl=offsets.length;j<jl;++j){var start=offsets[j].start;var count=offsets[j].count;var index=offsets[j].index;for(i=start,il=start+count;i<il;i+=3){iA=index+indices[i];iB=index+indices[i+1];iC=index+indices[i+2];handleVertex(iA);handleVertex(iB);handleVertex(iC);}}
this.hasTangents=true;this.tangentsNeedUpdate=true;},deallocate:function(){var index=THREE.GeometryLibrary.indexOf(this);if(index!==-1)THREE.GeometryLibrary.splice(index,1);}};THREE.Spline=function(points){this.points=points;var c=[],v3={x:0,y:0,z:0},point,intPoint,weight,w2,w3,pa,pb,pc,pd;this.initFromArray=function(a){this.points=[];for(var i=0;i<a.length;i++){this.points[i]={x:a[i][0],y:a[i][1],z:a[i][2]};}};this.getPoint=function(k){point=(this.points.length-1)*k;intPoint=Math.floor(point);weight=point-intPoint;c[0]=intPoint===0?intPoint:intPoint-1;c[1]=intPoint;c[2]=intPoint>this.points.length-2?this.points.length-1:intPoint+1;c[3]=intPoint>this.points.length-3?this.points.length-1:intPoint+2;pa=this.points[c[0]];pb=this.points[c[1]];pc=this.points[c[2]];pd=this.points[c[3]];w2=weight*weight;w3=weight*w2;v3.x=interpolate(pa.x,pb.x,pc.x,pd.x,weight,w2,w3);v3.y=interpolate(pa.y,pb.y,pc.y,pd.y,weight,w2,w3);v3.z=interpolate(pa.z,pb.z,pc.z,pd.z,weight,w2,w3);return v3;};this.getControlPointsArray=function(){var i,p,l=this.points.length,coords=[];for(i=0;i<l;i++){p=this.points[i];coords[i]=[p.x,p.y,p.z];}
return coords;};this.getLength=function(nSubDivisions){var i,index,nSamples,position,point=0,intPoint=0,oldIntPoint=0,oldPosition=new THREE.Vector3(),tmpVec=new THREE.Vector3(),chunkLengths=[],totalLength=0;chunkLengths[0]=0;if(!nSubDivisions)nSubDivisions=100;nSamples=this.points.length*nSubDivisions;oldPosition.copy(this.points[0]);for(i=1;i<nSamples;i++){index=i/nSamples;position=this.getPoint(index);tmpVec.copy(position);totalLength+=tmpVec.distanceTo(oldPosition);oldPosition.copy(position);point=(this.points.length-1)*index;intPoint=Math.floor(point);if(intPoint!=oldIntPoint){chunkLengths[intPoint]=totalLength;oldIntPoint=intPoint;}}
chunkLengths[chunkLengths.length]=totalLength;return{chunks:chunkLengths,total:totalLength};};this.reparametrizeByArcLength=function(samplingCoef){var i,j,index,indexCurrent,indexNext,linearDistance,realDistance,sampling,position,newpoints=[],tmpVec=new THREE.Vector3(),sl=this.getLength();newpoints.push(tmpVec.copy(this.points[0]).clone());for(i=1;i<this.points.length;i++){realDistance=sl.chunks[i]-sl.chunks[i-1];sampling=Math.ceil(samplingCoef*realDistance/sl.total);indexCurrent=(i-1)/(this.points.length-1);indexNext=i/(this.points.length-1);for(j=1;j<sampling-1;j++){index=indexCurrent+j*(1/sampling)*(indexNext-indexCurrent);position=this.getPoint(index);newpoints.push(tmpVec.copy(position).clone());}
newpoints.push(tmpVec.copy(this.points[i]).clone());}
this.points=newpoints;};function interpolate(p0,p1,p2,p3,t,t2,t3){var v0=(p2-p0)*0.5,v1=(p3-p1)*0.5;return(2*(p1-p2)+v0+v1)*t3+(-3*(p1-p2)-2*v0-v1)*t2+v0*t+p1;};};THREE.Camera=function(){THREE.Object3D.call(this);this.matrixWorldInverse=new THREE.Matrix4();this.projectionMatrix=new THREE.Matrix4();this.projectionMatrixInverse=new THREE.Matrix4();};THREE.Camera.prototype=Object.create(THREE.Object3D.prototype);THREE.Camera.prototype.lookAt=function(vector){this.matrix.lookAt(this.position,vector,this.up);if(this.rotationAutoUpdate===true){this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder);}};THREE.OrthographicCamera=function(left,right,top,bottom,near,far){THREE.Camera.call(this);this.left=left;this.right=right;this.top=top;this.bottom=bottom;this.near=(near!==undefined)?near:0.1;this.far=(far!==undefined)?far:2000;this.updateProjectionMatrix();};THREE.OrthographicCamera.prototype=Object.create(THREE.Camera.prototype);THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far);};THREE.PerspectiveCamera=function(fov,aspect,near,far){THREE.Camera.call(this);this.fov=fov!==undefined?fov:50;this.aspect=aspect!==undefined?aspect:1;this.near=near!==undefined?near:0.1;this.far=far!==undefined?far:2000;this.updateProjectionMatrix();};THREE.PerspectiveCamera.prototype=Object.create(THREE.Camera.prototype);THREE.PerspectiveCamera.prototype.setLens=function(focalLength,frameHeight){if(frameHeight===undefined)frameHeight=24;this.fov=2*Math.atan(frameHeight/(focalLength*2))*(180/Math.PI);this.updateProjectionMatrix();}
THREE.PerspectiveCamera.prototype.setViewOffset=function(fullWidth,fullHeight,x,y,width,height){this.fullWidth=fullWidth;this.fullHeight=fullHeight;this.x=x;this.y=y;this.width=width;this.height=height;this.updateProjectionMatrix();};THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var aspect=this.fullWidth/this.fullHeight;var top=Math.tan(this.fov*Math.PI/360)*this.near;var bottom=-top;var left=aspect*bottom;var right=aspect*top;var width=Math.abs(right-left);var height=Math.abs(top-bottom);this.projectionMatrix.makeFrustum(left+this.x*width/this.fullWidth,left+(this.x+this.width)*width/this.fullWidth,top-(this.y+this.height)*height/this.fullHeight,top-this.y*height/this.fullHeight,this.near,this.far);}else{this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far);}};THREE.Light=function(hex){THREE.Object3D.call(this);this.color=new THREE.Color(hex);};THREE.Light.prototype=Object.create(THREE.Object3D.prototype);THREE.AmbientLight=function(hex){THREE.Light.call(this,hex);};THREE.AmbientLight.prototype=Object.create(THREE.Light.prototype);THREE.DirectionalLight=function(hex,intensity,distance){THREE.Light.call(this,hex);this.position=new THREE.Vector3(0,1,0);this.target=new THREE.Object3D();this.intensity=(intensity!==undefined)?intensity:1;this.distance=(distance!==undefined)?distance:0;this.castShadow=false;this.onlyShadow=false;this.shadowCameraNear=50;this.shadowCameraFar=5000;this.shadowCameraLeft=-500;this.shadowCameraRight=500;this.shadowCameraTop=500;this.shadowCameraBottom=-500;this.shadowCameraVisible=false;this.shadowBias=0;this.shadowDarkness=0.5;this.shadowMapWidth=512;this.shadowMapHeight=512;this.shadowCascade=false;this.shadowCascadeOffset=new THREE.Vector3(0,0,-1000);this.shadowCascadeCount=2;this.shadowCascadeBias=[0,0,0];this.shadowCascadeWidth=[512,512,512];this.shadowCascadeHeight=[512,512,512];this.shadowCascadeNearZ=[-1.000,0.990,0.998];this.shadowCascadeFarZ=[0.990,0.998,1.000];this.shadowCascadeArray=[];this.shadowMap=null;this.shadowMapSize=null;this.shadowCamera=null;this.shadowMatrix=null;};THREE.DirectionalLight.prototype=Object.create(THREE.Light.prototype);THREE.HemisphereLight=function(skyColorHex,groundColorHex,intensity){THREE.Light.call(this,skyColorHex);this.groundColor=new THREE.Color(groundColorHex);this.position=new THREE.Vector3(0,100,0);this.intensity=(intensity!==undefined)?intensity:1;};THREE.HemisphereLight.prototype=Object.create(THREE.Light.prototype);THREE.PointLight=function(hex,intensity,distance){THREE.Light.call(this,hex);this.position=new THREE.Vector3(0,0,0);this.intensity=(intensity!==undefined)?intensity:1;this.distance=(distance!==undefined)?distance:0;};THREE.PointLight.prototype=Object.create(THREE.Light.prototype);THREE.SpotLight=function(hex,intensity,distance,angle,exponent){THREE.Light.call(this,hex);this.position=new THREE.Vector3(0,1,0);this.target=new THREE.Object3D();this.intensity=(intensity!==undefined)?intensity:1;this.distance=(distance!==undefined)?distance:0;this.angle=(angle!==undefined)?angle:Math.PI/2;this.exponent=(exponent!==undefined)?exponent:10;this.castShadow=false;this.onlyShadow=false;this.shadowCameraNear=50;this.shadowCameraFar=5000;this.shadowCameraFov=50;this.shadowCameraVisible=false;this.shadowBias=0;this.shadowDarkness=0.5;this.shadowMapWidth=512;this.shadowMapHeight=512;this.shadowMap=null;this.shadowMapSize=null;this.shadowCamera=null;this.shadowMatrix=null;};THREE.SpotLight.prototype=Object.create(THREE.Light.prototype);THREE.Loader=function(showStatus){this.showStatus=showStatus;this.statusDomElement=showStatus?THREE.Loader.prototype.addStatusElement():null;this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){};};THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:'anonymous',addStatusElement:function(){var e=document.createElement("div");e.style.position="absolute";e.style.right="0px";e.style.top="0px";e.style.fontSize="0.8em";e.style.textAlign="left";e.style.background="rgba(0,0,0,0.25)";e.style.color="#fff";e.style.width="120px";e.style.padding="0.5em 0.5em 0.5em 0.5em";e.style.zIndex=1000;e.innerHTML="Loading ...";return e;},updateProgress:function(progress){var message="Loaded ";if(progress.total){message+=(100*progress.loaded/progress.total).toFixed(0)+"%";}else{message+=(progress.loaded/1000).toFixed(2)+" KB";}
this.statusDomElement.innerHTML=message;},extractUrlBase:function(url){var parts=url.split('/');parts.pop();return(parts.length<1?'.':parts.join('/'))+'/';},initMaterials:function(scope,materials,texturePath){scope.materials=[];for(var i=0;i<materials.length;++i){scope.materials[i]=THREE.Loader.prototype.createMaterial(materials[i],texturePath);}},hasNormals:function(scope){var m,i,il=scope.materials.length;for(i=0;i<il;i++){m=scope.materials[i];if(m instanceof THREE.ShaderMaterial)return true;}
return false;},createMaterial:function(m,texturePath){var _this=this;function is_pow2(n){var l=Math.log(n)/Math.LN2;return Math.floor(l)==l;}
function nearest_pow2(n){var l=Math.log(n)/Math.LN2;return Math.pow(2,Math.round(l));}
function load_image(where,url){var image=new Image();image.onload=function(){if(!is_pow2(this.width)||!is_pow2(this.height)){var width=nearest_pow2(this.width);var height=nearest_pow2(this.height);where.image.width=width;where.image.height=height;where.image.getContext('2d').drawImage(this,0,0,width,height);}else{where.image=this;}
where.needsUpdate=true;};image.crossOrigin=_this.crossOrigin;image.src=url;}
function create_texture(where,name,sourceFile,repeat,offset,wrap,anisotropy){var isCompressed=sourceFile.toLowerCase().endsWith(".dds");var fullPath=texturePath+"/"+sourceFile;if(isCompressed){var texture=THREE.ImageUtils.loadCompressedTexture(fullPath);where[name]=texture;}else{var texture=document.createElement('canvas');where[name]=new THREE.Texture(texture);}
where[name].sourceFile=sourceFile;if(repeat){where[name].repeat.set(repeat[0],repeat[1]);if(repeat[0]!==1)where[name].wrapS=THREE.RepeatWrapping;if(repeat[1]!==1)where[name].wrapT=THREE.RepeatWrapping;}
if(offset){where[name].offset.set(offset[0],offset[1]);}
if(wrap){var wrapMap={"repeat":THREE.RepeatWrapping,"mirror":THREE.MirroredRepeatWrapping}
if(wrapMap[wrap[0]]!==undefined)where[name].wrapS=wrapMap[wrap[0]];if(wrapMap[wrap[1]]!==undefined)where[name].wrapT=wrapMap[wrap[1]];}
if(anisotropy){where[name].anisotropy=anisotropy;}
if(!isCompressed){load_image(where[name],fullPath);}}
function rgb2hex(rgb){return(rgb[0]*255<<16)+(rgb[1]*255<<8)+rgb[2]*255;}
var mtype="MeshLambertMaterial";var mpars={color:0xeeeeee,opacity:1.0,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:false};if(m.shading){var shading=m.shading.toLowerCase();if(shading==="phong")mtype="MeshPhongMaterial";else if(shading==="basic")mtype="MeshBasicMaterial";}
if(m.blending!==undefined&&THREE[m.blending]!==undefined){mpars.blending=THREE[m.blending];}
if(m.transparent!==undefined||m.opacity<1.0){mpars.transparent=m.transparent;}
if(m.depthTest!==undefined){mpars.depthTest=m.depthTest;}
if(m.depthWrite!==undefined){mpars.depthWrite=m.depthWrite;}
if(m.visible!==undefined){mpars.visible=m.visible;}
if(m.flipSided!==undefined){mpars.side=THREE.BackSide;}
if(m.doubleSided!==undefined){mpars.side=THREE.DoubleSide;}
if(m.wireframe!==undefined){mpars.wireframe=m.wireframe;}
if(m.vertexColors!==undefined){if(m.vertexColors==="face"){mpars.vertexColors=THREE.FaceColors;}else if(m.vertexColors){mpars.vertexColors=THREE.VertexColors;}}
if(m.colorDiffuse){mpars.color=rgb2hex(m.colorDiffuse);}else if(m.DbgColor){mpars.color=m.DbgColor;}
if(m.colorSpecular){mpars.specular=rgb2hex(m.colorSpecular);}
if(m.colorAmbient){mpars.ambient=rgb2hex(m.colorAmbient);}
if(m.transparency){mpars.opacity=m.transparency;}
if(m.specularCoef){mpars.shininess=m.specularCoef;}
if(m.mapDiffuse&&texturePath){create_texture(mpars,"map",m.mapDiffuse,m.mapDiffuseRepeat,m.mapDiffuseOffset,m.mapDiffuseWrap,m.mapDiffuseAnisotropy);}
if(m.mapLight&&texturePath){create_texture(mpars,"lightMap",m.mapLight,m.mapLightRepeat,m.mapLightOffset,m.mapLightWrap,m.mapLightAnisotropy);}
if(m.mapBump&&texturePath){create_texture(mpars,"bumpMap",m.mapBump,m.mapBumpRepeat,m.mapBumpOffset,m.mapBumpWrap,m.mapBumpAnisotropy);}
if(m.mapNormal&&texturePath){create_texture(mpars,"normalMap",m.mapNormal,m.mapNormalRepeat,m.mapNormalOffset,m.mapNormalWrap,m.mapNormalAnisotropy);}
if(m.mapSpecular&&texturePath){create_texture(mpars,"specularMap",m.mapSpecular,m.mapSpecularRepeat,m.mapSpecularOffset,m.mapSpecularWrap,m.mapSpecularAnisotropy);}
if(m.mapBumpScale){mpars.bumpScale=m.mapBumpScale;}
if(m.mapNormal){var shader=THREE.ShaderUtils.lib["normal"];var uniforms=THREE.UniformsUtils.clone(shader.uniforms);uniforms["tNormal"].value=mpars.normalMap;if(m.mapNormalFactor){uniforms["uNormalScale"].value.set(m.mapNormalFactor,m.mapNormalFactor);}
if(mpars.map){uniforms["tDiffuse"].value=mpars.map;uniforms["enableDiffuse"].value=true;}
if(mpars.specularMap){uniforms["tSpecular"].value=mpars.specularMap;uniforms["enableSpecular"].value=true;}
if(mpars.lightMap){uniforms["tAO"].value=mpars.lightMap;uniforms["enableAO"].value=true;}
uniforms["uDiffuseColor"].value.setHex(mpars.color);uniforms["uSpecularColor"].value.setHex(mpars.specular);uniforms["uAmbientColor"].value.setHex(mpars.ambient);uniforms["uShininess"].value=mpars.shininess;if(mpars.opacity!==undefined){uniforms["uOpacity"].value=mpars.opacity;}
var parameters={fragmentShader:shader.fragmentShader,vertexShader:shader.vertexShader,uniforms:uniforms,lights:true,fog:true};var material=new THREE.ShaderMaterial(parameters);}else{var material=new THREE[mtype](mpars);}
if(m.DbgName!==undefined)material.name=m.DbgName;return material;}};THREE.BinaryLoader=function(showStatus){THREE.Loader.call(this,showStatus);};THREE.BinaryLoader.prototype=Object.create(THREE.Loader.prototype);THREE.BinaryLoader.prototype.load=function(url,callback,texturePath,binaryPath){texturePath=texturePath?texturePath:this.extractUrlBase(url);binaryPath=binaryPath?binaryPath:this.extractUrlBase(url);var callbackProgress=this.showProgress?THREE.Loader.prototype.updateProgress:null;this.onLoadStart();this.loadAjaxJSON(this,url,callback,texturePath,binaryPath,callbackProgress);};THREE.BinaryLoader.prototype.loadAjaxJSON=function(context,url,callback,texturePath,binaryPath,callbackProgress){var xhr=new XMLHttpRequest();xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status==200||xhr.status==0){var json=JSON.parse(xhr.responseText);context.loadAjaxBuffers(json,callback,binaryPath,texturePath,callbackProgress);}else{console.error("THREE.BinaryLoader: Couldn't load ["+url+"] ["+xhr.status+"]");}}};xhr.open("GET",url,true);xhr.send(null);};THREE.BinaryLoader.prototype.loadAjaxBuffers=function(json,callback,binaryPath,texturePath,callbackProgress){var xhr=new XMLHttpRequest(),url=binaryPath+"/"+json.buffers;var length=0;xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status==200||xhr.status==0){var buffer=xhr.response;if(buffer===undefined)buffer=(new Uint8Array(xhr.responseBody)).buffer;THREE.BinaryLoader.prototype.createBinModel(buffer,callback,texturePath,json.materials);}else{console.error("THREE.BinaryLoader: Couldn't load ["+url+"] ["+xhr.status+"]");}}else if(xhr.readyState==3){if(callbackProgress){if(length==0){length=xhr.getResponseHeader("Content-Length");}
callbackProgress({total:length,loaded:xhr.responseText.length});}}else if(xhr.readyState==2){length=xhr.getResponseHeader("Content-Length");}};xhr.open("GET",url,true);xhr.responseType="arraybuffer";xhr.send(null);};THREE.BinaryLoader.prototype.createBinModel=function(data,callback,texturePath,materials){var Model=function(texturePath){var scope=this,currentOffset=0,md,normals=[],uvs=[],start_tri_flat,start_tri_smooth,start_tri_flat_uv,start_tri_smooth_uv,start_quad_flat,start_quad_smooth,start_quad_flat_uv,start_quad_smooth_uv,tri_size,quad_size,len_tri_flat,len_tri_smooth,len_tri_flat_uv,len_tri_smooth_uv,len_quad_flat,len_quad_smooth,len_quad_flat_uv,len_quad_smooth_uv;THREE.Geometry.call(this);THREE.Loader.prototype.initMaterials(scope,materials,texturePath);md=parseMetaData(data,currentOffset);currentOffset+=md.header_bytes;tri_size=md.vertex_index_bytes*3+md.material_index_bytes;quad_size=md.vertex_index_bytes*4+md.material_index_bytes;len_tri_flat=md.ntri_flat*(tri_size);len_tri_smooth=md.ntri_smooth*(tri_size+md.normal_index_bytes*3);len_tri_flat_uv=md.ntri_flat_uv*(tri_size+md.uv_index_bytes*3);len_tri_smooth_uv=md.ntri_smooth_uv*(tri_size+md.normal_index_bytes*3+md.uv_index_bytes*3);len_quad_flat=md.nquad_flat*(quad_size);len_quad_smooth=md.nquad_smooth*(quad_size+md.normal_index_bytes*4);len_quad_flat_uv=md.nquad_flat_uv*(quad_size+md.uv_index_bytes*4);len_quad_smooth_uv=md.nquad_smooth_uv*(quad_size+md.normal_index_bytes*4+md.uv_index_bytes*4);currentOffset+=init_vertices(currentOffset);currentOffset+=init_normals(currentOffset);currentOffset+=handlePadding(md.nnormals*3);currentOffset+=init_uvs(currentOffset);start_tri_flat=currentOffset;start_tri_smooth=start_tri_flat+len_tri_flat+handlePadding(md.ntri_flat*2);start_tri_flat_uv=start_tri_smooth+len_tri_smooth+handlePadding(md.ntri_smooth*2);start_tri_smooth_uv=start_tri_flat_uv+len_tri_flat_uv+handlePadding(md.ntri_flat_uv*2);start_quad_flat=start_tri_smooth_uv+len_tri_smooth_uv+handlePadding(md.ntri_smooth_uv*2);start_quad_smooth=start_quad_flat+len_quad_flat+handlePadding(md.nquad_flat*2);start_quad_flat_uv=start_quad_smooth+len_quad_smooth+handlePadding(md.nquad_smooth*2);start_quad_smooth_uv=start_quad_flat_uv+len_quad_flat_uv+handlePadding(md.nquad_flat_uv*2);init_triangles_flat_uv(start_tri_flat_uv);init_triangles_smooth_uv(start_tri_smooth_uv);init_quads_flat_uv(start_quad_flat_uv);init_quads_smooth_uv(start_quad_smooth_uv);init_triangles_flat(start_tri_flat);init_triangles_smooth(start_tri_smooth);init_quads_flat(start_quad_flat);init_quads_smooth(start_quad_smooth);this.computeCentroids();this.computeFaceNormals();if(THREE.Loader.prototype.hasNormals(this))this.computeTangents();function handlePadding(n){return(n%4)?(4-n%4):0;};function parseMetaData(data,offset){var metaData={'signature':parseString(data,offset,12),'header_bytes':parseUChar8(data,offset+12),'vertex_coordinate_bytes':parseUChar8(data,offset+13),'normal_coordinate_bytes':parseUChar8(data,offset+14),'uv_coordinate_bytes':parseUChar8(data,offset+15),'vertex_index_bytes':parseUChar8(data,offset+16),'normal_index_bytes':parseUChar8(data,offset+17),'uv_index_bytes':parseUChar8(data,offset+18),'material_index_bytes':parseUChar8(data,offset+19),'nvertices':parseUInt32(data,offset+20),'nnormals':parseUInt32(data,offset+20+4*1),'nuvs':parseUInt32(data,offset+20+4*2),'ntri_flat':parseUInt32(data,offset+20+4*3),'ntri_smooth':parseUInt32(data,offset+20+4*4),'ntri_flat_uv':parseUInt32(data,offset+20+4*5),'ntri_smooth_uv':parseUInt32(data,offset+20+4*6),'nquad_flat':parseUInt32(data,offset+20+4*7),'nquad_smooth':parseUInt32(data,offset+20+4*8),'nquad_flat_uv':parseUInt32(data,offset+20+4*9),'nquad_smooth_uv':parseUInt32(data,offset+20+4*10)};return metaData;};function parseString(data,offset,length){var charArray=new Uint8Array(data,offset,length);var text="";for(var i=0;i<length;i++){text+=String.fromCharCode(charArray[offset+i]);}
return text;};function parseUChar8(data,offset){var charArray=new Uint8Array(data,offset,1);return charArray[0];};function parseUInt32(data,offset){var intArray=new Uint32Array(data,offset,1);return intArray[0];};function init_vertices(start){var nElements=md.nvertices;var coordArray=new Float32Array(data,start,nElements*3);var i,x,y,z;for(i=0;i<nElements;i++){x=coordArray[i*3];y=coordArray[i*3+1];z=coordArray[i*3+2];vertex(scope,x,y,z);}
return nElements*3*Float32Array.BYTES_PER_ELEMENT;};function init_normals(start){var nElements=md.nnormals;if(nElements){var normalArray=new Int8Array(data,start,nElements*3);var i,x,y,z;for(i=0;i<nElements;i++){x=normalArray[i*3];y=normalArray[i*3+1];z=normalArray[i*3+2];normals.push(x/127,y/127,z/127);}}
return nElements*3*Int8Array.BYTES_PER_ELEMENT;};function init_uvs(start){var nElements=md.nuvs;if(nElements){var uvArray=new Float32Array(data,start,nElements*2);var i,u,v;for(i=0;i<nElements;i++){u=uvArray[i*2];v=uvArray[i*2+1];uvs.push(u,v);}}
return nElements*2*Float32Array.BYTES_PER_ELEMENT;};function init_uvs3(nElements,offset){var i,uva,uvb,uvc,u1,u2,u3,v1,v2,v3;var uvIndexBuffer=new Uint32Array(data,offset,3*nElements);for(i=0;i<nElements;i++){uva=uvIndexBuffer[i*3];uvb=uvIndexBuffer[i*3+1];uvc=uvIndexBuffer[i*3+2];u1=uvs[uva*2];v1=uvs[uva*2+1];u2=uvs[uvb*2];v2=uvs[uvb*2+1];u3=uvs[uvc*2];v3=uvs[uvc*2+1];uv3(scope.faceVertexUvs[0],u1,v1,u2,v2,u3,v3);}};function init_uvs4(nElements,offset){var i,uva,uvb,uvc,uvd,u1,u2,u3,u4,v1,v2,v3,v4;var uvIndexBuffer=new Uint32Array(data,offset,4*nElements);for(i=0;i<nElements;i++){uva=uvIndexBuffer[i*4];uvb=uvIndexBuffer[i*4+1];uvc=uvIndexBuffer[i*4+2];uvd=uvIndexBuffer[i*4+3];u1=uvs[uva*2];v1=uvs[uva*2+1];u2=uvs[uvb*2];v2=uvs[uvb*2+1];u3=uvs[uvc*2];v3=uvs[uvc*2+1];u4=uvs[uvd*2];v4=uvs[uvd*2+1];uv4(scope.faceVertexUvs[0],u1,v1,u2,v2,u3,v3,u4,v4);}};function init_faces3_flat(nElements,offsetVertices,offsetMaterials){var i,a,b,c,m;var vertexIndexBuffer=new Uint32Array(data,offsetVertices,3*nElements);var materialIndexBuffer=new Uint16Array(data,offsetMaterials,nElements);for(i=0;i<nElements;i++){a=vertexIndexBuffer[i*3];b=vertexIndexBuffer[i*3+1];c=vertexIndexBuffer[i*3+2];m=materialIndexBuffer[i];f3(scope,a,b,c,m);}};function init_faces4_flat(nElements,offsetVertices,offsetMaterials){var i,a,b,c,d,m;var vertexIndexBuffer=new Uint32Array(data,offsetVertices,4*nElements);var materialIndexBuffer=new Uint16Array(data,offsetMaterials,nElements);for(i=0;i<nElements;i++){a=vertexIndexBuffer[i*4];b=vertexIndexBuffer[i*4+1];c=vertexIndexBuffer[i*4+2];d=vertexIndexBuffer[i*4+3];m=materialIndexBuffer[i];f4(scope,a,b,c,d,m);}};function init_faces3_smooth(nElements,offsetVertices,offsetNormals,offsetMaterials){var i,a,b,c,m;var na,nb,nc;var vertexIndexBuffer=new Uint32Array(data,offsetVertices,3*nElements);var normalIndexBuffer=new Uint32Array(data,offsetNormals,3*nElements);var materialIndexBuffer=new Uint16Array(data,offsetMaterials,nElements);for(i=0;i<nElements;i++){a=vertexIndexBuffer[i*3];b=vertexIndexBuffer[i*3+1];c=vertexIndexBuffer[i*3+2];na=normalIndexBuffer[i*3];nb=normalIndexBuffer[i*3+1];nc=normalIndexBuffer[i*3+2];m=materialIndexBuffer[i];f3n(scope,normals,a,b,c,m,na,nb,nc);}};function init_faces4_smooth(nElements,offsetVertices,offsetNormals,offsetMaterials){var i,a,b,c,d,m;var na,nb,nc,nd;var vertexIndexBuffer=new Uint32Array(data,offsetVertices,4*nElements);var normalIndexBuffer=new Uint32Array(data,offsetNormals,4*nElements);var materialIndexBuffer=new Uint16Array(data,offsetMaterials,nElements);for(i=0;i<nElements;i++){a=vertexIndexBuffer[i*4];b=vertexIndexBuffer[i*4+1];c=vertexIndexBuffer[i*4+2];d=vertexIndexBuffer[i*4+3];na=normalIndexBuffer[i*4];nb=normalIndexBuffer[i*4+1];nc=normalIndexBuffer[i*4+2];nd=normalIndexBuffer[i*4+3];m=materialIndexBuffer[i];f4n(scope,normals,a,b,c,d,m,na,nb,nc,nd);}};function init_triangles_flat(start){var nElements=md.ntri_flat;if(nElements){var offsetMaterials=start+nElements*Uint32Array.BYTES_PER_ELEMENT*3;init_faces3_flat(nElements,start,offsetMaterials);}};function init_triangles_flat_uv(start){var nElements=md.ntri_flat_uv;if(nElements){var offsetUvs=start+nElements*Uint32Array.BYTES_PER_ELEMENT*3;var offsetMaterials=offsetUvs+nElements*Uint32Array.BYTES_PER_ELEMENT*3;init_faces3_flat(nElements,start,offsetMaterials);init_uvs3(nElements,offsetUvs);}};function init_triangles_smooth(start){var nElements=md.ntri_smooth;if(nElements){var offsetNormals=start+nElements*Uint32Array.BYTES_PER_ELEMENT*3;var offsetMaterials=offsetNormals+nElements*Uint32Array.BYTES_PER_ELEMENT*3;init_faces3_smooth(nElements,start,offsetNormals,offsetMaterials);}};function init_triangles_smooth_uv(start){var nElements=md.ntri_smooth_uv;if(nElements){var offsetNormals=start+nElements*Uint32Array.BYTES_PER_ELEMENT*3;var offsetUvs=offsetNormals+nElements*Uint32Array.BYTES_PER_ELEMENT*3;var offsetMaterials=offsetUvs+nElements*Uint32Array.BYTES_PER_ELEMENT*3;init_faces3_smooth(nElements,start,offsetNormals,offsetMaterials);init_uvs3(nElements,offsetUvs);}};function init_quads_flat(start){var nElements=md.nquad_flat;if(nElements){var offsetMaterials=start+nElements*Uint32Array.BYTES_PER_ELEMENT*4;init_faces4_flat(nElements,start,offsetMaterials);}};function init_quads_flat_uv(start){var nElements=md.nquad_flat_uv;if(nElements){var offsetUvs=start+nElements*Uint32Array.BYTES_PER_ELEMENT*4;var offsetMaterials=offsetUvs+nElements*Uint32Array.BYTES_PER_ELEMENT*4;init_faces4_flat(nElements,start,offsetMaterials);init_uvs4(nElements,offsetUvs);}};function init_quads_smooth(start){var nElements=md.nquad_smooth;if(nElements){var offsetNormals=start+nElements*Uint32Array.BYTES_PER_ELEMENT*4;var offsetMaterials=offsetNormals+nElements*Uint32Array.BYTES_PER_ELEMENT*4;init_faces4_smooth(nElements,start,offsetNormals,offsetMaterials);}};function init_quads_smooth_uv(start){var nElements=md.nquad_smooth_uv;if(nElements){var offsetNormals=start+nElements*Uint32Array.BYTES_PER_ELEMENT*4;var offsetUvs=offsetNormals+nElements*Uint32Array.BYTES_PER_ELEMENT*4;var offsetMaterials=offsetUvs+nElements*Uint32Array.BYTES_PER_ELEMENT*4;init_faces4_smooth(nElements,start,offsetNormals,offsetMaterials);init_uvs4(nElements,offsetUvs);}};};function vertex(scope,x,y,z){scope.vertices.push(new THREE.Vector3(x,y,z));};function f3(scope,a,b,c,mi){scope.faces.push(new THREE.Face3(a,b,c,null,null,mi));};function f4(scope,a,b,c,d,mi){scope.faces.push(new THREE.Face4(a,b,c,d,null,null,mi));};function f3n(scope,normals,a,b,c,mi,na,nb,nc){var nax=normals[na*3],nay=normals[na*3+1],naz=normals[na*3+2],nbx=normals[nb*3],nby=normals[nb*3+1],nbz=normals[nb*3+2],ncx=normals[nc*3],ncy=normals[nc*3+1],ncz=normals[nc*3+2];scope.faces.push(new THREE.Face3(a,b,c,[new THREE.Vector3(nax,nay,naz),new THREE.Vector3(nbx,nby,nbz),new THREE.Vector3(ncx,ncy,ncz)],null,mi));};function f4n(scope,normals,a,b,c,d,mi,na,nb,nc,nd){var nax=normals[na*3],nay=normals[na*3+1],naz=normals[na*3+2],nbx=normals[nb*3],nby=normals[nb*3+1],nbz=normals[nb*3+2],ncx=normals[nc*3],ncy=normals[nc*3+1],ncz=normals[nc*3+2],ndx=normals[nd*3],ndy=normals[nd*3+1],ndz=normals[nd*3+2];scope.faces.push(new THREE.Face4(a,b,c,d,[new THREE.Vector3(nax,nay,naz),new THREE.Vector3(nbx,nby,nbz),new THREE.Vector3(ncx,ncy,ncz),new THREE.Vector3(ndx,ndy,ndz)],null,mi));};function uv3(where,u1,v1,u2,v2,u3,v3){var uv=[];uv.push(new THREE.UV(u1,v1));uv.push(new THREE.UV(u2,v2));uv.push(new THREE.UV(u3,v3));where.push(uv);};function uv4(where,u1,v1,u2,v2,u3,v3,u4,v4){var uv=[];uv.push(new THREE.UV(u1,v1));uv.push(new THREE.UV(u2,v2));uv.push(new THREE.UV(u3,v3));uv.push(new THREE.UV(u4,v4));where.push(uv);};Model.prototype=Object.create(THREE.Geometry.prototype);callback(new Model(texturePath));};THREE.ImageLoader=function(){THREE.EventTarget.call(this);this.crossOrigin=null;};THREE.ImageLoader.prototype={constructor:THREE.ImageLoader,load:function(url,image){var scope=this;if(image===undefined)image=new Image();image.addEventListener('load',function(){scope.dispatchEvent({type:'load',content:image});},false);image.addEventListener('error',function(){scope.dispatchEvent({type:'error',message:'Couldn\'t load URL ['+url+']'});},false);if(scope.crossOrigin)image.crossOrigin=scope.crossOrigin;image.src=url;}}
THREE.JSONLoader=function(showStatus){THREE.Loader.call(this,showStatus);};THREE.JSONLoader.prototype=Object.create(THREE.Loader.prototype);THREE.JSONLoader.prototype.load=function(url,callback,texturePath){var scope=this;texturePath=texturePath?texturePath:this.extractUrlBase(url);this.onLoadStart();this.loadAjaxJSON(this,url,callback,texturePath);};THREE.JSONLoader.prototype.loadAjaxJSON=function(context,url,callback,texturePath,callbackProgress){var xhr=new XMLHttpRequest();var length=0;xhr.onreadystatechange=function(){if(xhr.readyState===xhr.DONE){if(xhr.status===200||xhr.status===0){if(xhr.responseText){var json=JSON.parse(xhr.responseText);context.createModel(json,callback,texturePath);}else{console.warn("THREE.JSONLoader: ["+url+"] seems to be unreachable or file there is empty");}
context.onLoadComplete();}else{console.error("THREE.JSONLoader: Couldn't load ["+url+"] ["+xhr.status+"]");}}else if(xhr.readyState===xhr.LOADING){if(callbackProgress){if(length===0){length=xhr.getResponseHeader("Content-Length");}
callbackProgress({total:length,loaded:xhr.responseText.length});}}else if(xhr.readyState===xhr.HEADERS_RECEIVED){length=xhr.getResponseHeader("Content-Length");}};xhr.open("GET",url,true);xhr.send(null);};THREE.JSONLoader.prototype.createModel=function(json,callback,texturePath){var scope=this,geometry=new THREE.Geometry(),scale=(json.scale!==undefined)?1.0/json.scale:1.0;this.initMaterials(geometry,json.materials,texturePath);parseModel(scale);parseSkin();parseMorphing(scale);geometry.computeCentroids();geometry.computeFaceNormals();if(this.hasNormals(geometry))geometry.computeTangents();function parseModel(scale){function isBitSet(value,position){return value&(1<<position);}
var i,j,fi,offset,zLength,nVertices,colorIndex,normalIndex,uvIndex,materialIndex,type,isQuad,hasMaterial,hasFaceUv,hasFaceVertexUv,hasFaceNormal,hasFaceVertexNormal,hasFaceColor,hasFaceVertexColor,vertex,face,color,normal,uvLayer,uvs,u,v,faces=json.faces,vertices=json.vertices,normals=json.normals,colors=json.colors,nUvLayers=0;for(i=0;i<json.uvs.length;i++){if(json.uvs[i].length)nUvLayers++;}
for(i=0;i<nUvLayers;i++){geometry.faceUvs[i]=[];geometry.faceVertexUvs[i]=[];}
offset=0;zLength=vertices.length;while(offset<zLength){vertex=new THREE.Vector3();vertex.x=vertices[offset++]*scale;vertex.y=vertices[offset++]*scale;vertex.z=vertices[offset++]*scale;geometry.vertices.push(vertex);}
offset=0;zLength=faces.length;while(offset<zLength){type=faces[offset++];isQuad=isBitSet(type,0);hasMaterial=isBitSet(type,1);hasFaceUv=isBitSet(type,2);hasFaceVertexUv=isBitSet(type,3);hasFaceNormal=isBitSet(type,4);hasFaceVertexNormal=isBitSet(type,5);hasFaceColor=isBitSet(type,6);hasFaceVertexColor=isBitSet(type,7);if(isQuad){face=new THREE.Face4();face.a=faces[offset++];face.b=faces[offset++];face.c=faces[offset++];face.d=faces[offset++];nVertices=4;}else{face=new THREE.Face3();face.a=faces[offset++];face.b=faces[offset++];face.c=faces[offset++];nVertices=3;}
if(hasMaterial){materialIndex=faces[offset++];face.materialIndex=materialIndex;}
fi=geometry.faces.length;if(hasFaceUv){for(i=0;i<nUvLayers;i++){uvLayer=json.uvs[i];uvIndex=faces[offset++];u=uvLayer[uvIndex*2];v=uvLayer[uvIndex*2+1];geometry.faceUvs[i][fi]=new THREE.UV(u,v);}}
if(hasFaceVertexUv){for(i=0;i<nUvLayers;i++){uvLayer=json.uvs[i];uvs=[];for(j=0;j<nVertices;j++){uvIndex=faces[offset++];u=uvLayer[uvIndex*2];v=uvLayer[uvIndex*2+1];uvs[j]=new THREE.UV(u,v);}
geometry.faceVertexUvs[i][fi]=uvs;}}
if(hasFaceNormal){normalIndex=faces[offset++]*3;normal=new THREE.Vector3();normal.x=normals[normalIndex++];normal.y=normals[normalIndex++];normal.z=normals[normalIndex];face.normal=normal;}
if(hasFaceVertexNormal){for(i=0;i<nVertices;i++){normalIndex=faces[offset++]*3;normal=new THREE.Vector3();normal.x=normals[normalIndex++];normal.y=normals[normalIndex++];normal.z=normals[normalIndex];face.vertexNormals.push(normal);}}
if(hasFaceColor){colorIndex=faces[offset++];color=new THREE.Color(colors[colorIndex]);face.color=color;}
if(hasFaceVertexColor){for(i=0;i<nVertices;i++){colorIndex=faces[offset++];color=new THREE.Color(colors[colorIndex]);face.vertexColors.push(color);}}
geometry.faces.push(face);}};function parseSkin(){var i,l,x,y,z,w,a,b,c,d;if(json.skinWeights){for(i=0,l=json.skinWeights.length;i<l;i+=2){x=json.skinWeights[i];y=json.skinWeights[i+1];z=0;w=0;geometry.skinWeights.push(new THREE.Vector4(x,y,z,w));}}
if(json.skinIndices){for(i=0,l=json.skinIndices.length;i<l;i+=2){a=json.skinIndices[i];b=json.skinIndices[i+1];c=0;d=0;geometry.skinIndices.push(new THREE.Vector4(a,b,c,d));}}
geometry.bones=json.bones;geometry.animation=json.animation;};function parseMorphing(scale){if(json.morphTargets!==undefined){var i,l,v,vl,dstVertices,srcVertices;for(i=0,l=json.morphTargets.length;i<l;i++){geometry.morphTargets[i]={};geometry.morphTargets[i].name=json.morphTargets[i].name;geometry.morphTargets[i].vertices=[];dstVertices=geometry.morphTargets[i].vertices;srcVertices=json.morphTargets[i].vertices;for(v=0,vl=srcVertices.length;v<vl;v+=3){var vertex=new THREE.Vector3();vertex.x=srcVertices[v]*scale;vertex.y=srcVertices[v+1]*scale;vertex.z=srcVertices[v+2]*scale;dstVertices.push(vertex);}}}
if(json.morphColors!==undefined){var i,l,c,cl,dstColors,srcColors,color;for(i=0,l=json.morphColors.length;i<l;i++){geometry.morphColors[i]={};geometry.morphColors[i].name=json.morphColors[i].name;geometry.morphColors[i].colors=[];dstColors=geometry.morphColors[i].colors;srcColors=json.morphColors[i].colors;for(c=0,cl=srcColors.length;c<cl;c+=3){color=new THREE.Color(0xffaa00);color.setRGB(srcColors[c],srcColors[c+1],srcColors[c+2]);dstColors.push(color);}}}};callback(geometry);};THREE.LoadingMonitor=function(){THREE.EventTarget.call(this);var scope=this;var loaded=0;var total=0;var onLoad=function(event){loaded++;scope.dispatchEvent({type:'progress',loaded:loaded,total:total});if(loaded===total){scope.dispatchEvent({type:'load'});}};this.add=function(loader){total++;loader.addEventListener('load',onLoad,false);};};THREE.GeometryLoader=function(){THREE.EventTarget.call(this);this.crossOrigin=null;this.path=null;};THREE.GeometryLoader.prototype={constructor:THREE.GeometryLoader,load:function(url){var scope=this;var geometry=null;if(scope.path===null){var parts=url.split('/');parts.pop();scope.path=(parts.length<1?'.':parts.join('/'));}
var xhr=new XMLHttpRequest();xhr.addEventListener('load',function(event){if(event.target.responseText){geometry=scope.parse(JSON.parse(event.target.responseText),monitor);}else{scope.dispatchEvent({type:'error',message:'Invalid file ['+url+']'});}},false);xhr.addEventListener('error',function(){scope.dispatchEvent({type:'error',message:'Couldn\'t load URL ['+url+']'});},false);xhr.open('GET',url,true);xhr.send(null);var monitor=new THREE.LoadingMonitor();monitor.addEventListener('load',function(event){scope.dispatchEvent({type:'load',content:geometry});});monitor.add(xhr);},parse:function(data,monitor){var scope=this;var geometry=new THREE.Geometry();var scale=(data.scale!==undefined)?1/data.scale:1;if(data.materials){geometry.materials=[];for(var i=0;i<data.materials.length;++i){var m=data.materials[i];function isPow2(n){var l=Math.log(n)/Math.LN2;return Math.floor(l)==l;}
function nearestPow2(n){var l=Math.log(n)/Math.LN2;return Math.pow(2,Math.round(l));}
function createTexture(where,name,sourceFile,repeat,offset,wrap){where[name]=new THREE.Texture();where[name].sourceFile=sourceFile;if(repeat){where[name].repeat.set(repeat[0],repeat[1]);if(repeat[0]!==1)where[name].wrapS=THREE.RepeatWrapping;if(repeat[1]!==1)where[name].wrapT=THREE.RepeatWrapping;}
if(offset){where[name].offset.set(offset[0],offset[1]);}
if(wrap){var wrapMap={"repeat":THREE.RepeatWrapping,"mirror":THREE.MirroredRepeatWrapping}
if(wrapMap[wrap[0]]!==undefined)where[name].wrapS=wrapMap[wrap[0]];if(wrapMap[wrap[1]]!==undefined)where[name].wrapT=wrapMap[wrap[1]];}
var texture=where[name];var loader=new THREE.ImageLoader();loader.addEventListener('load',function(event){var image=event.content;if(!isPow2(image.width)||!isPow2(image.height)){var width=nearestPow2(image.width);var height=nearestPow2(image.height);texture.image=document.createElement('canvas');texture.image.width=width;texture.image.height=height;texture.image.getContext('2d').drawImage(image,0,0,width,height);}else{texture.image=image;}
texture.needsUpdate=true;});loader.crossOrigin=scope.crossOrigin;loader.load(scope.path+'/'+sourceFile);if(monitor)monitor.add(loader);}
function rgb2hex(rgb){return(rgb[0]*255<<16)+(rgb[1]*255<<8)+rgb[2]*255;}
var mtype="MeshLambertMaterial";var mpars={color:0xeeeeee,opacity:1.0,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:false};if(m.shading){var shading=m.shading.toLowerCase();if(shading==="phong")mtype="MeshPhongMaterial";else if(shading==="basic")mtype="MeshBasicMaterial";}
if(m.blending!==undefined&&THREE[m.blending]!==undefined){mpars.blending=THREE[m.blending];}
if(m.transparent!==undefined||m.opacity<1.0){mpars.transparent=m.transparent;}
if(m.depthTest!==undefined){mpars.depthTest=m.depthTest;}
if(m.depthWrite!==undefined){mpars.depthWrite=m.depthWrite;}
if(m.vertexColors!==undefined){if(m.vertexColors=="face"){mpars.vertexColors=THREE.FaceColors;}else if(m.vertexColors){mpars.vertexColors=THREE.VertexColors;}}
if(m.colorDiffuse){mpars.color=rgb2hex(m.colorDiffuse);}else if(m.DbgColor){mpars.color=m.DbgColor;}
if(m.colorSpecular){mpars.specular=rgb2hex(m.colorSpecular);}
if(m.colorAmbient){mpars.ambient=rgb2hex(m.colorAmbient);}
if(m.transparency){mpars.opacity=m.transparency;}
if(m.specularCoef){mpars.shininess=m.specularCoef;}
if(m.visible!==undefined){mpars.visible=m.visible;}
if(m.flipSided!==undefined){mpars.side=THREE.BackSide;}
if(m.doubleSided!==undefined){mpars.side=THREE.DoubleSide;}
if(m.wireframe!==undefined){mpars.wireframe=m.wireframe;}
if(m.mapDiffuse){createTexture(mpars,"map",m.mapDiffuse,m.mapDiffuseRepeat,m.mapDiffuseOffset,m.mapDiffuseWrap);}
if(m.mapLight){createTexture(mpars,"lightMap",m.mapLight,m.mapLightRepeat,m.mapLightOffset,m.mapLightWrap);}
if(m.mapBump){createTexture(mpars,"bumpMap",m.mapBump,m.mapBumpRepeat,m.mapBumpOffset,m.mapBumpWrap);}
if(m.mapNormal){createTexture(mpars,"normalMap",m.mapNormal,m.mapNormalRepeat,m.mapNormalOffset,m.mapNormalWrap);}
if(m.mapSpecular){createTexture(mpars,"specularMap",m.mapSpecular,m.mapSpecularRepeat,m.mapSpecularOffset,m.mapSpecularWrap);}
if(m.mapNormal){var shader=THREE.ShaderUtils.lib["normal"];var uniforms=THREE.UniformsUtils.clone(shader.uniforms);uniforms["tNormal"].value=mpars.normalMap;if(m.mapNormalFactor){uniforms["uNormalScale"].value.set(m.mapNormalFactor,m.mapNormalFactor);}
if(mpars.map){uniforms["tDiffuse"].value=mpars.map;uniforms["enableDiffuse"].value=true;}
if(mpars.specularMap){uniforms["tSpecular"].value=mpars.specularMap;uniforms["enableSpecular"].value=true;}
if(mpars.lightMap){uniforms["tAO"].value=mpars.lightMap;uniforms["enableAO"].value=true;}
uniforms["uDiffuseColor"].value.setHex(mpars.color);uniforms["uSpecularColor"].value.setHex(mpars.specular);uniforms["uAmbientColor"].value.setHex(mpars.ambient);uniforms["uShininess"].value=mpars.shininess;if(mpars.opacity!==undefined){uniforms["uOpacity"].value=mpars.opacity;}
var parameters={fragmentShader:shader.fragmentShader,vertexShader:shader.vertexShader,uniforms:uniforms,lights:true,fog:true};var material=new THREE.ShaderMaterial(parameters);}else{var material=new THREE[mtype](mpars);}
if(m.DbgName!==undefined)material.name=m.DbgName;geometry.materials[i]=material;}}
function isBitSet(value,position){return value&(1<<position);}
var faces=data.faces;var vertices=data.vertices;var normals=data.normals;var colors=data.colors;var nUvLayers=0;if(data.uvs){for(var i=0;i<data.uvs.length;i++){if(data.uvs[i].length)nUvLayers++;}}
for(var i=0;i<nUvLayers;i++){geometry.faceUvs[i]=[];geometry.faceVertexUvs[i]=[];}
var offset=0;var zLength=vertices.length;while(offset<zLength){var vertex=new THREE.Vector3();vertex.x=vertices[offset++]*scale;vertex.y=vertices[offset++]*scale;vertex.z=vertices[offset++]*scale;geometry.vertices.push(vertex);}
offset=0;zLength=faces.length;while(offset<zLength){var type=faces[offset++];var isQuad=isBitSet(type,0);var hasMaterial=isBitSet(type,1);var hasFaceUv=isBitSet(type,2);var hasFaceVertexUv=isBitSet(type,3);var hasFaceNormal=isBitSet(type,4);var hasFaceVertexNormal=isBitSet(type,5);var hasFaceColor=isBitSet(type,6);var hasFaceVertexColor=isBitSet(type,7);if(isQuad){var face=new THREE.Face4();face.a=faces[offset++];face.b=faces[offset++];face.c=faces[offset++];face.d=faces[offset++];var nVertices=4;}else{var face=new THREE.Face3();face.a=faces[offset++];face.b=faces[offset++];face.c=faces[offset++];var nVertices=3;}
if(hasMaterial){var materialIndex=faces[offset++];face.materialIndex=materialIndex;}
var fi=geometry.faces.length;if(hasFaceUv){for(var i=0;i<nUvLayers;i++){var uvLayer=data.uvs[i];var uvIndex=faces[offset++];var u=uvLayer[uvIndex*2];var v=uvLayer[uvIndex*2+1];geometry.faceUvs[i][fi]=new THREE.UV(u,v);}}
if(hasFaceVertexUv){for(var i=0;i<nUvLayers;i++){var uvLayer=data.uvs[i];var uvs=[];for(var j=0;j<nVertices;j++){var uvIndex=faces[offset++];var u=uvLayer[uvIndex*2];var v=uvLayer[uvIndex*2+1];uvs[j]=new THREE.UV(u,v);}
geometry.faceVertexUvs[i][fi]=uvs;}}
if(hasFaceNormal){var normalIndex=faces[offset++]*3;var normal=new THREE.Vector3();normal.x=normals[normalIndex++];normal.y=normals[normalIndex++];normal.z=normals[normalIndex];face.normal=normal;}
if(hasFaceVertexNormal){for(i=0;i<nVertices;i++){var normalIndex=faces[offset++]*3;var normal=new THREE.Vector3();normal.x=normals[normalIndex++];normal.y=normals[normalIndex++];normal.z=normals[normalIndex];face.vertexNormals.push(normal);}}
if(hasFaceColor){var colorIndex=faces[offset++];face.color=new THREE.Color(colors[colorIndex]);}
if(hasFaceVertexColor){for(var i=0;i<nVertices;i++){var colorIndex=faces[offset++];face.vertexColors.push(new THREE.Color(colors[colorIndex]));}}
geometry.faces.push(face);}
if(data.skinWeights){for(var i=0,l=data.skinWeights.length;i<l;i+=2){var x=data.skinWeights[i];var y=data.skinWeights[i+1];var z=0;var w=0;geometry.skinWeights.push(new THREE.Vector4(x,y,z,w));}}
if(data.skinIndices){for(var i=0,l=data.skinIndices.length;i<l;i+=2){var a=data.skinIndices[i];var b=data.skinIndices[i+1];var c=0;var d=0;geometry.skinIndices.push(new THREE.Vector4(a,b,c,d));}}
geometry.bones=data.bones;geometry.animation=data.animation;if(data.morphTargets){for(var i=0,l=data.morphTargets.length;i<l;i++){geometry.morphTargets[i]={};geometry.morphTargets[i].name=data.morphTargets[i].name;geometry.morphTargets[i].vertices=[];var dstVertices=geometry.morphTargets[i].vertices;var srcVertices=data.morphTargets[i].vertices;for(var v=0,vl=srcVertices.length;v<vl;v+=3){var vertex=new THREE.Vector3();vertex.x=srcVertices[v]*scale;vertex.y=srcVertices[v+1]*scale;vertex.z=srcVertices[v+2]*scale;dstVertices.push(vertex);}}}
if(data.morphColors){for(var i=0,l=data.morphColors.length;i<l;i++){geometry.morphColors[i]={};geometry.morphColors[i].name=data.morphColors[i].name;geometry.morphColors[i].colors=[];var dstColors=geometry.morphColors[i].colors;var srcColors=data.morphColors[i].colors;for(var c=0,cl=srcColors.length;c<cl;c+=3){var color=new THREE.Color(0xffaa00);color.setRGB(srcColors[c],srcColors[c+1],srcColors[c+2]);dstColors.push(color);}}}
geometry.computeCentroids();geometry.computeFaceNormals();return geometry;}};THREE.SceneLoader=function(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){};this.callbackSync=function(){};this.callbackProgress=function(){};this.geometryHandlerMap={};this.addGeometryHandler("ascii",THREE.JSONLoader);this.addGeometryHandler("binary",THREE.BinaryLoader);};THREE.SceneLoader.prototype.constructor=THREE.SceneLoader;THREE.SceneLoader.prototype.load=function(url,callbackFinished){var scope=this;var xhr=new XMLHttpRequest();xhr.onreadystatechange=function(){if(xhr.readyState===4){if(xhr.status===200||xhr.status===0){var json=JSON.parse(xhr.responseText);scope.parse(json,callbackFinished,url);}else{console.error("THREE.SceneLoader: Couldn't load ["+url+"] ["+xhr.status+"]");}}};xhr.open("GET",url,true);xhr.send(null);};THREE.SceneLoader.prototype.addGeometryHandler=function(typeID,loaderClass){this.geometryHandlerMap[typeID]={"loaderClass":loaderClass};};THREE.SceneLoader.prototype.parse=function(json,callbackFinished,url){var scope=this;var urlBase=THREE.Loader.prototype.extractUrlBase(url);var dg,dm,dl,dc,df,dt,g,m,l,d,p,r,q,s,c,t,f,tt,pp,u,geometry,material,camera,fog,texture,images,light,counter_models,counter_textures,total_models,total_textures,result;var data=json;for(var typeID in this.geometryHandlerMap){var loaderClass=this.geometryHandlerMap[typeID]["loaderClass"];this.geometryHandlerMap[typeID]["loaderObject"]=new loaderClass();}
counter_models=0;counter_textures=0;result={scene:new THREE.Scene(),geometries:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{}};if(data.transform){var position=data.transform.position,rotation=data.transform.rotation,scale=data.transform.scale;if(position)
result.scene.position.set(position[0],position[1],position[2]);if(rotation)
result.scene.rotation.set(rotation[0],rotation[1],rotation[2]);if(scale)
result.scene.scale.set(scale[0],scale[1],scale[2]);if(position||rotation||scale){result.scene.updateMatrix();result.scene.updateMatrixWorld();}}
function get_url(source_url,url_type){if(url_type=="relativeToHTML"){return source_url;}else{return urlBase+"/"+source_url;}};function handle_objects(){handle_children(result.scene,data.objects);}
function handle_children(parent,children){for(var dd in children){if(result.objects[dd]===undefined){var o=children[dd];var object=null;if(o.geometry!==undefined){geometry=result.geometries[o.geometry];if(geometry){var hasNormals=false;material=result.materials[o.materials[0]];hasNormals=material instanceof THREE.ShaderMaterial;if(hasNormals){geometry.computeTangents();}
p=o.position;r=o.rotation;q=o.quaternion;s=o.scale;m=o.matrix;q=0;if(o.materials.length===0){material=new THREE.MeshFaceMaterial();}
if(o.materials.length>1){material=new THREE.MeshFaceMaterial();}
if(o.morph){object=new THREE.MorphAnimMesh(geometry,material);if(o.duration!==undefined){object.duration=o.duration;}
if(o.time!==undefined){object.time=o.time;}
if(o.mirroredLoop!==undefined){object.mirroredLoop=o.mirroredLoop;}
if(material.morphNormals){geometry.computeMorphNormals();}}else{object=new THREE.Mesh(geometry,material);}
object.name=dd;if(m){object.matrixAutoUpdate=false;object.matrix.set(m[0],m[1],m[2],m[3],m[4],m[5],m[6],m[7],m[8],m[9],m[10],m[11],m[12],m[13],m[14],m[15]);}else{object.position.set(p[0],p[1],p[2]);if(q){object.quaternion.set(q[0],q[1],q[2],q[3]);object.useQuaternion=true;}else{object.rotation.set(r[0],r[1],r[2]);}
object.scale.set(s[0],s[1],s[2]);}
object.visible=o.visible;object.castShadow=o.castShadow;object.receiveShadow=o.receiveShadow;parent.add(object);result.objects[dd]=object;}}else{p=o.position;r=o.rotation;q=o.quaternion;s=o.scale;q=0;object=new THREE.Object3D();object.name=dd;object.position.set(p[0],p[1],p[2]);if(q){object.quaternion.set(q[0],q[1],q[2],q[3]);object.useQuaternion=true;}else{object.rotation.set(r[0],r[1],r[2]);}
object.scale.set(s[0],s[1],s[2]);object.visible=(o.visible!==undefined)?o.visible:false;parent.add(object);result.objects[dd]=object;result.empties[dd]=object;}
if(object){if(o.properties!==undefined){for(var key in o.properties){var value=o.properties[key];object.properties[key]=value;}}
if(o.children!==undefined){handle_children(object,o.children);}}}}};function handle_mesh(geo,id){result.geometries[id]=geo;handle_objects();};function create_callback(id){return function(geo){handle_mesh(geo,id);counter_models-=1;scope.onLoadComplete();async_callback_gate();}};function create_callback_embed(id){return function(geo){result.geometries[id]=geo;}};function async_callback_gate(){var progress={totalModels:total_models,totalTextures:total_textures,loadedModels:total_models-counter_models,loadedTextures:total_textures-counter_textures};scope.callbackProgress(progress,result);scope.onLoadProgress();if(counter_models===0&&counter_textures===0){callbackFinished(result);}};var callbackTexture=function(count){counter_textures-=count;async_callback_gate();scope.onLoadComplete();};var generateTextureCallback=function(count){return function(){callbackTexture(count);};};for(dc in data.cameras){c=data.cameras[dc];if(c.type==="perspective"){camera=new THREE.PerspectiveCamera(c.fov,c.aspect,c.near,c.far);}else if(c.type==="ortho"){camera=new THREE.OrthographicCamera(c.left,c.right,c.top,c.bottom,c.near,c.far);}
p=c.position;t=c.target;u=c.up;camera.position.set(p[0],p[1],p[2]);camera.target=new THREE.Vector3(t[0],t[1],t[2]);if(u)camera.up.set(u[0],u[1],u[2]);result.cameras[dc]=camera;}
var hex,intensity;for(dl in data.lights){l=data.lights[dl];hex=(l.color!==undefined)?l.color:0xffffff;intensity=(l.intensity!==undefined)?l.intensity:1;if(l.type==="directional"){p=l.direction;light=new THREE.DirectionalLight(hex,intensity);light.position.set(p[0],p[1],p[2]);light.position.normalize();}else if(l.type==="point"){p=l.position;d=l.distance;light=new THREE.PointLight(hex,intensity,d);light.position.set(p[0],p[1],p[2]);}else if(l.type==="ambient"){light=new THREE.AmbientLight(hex);}
result.scene.add(light);result.lights[dl]=light;}
for(df in data.fogs){f=data.fogs[df];if(f.type==="linear"){fog=new THREE.Fog(0x000000,f.near,f.far);}else if(f.type==="exp2"){fog=new THREE.FogExp2(0x000000,f.density);}
c=f.color;fog.color.setRGB(c[0],c[1],c[2]);result.fogs[df]=fog;}
if(result.cameras&&data.defaults.camera){result.currentCamera=result.cameras[data.defaults.camera];}
if(result.fogs&&data.defaults.fog){result.scene.fog=result.fogs[data.defaults.fog];}
c=data.defaults.bgcolor;result.bgColor=new THREE.Color();result.bgColor.setRGB(c[0],c[1],c[2]);result.bgColorAlpha=data.defaults.bgalpha;for(dg in data.geometries){g=data.geometries[dg];if(g.type in this.geometryHandlerMap){counter_models+=1;scope.onLoadStart();}}
total_models=counter_models;for(dg in data.geometries){g=data.geometries[dg];if(g.type==="cube"){geometry=new THREE.CubeGeometry(g.width,g.height,g.depth,g.segmentsWidth,g.segmentsHeight,g.segmentsDepth,null,g.flipped,g.sides);result.geometries[dg]=geometry;}else if(g.type==="plane"){geometry=new THREE.PlaneGeometry(g.width,g.height,g.segmentsWidth,g.segmentsHeight);result.geometries[dg]=geometry;}else if(g.type==="sphere"){geometry=new THREE.SphereGeometry(g.radius,g.segmentsWidth,g.segmentsHeight);result.geometries[dg]=geometry;}else if(g.type==="cylinder"){geometry=new THREE.CylinderGeometry(g.topRad,g.botRad,g.height,g.radSegs,g.heightSegs);result.geometries[dg]=geometry;}else if(g.type==="torus"){geometry=new THREE.TorusGeometry(g.radius,g.tube,g.segmentsR,g.segmentsT);result.geometries[dg]=geometry;}else if(g.type==="icosahedron"){geometry=new THREE.IcosahedronGeometry(g.radius,g.subdivisions);result.geometries[dg]=geometry;}else if(g.type in this.geometryHandlerMap){var loaderParameters={};for(var parType in g){if(parType!=="type"&&parType!=="url"){loaderParameters[parType]=g[parType];}}
var loader=this.geometryHandlerMap[g.type]["loaderObject"];loader.load(get_url(g.url,data.urlBaseType),create_callback(dg),loaderParameters);}else if(g.type==="embedded"){var modelJson=data.embeds[g.id],texture_path="";modelJson.metadata=data.metadata;if(modelJson){var jsonLoader=this.geometryHandlerMap["ascii"]["loaderObject"];jsonLoader.createModel(modelJson,create_callback_embed(dg),texture_path);}}}
for(dt in data.textures){tt=data.textures[dt];if(tt.url instanceof Array){counter_textures+=tt.url.length;for(var n=0;n<tt.url.length;n++){scope.onLoadStart();}}else{counter_textures+=1;scope.onLoadStart();}}
total_textures=counter_textures;for(dt in data.textures){tt=data.textures[dt];if(tt.mapping!==undefined&&THREE[tt.mapping]!==undefined){tt.mapping=new THREE[tt.mapping]();}
if(tt.url instanceof Array){var count=tt.url.length;var url_array=[];for(var i=0;i<count;i++){url_array[i]=get_url(tt.url[i],data.urlBaseType);}
var isCompressed=url_array[0].endsWith(".dds");if(isCompressed){texture=THREE.ImageUtils.loadCompressedTextureCube(url_array,tt.mapping,generateTextureCallback(count));}else{texture=THREE.ImageUtils.loadTextureCube(url_array,tt.mapping,generateTextureCallback(count));}}else{var isCompressed=tt.url.toLowerCase().endsWith(".dds");var fullUrl=get_url(tt.url,data.urlBaseType);var textureCallback=generateTextureCallback(1);if(isCompressed){texture=THREE.ImageUtils.loadCompressedTexture(fullUrl,tt.mapping,textureCallback);}else{texture=THREE.ImageUtils.loadTexture(fullUrl,tt.mapping,textureCallback);}
if(THREE[tt.minFilter]!==undefined)
texture.minFilter=THREE[tt.minFilter];if(THREE[tt.magFilter]!==undefined)
texture.magFilter=THREE[tt.magFilter];if(tt.anisotropy)texture.anisotropy=tt.anisotropy;if(tt.repeat){texture.repeat.set(tt.repeat[0],tt.repeat[1]);if(tt.repeat[0]!==1)texture.wrapS=THREE.RepeatWrapping;if(tt.repeat[1]!==1)texture.wrapT=THREE.RepeatWrapping;}
if(tt.offset){texture.offset.set(tt.offset[0],tt.offset[1]);}
if(tt.wrap){var wrapMap={"repeat":THREE.RepeatWrapping,"mirror":THREE.MirroredRepeatWrapping}
if(wrapMap[tt.wrap[0]]!==undefined)texture.wrapS=wrapMap[tt.wrap[0]];if(wrapMap[tt.wrap[1]]!==undefined)texture.wrapT=wrapMap[tt.wrap[1]];}}
result.textures[dt]=texture;}
for(dm in data.materials){m=data.materials[dm];for(pp in m.parameters){if(pp==="envMap"||pp==="map"||pp==="lightMap"||pp==="bumpMap"){m.parameters[pp]=result.textures[m.parameters[pp]];}else if(pp==="shading"){m.parameters[pp]=(m.parameters[pp]==="flat")?THREE.FlatShading:THREE.SmoothShading;}else if(pp==="side"){if(m.parameters[pp]=="double"){m.parameters[pp]=THREE.DoubleSide;}else if(m.parameters[pp]=="back"){m.parameters[pp]=THREE.BackSide;}else{m.parameters[pp]=THREE.FrontSide;}}else if(pp==="blending"){m.parameters[pp]=m.parameters[pp]in THREE?THREE[m.parameters[pp]]:THREE.NormalBlending;}else if(pp==="combine"){m.parameters[pp]=(m.parameters[pp]=="MixOperation")?THREE.MixOperation:THREE.MultiplyOperation;}else if(pp==="vertexColors"){if(m.parameters[pp]=="face"){m.parameters[pp]=THREE.FaceColors;}else if(m.parameters[pp]){m.parameters[pp]=THREE.VertexColors;}}else if(pp==="wrapRGB"){var v3=m.parameters[pp];m.parameters[pp]=new THREE.Vector3(v3[0],v3[1],v3[2]);}}
if(m.parameters.opacity!==undefined&&m.parameters.opacity<1.0){m.parameters.transparent=true;}
if(m.parameters.normalMap){var shader=THREE.ShaderUtils.lib["normal"];var uniforms=THREE.UniformsUtils.clone(shader.uniforms);var diffuse=m.parameters.color;var specular=m.parameters.specular;var ambient=m.parameters.ambient;var shininess=m.parameters.shininess;uniforms["tNormal"].value=result.textures[m.parameters.normalMap];if(m.parameters.normalScale){uniforms["uNormalScale"].value.set(m.parameters.normalScale[0],m.parameters.normalScale[1]);}
if(m.parameters.map){uniforms["tDiffuse"].value=m.parameters.map;uniforms["enableDiffuse"].value=true;}
if(m.parameters.envMap){uniforms["tCube"].value=m.parameters.envMap;uniforms["enableReflection"].value=true;uniforms["uReflectivity"].value=m.parameters.reflectivity;}
if(m.parameters.lightMap){uniforms["tAO"].value=m.parameters.lightMap;uniforms["enableAO"].value=true;}
if(m.parameters.specularMap){uniforms["tSpecular"].value=result.textures[m.parameters.specularMap];uniforms["enableSpecular"].value=true;}
if(m.parameters.displacementMap){uniforms["tDisplacement"].value=result.textures[m.parameters.displacementMap];uniforms["enableDisplacement"].value=true;uniforms["uDisplacementBias"].value=m.parameters.displacementBias;uniforms["uDisplacementScale"].value=m.parameters.displacementScale;}
uniforms["uDiffuseColor"].value.setHex(diffuse);uniforms["uSpecularColor"].value.setHex(specular);uniforms["uAmbientColor"].value.setHex(ambient);uniforms["uShininess"].value=shininess;if(m.parameters.opacity){uniforms["uOpacity"].value=m.parameters.opacity;}
var parameters={fragmentShader:shader.fragmentShader,vertexShader:shader.vertexShader,uniforms:uniforms,lights:true,fog:true};material=new THREE.ShaderMaterial(parameters);}else{material=new THREE[m.type](m.parameters);}
result.materials[dm]=material;}
handle_objects();scope.callbackSync(result);async_callback_gate();};THREE.TextureLoader=function(){THREE.EventTarget.call(this);this.crossOrigin=null;};THREE.TextureLoader.prototype={constructor:THREE.TextureLoader,load:function(url){var scope=this;var image=new Image();image.addEventListener('load',function(){var texture=new THREE.Texture(image);texture.needsUpdate=true;scope.dispatchEvent({type:'load',content:texture});},false);image.addEventListener('error',function(){scope.dispatchEvent({type:'error',message:'Couldn\'t load URL ['+url+']'});},false);if(scope.crossOrigin)image.crossOrigin=scope.crossOrigin;image.src=url;}}
THREE.Material=function(){THREE.MaterialLibrary.push(this);this.id=THREE.MaterialIdCount++;this.name='';this.side=THREE.FrontSide;this.opacity=1;this.transparent=false;this.blending=THREE.NormalBlending;this.blendSrc=THREE.SrcAlphaFactor;this.blendDst=THREE.OneMinusSrcAlphaFactor;this.blendEquation=THREE.AddEquation;this.depthTest=true;this.depthWrite=true;this.polygonOffset=false;this.polygonOffsetFactor=0;this.polygonOffsetUnits=0;this.alphaTest=0;this.overdraw=false;this.visible=true;this.needsUpdate=true;};THREE.Material.prototype.setValues=function(values){if(values===undefined)return;for(var key in values){var newValue=values[key];if(newValue===undefined){console.warn('THREE.Material: \''+key+'\' parameter is undefined.');continue;}
if(key in this){var currentValue=this[key];if(currentValue instanceof THREE.Color&&newValue instanceof THREE.Color){currentValue.copy(newValue);}else if(currentValue instanceof THREE.Color&&typeof(newValue)==="number"){currentValue.setHex(newValue);}else if(currentValue instanceof THREE.Vector3&&newValue instanceof THREE.Vector3){currentValue.copy(newValue);}else{this[key]=newValue;}}}};THREE.Material.prototype.clone=function(material){if(material===undefined)material=new THREE.Material();material.name=this.name;material.side=this.side;material.opacity=this.opacity;material.transparent=this.transparent;material.blending=this.blending;material.blendSrc=this.blendSrc;material.blendDst=this.blendDst;material.blendEquation=this.blendEquation;material.depthTest=this.depthTest;material.depthWrite=this.depthWrite;material.polygonOffset=this.polygonOffset;material.polygonOffsetFactor=this.polygonOffsetFactor;material.polygonOffsetUnits=this.polygonOffsetUnits;material.alphaTest=this.alphaTest;material.overdraw=this.overdraw;material.visible=this.visible;return material;};THREE.Material.prototype.deallocate=function(){var index=THREE.MaterialLibrary.indexOf(this);if(index!==-1)THREE.MaterialLibrary.splice(index,1);};THREE.MaterialIdCount=0;THREE.MaterialLibrary=[];THREE.LineBasicMaterial=function(parameters){THREE.Material.call(this);this.color=new THREE.Color(0xffffff);this.linewidth=1;this.linecap='round';this.linejoin='round';this.vertexColors=false;this.fog=true;this.setValues(parameters);};THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.LineBasicMaterial.prototype.clone=function(){var material=new THREE.LineBasicMaterial();THREE.Material.prototype.clone.call(this,material);material.color.copy(this.color);material.linewidth=this.linewidth;material.linecap=this.linecap;material.linejoin=this.linejoin;material.vertexColors=this.vertexColors;material.fog=this.fog;return material;};THREE.MeshBasicMaterial=function(parameters){THREE.Material.call(this);this.color=new THREE.Color(0xffffff);this.map=null;this.lightMap=null;this.specularMap=null;this.envMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=0.98;this.fog=true;this.shading=THREE.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap='round';this.wireframeLinejoin='round';this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.setValues(parameters);};THREE.MeshBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshBasicMaterial.prototype.clone=function(){var material=new THREE.MeshBasicMaterial();THREE.Material.prototype.clone.call(this,material);material.color.copy(this.color);material.map=this.map;material.lightMap=this.lightMap;material.specularMap=this.specularMap;material.envMap=this.envMap;material.combine=this.combine;material.reflectivity=this.reflectivity;material.refractionRatio=this.refractionRatio;material.fog=this.fog;material.shading=this.shading;material.wireframe=this.wireframe;material.wireframeLinewidth=this.wireframeLinewidth;material.wireframeLinecap=this.wireframeLinecap;material.wireframeLinejoin=this.wireframeLinejoin;material.vertexColors=this.vertexColors;material.skinning=this.skinning;material.morphTargets=this.morphTargets;return material;};THREE.MeshLambertMaterial=function(parameters){THREE.Material.call(this);this.color=new THREE.Color(0xffffff);this.ambient=new THREE.Color(0xffffff);this.emissive=new THREE.Color(0x000000);this.wrapAround=false;this.wrapRGB=new THREE.Vector3(1,1,1);this.map=null;this.lightMap=null;this.specularMap=null;this.envMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=0.98;this.fog=true;this.shading=THREE.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap='round';this.wireframeLinejoin='round';this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(parameters);};THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshLambertMaterial.prototype.clone=function(){var material=new THREE.MeshLambertMaterial();THREE.Material.prototype.clone.call(this,material);material.color.copy(this.color);material.ambient.copy(this.ambient);material.emissive.copy(this.emissive);material.wrapAround=this.wrapAround;material.wrapRGB.copy(this.wrapRGB);material.map=this.map;material.lightMap=this.lightMap;material.specularMap=this.specularMap;material.envMap=this.envMap;material.combine=this.combine;material.reflectivity=this.reflectivity;material.refractionRatio=this.refractionRatio;material.fog=this.fog;material.shading=this.shading;material.wireframe=this.wireframe;material.wireframeLinewidth=this.wireframeLinewidth;material.wireframeLinecap=this.wireframeLinecap;material.wireframeLinejoin=this.wireframeLinejoin;material.vertexColors=this.vertexColors;material.skinning=this.skinning;material.morphTargets=this.morphTargets;material.morphNormals=this.morphNormals;return material;};THREE.MeshPhongMaterial=function(parameters){THREE.Material.call(this);this.color=new THREE.Color(0xffffff);this.ambient=new THREE.Color(0xffffff);this.emissive=new THREE.Color(0x000000);this.specular=new THREE.Color(0x111111);this.shininess=30;this.metal=false;this.perPixel=false;this.wrapAround=false;this.wrapRGB=new THREE.Vector3(1,1,1);this.map=null;this.lightMap=null;this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new THREE.Vector2(1,1);this.specularMap=null;this.envMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=0.98;this.fog=true;this.shading=THREE.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap='round';this.wireframeLinejoin='round';this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(parameters);};THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshPhongMaterial.prototype.clone=function(){var material=new THREE.MeshPhongMaterial();THREE.Material.prototype.clone.call(this,material);material.color.copy(this.color);material.ambient.copy(this.ambient);material.emissive.copy(this.emissive);material.specular.copy(this.specular);material.shininess=this.shininess;material.metal=this.metal;material.perPixel=this.perPixel;material.wrapAround=this.wrapAround;material.wrapRGB.copy(this.wrapRGB);material.map=this.map;material.lightMap=this.lightMap;material.bumpMap=this.bumpMap;material.bumpScale=this.bumpScale;material.normalMap=this.normalMap;material.normalScale.copy(this.normalScale);material.specularMap=this.specularMap;material.envMap=this.envMap;material.combine=this.combine;material.reflectivity=this.reflectivity;material.refractionRatio=this.refractionRatio;material.fog=this.fog;material.shading=this.shading;material.wireframe=this.wireframe;material.wireframeLinewidth=this.wireframeLinewidth;material.wireframeLinecap=this.wireframeLinecap;material.wireframeLinejoin=this.wireframeLinejoin;material.vertexColors=this.vertexColors;material.skinning=this.skinning;material.morphTargets=this.morphTargets;material.morphNormals=this.morphNormals;return material;};THREE.MeshDepthMaterial=function(parameters){THREE.Material.call(this);this.wireframe=false;this.wireframeLinewidth=1;this.setValues(parameters);};THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshDepthMaterial.prototype.clone=function(){var material=new THREE.LineBasicMaterial();THREE.Material.prototype.clone.call(this,material);material.wireframe=this.wireframe;material.wireframeLinewidth=this.wireframeLinewidth;return material;};THREE.MeshNormalMaterial=function(parameters){THREE.Material.call(this,parameters);this.shading=THREE.FlatShading;this.wireframe=false;this.wireframeLinewidth=1;this.setValues(parameters);};THREE.MeshNormalMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshNormalMaterial.prototype.clone=function(){var material=new THREE.MeshNormalMaterial();THREE.Material.prototype.clone.call(this,material);material.shading=this.shading;material.wireframe=this.wireframe;material.wireframeLinewidth=this.wireframeLinewidth;return material;};THREE.MeshFaceMaterial=function(){};THREE.MeshFaceMaterial.prototype.clone=function(){return new THREE.MeshFaceMaterial();};THREE.ParticleBasicMaterial=function(parameters){THREE.Material.call(this);this.color=new THREE.Color(0xffffff);this.map=null;this.size=1;this.sizeAttenuation=true;this.vertexColors=false;this.fog=true;this.setValues(parameters);};THREE.ParticleBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.ParticleBasicMaterial.prototype.clone=function(){var material=new THREE.ParticleBasicMaterial();THREE.Material.prototype.clone.call(this,material);material.color.copy(this.color);material.map=this.map;material.size=this.size;material.sizeAttenuation=this.sizeAttenuation;material.vertexColors=this.vertexColors;material.fog=this.fog;return material;};THREE.ParticleCanvasMaterial=function(parameters){THREE.Material.call(this);this.color=new THREE.Color(0xffffff);this.program=function(context,color){};this.setValues(parameters);};THREE.ParticleCanvasMaterial.prototype=Object.create(THREE.Material.prototype);THREE.ParticleCanvasMaterial.prototype.clone=function(){var material=new THREE.ParticleCanvasMaterial();THREE.Material.prototype.clone.call(this,material);material.color.copy(this.color);material.program=this.program;return material;};THREE.ParticleDOMMaterial=function(element){this.element=element;};THREE.ParticleDOMMaterial.prototype.clone=function(){return new THREE.ParticleDOMMaterial(this.element);};THREE.ShaderMaterial=function(parameters){THREE.Material.call(this);this.fragmentShader="void main() {}";this.vertexShader="void main() {}";this.uniforms={};this.defines={};this.attributes=null;this.shading=THREE.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.fog=false;this.lights=false;this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(parameters);};THREE.ShaderMaterial.prototype=Object.create(THREE.Material.prototype);THREE.ShaderMaterial.prototype.clone=function(){var material=new THREE.ShaderMaterial();THREE.Material.prototype.clone.call(this,material);material.fragmentShader=this.fragmentShader;material.vertexShader=this.vertexShader;material.uniforms=this.uniforms;material.attributes=this.attributes;material.defines=this.defines;material.shading=this.shading;material.wireframe=this.wireframe;material.wireframeLinewidth=this.wireframeLinewidth;material.fog=this.fog;material.lights=this.lights;material.vertexColors=this.vertexColors;material.skinning=this.skinning;material.morphTargets=this.morphTargets;material.morphNormals=this.morphNormals;return material;};THREE.Texture=function(image,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy){THREE.TextureLibrary.push(this);this.id=THREE.TextureIdCount++;this.image=image;this.mapping=mapping!==undefined?mapping:new THREE.UVMapping();this.wrapS=wrapS!==undefined?wrapS:THREE.ClampToEdgeWrapping;this.wrapT=wrapT!==undefined?wrapT:THREE.ClampToEdgeWrapping;this.magFilter=magFilter!==undefined?magFilter:THREE.LinearFilter;this.minFilter=minFilter!==undefined?minFilter:THREE.LinearMipMapLinearFilter;this.anisotropy=anisotropy!==undefined?anisotropy:1;this.format=format!==undefined?format:THREE.RGBAFormat;this.type=type!==undefined?type:THREE.UnsignedByteType;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.generateMipmaps=true;this.premultiplyAlpha=false;this.flipY=true;this.needsUpdate=false;this.onUpdate=null;};THREE.Texture.prototype={constructor:THREE.Texture,clone:function(){var texture=new THREE.Texture();texture.image=this.image;texture.mapping=this.mapping;texture.wrapS=this.wrapS;texture.wrapT=this.wrapT;texture.magFilter=this.magFilter;texture.minFilter=this.minFilter;texture.anisotropy=this.anisotropy;texture.format=this.format;texture.type=this.type;texture.offset.copy(this.offset);texture.repeat.copy(this.repeat);texture.generateMipmaps=this.generateMipmaps;texture.premultiplyAlpha=this.premultiplyAlpha;texture.flipY=this.flipY;return texture;},deallocate:function(){var index=THREE.TextureLibrary.indexOf(this);if(index!==-1)THREE.TextureLibrary.splice(index,1);}};THREE.TextureIdCount=0;THREE.TextureLibrary=[];THREE.CompressedTexture=function(mipmaps,width,height,format,type,mapping,wrapS,wrapT,magFilter,minFilter){THREE.Texture.call(this,null,mapping,wrapS,wrapT,magFilter,minFilter,format,type);this.image={width:width,height:height};this.mipmaps=mipmaps;};THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype);THREE.CompressedTexture.prototype.clone=function(){var texture=new THREE.CompressedTexture();texture.image=this.image;texture.mipmaps=this.mipmaps;texture.format=this.format;texture.type=this.type;texture.mapping=this.mapping;texture.wrapS=this.wrapS;texture.wrapT=this.wrapT;texture.magFilter=this.magFilter;texture.minFilter=this.minFilter;texture.anisotropy=this.anisotropy;texture.offset.copy(this.offset);texture.repeat.copy(this.repeat);return texture;};THREE.DataTexture=function(data,width,height,format,type,mapping,wrapS,wrapT,magFilter,minFilter){THREE.Texture.call(this,null,mapping,wrapS,wrapT,magFilter,minFilter,format,type);this.image={data:data,width:width,height:height};};THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype);THREE.DataTexture.prototype.clone=function(){var clonedTexture=new THREE.DataTexture(this.image.data,this.image.width,this.image.height,this.format,this.type,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter);clonedTexture.offset.copy(this.offset);clonedTexture.repeat.copy(this.repeat);return clonedTexture;};THREE.Particle=function(material){THREE.Object3D.call(this);this.material=material;};THREE.Particle.prototype=Object.create(THREE.Object3D.prototype);THREE.Particle.prototype.clone=function(object){if(object===undefined)object=new THREE.Particle(this.material);THREE.Object3D.prototype.clone.call(this,object);return object;};THREE.ParticleSystem=function(geometry,material){THREE.Object3D.call(this);this.geometry=geometry;this.material=(material!==undefined)?material:new THREE.ParticleBasicMaterial({color:Math.random()*0xffffff});this.sortParticles=false;if(this.geometry){if(this.geometry.boundingSphere===null){this.geometry.computeBoundingSphere();}
this.boundRadius=geometry.boundingSphere.radius;}
this.frustumCulled=false;};THREE.ParticleSystem.prototype=Object.create(THREE.Object3D.prototype);THREE.ParticleSystem.prototype.clone=function(object){if(object===undefined)object=new THREE.ParticleSystem(this.geometry,this.material);object.sortParticles=this.sortParticles;THREE.Object3D.prototype.clone.call(this,object);return object;};THREE.Line=function(geometry,material,type){THREE.Object3D.call(this);this.geometry=geometry;this.material=(material!==undefined)?material:new THREE.LineBasicMaterial({color:Math.random()*0xffffff});this.type=(type!==undefined)?type:THREE.LineStrip;if(this.geometry){if(!this.geometry.boundingSphere){this.geometry.computeBoundingSphere();}}};THREE.LineStrip=0;THREE.LinePieces=1;THREE.Line.prototype=Object.create(THREE.Object3D.prototype);THREE.Line.prototype.clone=function(object){if(object===undefined)object=new THREE.Line(this.geometry,this.material,this.type);THREE.Object3D.prototype.clone.call(this,object);return object;};THREE.Mesh=function(geometry,material){THREE.Object3D.call(this);this.geometry=geometry;this.material=(material!==undefined)?material:new THREE.MeshBasicMaterial({color:Math.random()*0xffffff,wireframe:true});if(this.geometry){if(this.geometry.boundingSphere===null){this.geometry.computeBoundingSphere();}
this.boundRadius=geometry.boundingSphere.radius;if(this.geometry.morphTargets.length){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var m=0;m<this.geometry.morphTargets.length;m++){this.morphTargetInfluences.push(0);this.morphTargetDictionary[this.geometry.morphTargets[m].name]=m;}}}}
THREE.Mesh.prototype=Object.create(THREE.Object3D.prototype);THREE.Mesh.prototype.getMorphTargetIndexByName=function(name){if(this.morphTargetDictionary[name]!==undefined){return this.morphTargetDictionary[name];}
console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+name+" does not exist. Returning 0.");return 0;};THREE.Mesh.prototype.clone=function(object){if(object===undefined)object=new THREE.Mesh(this.geometry,this.material);THREE.Object3D.prototype.clone.call(this,object);return object;};THREE.Bone=function(belongsToSkin){THREE.Object3D.call(this);this.skin=belongsToSkin;this.skinMatrix=new THREE.Matrix4();};THREE.Bone.prototype=Object.create(THREE.Object3D.prototype);THREE.Bone.prototype.update=function(parentSkinMatrix,forceUpdate){if(this.matrixAutoUpdate){forceUpdate|=this.updateMatrix();}
if(forceUpdate||this.matrixWorldNeedsUpdate){if(parentSkinMatrix){this.skinMatrix.multiply(parentSkinMatrix,this.matrix);}else{this.skinMatrix.copy(this.matrix);}
this.matrixWorldNeedsUpdate=false;forceUpdate=true;}
var child,i,l=this.children.length;for(i=0;i<l;i++){this.children[i].update(this.skinMatrix,forceUpdate);}};THREE.SkinnedMesh=function(geometry,material,useVertexTexture){THREE.Mesh.call(this,geometry,material);this.useVertexTexture=useVertexTexture!==undefined?useVertexTexture:true;this.identityMatrix=new THREE.Matrix4();this.bones=[];this.boneMatrices=[];var b,bone,gbone,p,q,s;if(this.geometry.bones!==undefined){for(b=0;b<this.geometry.bones.length;b++){gbone=this.geometry.bones[b];p=gbone.pos;q=gbone.rotq;s=gbone.scl;bone=this.addBone();bone.name=gbone.name;bone.position.set(p[0],p[1],p[2]);bone.quaternion.set(q[0],q[1],q[2],q[3]);bone.useQuaternion=true;if(s!==undefined){bone.scale.set(s[0],s[1],s[2]);}else{bone.scale.set(1,1,1);}}
for(b=0;b<this.bones.length;b++){gbone=this.geometry.bones[b];bone=this.bones[b];if(gbone.parent===-1){this.add(bone);}else{this.bones[gbone.parent].add(bone);}}
var nBones=this.bones.length;if(this.useVertexTexture){var size;if(nBones>256)
size=64;else if(nBones>64)
size=32;else if(nBones>16)
size=16;else
size=8;this.boneTextureWidth=size;this.boneTextureHeight=size;this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4);this.boneTexture=new THREE.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,THREE.RGBAFormat,THREE.FloatType);this.boneTexture.minFilter=THREE.NearestFilter;this.boneTexture.magFilter=THREE.NearestFilter;this.boneTexture.generateMipmaps=false;this.boneTexture.flipY=false;}else{this.boneMatrices=new Float32Array(16*nBones);}
this.pose();}};THREE.SkinnedMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.SkinnedMesh.prototype.addBone=function(bone){if(bone===undefined){bone=new THREE.Bone(this);}
this.bones.push(bone);return bone;};THREE.SkinnedMesh.prototype.updateMatrixWorld=function(force){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||force){if(this.parent){this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix);}else{this.matrixWorld.copy(this.matrix);}
this.matrixWorldNeedsUpdate=false;force=true;}
for(var i=0,l=this.children.length;i<l;i++){var child=this.children[i];if(child instanceof THREE.Bone){child.update(this.identityMatrix,false);}else{child.updateMatrixWorld(true);}}
if(this.boneInverses==undefined){this.boneInverses=[];for(var b=0,bl=this.bones.length;b<bl;b++){var inverse=new THREE.Matrix4();inverse.getInverse(this.bones[b].skinMatrix);this.boneInverses.push(inverse);}}
for(var b=0,bl=this.bones.length;b<bl;b++){THREE.SkinnedMesh.offsetMatrix.multiply(this.bones[b].skinMatrix,this.boneInverses[b]);THREE.SkinnedMesh.offsetMatrix.flattenToArrayOffset(this.boneMatrices,b*16);}
if(this.useVertexTexture){this.boneTexture.needsUpdate=true;}};THREE.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(true);for(var i=0;i<this.geometry.skinIndices.length;i++){var sw=this.geometry.skinWeights[i];var scale=1.0/sw.lengthManhattan();if(scale!==Infinity){sw.multiplyScalar(scale);}else{sw.set(1);}}};THREE.SkinnedMesh.prototype.clone=function(object){if(object===undefined)object=new THREE.SkinnedMesh(this.geometry,this.material,this.useVertexTexture);THREE.Mesh.prototype.clone.call(this,object);return object;};THREE.SkinnedMesh.offsetMatrix=new THREE.Matrix4();THREE.MorphAnimMesh=function(geometry,material){THREE.Mesh.call(this,geometry,material);this.duration=1000;this.mirroredLoop=false;this.time=0;this.lastKeyframe=0;this.currentKeyframe=0;this.direction=1;this.directionBackwards=false;this.setFrameRange(0,this.geometry.morphTargets.length-1);};THREE.MorphAnimMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.MorphAnimMesh.prototype.setFrameRange=function(start,end){this.startKeyframe=start;this.endKeyframe=end;this.length=this.endKeyframe-this.startKeyframe+1;};THREE.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1;this.directionBackwards=false;};THREE.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1;this.directionBackwards=true;};THREE.MorphAnimMesh.prototype.parseAnimations=function(){var geometry=this.geometry;if(!geometry.animations)geometry.animations={};var firstAnimation,animations=geometry.animations;var pattern=/([a-z]+)(\d+)/;for(var i=0,il=geometry.morphTargets.length;i<il;i++){var morph=geometry.morphTargets[i];var parts=morph.name.match(pattern);if(parts&&parts.length>1){var label=parts[1];var num=parts[2];if(!animations[label])animations[label]={start:Infinity,end:-Infinity};var animation=animations[label];if(i<animation.start)animation.start=i;if(i>animation.end)animation.end=i;if(!firstAnimation)firstAnimation=label;}}
geometry.firstAnimation=firstAnimation;};THREE.MorphAnimMesh.prototype.setAnimationLabel=function(label,start,end){if(!this.geometry.animations)this.geometry.animations={};this.geometry.animations[label]={start:start,end:end};};THREE.MorphAnimMesh.prototype.playAnimation=function(label,fps){var animation=this.geometry.animations[label];if(animation){this.setFrameRange(animation.start,animation.end);this.duration=1000*((animation.end-animation.start)/fps);this.time=0;}else{console.warn("animation["+label+"] undefined");}};THREE.MorphAnimMesh.prototype.updateAnimation=function(delta){var frameTime=this.duration/this.length;this.time+=this.direction*delta;if(this.mirroredLoop){if(this.time>this.duration||this.time<0){this.direction*=-1;if(this.time>this.duration){this.time=this.duration;this.directionBackwards=true;}
if(this.time<0){this.time=0;this.directionBackwards=false;}}}else{this.time=this.time%this.duration;if(this.time<0)this.time+=this.duration;}
var keyframe=this.startKeyframe+THREE.Math.clamp(Math.floor(this.time/frameTime),0,this.length-1);if(keyframe!==this.currentKeyframe){this.morphTargetInfluences[this.lastKeyframe]=0;this.morphTargetInfluences[this.currentKeyframe]=1;this.morphTargetInfluences[keyframe]=0;this.lastKeyframe=this.currentKeyframe;this.currentKeyframe=keyframe;}
var mix=(this.time%frameTime)/frameTime;if(this.directionBackwards){mix=1-mix;}
this.morphTargetInfluences[this.currentKeyframe]=mix;this.morphTargetInfluences[this.lastKeyframe]=1-mix;};THREE.MorphAnimMesh.prototype.clone=function(object){if(object===undefined)object=new THREE.MorphAnimMesh(this.geometry,this.material);object.duration=this.duration;object.mirroredLoop=this.mirroredLoop;object.time=this.time;object.lastKeyframe=this.lastKeyframe;object.currentKeyframe=this.currentKeyframe;object.direction=this.direction;object.directionBackwards=this.directionBackwards;THREE.Mesh.prototype.clone.call(this,object);return object;};THREE.Ribbon=function(geometry,material){THREE.Object3D.call(this);this.geometry=geometry;this.material=material;};THREE.Ribbon.prototype=Object.create(THREE.Object3D.prototype);THREE.Ribbon.prototype.clone=function(object){if(object===undefined)object=new THREE.Ribbon(this.geometry,this.material);THREE.Object3D.prototype.clone.call(this,object);return object;};THREE.LOD=function(){THREE.Object3D.call(this);this.LODs=[];};THREE.LOD.prototype=Object.create(THREE.Object3D.prototype);THREE.LOD.prototype.addLevel=function(object3D,visibleAtDistance){if(visibleAtDistance===undefined){visibleAtDistance=0;}
visibleAtDistance=Math.abs(visibleAtDistance);for(var l=0;l<this.LODs.length;l++){if(visibleAtDistance<this.LODs[l].visibleAtDistance){break;}}
this.LODs.splice(l,0,{visibleAtDistance:visibleAtDistance,object3D:object3D});this.add(object3D);};THREE.LOD.prototype.update=function(camera){if(this.LODs.length>1){camera.matrixWorldInverse.getInverse(camera.matrixWorld);var inverse=camera.matrixWorldInverse;var distance=-(inverse.elements[2]*this.matrixWorld.elements[12]+inverse.elements[6]*this.matrixWorld.elements[13]+inverse.elements[10]*this.matrixWorld.elements[14]+inverse.elements[14]);this.LODs[0].object3D.visible=true;for(var l=1;l<this.LODs.length;l++){if(distance>=this.LODs[l].visibleAtDistance){this.LODs[l-1].object3D.visible=false;this.LODs[l].object3D.visible=true;}else{break;}}
for(;l<this.LODs.length;l++){this.LODs[l].object3D.visible=false;}}};THREE.LOD.prototype.clone=function(){};THREE.Sprite=function(parameters){THREE.Object3D.call(this);this.color=(parameters.color!==undefined)?new THREE.Color(parameters.color):new THREE.Color(0xffffff);this.map=(parameters.map!==undefined)?parameters.map:new THREE.Texture();this.blending=(parameters.blending!==undefined)?parameters.blending:THREE.NormalBlending;this.blendSrc=parameters.blendSrc!==undefined?parameters.blendSrc:THREE.SrcAlphaFactor;this.blendDst=parameters.blendDst!==undefined?parameters.blendDst:THREE.OneMinusSrcAlphaFactor;this.blendEquation=parameters.blendEquation!==undefined?parameters.blendEquation:THREE.AddEquation;this.useScreenCoordinates=(parameters.useScreenCoordinates!==undefined)?parameters.useScreenCoordinates:true;this.mergeWith3D=(parameters.mergeWith3D!==undefined)?parameters.mergeWith3D:!this.useScreenCoordinates;this.affectedByDistance=(parameters.affectedByDistance!==undefined)?parameters.affectedByDistance:!this.useScreenCoordinates;this.scaleByViewport=(parameters.scaleByViewport!==undefined)?parameters.scaleByViewport:!this.affectedByDistance;this.alignment=(parameters.alignment instanceof THREE.Vector2)?parameters.alignment:THREE.SpriteAlignment.center;this.rotation3d=this.rotation;this.rotation=0;this.opacity=1;this.uvOffset=new THREE.Vector2(0,0);this.uvScale=new THREE.Vector2(1,1);};THREE.Sprite.prototype=Object.create(THREE.Object3D.prototype);THREE.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position);this.rotation3d.set(0,0,this.rotation);this.matrix.setRotationFromEuler(this.rotation3d);if(this.scale.x!==1||this.scale.y!==1){this.matrix.scale(this.scale);this.boundRadiusScale=Math.max(this.scale.x,this.scale.y);}
this.matrixWorldNeedsUpdate=true;};THREE.Sprite.prototype.clone=function(object){if(object===undefined)object=new THREE.Sprite({});object.color.copy(this.color);object.map=this.map;object.blending=this.blending;object.useScreenCoordinates=this.useScreenCoordinates;object.mergeWith3D=this.mergeWith3D;object.affectedByDistance=this.affectedByDistance;object.scaleByViewport=this.scaleByViewport;object.alignment=this.alignment;object.rotation3d.copy(this.rotation3d);object.rotation=this.rotation;object.opacity=this.opacity;object.uvOffset.copy(this.uvOffset);object.uvScale.copy(this.uvScale);THREE.Object3D.prototype.clone.call(this,object);return object;};THREE.SpriteAlignment={};THREE.SpriteAlignment.topLeft=new THREE.Vector2(1,-1);THREE.SpriteAlignment.topCenter=new THREE.Vector2(0,-1);THREE.SpriteAlignment.topRight=new THREE.Vector2(-1,-1);THREE.SpriteAlignment.centerLeft=new THREE.Vector2(1,0);THREE.SpriteAlignment.center=new THREE.Vector2(0,0);THREE.SpriteAlignment.centerRight=new THREE.Vector2(-1,0);THREE.SpriteAlignment.bottomLeft=new THREE.Vector2(1,1);THREE.SpriteAlignment.bottomCenter=new THREE.Vector2(0,1);THREE.SpriteAlignment.bottomRight=new THREE.Vector2(-1,1);THREE.Scene=function(){THREE.Object3D.call(this);this.fog=null;this.overrideMaterial=null;this.matrixAutoUpdate=false;this.__objects=[];this.__lights=[];this.__objectsAdded=[];this.__objectsRemoved=[];};THREE.Scene.prototype=Object.create(THREE.Object3D.prototype);THREE.Scene.prototype.__addObject=function(object){if(object instanceof THREE.Light){if(this.__lights.indexOf(object)===-1){this.__lights.push(object);}
if(object.target&&object.target.parent===undefined){this.add(object.target);}}else if(!(object instanceof THREE.Camera||object instanceof THREE.Bone)){if(this.__objects.indexOf(object)===-1){this.__objects.push(object);this.__objectsAdded.push(object);var i=this.__objectsRemoved.indexOf(object);if(i!==-1){this.__objectsRemoved.splice(i,1);}}}
for(var c=0;c<object.children.length;c++){this.__addObject(object.children[c]);}};THREE.Scene.prototype.__removeObject=function(object){if(object instanceof THREE.Light){var i=this.__lights.indexOf(object);if(i!==-1){this.__lights.splice(i,1);}}else if(!(object instanceof THREE.Camera)){var i=this.__objects.indexOf(object);if(i!==-1){this.__objects.splice(i,1);this.__objectsRemoved.push(object);var ai=this.__objectsAdded.indexOf(object);if(ai!==-1){this.__objectsAdded.splice(ai,1);}}}
for(var c=0;c<object.children.length;c++){this.__removeObject(object.children[c]);}};THREE.Fog=function(hex,near,far){this.color=new THREE.Color(hex);this.near=(near!==undefined)?near:1;this.far=(far!==undefined)?far:1000;};THREE.FogExp2=function(hex,density){this.color=new THREE.Color(hex);this.density=(density!==undefined)?density:0.00025;};THREE.CanvasRenderer=function(parameters){console.log('THREE.CanvasRenderer',THREE.REVISION);parameters=parameters||{};var _this=this,_renderData,_elements,_lights,_projector=new THREE.Projector(),_canvas=parameters.canvas!==undefined?parameters.canvas:document.createElement('canvas'),_canvasWidth,_canvasHeight,_canvasWidthHalf,_canvasHeightHalf,_context=_canvas.getContext('2d'),_clearColor=new THREE.Color(0x000000),_clearOpacity=0,_contextGlobalAlpha=1,_contextGlobalCompositeOperation=0,_contextStrokeStyle=null,_contextFillStyle=null,_contextLineWidth=null,_contextLineCap=null,_contextLineJoin=null,_v1,_v2,_v3,_v4,_v5=new THREE.RenderableVertex(),_v6=new THREE.RenderableVertex(),_v1x,_v1y,_v2x,_v2y,_v3x,_v3y,_v4x,_v4y,_v5x,_v5y,_v6x,_v6y,_color=new THREE.Color(),_color1=new THREE.Color(),_color2=new THREE.Color(),_color3=new THREE.Color(),_color4=new THREE.Color(),_diffuseColor=new THREE.Color(),_emissiveColor=new THREE.Color(),_patterns={},_imagedatas={},_near,_far,_image,_uvs,_uv1x,_uv1y,_uv2x,_uv2y,_uv3x,_uv3y,_clipRect=new THREE.Rectangle(),_clearRect=new THREE.Rectangle(),_bboxRect=new THREE.Rectangle(),_enableLighting=false,_ambientLight=new THREE.Color(),_directionalLights=new THREE.Color(),_pointLights=new THREE.Color(),_pi2=Math.PI*2,_vector3=new THREE.Vector3(),_pixelMap,_pixelMapContext,_pixelMapImage,_pixelMapData,_gradientMap,_gradientMapContext,_gradientMapQuality=16;_pixelMap=document.createElement('canvas');_pixelMap.width=_pixelMap.height=2;_pixelMapContext=_pixelMap.getContext('2d');_pixelMapContext.fillStyle='rgba(0,0,0,1)';_pixelMapContext.fillRect(0,0,2,2);_pixelMapImage=_pixelMapContext.getImageData(0,0,2,2);_pixelMapData=_pixelMapImage.data;_gradientMap=document.createElement('canvas');_gradientMap.width=_gradientMap.height=_gradientMapQuality;_gradientMapContext=_gradientMap.getContext('2d');_gradientMapContext.translate(-_gradientMapQuality/2,-_gradientMapQuality/2);_gradientMapContext.scale(_gradientMapQuality,_gradientMapQuality);_gradientMapQuality--;this.domElement=_canvas;this.autoClear=true;this.sortObjects=true;this.sortElements=true;this.info={render:{vertices:0,faces:0}}
this.setSize=function(width,height){_canvasWidth=width;_canvasHeight=height;_canvasWidthHalf=Math.floor(_canvasWidth/2);_canvasHeightHalf=Math.floor(_canvasHeight/2);_canvas.width=_canvasWidth;_canvas.height=_canvasHeight;_clipRect.set(-_canvasWidthHalf,-_canvasHeightHalf,_canvasWidthHalf,_canvasHeightHalf);_clearRect.set(-_canvasWidthHalf,-_canvasHeightHalf,_canvasWidthHalf,_canvasHeightHalf);_contextGlobalAlpha=1;_contextGlobalCompositeOperation=0;_contextStrokeStyle=null;_contextFillStyle=null;_contextLineWidth=null;_contextLineCap=null;_contextLineJoin=null;};this.setClearColor=function(color,opacity){_clearColor.copy(color);_clearOpacity=opacity!==undefined?opacity:1;_clearRect.set(-_canvasWidthHalf,-_canvasHeightHalf,_canvasWidthHalf,_canvasHeightHalf);};this.setClearColorHex=function(hex,opacity){_clearColor.setHex(hex);_clearOpacity=opacity!==undefined?opacity:1;_clearRect.set(-_canvasWidthHalf,-_canvasHeightHalf,_canvasWidthHalf,_canvasHeightHalf);};this.getMaxAnisotropy=function(){return 0;};this.clear=function(){_context.setTransform(1,0,0,-1,_canvasWidthHalf,_canvasHeightHalf);if(_clearRect.isEmpty()===false){_clearRect.minSelf(_clipRect);_clearRect.inflate(2);if(_clearOpacity<1){_context.clearRect(Math.floor(_clearRect.getX()),Math.floor(_clearRect.getY()),Math.floor(_clearRect.getWidth()),Math.floor(_clearRect.getHeight()));}
if(_clearOpacity>0){setBlending(THREE.NormalBlending);setOpacity(1);setFillStyle('rgba('+Math.floor(_clearColor.r*255)+','+Math.floor(_clearColor.g*255)+','+Math.floor(_clearColor.b*255)+','+_clearOpacity+')');_context.fillRect(Math.floor(_clearRect.getX()),Math.floor(_clearRect.getY()),Math.floor(_clearRect.getWidth()),Math.floor(_clearRect.getHeight()));}
_clearRect.empty();}};this.render=function(scene,camera){if(camera instanceof THREE.Camera===false){console.error('THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.');return;}
var e,el,element,material;this.autoClear===true?this.clear():_context.setTransform(1,0,0,-1,_canvasWidthHalf,_canvasHeightHalf);_this.info.render.vertices=0;_this.info.render.faces=0;_renderData=_projector.projectScene(scene,camera,this.sortObjects,this.sortElements);_elements=_renderData.elements;_lights=_renderData.lights;_enableLighting=_lights.length>0;if(_enableLighting===true){calculateLights();}
for(e=0,el=_elements.length;e<el;e++){element=_elements[e];material=element.material;if(material===undefined||material.visible===false)continue;_bboxRect.empty();if(element instanceof THREE.RenderableParticle){_v1=element;_v1.x*=_canvasWidthHalf;_v1.y*=_canvasHeightHalf;renderParticle(_v1,element,material,scene);}else if(element instanceof THREE.RenderableLine){_v1=element.v1;_v2=element.v2;_v1.positionScreen.x*=_canvasWidthHalf;_v1.positionScreen.y*=_canvasHeightHalf;_v2.positionScreen.x*=_canvasWidthHalf;_v2.positionScreen.y*=_canvasHeightHalf;_bboxRect.addPoint(_v1.positionScreen.x,_v1.positionScreen.y);_bboxRect.addPoint(_v2.positionScreen.x,_v2.positionScreen.y);if(_clipRect.intersects(_bboxRect)===true){renderLine(_v1,_v2,element,material,scene);}}else if(element instanceof THREE.RenderableFace3){_v1=element.v1;_v2=element.v2;_v3=element.v3;_v1.positionScreen.x*=_canvasWidthHalf;_v1.positionScreen.y*=_canvasHeightHalf;_v2.positionScreen.x*=_canvasWidthHalf;_v2.positionScreen.y*=_canvasHeightHalf;_v3.positionScreen.x*=_canvasWidthHalf;_v3.positionScreen.y*=_canvasHeightHalf;if(material.overdraw===true){expand(_v1.positionScreen,_v2.positionScreen);expand(_v2.positionScreen,_v3.positionScreen);expand(_v3.positionScreen,_v1.positionScreen);}
_bboxRect.add3Points(_v1.positionScreen.x,_v1.positionScreen.y,_v2.positionScreen.x,_v2.positionScreen.y,_v3.positionScreen.x,_v3.positionScreen.y);if(_clipRect.intersects(_bboxRect)===true){renderFace3(_v1,_v2,_v3,0,1,2,element,material,scene);}}else if(element instanceof THREE.RenderableFace4){_v1=element.v1;_v2=element.v2;_v3=element.v3;_v4=element.v4;_v1.positionScreen.x*=_canvasWidthHalf;_v1.positionScreen.y*=_canvasHeightHalf;_v2.positionScreen.x*=_canvasWidthHalf;_v2.positionScreen.y*=_canvasHeightHalf;_v3.positionScreen.x*=_canvasWidthHalf;_v3.positionScreen.y*=_canvasHeightHalf;_v4.positionScreen.x*=_canvasWidthHalf;_v4.positionScreen.y*=_canvasHeightHalf;_v5.positionScreen.copy(_v2.positionScreen);_v6.positionScreen.copy(_v4.positionScreen);if(material.overdraw===true){expand(_v1.positionScreen,_v2.positionScreen);expand(_v2.positionScreen,_v4.positionScreen);expand(_v4.positionScreen,_v1.positionScreen);expand(_v3.positionScreen,_v5.positionScreen);expand(_v3.positionScreen,_v6.positionScreen);}
_bboxRect.addPoint(_v1.positionScreen.x,_v1.positionScreen.y);_bboxRect.addPoint(_v2.positionScreen.x,_v2.positionScreen.y);_bboxRect.addPoint(_v3.positionScreen.x,_v3.positionScreen.y);_bboxRect.addPoint(_v4.positionScreen.x,_v4.positionScreen.y);if(_clipRect.intersects(_bboxRect)===true){renderFace4(_v1,_v2,_v3,_v4,_v5,_v6,element,material,scene);}}
_clearRect.addRectangle(_bboxRect);}
_context.setTransform(1,0,0,1,0,0);function calculateLights(){_ambientLight.setRGB(0,0,0);_directionalLights.setRGB(0,0,0);_pointLights.setRGB(0,0,0);for(var l=0,ll=_lights.length;l<ll;l++){var light=_lights[l];var lightColor=light.color;if(light instanceof THREE.AmbientLight){_ambientLight.r+=lightColor.r;_ambientLight.g+=lightColor.g;_ambientLight.b+=lightColor.b;}else if(light instanceof THREE.DirectionalLight){_directionalLights.r+=lightColor.r;_directionalLights.g+=lightColor.g;_directionalLights.b+=lightColor.b;}else if(light instanceof THREE.PointLight){_pointLights.r+=lightColor.r;_pointLights.g+=lightColor.g;_pointLights.b+=lightColor.b;}}}
function calculateLight(position,normal,color){for(var l=0,ll=_lights.length;l<ll;l++){var light=_lights[l];var lightColor=light.color;if(light instanceof THREE.DirectionalLight){var lightPosition=light.matrixWorld.getPosition().normalize();var amount=normal.dot(lightPosition);if(amount<=0)continue;amount*=light.intensity;color.r+=lightColor.r*amount;color.g+=lightColor.g*amount;color.b+=lightColor.b*amount;}else if(light instanceof THREE.PointLight){var lightPosition=light.matrixWorld.getPosition();var amount=normal.dot(_vector3.sub(lightPosition,position).normalize());if(amount<=0)continue;amount*=light.distance==0?1:1-Math.min(position.distanceTo(lightPosition)/light.distance,1);if(amount==0)continue;amount*=light.intensity;color.r+=lightColor.r*amount;color.g+=lightColor.g*amount;color.b+=lightColor.b*amount;}}}
function renderParticle(v1,element,material,scene){setOpacity(material.opacity);setBlending(material.blending);var width,height,scaleX,scaleY,bitmap,bitmapWidth,bitmapHeight;if(material instanceof THREE.ParticleBasicMaterial){if(material.map===null){scaleX=element.object.scale.x;scaleY=element.object.scale.y;scaleX*=element.scale.x*_canvasWidthHalf;scaleY*=element.scale.y*_canvasHeightHalf;_bboxRect.set(v1.x-scaleX,v1.y-scaleY,v1.x+scaleX,v1.y+scaleY);if(_clipRect.intersects(_bboxRect)===false){return;}
setFillStyle(material.color.getContextStyle());_context.save();_context.translate(v1.x,v1.y);_context.rotate(-element.rotation);_context.scale(scaleX,scaleY);_context.fillRect(-1,-1,2,2);_context.restore();}else{bitmap=material.map.image;bitmapWidth=bitmap.width>>1;bitmapHeight=bitmap.height>>1;scaleX=element.scale.x*_canvasWidthHalf;scaleY=element.scale.y*_canvasHeightHalf;width=scaleX*bitmapWidth;height=scaleY*bitmapHeight;_bboxRect.set(v1.x-width,v1.y-height,v1.x+width,v1.y+height);if(_clipRect.intersects(_bboxRect)===false){return;}
_context.save();_context.translate(v1.x,v1.y);_context.rotate(-element.rotation);_context.scale(scaleX,-scaleY);_context.translate(-bitmapWidth,-bitmapHeight);_context.drawImage(bitmap,0,0);_context.restore();}}else if(material instanceof THREE.ParticleCanvasMaterial){width=element.scale.x*_canvasWidthHalf;height=element.scale.y*_canvasHeightHalf;_bboxRect.set(v1.x-width,v1.y-height,v1.x+width,v1.y+height);if(_clipRect.intersects(_bboxRect)===false){return;}
setStrokeStyle(material.color.getContextStyle());setFillStyle(material.color.getContextStyle());_context.save();_context.translate(v1.x,v1.y);_context.rotate(-element.rotation);_context.scale(width,height);material.program(_context);_context.restore();}}
function renderLine(v1,v2,element,material,scene){setOpacity(material.opacity);setBlending(material.blending);_context.beginPath();_context.moveTo(v1.positionScreen.x,v1.positionScreen.y);_context.lineTo(v2.positionScreen.x,v2.positionScreen.y);if(material instanceof THREE.LineBasicMaterial){setLineWidth(material.linewidth);setLineCap(material.linecap);setLineJoin(material.linejoin);setStrokeStyle(material.color.getContextStyle());_context.stroke();_bboxRect.inflate(material.linewidth*2);}}
function renderFace3(v1,v2,v3,uv1,uv2,uv3,element,material,scene){_this.info.render.vertices+=3;_this.info.render.faces++;setOpacity(material.opacity);setBlending(material.blending);_v1x=v1.positionScreen.x;_v1y=v1.positionScreen.y;_v2x=v2.positionScreen.x;_v2y=v2.positionScreen.y;_v3x=v3.positionScreen.x;_v3y=v3.positionScreen.y;drawTriangle(_v1x,_v1y,_v2x,_v2y,_v3x,_v3y);if((material instanceof THREE.MeshLambertMaterial||material instanceof THREE.MeshPhongMaterial)&&material.map===null&&material.map===null){_diffuseColor.copy(material.color);_emissiveColor.copy(material.emissive);if(material.vertexColors===THREE.FaceColors){_diffuseColor.r*=element.color.r;_diffuseColor.g*=element.color.g;_diffuseColor.b*=element.color.b;}
if(_enableLighting===true){if(material.wireframe===false&&material.shading==THREE.SmoothShading&&element.vertexNormalsLength==3){_color1.r=_color2.r=_color3.r=_ambientLight.r;_color1.g=_color2.g=_color3.g=_ambientLight.g;_color1.b=_color2.b=_color3.b=_ambientLight.b;calculateLight(element.v1.positionWorld,element.vertexNormalsWorld[0],_color1);calculateLight(element.v2.positionWorld,element.vertexNormalsWorld[1],_color2);calculateLight(element.v3.positionWorld,element.vertexNormalsWorld[2],_color3);_color1.r=_color1.r*_diffuseColor.r+_emissiveColor.r;_color1.g=_color1.g*_diffuseColor.g+_emissiveColor.g;_color1.b=_color1.b*_diffuseColor.b+_emissiveColor.b;_color2.r=_color2.r*_diffuseColor.r+_emissiveColor.r;_color2.g=_color2.g*_diffuseColor.g+_emissiveColor.g;_color2.b=_color2.b*_diffuseColor.b+_emissiveColor.b;_color3.r=_color3.r*_diffuseColor.r+_emissiveColor.r;_color3.g=_color3.g*_diffuseColor.g+_emissiveColor.g;_color3.b=_color3.b*_diffuseColor.b+_emissiveColor.b;_color4.r=(_color2.r+_color3.r)*0.5;_color4.g=(_color2.g+_color3.g)*0.5;_color4.b=(_color2.b+_color3.b)*0.5;_image=getGradientTexture(_color1,_color2,_color3,_color4);clipImage(_v1x,_v1y,_v2x,_v2y,_v3x,_v3y,0,0,1,0,0,1,_image);}else{_color.r=_ambientLight.r;_color.g=_ambientLight.g;_color.b=_ambientLight.b;calculateLight(element.centroidWorld,element.normalWorld,_color);_color.r=_color.r*_diffuseColor.r+_emissiveColor.r;_color.g=_color.g*_diffuseColor.g+_emissiveColor.g;_color.b=_color.b*_diffuseColor.b+_emissiveColor.b;material.wireframe===true?strokePath(_color,material.wireframeLinewidth,material.wireframeLinecap,material.wireframeLinejoin):fillPath(_color);}}else{material.wireframe===true?strokePath(material.color,material.wireframeLinewidth,material.wireframeLinecap,material.wireframeLinejoin):fillPath(material.color);}}else if(material instanceof THREE.MeshBasicMaterial||material instanceof THREE.MeshLambertMaterial||material instanceof THREE.MeshPhongMaterial){if(material.map!==null){if(material.map.mapping instanceof THREE.UVMapping){_uvs=element.uvs[0];patternPath(_v1x,_v1y,_v2x,_v2y,_v3x,_v3y,_uvs[uv1].u,_uvs[uv1].v,_uvs[uv2].u,_uvs[uv2].v,_uvs[uv3].u,_uvs[uv3].v,material.map);}}else if(material.envMap!==null){if(material.envMap.mapping instanceof THREE.SphericalReflectionMapping){var cameraMatrix=camera.matrixWorldInverse;_vector3.copy(element.vertexNormalsWorld[uv1]);_uv1x=(_vector3.x*cameraMatrix.elements[0]+_vector3.y*cameraMatrix.elements[4]+_vector3.z*cameraMatrix.elements[8])*0.5+0.5;_uv1y=(_vector3.x*cameraMatrix.elements[1]+_vector3.y*cameraMatrix.elements[5]+_vector3.z*cameraMatrix.elements[9])*0.5+0.5;_vector3.copy(element.vertexNormalsWorld[uv2]);_uv2x=(_vector3.x*cameraMatrix.elements[0]+_vector3.y*cameraMatrix.elements[4]+_vector3.z*cameraMatrix.elements[8])*0.5+0.5;_uv2y=(_vector3.x*cameraMatrix.elements[1]+_vector3.y*cameraMatrix.elements[5]+_vector3.z*cameraMatrix.elements[9])*0.5+0.5;_vector3.copy(element.vertexNormalsWorld[uv3]);_uv3x=(_vector3.x*cameraMatrix.elements[0]+_vector3.y*cameraMatrix.elements[4]+_vector3.z*cameraMatrix.elements[8])*0.5+0.5;_uv3y=(_vector3.x*cameraMatrix.elements[1]+_vector3.y*cameraMatrix.elements[5]+_vector3.z*cameraMatrix.elements[9])*0.5+0.5;patternPath(_v1x,_v1y,_v2x,_v2y,_v3x,_v3y,_uv1x,_uv1y,_uv2x,_uv2y,_uv3x,_uv3y,material.envMap);}}else{_color.copy(material.color);if(material.vertexColors===THREE.FaceColors){_color.r*=element.color.r;_color.g*=element.color.g;_color.b*=element.color.b;}
material.wireframe===true?strokePath(_color,material.wireframeLinewidth,material.wireframeLinecap,material.wireframeLinejoin):fillPath(_color);}}else if(material instanceof THREE.MeshDepthMaterial){_near=camera.near;_far=camera.far;_color1.r=_color1.g=_color1.b=1-smoothstep(v1.positionScreen.z,_near,_far);_color2.r=_color2.g=_color2.b=1-smoothstep(v2.positionScreen.z,_near,_far);_color3.r=_color3.g=_color3.b=1-smoothstep(v3.positionScreen.z,_near,_far);_color4.r=(_color2.r+_color3.r)*0.5;_color4.g=(_color2.g+_color3.g)*0.5;_color4.b=(_color2.b+_color3.b)*0.5;_image=getGradientTexture(_color1,_color2,_color3,_color4);clipImage(_v1x,_v1y,_v2x,_v2y,_v3x,_v3y,0,0,1,0,0,1,_image);}else if(material instanceof THREE.MeshNormalMaterial){_color.r=normalToComponent(element.normalWorld.x);_color.g=normalToComponent(element.normalWorld.y);_color.b=normalToComponent(element.normalWorld.z);material.wireframe===true?strokePath(_color,material.wireframeLinewidth,material.wireframeLinecap,material.wireframeLinejoin):fillPath(_color);}}
function renderFace4(v1,v2,v3,v4,v5,v6,element,material,scene){_this.info.render.vertices+=4;_this.info.render.faces++;setOpacity(material.opacity);setBlending(material.blending);if((material.map!==undefined&&material.map!==null)||(material.envMap!==undefined&&material.envMap!==null)){renderFace3(v1,v2,v4,0,1,3,element,material,scene);renderFace3(v5,v3,v6,1,2,3,element,material,scene);return;}
_v1x=v1.positionScreen.x;_v1y=v1.positionScreen.y;_v2x=v2.positionScreen.x;_v2y=v2.positionScreen.y;_v3x=v3.positionScreen.x;_v3y=v3.positionScreen.y;_v4x=v4.positionScreen.x;_v4y=v4.positionScreen.y;_v5x=v5.positionScreen.x;_v5y=v5.positionScreen.y;_v6x=v6.positionScreen.x;_v6y=v6.positionScreen.y;if(material instanceof THREE.MeshLambertMaterial||material instanceof THREE.MeshPhongMaterial){_diffuseColor.copy(material.color);_emissiveColor.copy(material.emissive);if(material.vertexColors===THREE.FaceColors){_diffuseColor.r*=element.color.r;_diffuseColor.g*=element.color.g;_diffuseColor.b*=element.color.b;}
if(_enableLighting===true){if(material.wireframe===false&&material.shading==THREE.SmoothShading&&element.vertexNormalsLength==4){_color1.r=_color2.r=_color3.r=_color4.r=_ambientLight.r;_color1.g=_color2.g=_color3.g=_color4.g=_ambientLight.g;_color1.b=_color2.b=_color3.b=_color4.b=_ambientLight.b;calculateLight(element.v1.positionWorld,element.vertexNormalsWorld[0],_color1);calculateLight(element.v2.positionWorld,element.vertexNormalsWorld[1],_color2);calculateLight(element.v4.positionWorld,element.vertexNormalsWorld[3],_color3);calculateLight(element.v3.positionWorld,element.vertexNormalsWorld[2],_color4);_color1.r=_color1.r*_diffuseColor.r+_emissiveColor.r;_color1.g=_color1.g*_diffuseColor.g+_emissiveColor.g;_color1.b=_color1.b*_diffuseColor.b+_emissiveColor.b;_color2.r=_color2.r*_diffuseColor.r+_emissiveColor.r;_color2.g=_color2.g*_diffuseColor.g+_emissiveColor.g;_color2.b=_color2.b*_diffuseColor.b+_emissiveColor.b;_color3.r=_color3.r*_diffuseColor.r+_emissiveColor.r;_color3.g=_color3.g*_diffuseColor.g+_emissiveColor.g;_color3.b=_color3.b*_diffuseColor.b+_emissiveColor.b;_color4.r=_color4.r*_diffuseColor.r+_emissiveColor.r;_color4.g=_color4.g*_diffuseColor.g+_emissiveColor.g;_color4.b=_color4.b*_diffuseColor.b+_emissiveColor.b;_image=getGradientTexture(_color1,_color2,_color3,_color4);drawTriangle(_v1x,_v1y,_v2x,_v2y,_v4x,_v4y);clipImage(_v1x,_v1y,_v2x,_v2y,_v4x,_v4y,0,0,1,0,0,1,_image);drawTriangle(_v5x,_v5y,_v3x,_v3y,_v6x,_v6y);clipImage(_v5x,_v5y,_v3x,_v3y,_v6x,_v6y,1,0,1,1,0,1,_image);}else{_color.r=_ambientLight.r;_color.g=_ambientLight.g;_color.b=_ambientLight.b;calculateLight(element.centroidWorld,element.normalWorld,_color);_color.r=_color.r*_diffuseColor.r+_emissiveColor.r;_color.g=_color.g*_diffuseColor.g+_emissiveColor.g;_color.b=_color.b*_diffuseColor.b+_emissiveColor.b;drawQuad(_v1x,_v1y,_v2x,_v2y,_v3x,_v3y,_v4x,_v4y);material.wireframe===true?strokePath(_color,material.wireframeLinewidth,material.wireframeLinecap,material.wireframeLinejoin):fillPath(_color);}}else{_color.r=_diffuseColor.r+_emissiveColor.r;_color.g=_diffuseColor.g+_emissiveColor.g;_color.b=_diffuseColor.b+_emissiveColor.b;drawQuad(_v1x,_v1y,_v2x,_v2y,_v3x,_v3y,_v4x,_v4y);material.wireframe===true?strokePath(_color,material.wireframeLinewidth,material.wireframeLinecap,material.wireframeLinejoin):fillPath(_color);}}else if(material instanceof THREE.MeshBasicMaterial){_color.copy(material.color);if(material.vertexColors===THREE.FaceColors){_color.r*=element.color.r;_color.g*=element.color.g;_color.b*=element.color.b;}
drawQuad(_v1x,_v1y,_v2x,_v2y,_v3x,_v3y,_v4x,_v4y);material.wireframe===true?strokePath(_color,material.wireframeLinewidth,material.wireframeLinecap,material.wireframeLinejoin):fillPath(_color);}else if(material instanceof THREE.MeshNormalMaterial){_color.r=normalToComponent(element.normalWorld.x);_color.g=normalToComponent(element.normalWorld.y);_color.b=normalToComponent(element.normalWorld.z);drawQuad(_v1x,_v1y,_v2x,_v2y,_v3x,_v3y,_v4x,_v4y);material.wireframe===true?strokePath(_color,material.wireframeLinewidth,material.wireframeLinecap,material.wireframeLinejoin):fillPath(_color);}else if(material instanceof THREE.MeshDepthMaterial){_near=camera.near;_far=camera.far;_color1.r=_color1.g=_color1.b=1-smoothstep(v1.positionScreen.z,_near,_far);_color2.r=_color2.g=_color2.b=1-smoothstep(v2.positionScreen.z,_near,_far);_color3.r=_color3.g=_color3.b=1-smoothstep(v4.positionScreen.z,_near,_far);_color4.r=_color4.g=_color4.b=1-smoothstep(v3.positionScreen.z,_near,_far);_image=getGradientTexture(_color1,_color2,_color3,_color4);drawTriangle(_v1x,_v1y,_v2x,_v2y,_v4x,_v4y);clipImage(_v1x,_v1y,_v2x,_v2y,_v4x,_v4y,0,0,1,0,0,1,_image);drawTriangle(_v5x,_v5y,_v3x,_v3y,_v6x,_v6y);clipImage(_v5x,_v5y,_v3x,_v3y,_v6x,_v6y,1,0,1,1,0,1,_image);}}
function drawTriangle(x0,y0,x1,y1,x2,y2){_context.beginPath();_context.moveTo(x0,y0);_context.lineTo(x1,y1);_context.lineTo(x2,y2);_context.closePath();}
function drawQuad(x0,y0,x1,y1,x2,y2,x3,y3){_context.beginPath();_context.moveTo(x0,y0);_context.lineTo(x1,y1);_context.lineTo(x2,y2);_context.lineTo(x3,y3);_context.closePath();}
function strokePath(color,linewidth,linecap,linejoin){setLineWidth(linewidth);setLineCap(linecap);setLineJoin(linejoin);setStrokeStyle(color.getContextStyle());_context.stroke();_bboxRect.inflate(linewidth*2);}
function fillPath(color){setFillStyle(color.getContextStyle());_context.fill();}
function patternPath(x0,y0,x1,y1,x2,y2,u0,v0,u1,v1,u2,v2,texture){if(texture instanceof THREE.DataTexture||texture.image===undefined||texture.image.width==0)return;if(texture.needsUpdate===true){var repeatX=texture.wrapS==THREE.RepeatWrapping;var repeatY=texture.wrapT==THREE.RepeatWrapping;_patterns[texture.id]=_context.createPattern(texture.image,repeatX===true&&repeatY===true?'repeat':repeatX===true&&repeatY===false?'repeat-x':repeatX===false&&repeatY===true?'repeat-y':'no-repeat');texture.needsUpdate=false;}
_patterns[texture.id]===undefined?setFillStyle('rgba(0,0,0,1)'):setFillStyle(_patterns[texture.id]);var a,b,c,d,e,f,det,idet,offsetX=texture.offset.x/texture.repeat.x,offsetY=texture.offset.y/texture.repeat.y,width=texture.image.width*texture.repeat.x,height=texture.image.height*texture.repeat.y;u0=(u0+offsetX)*width;v0=(1.0-v0+offsetY)*height;u1=(u1+offsetX)*width;v1=(1.0-v1+offsetY)*height;u2=(u2+offsetX)*width;v2=(1.0-v2+offsetY)*height;x1-=x0;y1-=y0;x2-=x0;y2-=y0;u1-=u0;v1-=v0;u2-=u0;v2-=v0;det=u1*v2-u2*v1;if(det===0){if(_imagedatas[texture.id]===undefined){var canvas=document.createElement('canvas')
canvas.width=texture.image.width;canvas.height=texture.image.height;var context=canvas.getContext('2d');context.drawImage(texture.image,0,0);_imagedatas[texture.id]=context.getImageData(0,0,texture.image.width,texture.image.height).data;}
var data=_imagedatas[texture.id];var index=(Math.floor(u0)+Math.floor(v0)*texture.image.width)*4;_color.setRGB(data[index]/255,data[index+1]/255,data[index+2]/255);fillPath(_color);return;}
idet=1/det;a=(v2*x1-v1*x2)*idet;b=(v2*y1-v1*y2)*idet;c=(u1*x2-u2*x1)*idet;d=(u1*y2-u2*y1)*idet;e=x0-a*u0-c*v0;f=y0-b*u0-d*v0;_context.save();_context.transform(a,b,c,d,e,f);_context.fill();_context.restore();}
function clipImage(x0,y0,x1,y1,x2,y2,u0,v0,u1,v1,u2,v2,image){var a,b,c,d,e,f,det,idet,width=image.width-1,height=image.height-1;u0*=width;v0*=height;u1*=width;v1*=height;u2*=width;v2*=height;x1-=x0;y1-=y0;x2-=x0;y2-=y0;u1-=u0;v1-=v0;u2-=u0;v2-=v0;det=u1*v2-u2*v1;idet=1/det;a=(v2*x1-v1*x2)*idet;b=(v2*y1-v1*y2)*idet;c=(u1*x2-u2*x1)*idet;d=(u1*y2-u2*y1)*idet;e=x0-a*u0-c*v0;f=y0-b*u0-d*v0;_context.save();_context.transform(a,b,c,d,e,f);_context.clip();_context.drawImage(image,0,0);_context.restore();}
function getGradientTexture(color1,color2,color3,color4){_pixelMapData[0]=(color1.r*255)|0;_pixelMapData[1]=(color1.g*255)|0;_pixelMapData[2]=(color1.b*255)|0;_pixelMapData[4]=(color2.r*255)|0;_pixelMapData[5]=(color2.g*255)|0;_pixelMapData[6]=(color2.b*255)|0;_pixelMapData[8]=(color3.r*255)|0;_pixelMapData[9]=(color3.g*255)|0;_pixelMapData[10]=(color3.b*255)|0;_pixelMapData[12]=(color4.r*255)|0;_pixelMapData[13]=(color4.g*255)|0;_pixelMapData[14]=(color4.b*255)|0;_pixelMapContext.putImageData(_pixelMapImage,0,0);_gradientMapContext.drawImage(_pixelMap,0,0);return _gradientMap;}
function smoothstep(value,min,max){var x=(value-min)/(max-min);return x*x*(3-2*x);}
function normalToComponent(normal){var component=(normal+1)*0.5;return component<0?0:(component>1?1:component);}
function expand(v1,v2){var x=v2.x-v1.x,y=v2.y-v1.y,det=x*x+y*y,idet;if(det===0)return;idet=1/Math.sqrt(det);x*=idet;y*=idet;v2.x+=x;v2.y+=y;v1.x-=x;v1.y-=y;}};function setOpacity(value){if(_contextGlobalAlpha!==value){_context.globalAlpha=value;_contextGlobalAlpha=value;}}
function setBlending(value){if(_contextGlobalCompositeOperation!==value){if(value===THREE.NormalBlending){_context.globalCompositeOperation='source-over';}else if(value===THREE.AdditiveBlending){_context.globalCompositeOperation='lighter';}else if(value===THREE.SubtractiveBlending){_context.globalCompositeOperation='darker';}
_contextGlobalCompositeOperation=value;}}
function setLineWidth(value){if(_contextLineWidth!==value){_context.lineWidth=value;_contextLineWidth=value;}}
function setLineCap(value){if(_contextLineCap!==value){_context.lineCap=value;_contextLineCap=value;}}
function setLineJoin(value){if(_contextLineJoin!==value){_context.lineJoin=value;_contextLineJoin=value;}}
function setStrokeStyle(value){if(_contextStrokeStyle!==value){_context.strokeStyle=value;_contextStrokeStyle=value;}}
function setFillStyle(value){if(_contextFillStyle!==value){_context.fillStyle=value;_contextFillStyle=value;}}};THREE.ShaderChunk={fog_pars_fragment:["#ifdef USE_FOG","uniform vec3 fogColor;","#ifdef FOG_EXP2","uniform float fogDensity;","#else","uniform float fogNear;","uniform float fogFar;","#endif","#endif"].join("\n"),fog_fragment:["#ifdef USE_FOG","float depth = gl_FragCoord.z / gl_FragCoord.w;","#ifdef FOG_EXP2","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","#else","float fogFactor = smoothstep( fogNear, fogFar, depth );","#endif","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","#endif"].join("\n"),envmap_pars_fragment:["#ifdef USE_ENVMAP","uniform float reflectivity;","uniform samplerCube envMap;","uniform float flipEnvMap;","uniform int combine;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","uniform bool useRefract;","uniform float refractionRatio;","#else","varying vec3 vReflect;","#endif","#endif"].join("\n"),envmap_fragment:["#ifdef USE_ENVMAP","vec3 reflectVec;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","reflectVec = refract( cameraToVertex, normal, refractionRatio );","} else { ","reflectVec = reflect( cameraToVertex, normal );","}","#else","reflectVec = vReflect;","#endif","#ifdef DOUBLE_SIDED","float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );","vec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#else","vec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#endif","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","if ( combine == 1 ) {","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );","} else {","gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );","}","#endif"].join("\n"),envmap_pars_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","varying vec3 vReflect;","uniform float refractionRatio;","uniform bool useRefract;","#endif"].join("\n"),worldpos_vertex:["#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )","#ifdef USE_SKINNING","vec4 mPosition = modelMatrix * skinned;","#endif","#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 mPosition = modelMatrix * vec4( morphed, 1.0 );","#endif","#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 mPosition = modelMatrix * vec4( position, 1.0 );","#endif","#endif"].join("\n"),envmap_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","vec3 nWorld = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;","if ( useRefract ) {","vReflect = refract( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ), refractionRatio );","} else {","vReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );","}","#endif"].join("\n"),map_particle_pars_fragment:["#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_particle_fragment:["#ifdef USE_MAP","gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );","#endif"].join("\n"),map_pars_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","varying vec2 vUv;","uniform vec4 offsetRepeat;","#endif"].join("\n"),map_pars_fragment:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","varying vec2 vUv;","#endif","#ifdef USE_MAP","uniform sampler2D map;","#endif",].join("\n"),map_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","vUv = uv * offsetRepeat.zw + offsetRepeat.xy;","#endif"].join("\n"),map_fragment:["#ifdef USE_MAP","#ifdef GAMMA_INPUT","vec4 texelColor = texture2D( map, vUv );","texelColor.xyz *= texelColor.xyz;","gl_FragColor = gl_FragColor * texelColor;","#else","gl_FragColor = gl_FragColor * texture2D( map, vUv );","#endif","#endif"].join("\n"),lightmap_pars_fragment:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","uniform sampler2D lightMap;","#endif"].join("\n"),lightmap_pars_vertex:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","#endif"].join("\n"),lightmap_fragment:["#ifdef USE_LIGHTMAP","gl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );","#endif"].join("\n"),lightmap_vertex:["#ifdef USE_LIGHTMAP","vUv2 = uv2;","#endif"].join("\n"),bumpmap_pars_fragment:["#ifdef USE_BUMPMAP","uniform sampler2D bumpMap;","uniform float bumpScale;","vec2 dHdxy_fwd() {","vec2 dSTdx = dFdx( vUv );","vec2 dSTdy = dFdy( vUv );","float Hll = bumpScale * texture2D( bumpMap, vUv ).x;","float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;","float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;","return vec2( dBx, dBy );","}","vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {","vec3 vSigmaX = dFdx( surf_pos );","vec3 vSigmaY = dFdy( surf_pos );","vec3 vN = surf_norm;","vec3 R1 = cross( vSigmaY, vN );","vec3 R2 = cross( vN, vSigmaX );","float fDet = dot( vSigmaX, R1 );","vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );","return normalize( abs( fDet ) * surf_norm - vGrad );","}","#endif"].join("\n"),normalmap_pars_fragment:["#ifdef USE_NORMALMAP","uniform sampler2D normalMap;","uniform vec2 normalScale;","vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {","vec3 q0 = dFdx( eye_pos.xyz );","vec3 q1 = dFdy( eye_pos.xyz );","vec2 st0 = dFdx( vUv.st );","vec2 st1 = dFdy( vUv.st );","vec3 S = normalize(  q0 * st1.t - q1 * st0.t );","vec3 T = normalize( -q0 * st1.s + q1 * st0.s );","vec3 N = normalize( surf_norm );","vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;","mapN.xy = normalScale * mapN.xy;","mat3 tsn = mat3( S, T, N );","return normalize( tsn * mapN );","}","#endif"].join("\n"),specularmap_pars_fragment:["#ifdef USE_SPECULARMAP","uniform sampler2D specularMap;","#endif"].join("\n"),specularmap_fragment:["float specularStrength;","#ifdef USE_SPECULARMAP","vec4 texelSpecular = texture2D( specularMap, vUv );","specularStrength = texelSpecular.r;","#else","specularStrength = 1.0;","#endif"].join("\n"),lights_lambert_pars_vertex:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightPosition[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngle[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif"].join("\n"),lights_lambert_vertex:["vLightFront = vec3( 0.0 );","#ifdef DOUBLE_SIDED","vLightBack = vec3( 0.0 );","#endif","transformedNormal = normalize( transformedNormal );","#if MAX_DIR_LIGHTS > 0","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, dirVector );","vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += directionalLightColor[ i ] * directionalLightWeighting;","#ifdef DOUBLE_SIDED","vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;","#endif","}","#endif","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;","#ifdef DOUBLE_SIDED","vLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","lVector = normalize( lVector );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - mPosition.xyz ) );","if ( spotEffect > spotLightAngle[ i ] ) {","spotEffect = pow( spotEffect, spotLightExponent[ i ] );","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","float dotProduct = dot( transformedNormal, lVector );","vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;","#ifdef DOUBLE_SIDED","vLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_HEMI_LIGHTS > 0","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( hemisphereLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;","vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","#ifdef DOUBLE_SIDED","vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );","#endif","}","#endif","vLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;","#ifdef DOUBLE_SIDED","vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;","#endif"].join("\n"),lights_phong_pars_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif"].join("\n"),lights_phong_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","vPointLight[ i ] = vec4( lVector, lDistance );","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","vSpotLight[ i ] = vec4( lVector, lDistance );","}","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","vWorldPosition = mPosition.xyz;","#endif"].join("\n"),lights_phong_pars_fragment:["uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightPosition[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#else","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngle[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#else","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vViewPosition;","varying vec3 vNormal;"].join("\n"),lights_phong_fragment:["vec3 normal = normalize( vNormal );","vec3 viewPosition = normalize( vViewPosition );","#ifdef DOUBLE_SIDED","normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );","#endif","#ifdef USE_NORMALMAP","normal = perturbNormal2Arb( -viewPosition, normal );","#elif defined( USE_BUMPMAP )","normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse  = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vPointLight[ i ].xyz );","float lDistance = vPointLight[ i ].w;","#endif","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dotProduct, 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dotProduct, 0.0 );","#endif","pointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;","#else","pointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse  = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vSpotLight[ i ].xyz );","float lDistance = vSpotLight[ i ].w;","#endif","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngle[ i ] ) {","spotEffect = pow( spotEffect, spotLightExponent[ i ] );","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dotProduct, 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dotProduct, 0.0 );","#endif","spotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;","vec3 spotHalfVector = normalize( lVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;","#else","spotSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse  = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, dirVector );","#ifdef WRAP_AROUND","float dirDiffuseWeightFull = max( dotProduct, 0.0 );","float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dotProduct, 0.0 );","#endif","dirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( hemisphereLightPosition[ i ], 1.0 );","vec3 lVector = normalize( lPosition.xyz + vViewPosition.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += diffuse * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = normalize( -lPosition.xyz + vViewPosition.xyz );","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += specular * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;","#endif"].join("\n"),color_pars_fragment:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_fragment:["#ifdef USE_COLOR","gl_FragColor = gl_FragColor * vec4( vColor, opacity );","#endif"].join("\n"),color_pars_vertex:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_vertex:["#ifdef USE_COLOR","#ifdef GAMMA_INPUT","vColor = color * color;","#else","vColor = color;","#endif","#endif"].join("\n"),skinning_pars_vertex:["#ifdef USE_SKINNING","#ifdef BONE_TEXTURE","uniform sampler2D boneTexture;","mat4 getBoneMatrix( const in float i ) {","float j = i * 4.0;","float x = mod( j, N_BONE_PIXEL_X );","float y = floor( j / N_BONE_PIXEL_X );","const float dx = 1.0 / N_BONE_PIXEL_X;","const float dy = 1.0 / N_BONE_PIXEL_Y;","y = dy * ( y + 0.5 );","vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );","vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );","vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );","vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );","mat4 bone = mat4( v1, v2, v3, v4 );","return bone;","}","#else","uniform mat4 boneGlobalMatrices[ MAX_BONES ];","mat4 getBoneMatrix( const in float i ) {","mat4 bone = boneGlobalMatrices[ int(i) ];","return bone;","}","#endif","#endif"].join("\n"),skinbase_vertex:["#ifdef USE_SKINNING","mat4 boneMatX = getBoneMatrix( skinIndex.x );","mat4 boneMatY = getBoneMatrix( skinIndex.y );","#endif"].join("\n"),skinning_vertex:["#ifdef USE_SKINNING","#ifdef USE_MORPHTARGETS","vec4 skinVertex = vec4( morphed, 1.0 );","#else","vec4 skinVertex = vec4( position, 1.0 );","#endif","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned    += boneMatY * skinVertex * skinWeight.y;","#endif"].join("\n"),morphtarget_pars_vertex:["#ifdef USE_MORPHTARGETS","#ifndef USE_MORPHNORMALS","uniform float morphTargetInfluences[ 8 ];","#else","uniform float morphTargetInfluences[ 4 ];","#endif","#endif"].join("\n"),morphtarget_vertex:["#ifdef USE_MORPHTARGETS","vec3 morphed = vec3( 0.0 );","morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];","morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];","morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];","morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];","#ifndef USE_MORPHNORMALS","morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];","morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];","morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];","morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];","#endif","morphed += position;","#endif"].join("\n"),default_vertex:["vec4 mvPosition;","#ifdef USE_SKINNING","mvPosition = modelViewMatrix * skinned;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( morphed, 1.0 );","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;",].join("\n"),morphnormal_vertex:["#ifdef USE_MORPHNORMALS","vec3 morphedNormal = vec3( 0.0 );","morphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];","morphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];","morphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];","morphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];","morphedNormal += normal;","#endif"].join("\n"),skinnormal_vertex:["#ifdef USE_SKINNING","mat4 skinMatrix = skinWeight.x * boneMatX;","skinMatrix  += skinWeight.y * boneMatY;","#ifdef USE_MORPHNORMALS","vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );","#else","vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );","#endif","#endif"].join("\n"),defaultnormal_vertex:["vec3 objectNormal;","#ifdef USE_SKINNING","objectNormal = skinnedNormal.xyz;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )","objectNormal = morphedNormal;","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )","objectNormal = normal;","#endif","#ifdef FLIP_SIDED","objectNormal = -objectNormal;","#endif","vec3 transformedNormal = normalMatrix * objectNormal;",].join("\n"),shadowmap_pars_fragment:["#ifdef USE_SHADOWMAP","uniform sampler2D shadowMap[ MAX_SHADOWS ];","uniform vec2 shadowMapSize[ MAX_SHADOWS ];","uniform float shadowDarkness[ MAX_SHADOWS ];","uniform float shadowBias[ MAX_SHADOWS ];","varying vec4 vShadowCoord[ MAX_SHADOWS ];","float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","#endif"].join("\n"),shadowmap_fragment:["#ifdef USE_SHADOWMAP","#ifdef SHADOWMAP_DEBUG","vec3 frustumColors[3];","frustumColors[0] = vec3( 1.0, 0.5, 0.0 );","frustumColors[1] = vec3( 0.0, 1.0, 0.8 );","frustumColors[2] = vec3( 0.0, 0.5, 1.0 );","#endif","#ifdef SHADOWMAP_CASCADE","int inFrustumCount = 0;","#endif","float fDepth;","vec3 shadowColor = vec3( 1.0 );","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;","bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );","bool inFrustum = all( inFrustumVec );","#ifdef SHADOWMAP_CASCADE","inFrustumCount += int( inFrustum );","bvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );","#else","bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );","#endif","bool frustumTest = all( frustumTestVec );","if ( frustumTest ) {","shadowCoord.z += shadowBias[ i ];","#ifdef SHADOWMAP_SOFT","float shadow = 0.0;","const float shadowDelta = 1.0 / 9.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.25 * xPixelOffset;","float dy0 = -1.25 * yPixelOffset;","float dx1 = 1.25 * xPixelOffset;","float dy1 = 1.25 * yPixelOffset;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#else","vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );","float fDepth = unpackDepth( rgbaDepth );","if ( fDepth < shadowCoord.z )","shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );","#endif","}","#ifdef SHADOWMAP_DEBUG","#ifdef SHADOWMAP_CASCADE","if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];","#else","if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];","#endif","#endif","}","#ifdef GAMMA_OUTPUT","shadowColor *= shadowColor;","#endif","gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;","#endif"].join("\n"),shadowmap_pars_vertex:["#ifdef USE_SHADOWMAP","varying vec4 vShadowCoord[ MAX_SHADOWS ];","uniform mat4 shadowMatrix[ MAX_SHADOWS ];","#endif"].join("\n"),shadowmap_vertex:["#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * mPosition;","}","#endif"].join("\n"),alphatest_fragment:["#ifdef ALPHATEST","if ( gl_FragColor.a < ALPHATEST ) discard;","#endif"].join("\n"),linear_to_gamma_fragment:["#ifdef GAMMA_OUTPUT","gl_FragColor.xyz = sqrt( gl_FragColor.xyz );","#endif"].join("\n"),};THREE.UniformsUtils={merge:function(uniforms){var u,p,tmp,merged={};for(u=0;u<uniforms.length;u++){tmp=this.clone(uniforms[u]);for(p in tmp){merged[p]=tmp[p];}}
return merged;},clone:function(uniforms_src){var u,p,parameter,parameter_src,uniforms_dst={};for(u in uniforms_src){uniforms_dst[u]={};for(p in uniforms_src[u]){parameter_src=uniforms_src[u][p];if(parameter_src instanceof THREE.Color||parameter_src instanceof THREE.Vector2||parameter_src instanceof THREE.Vector3||parameter_src instanceof THREE.Vector4||parameter_src instanceof THREE.Matrix4||parameter_src instanceof THREE.Texture){uniforms_dst[u][p]=parameter_src.clone();}else if(parameter_src instanceof Array){uniforms_dst[u][p]=parameter_src.slice();}else{uniforms_dst[u][p]=parameter_src;}}}
return uniforms_dst;}};THREE.UniformsLib={common:{"diffuse":{type:"c",value:new THREE.Color(0xeeeeee)},"opacity":{type:"f",value:1.0},"map":{type:"t",value:null},"offsetRepeat":{type:"v4",value:new THREE.Vector4(0,0,1,1)},"lightMap":{type:"t",value:null},"specularMap":{type:"t",value:null},"envMap":{type:"t",value:null},"flipEnvMap":{type:"f",value:-1},"useRefract":{type:"i",value:0},"reflectivity":{type:"f",value:1.0},"refractionRatio":{type:"f",value:0.98},"combine":{type:"i",value:0},"morphTargetInfluences":{type:"f",value:0}},bump:{"bumpMap":{type:"t",value:null},"bumpScale":{type:"f",value:1}},normalmap:{"normalMap":{type:"t",value:null},"normalScale":{type:"v2",value:new THREE.Vector2(1,1)}},fog:{"fogDensity":{type:"f",value:0.00025},"fogNear":{type:"f",value:1},"fogFar":{type:"f",value:2000},"fogColor":{type:"c",value:new THREE.Color(0xffffff)}},lights:{"ambientLightColor":{type:"fv",value:[]},"directionalLightDirection":{type:"fv",value:[]},"directionalLightColor":{type:"fv",value:[]},"hemisphereLightPosition":{type:"fv",value:[]},"hemisphereLightSkyColor":{type:"fv",value:[]},"hemisphereLightGroundColor":{type:"fv",value:[]},"pointLightColor":{type:"fv",value:[]},"pointLightPosition":{type:"fv",value:[]},"pointLightDistance":{type:"fv1",value:[]},"spotLightColor":{type:"fv",value:[]},"spotLightPosition":{type:"fv",value:[]},"spotLightDirection":{type:"fv",value:[]},"spotLightDistance":{type:"fv1",value:[]},"spotLightAngle":{type:"fv1",value:[]},"spotLightExponent":{type:"fv1",value:[]}},particle:{"psColor":{type:"c",value:new THREE.Color(0xeeeeee)},"opacity":{type:"f",value:1.0},"size":{type:"f",value:1.0},"scale":{type:"f",value:1.0},"map":{type:"t",value:null},"fogDensity":{type:"f",value:0.00025},"fogNear":{type:"f",value:1},"fogFar":{type:"f",value:2000},"fogColor":{type:"c",value:new THREE.Color(0xffffff)}},shadowmap:{"shadowMap":{type:"tv",value:[]},"shadowMapSize":{type:"v2v",value:[]},"shadowBias":{type:"fv1",value:[]},"shadowDarkness":{type:"fv1",value:[]},"shadowMatrix":{type:"m4v",value:[]},}};THREE.ShaderLib={'depth':{uniforms:{"mNear":{type:"f",value:1.0},"mFar":{type:"f",value:2000.0},"opacity":{type:"f",value:1.0}},vertexShader:["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;","void main() {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float color = 1.0 - smoothstep( mNear, mFar, depth );","gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},'normal':{uniforms:{"opacity":{type:"f",value:1.0}},vertexShader:["varying vec3 vNormal;","void main() {","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vNormal = normalMatrix * normal;","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;","void main() {","gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );","}"].join("\n")},'basic':{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["common"],THREE.UniformsLib["fog"],THREE.UniformsLib["shadowmap"]]),vertexShader:[THREE.ShaderChunk["map_pars_vertex"],THREE.ShaderChunk["lightmap_pars_vertex"],THREE.ShaderChunk["envmap_pars_vertex"],THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["skinning_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],"void main() {",THREE.ShaderChunk["map_vertex"],THREE.ShaderChunk["lightmap_vertex"],THREE.ShaderChunk["color_vertex"],"#ifdef USE_ENVMAP",THREE.ShaderChunk["morphnormal_vertex"],THREE.ShaderChunk["skinbase_vertex"],THREE.ShaderChunk["skinnormal_vertex"],THREE.ShaderChunk["defaultnormal_vertex"],"#endif",THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["skinning_vertex"],THREE.ShaderChunk["default_vertex"],THREE.ShaderChunk["worldpos_vertex"],THREE.ShaderChunk["envmap_vertex"],THREE.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["map_pars_fragment"],THREE.ShaderChunk["lightmap_pars_fragment"],THREE.ShaderChunk["envmap_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["shadowmap_pars_fragment"],THREE.ShaderChunk["specularmap_pars_fragment"],"void main() {","gl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk["map_fragment"],THREE.ShaderChunk["alphatest_fragment"],THREE.ShaderChunk["specularmap_fragment"],THREE.ShaderChunk["lightmap_fragment"],THREE.ShaderChunk["color_fragment"],THREE.ShaderChunk["envmap_fragment"],THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["linear_to_gamma_fragment"],THREE.ShaderChunk["fog_fragment"],"}"].join("\n")},'lambert':{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["common"],THREE.UniformsLib["fog"],THREE.UniformsLib["lights"],THREE.UniformsLib["shadowmap"],{"ambient":{type:"c",value:new THREE.Color(0xffffff)},"emissive":{type:"c",value:new THREE.Color(0x000000)},"wrapRGB":{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",THREE.ShaderChunk["map_pars_vertex"],THREE.ShaderChunk["lightmap_pars_vertex"],THREE.ShaderChunk["envmap_pars_vertex"],THREE.ShaderChunk["lights_lambert_pars_vertex"],THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["skinning_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],"void main() {",THREE.ShaderChunk["map_vertex"],THREE.ShaderChunk["lightmap_vertex"],THREE.ShaderChunk["color_vertex"],THREE.ShaderChunk["morphnormal_vertex"],THREE.ShaderChunk["skinbase_vertex"],THREE.ShaderChunk["skinnormal_vertex"],THREE.ShaderChunk["defaultnormal_vertex"],THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["skinning_vertex"],THREE.ShaderChunk["default_vertex"],THREE.ShaderChunk["worldpos_vertex"],THREE.ShaderChunk["envmap_vertex"],THREE.ShaderChunk["lights_lambert_vertex"],THREE.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["map_pars_fragment"],THREE.ShaderChunk["lightmap_pars_fragment"],THREE.ShaderChunk["envmap_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["shadowmap_pars_fragment"],THREE.ShaderChunk["specularmap_pars_fragment"],"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk["map_fragment"],THREE.ShaderChunk["alphatest_fragment"],THREE.ShaderChunk["specularmap_fragment"],"#ifdef DOUBLE_SIDED","if ( gl_FrontFacing )","gl_FragColor.xyz *= vLightFront;","else","gl_FragColor.xyz *= vLightBack;","#else","gl_FragColor.xyz *= vLightFront;","#endif",THREE.ShaderChunk["lightmap_fragment"],THREE.ShaderChunk["color_fragment"],THREE.ShaderChunk["envmap_fragment"],THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["linear_to_gamma_fragment"],THREE.ShaderChunk["fog_fragment"],"}"].join("\n")},'phong':{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["common"],THREE.UniformsLib["bump"],THREE.UniformsLib["normalmap"],THREE.UniformsLib["fog"],THREE.UniformsLib["lights"],THREE.UniformsLib["shadowmap"],{"ambient":{type:"c",value:new THREE.Color(0xffffff)},"emissive":{type:"c",value:new THREE.Color(0x000000)},"specular":{type:"c",value:new THREE.Color(0x111111)},"shininess":{type:"f",value:30},"wrapRGB":{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","varying vec3 vNormal;",THREE.ShaderChunk["map_pars_vertex"],THREE.ShaderChunk["lightmap_pars_vertex"],THREE.ShaderChunk["envmap_pars_vertex"],THREE.ShaderChunk["lights_phong_pars_vertex"],THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["skinning_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],"void main() {",THREE.ShaderChunk["map_vertex"],THREE.ShaderChunk["lightmap_vertex"],THREE.ShaderChunk["color_vertex"],THREE.ShaderChunk["morphnormal_vertex"],THREE.ShaderChunk["skinbase_vertex"],THREE.ShaderChunk["skinnormal_vertex"],THREE.ShaderChunk["defaultnormal_vertex"],"vNormal = transformedNormal;",THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["skinning_vertex"],THREE.ShaderChunk["default_vertex"],"vViewPosition = -mvPosition.xyz;",THREE.ShaderChunk["worldpos_vertex"],THREE.ShaderChunk["envmap_vertex"],THREE.ShaderChunk["lights_phong_vertex"],THREE.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;",THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["map_pars_fragment"],THREE.ShaderChunk["lightmap_pars_fragment"],THREE.ShaderChunk["envmap_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["lights_phong_pars_fragment"],THREE.ShaderChunk["shadowmap_pars_fragment"],THREE.ShaderChunk["bumpmap_pars_fragment"],THREE.ShaderChunk["normalmap_pars_fragment"],THREE.ShaderChunk["specularmap_pars_fragment"],"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk["map_fragment"],THREE.ShaderChunk["alphatest_fragment"],THREE.ShaderChunk["specularmap_fragment"],THREE.ShaderChunk["lights_phong_fragment"],THREE.ShaderChunk["lightmap_fragment"],THREE.ShaderChunk["color_fragment"],THREE.ShaderChunk["envmap_fragment"],THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["linear_to_gamma_fragment"],THREE.ShaderChunk["fog_fragment"],"}"].join("\n")},'particle_basic':{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["particle"],THREE.UniformsLib["shadowmap"]]),vertexShader:["uniform float size;","uniform float scale;",THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],"void main() {",THREE.ShaderChunk["color_vertex"],"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#ifdef USE_SIZEATTENUATION","gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","#else","gl_PointSize = size;","#endif","gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk["worldpos_vertex"],THREE.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["map_particle_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["shadowmap_pars_fragment"],"void main() {","gl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk["map_particle_fragment"],THREE.ShaderChunk["alphatest_fragment"],THREE.ShaderChunk["color_fragment"],THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["fog_fragment"],"}"].join("\n")},'depthRGBA':{uniforms:{},vertexShader:[THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["skinning_pars_vertex"],"void main() {",THREE.ShaderChunk["skinbase_vertex"],THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["skinning_vertex"],THREE.ShaderChunk["default_vertex"],"}"].join("\n"),fragmentShader:["vec4 pack_depth( const in float depth ) {","const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","const vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","vec4 res = fract( depth * bit_shift );","res -= res.xxyz * bit_mask;","return res;","}","void main() {","gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","}"].join("\n")}};THREE.WebGLRenderer=function(parameters){console.log('THREE.WebGLRenderer',THREE.REVISION);parameters=parameters||{};var _canvas=parameters.canvas!==undefined?parameters.canvas:document.createElement('canvas'),_precision=parameters.precision!==undefined?parameters.precision:'highp',_alpha=parameters.alpha!==undefined?parameters.alpha:true,_premultipliedAlpha=parameters.premultipliedAlpha!==undefined?parameters.premultipliedAlpha:true,_antialias=parameters.antialias!==undefined?parameters.antialias:false,_stencil=parameters.stencil!==undefined?parameters.stencil:true,_preserveDrawingBuffer=parameters.preserveDrawingBuffer!==undefined?parameters.preserveDrawingBuffer:false,_clearColor=parameters.clearColor!==undefined?new THREE.Color(parameters.clearColor):new THREE.Color(0x000000),_clearAlpha=parameters.clearAlpha!==undefined?parameters.clearAlpha:0,_maxLights=parameters.maxLights!==undefined?parameters.maxLights:4;this.domElement=_canvas;this.context=null;this.autoClear=true;this.autoClearColor=true;this.autoClearDepth=true;this.autoClearStencil=true;this.sortObjects=true;this.autoUpdateObjects=true;this.autoUpdateScene=true;this.gammaInput=false;this.gammaOutput=false;this.physicallyBasedShading=false;this.shadowMapEnabled=false;this.shadowMapAutoUpdate=true;this.shadowMapSoft=true;this.shadowMapCullFrontFaces=true;this.shadowMapDebug=false;this.shadowMapCascade=false;this.maxMorphTargets=8;this.maxMorphNormals=4;this.autoScaleCubemaps=true;this.renderPluginsPre=[];this.renderPluginsPost=[];this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var _this=this,_programs=[],_programs_counter=0,_currentProgram=null,_currentFramebuffer=null,_currentMaterialId=-1,_currentGeometryGroupHash=null,_currentCamera=null,_geometryGroupCounter=0,_usedTextureUnits=0,_oldDoubleSided=-1,_oldFlipSided=-1,_oldBlending=-1,_oldBlendEquation=-1,_oldBlendSrc=-1,_oldBlendDst=-1,_oldDepthTest=-1,_oldDepthWrite=-1,_oldPolygonOffset=null,_oldPolygonOffsetFactor=null,_oldPolygonOffsetUnits=null,_oldLineWidth=null,_viewportX=0,_viewportY=0,_viewportWidth=0,_viewportHeight=0,_currentWidth=0,_currentHeight=0,_frustum=new THREE.Frustum(),_projScreenMatrix=new THREE.Matrix4(),_projScreenMatrixPS=new THREE.Matrix4(),_vector3=new THREE.Vector4(),_direction=new THREE.Vector3(),_lightsNeedUpdate=true,_lights={ambient:[0,0,0],directional:{length:0,colors:new Array(),positions:new Array()},point:{length:0,colors:new Array(),positions:new Array(),distances:new Array()},spot:{length:0,colors:new Array(),positions:new Array(),distances:new Array(),directions:new Array(),angles:new Array(),exponents:new Array()},hemi:{length:0,skyColors:new Array(),groundColors:new Array(),positions:new Array()}};var _gl;var _glExtensionTextureFloat;var _glExtensionStandardDerivatives;var _glExtensionTextureFilterAnisotropic;var _glExtensionCompressedTextureS3TC;initGL();setDefaultGLState();this.context=_gl;var _maxTextures=_gl.getParameter(_gl.MAX_TEXTURE_IMAGE_UNITS);var _maxVertexTextures=_gl.getParameter(_gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS);var _maxTextureSize=_gl.getParameter(_gl.MAX_TEXTURE_SIZE);var _maxCubemapSize=_gl.getParameter(_gl.MAX_CUBE_MAP_TEXTURE_SIZE);var _maxAnisotropy=_glExtensionTextureFilterAnisotropic?_gl.getParameter(_glExtensionTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0;var _supportsVertexTextures=(_maxVertexTextures>0);var _supportsBoneTextures=_supportsVertexTextures&&_glExtensionTextureFloat;var _compressedTextureFormats=_glExtensionCompressedTextureS3TC?_gl.getParameter(_gl.COMPRESSED_TEXTURE_FORMATS):[];this.getContext=function(){return _gl;};this.supportsVertexTextures=function(){return _supportsVertexTextures;};this.getMaxAnisotropy=function(){return _maxAnisotropy;};this.setSize=function(width,height){_canvas.width=width;_canvas.height=height;this.setViewport(0,0,_canvas.width,_canvas.height);};this.setViewport=function(x,y,width,height){_viewportX=x!==undefined?x:0;_viewportY=y!==undefined?y:0;_viewportWidth=width!==undefined?width:_canvas.width;_viewportHeight=height!==undefined?height:_canvas.height;_gl.viewport(_viewportX,_viewportY,_viewportWidth,_viewportHeight);};this.setScissor=function(x,y,width,height){_gl.scissor(x,y,width,height);};this.enableScissorTest=function(enable){enable?_gl.enable(_gl.SCISSOR_TEST):_gl.disable(_gl.SCISSOR_TEST);};this.setClearColorHex=function(hex,alpha){_clearColor.setHex(hex);_clearAlpha=alpha;_gl.clearColor(_clearColor.r,_clearColor.g,_clearColor.b,_clearAlpha);};this.setClearColor=function(color,alpha){_clearColor.copy(color);_clearAlpha=alpha;_gl.clearColor(_clearColor.r,_clearColor.g,_clearColor.b,_clearAlpha);};this.getClearColor=function(){return _clearColor;};this.getClearAlpha=function(){return _clearAlpha;};this.clear=function(color,depth,stencil){var bits=0;if(color===undefined||color)bits|=_gl.COLOR_BUFFER_BIT;if(depth===undefined||depth)bits|=_gl.DEPTH_BUFFER_BIT;if(stencil===undefined||stencil)bits|=_gl.STENCIL_BUFFER_BIT;_gl.clear(bits);};this.clearTarget=function(renderTarget,color,depth,stencil){this.setRenderTarget(renderTarget);this.clear(color,depth,stencil);};this.addPostPlugin=function(plugin){plugin.init(this);this.renderPluginsPost.push(plugin);};this.addPrePlugin=function(plugin){plugin.init(this);this.renderPluginsPre.push(plugin);};this.deallocateObject=function(object){if(!object.__webglInit)return;object.__webglInit=false;delete object._modelViewMatrix;delete object._normalMatrix;delete object._normalMatrixArray;delete object._modelViewMatrixArray;delete object._modelMatrixArray;if(object instanceof THREE.Mesh){for(var g in object.geometry.geometryGroups){deleteMeshBuffers(object.geometry.geometryGroups[g]);}}else if(object instanceof THREE.Ribbon){deleteRibbonBuffers(object.geometry);}else if(object instanceof THREE.Line){deleteLineBuffers(object.geometry);}else if(object instanceof THREE.ParticleSystem){deleteParticleBuffers(object.geometry);}};this.deallocateTexture=function(texture){if(!texture.__webglInit)return;texture.__webglInit=false;_gl.deleteTexture(texture.__webglTexture);_this.info.memory.textures--;};this.deallocateRenderTarget=function(renderTarget){if(!renderTarget||!renderTarget.__webglTexture)return;_gl.deleteTexture(renderTarget.__webglTexture);if(renderTarget instanceof THREE.WebGLRenderTargetCube){for(var i=0;i<6;i++){_gl.deleteFramebuffer(renderTarget.__webglFramebuffer[i]);_gl.deleteRenderbuffer(renderTarget.__webglRenderbuffer[i]);}}else{_gl.deleteFramebuffer(renderTarget.__webglFramebuffer);_gl.deleteRenderbuffer(renderTarget.__webglRenderbuffer);}};this.deallocateMaterial=function(material){var program=material.program;if(!program)return;material.program=undefined;var i,il,programInfo;var deleteProgram=false;for(i=0,il=_programs.length;i<il;i++){programInfo=_programs[i];if(programInfo.program===program){programInfo.usedTimes--;if(programInfo.usedTimes===0){deleteProgram=true;}
break;}}
if(deleteProgram){var newPrograms=[];for(i=0,il=_programs.length;i<il;i++){programInfo=_programs[i];if(programInfo.program!==program){newPrograms.push(programInfo);}}
_programs=newPrograms;_gl.deleteProgram(program);_this.info.memory.programs--;}};this.updateShadowMap=function(scene,camera){_currentProgram=null;_oldBlending=-1;_oldDepthTest=-1;_oldDepthWrite=-1;_currentGeometryGroupHash=-1;_currentMaterialId=-1;_lightsNeedUpdate=true;_oldDoubleSided=-1;_oldFlipSided=-1;this.shadowMapPlugin.update(scene,camera);};function createParticleBuffers(geometry){geometry.__webglVertexBuffer=_gl.createBuffer();geometry.__webglColorBuffer=_gl.createBuffer();_this.info.memory.geometries++;};function createLineBuffers(geometry){geometry.__webglVertexBuffer=_gl.createBuffer();geometry.__webglColorBuffer=_gl.createBuffer();_this.info.memory.geometries++;};function createRibbonBuffers(geometry){geometry.__webglVertexBuffer=_gl.createBuffer();geometry.__webglColorBuffer=_gl.createBuffer();_this.info.memory.geometries++;};function createMeshBuffers(geometryGroup){geometryGroup.__webglVertexBuffer=_gl.createBuffer();geometryGroup.__webglNormalBuffer=_gl.createBuffer();geometryGroup.__webglTangentBuffer=_gl.createBuffer();geometryGroup.__webglColorBuffer=_gl.createBuffer();geometryGroup.__webglUVBuffer=_gl.createBuffer();geometryGroup.__webglUV2Buffer=_gl.createBuffer();geometryGroup.__webglSkinIndicesBuffer=_gl.createBuffer();geometryGroup.__webglSkinWeightsBuffer=_gl.createBuffer();geometryGroup.__webglFaceBuffer=_gl.createBuffer();geometryGroup.__webglLineBuffer=_gl.createBuffer();var m,ml;if(geometryGroup.numMorphTargets){geometryGroup.__webglMorphTargetsBuffers=[];for(m=0,ml=geometryGroup.numMorphTargets;m<ml;m++){geometryGroup.__webglMorphTargetsBuffers.push(_gl.createBuffer());}}
if(geometryGroup.numMorphNormals){geometryGroup.__webglMorphNormalsBuffers=[];for(m=0,ml=geometryGroup.numMorphNormals;m<ml;m++){geometryGroup.__webglMorphNormalsBuffers.push(_gl.createBuffer());}}
_this.info.memory.geometries++;};function deleteParticleBuffers(geometry){_gl.deleteBuffer(geometry.__webglVertexBuffer);_gl.deleteBuffer(geometry.__webglColorBuffer);_this.info.memory.geometries--;};function deleteLineBuffers(geometry){_gl.deleteBuffer(geometry.__webglVertexBuffer);_gl.deleteBuffer(geometry.__webglColorBuffer);_this.info.memory.geometries--;};function deleteRibbonBuffers(geometry){_gl.deleteBuffer(geometry.__webglVertexBuffer);_gl.deleteBuffer(geometry.__webglColorBuffer);_this.info.memory.geometries--;};function deleteMeshBuffers(geometryGroup){_gl.deleteBuffer(geometryGroup.__webglVertexBuffer);_gl.deleteBuffer(geometryGroup.__webglNormalBuffer);_gl.deleteBuffer(geometryGroup.__webglTangentBuffer);_gl.deleteBuffer(geometryGroup.__webglColorBuffer);_gl.deleteBuffer(geometryGroup.__webglUVBuffer);_gl.deleteBuffer(geometryGroup.__webglUV2Buffer);_gl.deleteBuffer(geometryGroup.__webglSkinIndicesBuffer);_gl.deleteBuffer(geometryGroup.__webglSkinWeightsBuffer);_gl.deleteBuffer(geometryGroup.__webglFaceBuffer);_gl.deleteBuffer(geometryGroup.__webglLineBuffer);var m,ml;if(geometryGroup.numMorphTargets){for(m=0,ml=geometryGroup.numMorphTargets;m<ml;m++){_gl.deleteBuffer(geometryGroup.__webglMorphTargetsBuffers[m]);}}
if(geometryGroup.numMorphNormals){for(m=0,ml=geometryGroup.numMorphNormals;m<ml;m++){_gl.deleteBuffer(geometryGroup.__webglMorphNormalsBuffers[m]);}}
if(geometryGroup.__webglCustomAttributesList){for(var id in geometryGroup.__webglCustomAttributesList){_gl.deleteBuffer(geometryGroup.__webglCustomAttributesList[id].buffer);}}
_this.info.memory.geometries--;};function initCustomAttributes(geometry,object){var nvertices=geometry.vertices.length;var material=object.material;if(material.attributes){if(geometry.__webglCustomAttributesList===undefined){geometry.__webglCustomAttributesList=[];}
for(var a in material.attributes){var attribute=material.attributes[a];if(!attribute.__webglInitialized||attribute.createUniqueBuffers){attribute.__webglInitialized=true;var size=1;if(attribute.type==="v2")size=2;else if(attribute.type==="v3")size=3;else if(attribute.type==="v4")size=4;else if(attribute.type==="c")size=3;attribute.size=size;attribute.array=new Float32Array(nvertices*size);attribute.buffer=_gl.createBuffer();attribute.buffer.belongsToAttribute=a;attribute.needsUpdate=true;}
geometry.__webglCustomAttributesList.push(attribute);}}};function initParticleBuffers(geometry,object){var nvertices=geometry.vertices.length;geometry.__vertexArray=new Float32Array(nvertices*3);geometry.__colorArray=new Float32Array(nvertices*3);geometry.__sortArray=[];geometry.__webglParticleCount=nvertices;initCustomAttributes(geometry,object);};function initLineBuffers(geometry,object){var nvertices=geometry.vertices.length;geometry.__vertexArray=new Float32Array(nvertices*3);geometry.__colorArray=new Float32Array(nvertices*3);geometry.__webglLineCount=nvertices;initCustomAttributes(geometry,object);};function initRibbonBuffers(geometry){var nvertices=geometry.vertices.length;geometry.__vertexArray=new Float32Array(nvertices*3);geometry.__colorArray=new Float32Array(nvertices*3);geometry.__webglVertexCount=nvertices;};function initMeshBuffers(geometryGroup,object){var geometry=object.geometry,faces3=geometryGroup.faces3,faces4=geometryGroup.faces4,nvertices=faces3.length*3+faces4.length*4,ntris=faces3.length*1+faces4.length*2,nlines=faces3.length*3+faces4.length*4,material=getBufferMaterial(object,geometryGroup),uvType=bufferGuessUVType(material),normalType=bufferGuessNormalType(material),vertexColorType=bufferGuessVertexColorType(material);geometryGroup.__vertexArray=new Float32Array(nvertices*3);if(normalType){geometryGroup.__normalArray=new Float32Array(nvertices*3);}
if(geometry.hasTangents){geometryGroup.__tangentArray=new Float32Array(nvertices*4);}
if(vertexColorType){geometryGroup.__colorArray=new Float32Array(nvertices*3);}
if(uvType){if(geometry.faceUvs.length>0||geometry.faceVertexUvs.length>0){geometryGroup.__uvArray=new Float32Array(nvertices*2);}
if(geometry.faceUvs.length>1||geometry.faceVertexUvs.length>1){geometryGroup.__uv2Array=new Float32Array(nvertices*2);}}
if(object.geometry.skinWeights.length&&object.geometry.skinIndices.length){geometryGroup.__skinIndexArray=new Float32Array(nvertices*4);geometryGroup.__skinWeightArray=new Float32Array(nvertices*4);}
geometryGroup.__faceArray=new Uint16Array(ntris*3);geometryGroup.__lineArray=new Uint16Array(nlines*2);var m,ml;if(geometryGroup.numMorphTargets){geometryGroup.__morphTargetsArrays=[];for(m=0,ml=geometryGroup.numMorphTargets;m<ml;m++){geometryGroup.__morphTargetsArrays.push(new Float32Array(nvertices*3));}}
if(geometryGroup.numMorphNormals){geometryGroup.__morphNormalsArrays=[];for(m=0,ml=geometryGroup.numMorphNormals;m<ml;m++){geometryGroup.__morphNormalsArrays.push(new Float32Array(nvertices*3));}}
geometryGroup.__webglFaceCount=ntris*3;geometryGroup.__webglLineCount=nlines*2;if(material.attributes){if(geometryGroup.__webglCustomAttributesList===undefined){geometryGroup.__webglCustomAttributesList=[];}
for(var a in material.attributes){var originalAttribute=material.attributes[a];var attribute={};for(var property in originalAttribute){attribute[property]=originalAttribute[property];}
if(!attribute.__webglInitialized||attribute.createUniqueBuffers){attribute.__webglInitialized=true;var size=1;if(attribute.type==="v2")size=2;else if(attribute.type==="v3")size=3;else if(attribute.type==="v4")size=4;else if(attribute.type==="c")size=3;attribute.size=size;attribute.array=new Float32Array(nvertices*size);attribute.buffer=_gl.createBuffer();attribute.buffer.belongsToAttribute=a;originalAttribute.needsUpdate=true;attribute.__original=originalAttribute;}
geometryGroup.__webglCustomAttributesList.push(attribute);}}
geometryGroup.__inittedArrays=true;};function getBufferMaterial(object,geometryGroup){if(object.material&&!(object.material instanceof THREE.MeshFaceMaterial)){return object.material;}else if(geometryGroup.materialIndex>=0){return object.geometry.materials[geometryGroup.materialIndex];}};function materialNeedsSmoothNormals(material){return material&&material.shading!==undefined&&material.shading===THREE.SmoothShading;};function bufferGuessNormalType(material){if((material instanceof THREE.MeshBasicMaterial&&!material.envMap)||material instanceof THREE.MeshDepthMaterial){return false;}
if(materialNeedsSmoothNormals(material)){return THREE.SmoothShading;}else{return THREE.FlatShading;}};function bufferGuessVertexColorType(material){if(material.vertexColors){return material.vertexColors;}
return false;};function bufferGuessUVType(material){if(material.map||material.lightMap||material.bumpMap||material.normalMap||material.specularMap||material instanceof THREE.ShaderMaterial){return true;}
return false;};function initDirectBuffers(geometry){var a,attribute,type;for(a in geometry.attributes){if(a==="index"){type=_gl.ELEMENT_ARRAY_BUFFER;}else{type=_gl.ARRAY_BUFFER;}
attribute=geometry.attributes[a];attribute.buffer=_gl.createBuffer();_gl.bindBuffer(type,attribute.buffer);_gl.bufferData(type,attribute.array,_gl.STATIC_DRAW);}};function setParticleBuffers(geometry,hint,object){var v,c,vertex,offset,index,color,vertices=geometry.vertices,vl=vertices.length,colors=geometry.colors,cl=colors.length,vertexArray=geometry.__vertexArray,colorArray=geometry.__colorArray,sortArray=geometry.__sortArray,dirtyVertices=geometry.verticesNeedUpdate,dirtyElements=geometry.elementsNeedUpdate,dirtyColors=geometry.colorsNeedUpdate,customAttributes=geometry.__webglCustomAttributesList,i,il,a,ca,cal,value,customAttribute;if(object.sortParticles){_projScreenMatrixPS.copy(_projScreenMatrix);_projScreenMatrixPS.multiplySelf(object.matrixWorld);for(v=0;v<vl;v++){vertex=vertices[v];_vector3.copy(vertex);_projScreenMatrixPS.multiplyVector3(_vector3);sortArray[v]=[_vector3.z,v];}
sortArray.sort(function(a,b){return b[0]-a[0];});for(v=0;v<vl;v++){vertex=vertices[sortArray[v][1]];offset=v*3;vertexArray[offset]=vertex.x;vertexArray[offset+1]=vertex.y;vertexArray[offset+2]=vertex.z;}
for(c=0;c<cl;c++){offset=c*3;color=colors[sortArray[c][1]];colorArray[offset]=color.r;colorArray[offset+1]=color.g;colorArray[offset+2]=color.b;}
if(customAttributes){for(i=0,il=customAttributes.length;i<il;i++){customAttribute=customAttributes[i];if(!(customAttribute.boundTo===undefined||customAttribute.boundTo==="vertices"))continue;offset=0;cal=customAttribute.value.length;if(customAttribute.size===1){for(ca=0;ca<cal;ca++){index=sortArray[ca][1];customAttribute.array[ca]=customAttribute.value[index];}}else if(customAttribute.size===2){for(ca=0;ca<cal;ca++){index=sortArray[ca][1];value=customAttribute.value[index];customAttribute.array[offset]=value.x;customAttribute.array[offset+1]=value.y;offset+=2;}}else if(customAttribute.size===3){if(customAttribute.type==="c"){for(ca=0;ca<cal;ca++){index=sortArray[ca][1];value=customAttribute.value[index];customAttribute.array[offset]=value.r;customAttribute.array[offset+1]=value.g;customAttribute.array[offset+2]=value.b;offset+=3;}}else{for(ca=0;ca<cal;ca++){index=sortArray[ca][1];value=customAttribute.value[index];customAttribute.array[offset]=value.x;customAttribute.array[offset+1]=value.y;customAttribute.array[offset+2]=value.z;offset+=3;}}}else if(customAttribute.size===4){for(ca=0;ca<cal;ca++){index=sortArray[ca][1];value=customAttribute.value[index];customAttribute.array[offset]=value.x;customAttribute.array[offset+1]=value.y;customAttribute.array[offset+2]=value.z;customAttribute.array[offset+3]=value.w;offset+=4;}}}}}else{if(dirtyVertices){for(v=0;v<vl;v++){vertex=vertices[v];offset=v*3;vertexArray[offset]=vertex.x;vertexArray[offset+1]=vertex.y;vertexArray[offset+2]=vertex.z;}}
if(dirtyColors){for(c=0;c<cl;c++){color=colors[c];offset=c*3;colorArray[offset]=color.r;colorArray[offset+1]=color.g;colorArray[offset+2]=color.b;}}
if(customAttributes){for(i=0,il=customAttributes.length;i<il;i++){customAttribute=customAttributes[i];if(customAttribute.needsUpdate&&(customAttribute.boundTo===undefined||customAttribute.boundTo==="vertices")){cal=customAttribute.value.length;offset=0;if(customAttribute.size===1){for(ca=0;ca<cal;ca++){customAttribute.array[ca]=customAttribute.value[ca];}}else if(customAttribute.size===2){for(ca=0;ca<cal;ca++){value=customAttribute.value[ca];customAttribute.array[offset]=value.x;customAttribute.array[offset+1]=value.y;offset+=2;}}else if(customAttribute.size===3){if(customAttribute.type==="c"){for(ca=0;ca<cal;ca++){value=customAttribute.value[ca];customAttribute.array[offset]=value.r;customAttribute.array[offset+1]=value.g;customAttribute.array[offset+2]=value.b;offset+=3;}}else{for(ca=0;ca<cal;ca++){value=customAttribute.value[ca];customAttribute.array[offset]=value.x;customAttribute.array[offset+1]=value.y;customAttribute.array[offset+2]=value.z;offset+=3;}}}else if(customAttribute.size===4){for(ca=0;ca<cal;ca++){value=customAttribute.value[ca];customAttribute.array[offset]=value.x;customAttribute.array[offset+1]=value.y;customAttribute.array[offset+2]=value.z;customAttribute.array[offset+3]=value.w;offset+=4;}}}}}}
if(dirtyVertices||object.sortParticles){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometry.__webglVertexBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,vertexArray,hint);}
if(dirtyColors||object.sortParticles){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometry.__webglColorBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,colorArray,hint);}
if(customAttributes){for(i=0,il=customAttributes.length;i<il;i++){customAttribute=customAttributes[i];if(customAttribute.needsUpdate||object.sortParticles){_gl.bindBuffer(_gl.ARRAY_BUFFER,customAttribute.buffer);_gl.bufferData(_gl.ARRAY_BUFFER,customAttribute.array,hint);}}}};function setLineBuffers(geometry,hint){var v,c,vertex,offset,color,vertices=geometry.vertices,colors=geometry.colors,vl=vertices.length,cl=colors.length,vertexArray=geometry.__vertexArray,colorArray=geometry.__colorArray,dirtyVertices=geometry.verticesNeedUpdate,dirtyColors=geometry.colorsNeedUpdate,customAttributes=geometry.__webglCustomAttributesList,i,il,a,ca,cal,value,customAttribute;if(dirtyVertices){for(v=0;v<vl;v++){vertex=vertices[v];offset=v*3;vertexArray[offset]=vertex.x;vertexArray[offset+1]=vertex.y;vertexArray[offset+2]=vertex.z;}
_gl.bindBuffer(_gl.ARRAY_BUFFER,geometry.__webglVertexBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,vertexArray,hint);}
if(dirtyColors){for(c=0;c<cl;c++){color=colors[c];offset=c*3;colorArray[offset]=color.r;colorArray[offset+1]=color.g;colorArray[offset+2]=color.b;}
_gl.bindBuffer(_gl.ARRAY_BUFFER,geometry.__webglColorBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,colorArray,hint);}
if(customAttributes){for(i=0,il=customAttributes.length;i<il;i++){customAttribute=customAttributes[i];if(customAttribute.needsUpdate&&(customAttribute.boundTo===undefined||customAttribute.boundTo==="vertices")){offset=0;cal=customAttribute.value.length;if(customAttribute.size===1){for(ca=0;ca<cal;ca++){customAttribute.array[ca]=customAttribute.value[ca];}}else if(customAttribute.size===2){for(ca=0;ca<cal;ca++){value=customAttribute.value[ca];customAttribute.array[offset]=value.x;customAttribute.array[offset+1]=value.y;offset+=2;}}else if(customAttribute.size===3){if(customAttribute.type==="c"){for(ca=0;ca<cal;ca++){value=customAttribute.value[ca];customAttribute.array[offset]=value.r;customAttribute.array[offset+1]=value.g;customAttribute.array[offset+2]=value.b;offset+=3;}}else{for(ca=0;ca<cal;ca++){value=customAttribute.value[ca];customAttribute.array[offset]=value.x;customAttribute.array[offset+1]=value.y;customAttribute.array[offset+2]=value.z;offset+=3;}}}else if(customAttribute.size===4){for(ca=0;ca<cal;ca++){value=customAttribute.value[ca];customAttribute.array[offset]=value.x;customAttribute.array[offset+1]=value.y;customAttribute.array[offset+2]=value.z;customAttribute.array[offset+3]=value.w;offset+=4;}}
_gl.bindBuffer(_gl.ARRAY_BUFFER,customAttribute.buffer);_gl.bufferData(_gl.ARRAY_BUFFER,customAttribute.array,hint);}}}};function setRibbonBuffers(geometry,hint){var v,c,vertex,offset,color,vertices=geometry.vertices,colors=geometry.colors,vl=vertices.length,cl=colors.length,vertexArray=geometry.__vertexArray,colorArray=geometry.__colorArray,dirtyVertices=geometry.verticesNeedUpdate,dirtyColors=geometry.colorsNeedUpdate;if(dirtyVertices){for(v=0;v<vl;v++){vertex=vertices[v];offset=v*3;vertexArray[offset]=vertex.x;vertexArray[offset+1]=vertex.y;vertexArray[offset+2]=vertex.z;}
_gl.bindBuffer(_gl.ARRAY_BUFFER,geometry.__webglVertexBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,vertexArray,hint);}
if(dirtyColors){for(c=0;c<cl;c++){color=colors[c];offset=c*3;colorArray[offset]=color.r;colorArray[offset+1]=color.g;colorArray[offset+2]=color.b;}
_gl.bindBuffer(_gl.ARRAY_BUFFER,geometry.__webglColorBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,colorArray,hint);}};function setMeshBuffers(geometryGroup,object,hint,dispose,material){if(!geometryGroup.__inittedArrays){return;}
var normalType=bufferGuessNormalType(material),vertexColorType=bufferGuessVertexColorType(material),uvType=bufferGuessUVType(material),needsSmoothNormals=(normalType===THREE.SmoothShading);var f,fl,fi,face,vertexNormals,faceNormal,normal,vertexColors,faceColor,vertexTangents,uv,uv2,v1,v2,v3,v4,t1,t2,t3,t4,n1,n2,n3,n4,c1,c2,c3,c4,sw1,sw2,sw3,sw4,si1,si2,si3,si4,sa1,sa2,sa3,sa4,sb1,sb2,sb3,sb4,m,ml,i,il,vn,uvi,uv2i,vk,vkl,vka,nka,chf,faceVertexNormals,a,vertexIndex=0,offset=0,offset_uv=0,offset_uv2=0,offset_face=0,offset_normal=0,offset_tangent=0,offset_line=0,offset_color=0,offset_skin=0,offset_morphTarget=0,offset_custom=0,offset_customSrc=0,value,vertexArray=geometryGroup.__vertexArray,uvArray=geometryGroup.__uvArray,uv2Array=geometryGroup.__uv2Array,normalArray=geometryGroup.__normalArray,tangentArray=geometryGroup.__tangentArray,colorArray=geometryGroup.__colorArray,skinIndexArray=geometryGroup.__skinIndexArray,skinWeightArray=geometryGroup.__skinWeightArray,morphTargetsArrays=geometryGroup.__morphTargetsArrays,morphNormalsArrays=geometryGroup.__morphNormalsArrays,customAttributes=geometryGroup.__webglCustomAttributesList,customAttribute,faceArray=geometryGroup.__faceArray,lineArray=geometryGroup.__lineArray,geometry=object.geometry,dirtyVertices=geometry.verticesNeedUpdate,dirtyElements=geometry.elementsNeedUpdate,dirtyUvs=geometry.uvsNeedUpdate,dirtyNormals=geometry.normalsNeedUpdate,dirtyTangents=geometry.tangentsNeedUpdate,dirtyColors=geometry.colorsNeedUpdate,dirtyMorphTargets=geometry.morphTargetsNeedUpdate,vertices=geometry.vertices,chunk_faces3=geometryGroup.faces3,chunk_faces4=geometryGroup.faces4,obj_faces=geometry.faces,obj_uvs=geometry.faceVertexUvs[0],obj_uvs2=geometry.faceVertexUvs[1],obj_colors=geometry.colors,obj_skinIndices=geometry.skinIndices,obj_skinWeights=geometry.skinWeights,morphTargets=geometry.morphTargets,morphNormals=geometry.morphNormals;if(dirtyVertices){for(f=0,fl=chunk_faces3.length;f<fl;f++){face=obj_faces[chunk_faces3[f]];v1=vertices[face.a];v2=vertices[face.b];v3=vertices[face.c];vertexArray[offset]=v1.x;vertexArray[offset+1]=v1.y;vertexArray[offset+2]=v1.z;vertexArray[offset+3]=v2.x;vertexArray[offset+4]=v2.y;vertexArray[offset+5]=v2.z;vertexArray[offset+6]=v3.x;vertexArray[offset+7]=v3.y;vertexArray[offset+8]=v3.z;offset+=9;}
for(f=0,fl=chunk_faces4.length;f<fl;f++){face=obj_faces[chunk_faces4[f]];v1=vertices[face.a];v2=vertices[face.b];v3=vertices[face.c];v4=vertices[face.d];vertexArray[offset]=v1.x;vertexArray[offset+1]=v1.y;vertexArray[offset+2]=v1.z;vertexArray[offset+3]=v2.x;vertexArray[offset+4]=v2.y;vertexArray[offset+5]=v2.z;vertexArray[offset+6]=v3.x;vertexArray[offset+7]=v3.y;vertexArray[offset+8]=v3.z;vertexArray[offset+9]=v4.x;vertexArray[offset+10]=v4.y;vertexArray[offset+11]=v4.z;offset+=12;}
_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglVertexBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,vertexArray,hint);}
if(dirtyMorphTargets){for(vk=0,vkl=morphTargets.length;vk<vkl;vk++){offset_morphTarget=0;for(f=0,fl=chunk_faces3.length;f<fl;f++){chf=chunk_faces3[f];face=obj_faces[chf];v1=morphTargets[vk].vertices[face.a];v2=morphTargets[vk].vertices[face.b];v3=morphTargets[vk].vertices[face.c];vka=morphTargetsArrays[vk];vka[offset_morphTarget]=v1.x;vka[offset_morphTarget+1]=v1.y;vka[offset_morphTarget+2]=v1.z;vka[offset_morphTarget+3]=v2.x;vka[offset_morphTarget+4]=v2.y;vka[offset_morphTarget+5]=v2.z;vka[offset_morphTarget+6]=v3.x;vka[offset_morphTarget+7]=v3.y;vka[offset_morphTarget+8]=v3.z;if(material.morphNormals){if(needsSmoothNormals){faceVertexNormals=morphNormals[vk].vertexNormals[chf];n1=faceVertexNormals.a;n2=faceVertexNormals.b;n3=faceVertexNormals.c;}else{n1=morphNormals[vk].faceNormals[chf];n2=n1;n3=n1;}
nka=morphNormalsArrays[vk];nka[offset_morphTarget]=n1.x;nka[offset_morphTarget+1]=n1.y;nka[offset_morphTarget+2]=n1.z;nka[offset_morphTarget+3]=n2.x;nka[offset_morphTarget+4]=n2.y;nka[offset_morphTarget+5]=n2.z;nka[offset_morphTarget+6]=n3.x;nka[offset_morphTarget+7]=n3.y;nka[offset_morphTarget+8]=n3.z;}
offset_morphTarget+=9;}
for(f=0,fl=chunk_faces4.length;f<fl;f++){chf=chunk_faces4[f];face=obj_faces[chf];v1=morphTargets[vk].vertices[face.a];v2=morphTargets[vk].vertices[face.b];v3=morphTargets[vk].vertices[face.c];v4=morphTargets[vk].vertices[face.d];vka=morphTargetsArrays[vk];vka[offset_morphTarget]=v1.x;vka[offset_morphTarget+1]=v1.y;vka[offset_morphTarget+2]=v1.z;vka[offset_morphTarget+3]=v2.x;vka[offset_morphTarget+4]=v2.y;vka[offset_morphTarget+5]=v2.z;vka[offset_morphTarget+6]=v3.x;vka[offset_morphTarget+7]=v3.y;vka[offset_morphTarget+8]=v3.z;vka[offset_morphTarget+9]=v4.x;vka[offset_morphTarget+10]=v4.y;vka[offset_morphTarget+11]=v4.z;if(material.morphNormals){if(needsSmoothNormals){faceVertexNormals=morphNormals[vk].vertexNormals[chf];n1=faceVertexNormals.a;n2=faceVertexNormals.b;n3=faceVertexNormals.c;n4=faceVertexNormals.d;}else{n1=morphNormals[vk].faceNormals[chf];n2=n1;n3=n1;n4=n1;}
nka=morphNormalsArrays[vk];nka[offset_morphTarget]=n1.x;nka[offset_morphTarget+1]=n1.y;nka[offset_morphTarget+2]=n1.z;nka[offset_morphTarget+3]=n2.x;nka[offset_morphTarget+4]=n2.y;nka[offset_morphTarget+5]=n2.z;nka[offset_morphTarget+6]=n3.x;nka[offset_morphTarget+7]=n3.y;nka[offset_morphTarget+8]=n3.z;nka[offset_morphTarget+9]=n4.x;nka[offset_morphTarget+10]=n4.y;nka[offset_morphTarget+11]=n4.z;}
offset_morphTarget+=12;}
_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglMorphTargetsBuffers[vk]);_gl.bufferData(_gl.ARRAY_BUFFER,morphTargetsArrays[vk],hint);if(material.morphNormals){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglMorphNormalsBuffers[vk]);_gl.bufferData(_gl.ARRAY_BUFFER,morphNormalsArrays[vk],hint);}}}
if(obj_skinWeights.length){for(f=0,fl=chunk_faces3.length;f<fl;f++){face=obj_faces[chunk_faces3[f]];sw1=obj_skinWeights[face.a];sw2=obj_skinWeights[face.b];sw3=obj_skinWeights[face.c];skinWeightArray[offset_skin]=sw1.x;skinWeightArray[offset_skin+1]=sw1.y;skinWeightArray[offset_skin+2]=sw1.z;skinWeightArray[offset_skin+3]=sw1.w;skinWeightArray[offset_skin+4]=sw2.x;skinWeightArray[offset_skin+5]=sw2.y;skinWeightArray[offset_skin+6]=sw2.z;skinWeightArray[offset_skin+7]=sw2.w;skinWeightArray[offset_skin+8]=sw3.x;skinWeightArray[offset_skin+9]=sw3.y;skinWeightArray[offset_skin+10]=sw3.z;skinWeightArray[offset_skin+11]=sw3.w;si1=obj_skinIndices[face.a];si2=obj_skinIndices[face.b];si3=obj_skinIndices[face.c];skinIndexArray[offset_skin]=si1.x;skinIndexArray[offset_skin+1]=si1.y;skinIndexArray[offset_skin+2]=si1.z;skinIndexArray[offset_skin+3]=si1.w;skinIndexArray[offset_skin+4]=si2.x;skinIndexArray[offset_skin+5]=si2.y;skinIndexArray[offset_skin+6]=si2.z;skinIndexArray[offset_skin+7]=si2.w;skinIndexArray[offset_skin+8]=si3.x;skinIndexArray[offset_skin+9]=si3.y;skinIndexArray[offset_skin+10]=si3.z;skinIndexArray[offset_skin+11]=si3.w;offset_skin+=12;}
for(f=0,fl=chunk_faces4.length;f<fl;f++){face=obj_faces[chunk_faces4[f]];sw1=obj_skinWeights[face.a];sw2=obj_skinWeights[face.b];sw3=obj_skinWeights[face.c];sw4=obj_skinWeights[face.d];skinWeightArray[offset_skin]=sw1.x;skinWeightArray[offset_skin+1]=sw1.y;skinWeightArray[offset_skin+2]=sw1.z;skinWeightArray[offset_skin+3]=sw1.w;skinWeightArray[offset_skin+4]=sw2.x;skinWeightArray[offset_skin+5]=sw2.y;skinWeightArray[offset_skin+6]=sw2.z;skinWeightArray[offset_skin+7]=sw2.w;skinWeightArray[offset_skin+8]=sw3.x;skinWeightArray[offset_skin+9]=sw3.y;skinWeightArray[offset_skin+10]=sw3.z;skinWeightArray[offset_skin+11]=sw3.w;skinWeightArray[offset_skin+12]=sw4.x;skinWeightArray[offset_skin+13]=sw4.y;skinWeightArray[offset_skin+14]=sw4.z;skinWeightArray[offset_skin+15]=sw4.w;si1=obj_skinIndices[face.a];si2=obj_skinIndices[face.b];si3=obj_skinIndices[face.c];si4=obj_skinIndices[face.d];skinIndexArray[offset_skin]=si1.x;skinIndexArray[offset_skin+1]=si1.y;skinIndexArray[offset_skin+2]=si1.z;skinIndexArray[offset_skin+3]=si1.w;skinIndexArray[offset_skin+4]=si2.x;skinIndexArray[offset_skin+5]=si2.y;skinIndexArray[offset_skin+6]=si2.z;skinIndexArray[offset_skin+7]=si2.w;skinIndexArray[offset_skin+8]=si3.x;skinIndexArray[offset_skin+9]=si3.y;skinIndexArray[offset_skin+10]=si3.z;skinIndexArray[offset_skin+11]=si3.w;skinIndexArray[offset_skin+12]=si4.x;skinIndexArray[offset_skin+13]=si4.y;skinIndexArray[offset_skin+14]=si4.z;skinIndexArray[offset_skin+15]=si4.w;offset_skin+=16;}
if(offset_skin>0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglSkinIndicesBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,skinIndexArray,hint);_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglSkinWeightsBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,skinWeightArray,hint);}}
if(dirtyColors&&vertexColorType){for(f=0,fl=chunk_faces3.length;f<fl;f++){face=obj_faces[chunk_faces3[f]];vertexColors=face.vertexColors;faceColor=face.color;if(vertexColors.length===3&&vertexColorType===THREE.VertexColors){c1=vertexColors[0];c2=vertexColors[1];c3=vertexColors[2];}else{c1=faceColor;c2=faceColor;c3=faceColor;}
colorArray[offset_color]=c1.r;colorArray[offset_color+1]=c1.g;colorArray[offset_color+2]=c1.b;colorArray[offset_color+3]=c2.r;colorArray[offset_color+4]=c2.g;colorArray[offset_color+5]=c2.b;colorArray[offset_color+6]=c3.r;colorArray[offset_color+7]=c3.g;colorArray[offset_color+8]=c3.b;offset_color+=9;}
for(f=0,fl=chunk_faces4.length;f<fl;f++){face=obj_faces[chunk_faces4[f]];vertexColors=face.vertexColors;faceColor=face.color;if(vertexColors.length===4&&vertexColorType===THREE.VertexColors){c1=vertexColors[0];c2=vertexColors[1];c3=vertexColors[2];c4=vertexColors[3];}else{c1=faceColor;c2=faceColor;c3=faceColor;c4=faceColor;}
colorArray[offset_color]=c1.r;colorArray[offset_color+1]=c1.g;colorArray[offset_color+2]=c1.b;colorArray[offset_color+3]=c2.r;colorArray[offset_color+4]=c2.g;colorArray[offset_color+5]=c2.b;colorArray[offset_color+6]=c3.r;colorArray[offset_color+7]=c3.g;colorArray[offset_color+8]=c3.b;colorArray[offset_color+9]=c4.r;colorArray[offset_color+10]=c4.g;colorArray[offset_color+11]=c4.b;offset_color+=12;}
if(offset_color>0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglColorBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,colorArray,hint);}}
if(dirtyTangents&&geometry.hasTangents){for(f=0,fl=chunk_faces3.length;f<fl;f++){face=obj_faces[chunk_faces3[f]];vertexTangents=face.vertexTangents;t1=vertexTangents[0];t2=vertexTangents[1];t3=vertexTangents[2];tangentArray[offset_tangent]=t1.x;tangentArray[offset_tangent+1]=t1.y;tangentArray[offset_tangent+2]=t1.z;tangentArray[offset_tangent+3]=t1.w;tangentArray[offset_tangent+4]=t2.x;tangentArray[offset_tangent+5]=t2.y;tangentArray[offset_tangent+6]=t2.z;tangentArray[offset_tangent+7]=t2.w;tangentArray[offset_tangent+8]=t3.x;tangentArray[offset_tangent+9]=t3.y;tangentArray[offset_tangent+10]=t3.z;tangentArray[offset_tangent+11]=t3.w;offset_tangent+=12;}
for(f=0,fl=chunk_faces4.length;f<fl;f++){face=obj_faces[chunk_faces4[f]];vertexTangents=face.vertexTangents;t1=vertexTangents[0];t2=vertexTangents[1];t3=vertexTangents[2];t4=vertexTangents[3];tangentArray[offset_tangent]=t1.x;tangentArray[offset_tangent+1]=t1.y;tangentArray[offset_tangent+2]=t1.z;tangentArray[offset_tangent+3]=t1.w;tangentArray[offset_tangent+4]=t2.x;tangentArray[offset_tangent+5]=t2.y;tangentArray[offset_tangent+6]=t2.z;tangentArray[offset_tangent+7]=t2.w;tangentArray[offset_tangent+8]=t3.x;tangentArray[offset_tangent+9]=t3.y;tangentArray[offset_tangent+10]=t3.z;tangentArray[offset_tangent+11]=t3.w;tangentArray[offset_tangent+12]=t4.x;tangentArray[offset_tangent+13]=t4.y;tangentArray[offset_tangent+14]=t4.z;tangentArray[offset_tangent+15]=t4.w;offset_tangent+=16;}
_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglTangentBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,tangentArray,hint);}
if(dirtyNormals&&normalType){for(f=0,fl=chunk_faces3.length;f<fl;f++){face=obj_faces[chunk_faces3[f]];vertexNormals=face.vertexNormals;faceNormal=face.normal;if(vertexNormals.length===3&&needsSmoothNormals){for(i=0;i<3;i++){vn=vertexNormals[i];normalArray[offset_normal]=vn.x;normalArray[offset_normal+1]=vn.y;normalArray[offset_normal+2]=vn.z;offset_normal+=3;}}else{for(i=0;i<3;i++){normalArray[offset_normal]=faceNormal.x;normalArray[offset_normal+1]=faceNormal.y;normalArray[offset_normal+2]=faceNormal.z;offset_normal+=3;}}}
for(f=0,fl=chunk_faces4.length;f<fl;f++){face=obj_faces[chunk_faces4[f]];vertexNormals=face.vertexNormals;faceNormal=face.normal;if(vertexNormals.length===4&&needsSmoothNormals){for(i=0;i<4;i++){vn=vertexNormals[i];normalArray[offset_normal]=vn.x;normalArray[offset_normal+1]=vn.y;normalArray[offset_normal+2]=vn.z;offset_normal+=3;}}else{for(i=0;i<4;i++){normalArray[offset_normal]=faceNormal.x;normalArray[offset_normal+1]=faceNormal.y;normalArray[offset_normal+2]=faceNormal.z;offset_normal+=3;}}}
_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglNormalBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,normalArray,hint);}
if(dirtyUvs&&obj_uvs&&uvType){for(f=0,fl=chunk_faces3.length;f<fl;f++){fi=chunk_faces3[f];uv=obj_uvs[fi];if(uv===undefined)continue;for(i=0;i<3;i++){uvi=uv[i];uvArray[offset_uv]=uvi.u;uvArray[offset_uv+1]=uvi.v;offset_uv+=2;}}
for(f=0,fl=chunk_faces4.length;f<fl;f++){fi=chunk_faces4[f];uv=obj_uvs[fi];if(uv===undefined)continue;for(i=0;i<4;i++){uvi=uv[i];uvArray[offset_uv]=uvi.u;uvArray[offset_uv+1]=uvi.v;offset_uv+=2;}}
if(offset_uv>0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglUVBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,uvArray,hint);}}
if(dirtyUvs&&obj_uvs2&&uvType){for(f=0,fl=chunk_faces3.length;f<fl;f++){fi=chunk_faces3[f];uv2=obj_uvs2[fi];if(uv2===undefined)continue;for(i=0;i<3;i++){uv2i=uv2[i];uv2Array[offset_uv2]=uv2i.u;uv2Array[offset_uv2+1]=uv2i.v;offset_uv2+=2;}}
for(f=0,fl=chunk_faces4.length;f<fl;f++){fi=chunk_faces4[f];uv2=obj_uvs2[fi];if(uv2===undefined)continue;for(i=0;i<4;i++){uv2i=uv2[i];uv2Array[offset_uv2]=uv2i.u;uv2Array[offset_uv2+1]=uv2i.v;offset_uv2+=2;}}
if(offset_uv2>0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglUV2Buffer);_gl.bufferData(_gl.ARRAY_BUFFER,uv2Array,hint);}}
if(dirtyElements){for(f=0,fl=chunk_faces3.length;f<fl;f++){faceArray[offset_face]=vertexIndex;faceArray[offset_face+1]=vertexIndex+1;faceArray[offset_face+2]=vertexIndex+2;offset_face+=3;lineArray[offset_line]=vertexIndex;lineArray[offset_line+1]=vertexIndex+1;lineArray[offset_line+2]=vertexIndex;lineArray[offset_line+3]=vertexIndex+2;lineArray[offset_line+4]=vertexIndex+1;lineArray[offset_line+5]=vertexIndex+2;offset_line+=6;vertexIndex+=3;}
for(f=0,fl=chunk_faces4.length;f<fl;f++){faceArray[offset_face]=vertexIndex;faceArray[offset_face+1]=vertexIndex+1;faceArray[offset_face+2]=vertexIndex+3;faceArray[offset_face+3]=vertexIndex+1;faceArray[offset_face+4]=vertexIndex+2;faceArray[offset_face+5]=vertexIndex+3;offset_face+=6;lineArray[offset_line]=vertexIndex;lineArray[offset_line+1]=vertexIndex+1;lineArray[offset_line+2]=vertexIndex;lineArray[offset_line+3]=vertexIndex+3;lineArray[offset_line+4]=vertexIndex+1;lineArray[offset_line+5]=vertexIndex+2;lineArray[offset_line+6]=vertexIndex+2;lineArray[offset_line+7]=vertexIndex+3;offset_line+=8;vertexIndex+=4;}
_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,geometryGroup.__webglFaceBuffer);_gl.bufferData(_gl.ELEMENT_ARRAY_BUFFER,faceArray,hint);_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,geometryGroup.__webglLineBuffer);_gl.bufferData(_gl.ELEMENT_ARRAY_BUFFER,lineArray,hint);}
if(customAttributes){for(i=0,il=customAttributes.length;i<il;i++){customAttribute=customAttributes[i];if(!customAttribute.__original.needsUpdate)continue;offset_custom=0;offset_customSrc=0;if(customAttribute.size===1){if(customAttribute.boundTo===undefined||customAttribute.boundTo==="vertices"){for(f=0,fl=chunk_faces3.length;f<fl;f++){face=obj_faces[chunk_faces3[f]];customAttribute.array[offset_custom]=customAttribute.value[face.a];customAttribute.array[offset_custom+1]=customAttribute.value[face.b];customAttribute.array[offset_custom+2]=customAttribute.value[face.c];offset_custom+=3;}
for(f=0,fl=chunk_faces4.length;f<fl;f++){face=obj_faces[chunk_faces4[f]];customAttribute.array[offset_custom]=customAttribute.value[face.a];customAttribute.array[offset_custom+1]=customAttribute.value[face.b];customAttribute.array[offset_custom+2]=customAttribute.value[face.c];customAttribute.array[offset_custom+3]=customAttribute.value[face.d];offset_custom+=4;}}else if(customAttribute.boundTo==="faces"){for(f=0,fl=chunk_faces3.length;f<fl;f++){value=customAttribute.value[chunk_faces3[f]];customAttribute.array[offset_custom]=value;customAttribute.array[offset_custom+1]=value;customAttribute.array[offset_custom+2]=value;offset_custom+=3;}
for(f=0,fl=chunk_faces4.length;f<fl;f++){value=customAttribute.value[chunk_faces4[f]];customAttribute.array[offset_custom]=value;customAttribute.array[offset_custom+1]=value;customAttribute.array[offset_custom+2]=value;customAttribute.array[offset_custom+3]=value;offset_custom+=4;}}}else if(customAttribute.size===2){if(customAttribute.boundTo===undefined||customAttribute.boundTo==="vertices"){for(f=0,fl=chunk_faces3.length;f<fl;f++){face=obj_faces[chunk_faces3[f]];v1=customAttribute.value[face.a];v2=customAttribute.value[face.b];v3=customAttribute.value[face.c];customAttribute.array[offset_custom]=v1.x;customAttribute.array[offset_custom+1]=v1.y;customAttribute.array[offset_custom+2]=v2.x;customAttribute.array[offset_custom+3]=v2.y;customAttribute.array[offset_custom+4]=v3.x;customAttribute.array[offset_custom+5]=v3.y;offset_custom+=6;}
for(f=0,fl=chunk_faces4.length;f<fl;f++){face=obj_faces[chunk_faces4[f]];v1=customAttribute.value[face.a];v2=customAttribute.value[face.b];v3=customAttribute.value[face.c];v4=customAttribute.value[face.d];customAttribute.array[offset_custom]=v1.x;customAttribute.array[offset_custom+1]=v1.y;customAttribute.array[offset_custom+2]=v2.x;customAttribute.array[offset_custom+3]=v2.y;customAttribute.array[offset_custom+4]=v3.x;customAttribute.array[offset_custom+5]=v3.y;customAttribute.array[offset_custom+6]=v4.x;customAttribute.array[offset_custom+7]=v4.y;offset_custom+=8;}}else if(customAttribute.boundTo==="faces"){for(f=0,fl=chunk_faces3.length;f<fl;f++){value=customAttribute.value[chunk_faces3[f]];v1=value;v2=value;v3=value;customAttribute.array[offset_custom]=v1.x;customAttribute.array[offset_custom+1]=v1.y;customAttribute.array[offset_custom+2]=v2.x;customAttribute.array[offset_custom+3]=v2.y;customAttribute.array[offset_custom+4]=v3.x;customAttribute.array[offset_custom+5]=v3.y;offset_custom+=6;}
for(f=0,fl=chunk_faces4.length;f<fl;f++){value=customAttribute.value[chunk_faces4[f]];v1=value;v2=value;v3=value;v4=value;customAttribute.array[offset_custom]=v1.x;customAttribute.array[offset_custom+1]=v1.y;customAttribute.array[offset_custom+2]=v2.x;customAttribute.array[offset_custom+3]=v2.y;customAttribute.array[offset_custom+4]=v3.x;customAttribute.array[offset_custom+5]=v3.y;customAttribute.array[offset_custom+6]=v4.x;customAttribute.array[offset_custom+7]=v4.y;offset_custom+=8;}}}else if(customAttribute.size===3){var pp;if(customAttribute.type==="c"){pp=["r","g","b"];}else{pp=["x","y","z"];}
if(customAttribute.boundTo===undefined||customAttribute.boundTo==="vertices"){for(f=0,fl=chunk_faces3.length;f<fl;f++){face=obj_faces[chunk_faces3[f]];v1=customAttribute.value[face.a];v2=customAttribute.value[face.b];v3=customAttribute.value[face.c];customAttribute.array[offset_custom]=v1[pp[0]];customAttribute.array[offset_custom+1]=v1[pp[1]];customAttribute.array[offset_custom+2]=v1[pp[2]];customAttribute.array[offset_custom+3]=v2[pp[0]];customAttribute.array[offset_custom+4]=v2[pp[1]];customAttribute.array[offset_custom+5]=v2[pp[2]];customAttribute.array[offset_custom+6]=v3[pp[0]];customAttribute.array[offset_custom+7]=v3[pp[1]];customAttribute.array[offset_custom+8]=v3[pp[2]];offset_custom+=9;}
for(f=0,fl=chunk_faces4.length;f<fl;f++){face=obj_faces[chunk_faces4[f]];v1=customAttribute.value[face.a];v2=customAttribute.value[face.b];v3=customAttribute.value[face.c];v4=customAttribute.value[face.d];customAttribute.array[offset_custom]=v1[pp[0]];customAttribute.array[offset_custom+1]=v1[pp[1]];customAttribute.array[offset_custom+2]=v1[pp[2]];customAttribute.array[offset_custom+3]=v2[pp[0]];customAttribute.array[offset_custom+4]=v2[pp[1]];customAttribute.array[offset_custom+5]=v2[pp[2]];customAttribute.array[offset_custom+6]=v3[pp[0]];customAttribute.array[offset_custom+7]=v3[pp[1]];customAttribute.array[offset_custom+8]=v3[pp[2]];customAttribute.array[offset_custom+9]=v4[pp[0]];customAttribute.array[offset_custom+10]=v4[pp[1]];customAttribute.array[offset_custom+11]=v4[pp[2]];offset_custom+=12;}}else if(customAttribute.boundTo==="faces"){for(f=0,fl=chunk_faces3.length;f<fl;f++){value=customAttribute.value[chunk_faces3[f]];v1=value;v2=value;v3=value;customAttribute.array[offset_custom]=v1[pp[0]];customAttribute.array[offset_custom+1]=v1[pp[1]];customAttribute.array[offset_custom+2]=v1[pp[2]];customAttribute.array[offset_custom+3]=v2[pp[0]];customAttribute.array[offset_custom+4]=v2[pp[1]];customAttribute.array[offset_custom+5]=v2[pp[2]];customAttribute.array[offset_custom+6]=v3[pp[0]];customAttribute.array[offset_custom+7]=v3[pp[1]];customAttribute.array[offset_custom+8]=v3[pp[2]];offset_custom+=9;}
for(f=0,fl=chunk_faces4.length;f<fl;f++){value=customAttribute.value[chunk_faces4[f]];v1=value;v2=value;v3=value;v4=value;customAttribute.array[offset_custom]=v1[pp[0]];customAttribute.array[offset_custom+1]=v1[pp[1]];customAttribute.array[offset_custom+2]=v1[pp[2]];customAttribute.array[offset_custom+3]=v2[pp[0]];customAttribute.array[offset_custom+4]=v2[pp[1]];customAttribute.array[offset_custom+5]=v2[pp[2]];customAttribute.array[offset_custom+6]=v3[pp[0]];customAttribute.array[offset_custom+7]=v3[pp[1]];customAttribute.array[offset_custom+8]=v3[pp[2]];customAttribute.array[offset_custom+9]=v4[pp[0]];customAttribute.array[offset_custom+10]=v4[pp[1]];customAttribute.array[offset_custom+11]=v4[pp[2]];offset_custom+=12;}}else if(customAttribute.boundTo==="faceVertices"){for(f=0,fl=chunk_faces3.length;f<fl;f++){value=customAttribute.value[chunk_faces3[f]];v1=value[0];v2=value[1];v3=value[2];customAttribute.array[offset_custom]=v1[pp[0]];customAttribute.array[offset_custom+1]=v1[pp[1]];customAttribute.array[offset_custom+2]=v1[pp[2]];customAttribute.array[offset_custom+3]=v2[pp[0]];customAttribute.array[offset_custom+4]=v2[pp[1]];customAttribute.array[offset_custom+5]=v2[pp[2]];customAttribute.array[offset_custom+6]=v3[pp[0]];customAttribute.array[offset_custom+7]=v3[pp[1]];customAttribute.array[offset_custom+8]=v3[pp[2]];offset_custom+=9;}
for(f=0,fl=chunk_faces4.length;f<fl;f++){value=customAttribute.value[chunk_faces4[f]];v1=value[0];v2=value[1];v3=value[2];v4=value[3];customAttribute.array[offset_custom]=v1[pp[0]];customAttribute.array[offset_custom+1]=v1[pp[1]];customAttribute.array[offset_custom+2]=v1[pp[2]];customAttribute.array[offset_custom+3]=v2[pp[0]];customAttribute.array[offset_custom+4]=v2[pp[1]];customAttribute.array[offset_custom+5]=v2[pp[2]];customAttribute.array[offset_custom+6]=v3[pp[0]];customAttribute.array[offset_custom+7]=v3[pp[1]];customAttribute.array[offset_custom+8]=v3[pp[2]];customAttribute.array[offset_custom+9]=v4[pp[0]];customAttribute.array[offset_custom+10]=v4[pp[1]];customAttribute.array[offset_custom+11]=v4[pp[2]];offset_custom+=12;}}}else if(customAttribute.size===4){if(customAttribute.boundTo===undefined||customAttribute.boundTo==="vertices"){for(f=0,fl=chunk_faces3.length;f<fl;f++){face=obj_faces[chunk_faces3[f]];v1=customAttribute.value[face.a];v2=customAttribute.value[face.b];v3=customAttribute.value[face.c];customAttribute.array[offset_custom]=v1.x;customAttribute.array[offset_custom+1]=v1.y;customAttribute.array[offset_custom+2]=v1.z;customAttribute.array[offset_custom+3]=v1.w;customAttribute.array[offset_custom+4]=v2.x;customAttribute.array[offset_custom+5]=v2.y;customAttribute.array[offset_custom+6]=v2.z;customAttribute.array[offset_custom+7]=v2.w;customAttribute.array[offset_custom+8]=v3.x;customAttribute.array[offset_custom+9]=v3.y;customAttribute.array[offset_custom+10]=v3.z;customAttribute.array[offset_custom+11]=v3.w;offset_custom+=12;}
for(f=0,fl=chunk_faces4.length;f<fl;f++){face=obj_faces[chunk_faces4[f]];v1=customAttribute.value[face.a];v2=customAttribute.value[face.b];v3=customAttribute.value[face.c];v4=customAttribute.value[face.d];customAttribute.array[offset_custom]=v1.x;customAttribute.array[offset_custom+1]=v1.y;customAttribute.array[offset_custom+2]=v1.z;customAttribute.array[offset_custom+3]=v1.w;customAttribute.array[offset_custom+4]=v2.x;customAttribute.array[offset_custom+5]=v2.y;customAttribute.array[offset_custom+6]=v2.z;customAttribute.array[offset_custom+7]=v2.w;customAttribute.array[offset_custom+8]=v3.x;customAttribute.array[offset_custom+9]=v3.y;customAttribute.array[offset_custom+10]=v3.z;customAttribute.array[offset_custom+11]=v3.w;customAttribute.array[offset_custom+12]=v4.x;customAttribute.array[offset_custom+13]=v4.y;customAttribute.array[offset_custom+14]=v4.z;customAttribute.array[offset_custom+15]=v4.w;offset_custom+=16;}}else if(customAttribute.boundTo==="faces"){for(f=0,fl=chunk_faces3.length;f<fl;f++){value=customAttribute.value[chunk_faces3[f]];v1=value;v2=value;v3=value;customAttribute.array[offset_custom]=v1.x;customAttribute.array[offset_custom+1]=v1.y;customAttribute.array[offset_custom+2]=v1.z;customAttribute.array[offset_custom+3]=v1.w;customAttribute.array[offset_custom+4]=v2.x;customAttribute.array[offset_custom+5]=v2.y;customAttribute.array[offset_custom+6]=v2.z;customAttribute.array[offset_custom+7]=v2.w;customAttribute.array[offset_custom+8]=v3.x;customAttribute.array[offset_custom+9]=v3.y;customAttribute.array[offset_custom+10]=v3.z;customAttribute.array[offset_custom+11]=v3.w;offset_custom+=12;}
for(f=0,fl=chunk_faces4.length;f<fl;f++){value=customAttribute.value[chunk_faces4[f]];v1=value;v2=value;v3=value;v4=value;customAttribute.array[offset_custom]=v1.x;customAttribute.array[offset_custom+1]=v1.y;customAttribute.array[offset_custom+2]=v1.z;customAttribute.array[offset_custom+3]=v1.w;customAttribute.array[offset_custom+4]=v2.x;customAttribute.array[offset_custom+5]=v2.y;customAttribute.array[offset_custom+6]=v2.z;customAttribute.array[offset_custom+7]=v2.w;customAttribute.array[offset_custom+8]=v3.x;customAttribute.array[offset_custom+9]=v3.y;customAttribute.array[offset_custom+10]=v3.z;customAttribute.array[offset_custom+11]=v3.w;customAttribute.array[offset_custom+12]=v4.x;customAttribute.array[offset_custom+13]=v4.y;customAttribute.array[offset_custom+14]=v4.z;customAttribute.array[offset_custom+15]=v4.w;offset_custom+=16;}}else if(customAttribute.boundTo==="faceVertices"){for(f=0,fl=chunk_faces3.length;f<fl;f++){value=customAttribute.value[chunk_faces3[f]];v1=value[0];v2=value[1];v3=value[2];customAttribute.array[offset_custom]=v1.x;customAttribute.array[offset_custom+1]=v1.y;customAttribute.array[offset_custom+2]=v1.z;customAttribute.array[offset_custom+3]=v1.w;customAttribute.array[offset_custom+4]=v2.x;customAttribute.array[offset_custom+5]=v2.y;customAttribute.array[offset_custom+6]=v2.z;customAttribute.array[offset_custom+7]=v2.w;customAttribute.array[offset_custom+8]=v3.x;customAttribute.array[offset_custom+9]=v3.y;customAttribute.array[offset_custom+10]=v3.z;customAttribute.array[offset_custom+11]=v3.w;offset_custom+=12;}
for(f=0,fl=chunk_faces4.length;f<fl;f++){value=customAttribute.value[chunk_faces4[f]];v1=value[0];v2=value[1];v3=value[2];v4=value[3];customAttribute.array[offset_custom]=v1.x;customAttribute.array[offset_custom+1]=v1.y;customAttribute.array[offset_custom+2]=v1.z;customAttribute.array[offset_custom+3]=v1.w;customAttribute.array[offset_custom+4]=v2.x;customAttribute.array[offset_custom+5]=v2.y;customAttribute.array[offset_custom+6]=v2.z;customAttribute.array[offset_custom+7]=v2.w;customAttribute.array[offset_custom+8]=v3.x;customAttribute.array[offset_custom+9]=v3.y;customAttribute.array[offset_custom+10]=v3.z;customAttribute.array[offset_custom+11]=v3.w;customAttribute.array[offset_custom+12]=v4.x;customAttribute.array[offset_custom+13]=v4.y;customAttribute.array[offset_custom+14]=v4.z;customAttribute.array[offset_custom+15]=v4.w;offset_custom+=16;}}}
_gl.bindBuffer(_gl.ARRAY_BUFFER,customAttribute.buffer);_gl.bufferData(_gl.ARRAY_BUFFER,customAttribute.array,hint);}}
if(dispose){delete geometryGroup.__inittedArrays;delete geometryGroup.__colorArray;delete geometryGroup.__normalArray;delete geometryGroup.__tangentArray;delete geometryGroup.__uvArray;delete geometryGroup.__uv2Array;delete geometryGroup.__faceArray;delete geometryGroup.__vertexArray;delete geometryGroup.__lineArray;delete geometryGroup.__skinIndexArray;delete geometryGroup.__skinWeightArray;}};function setDirectBuffers(geometry,hint,dispose){var attributes=geometry.attributes;var index=attributes["index"];var position=attributes["position"];var normal=attributes["normal"];var uv=attributes["uv"];var color=attributes["color"];var tangent=attributes["tangent"];if(geometry.elementsNeedUpdate&&index!==undefined){_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,index.buffer);_gl.bufferData(_gl.ELEMENT_ARRAY_BUFFER,index.array,hint);}
if(geometry.verticesNeedUpdate&&position!==undefined){_gl.bindBuffer(_gl.ARRAY_BUFFER,position.buffer);_gl.bufferData(_gl.ARRAY_BUFFER,position.array,hint);}
if(geometry.normalsNeedUpdate&&normal!==undefined){_gl.bindBuffer(_gl.ARRAY_BUFFER,normal.buffer);_gl.bufferData(_gl.ARRAY_BUFFER,normal.array,hint);}
if(geometry.uvsNeedUpdate&&uv!==undefined){_gl.bindBuffer(_gl.ARRAY_BUFFER,uv.buffer);_gl.bufferData(_gl.ARRAY_BUFFER,uv.array,hint);}
if(geometry.colorsNeedUpdate&&color!==undefined){_gl.bindBuffer(_gl.ARRAY_BUFFER,color.buffer);_gl.bufferData(_gl.ARRAY_BUFFER,color.array,hint);}
if(geometry.tangentsNeedUpdate&&tangent!==undefined){_gl.bindBuffer(_gl.ARRAY_BUFFER,tangent.buffer);_gl.bufferData(_gl.ARRAY_BUFFER,tangent.array,hint);}
if(dispose){for(var i in geometry.attributes){delete geometry.attributes[i].array;}}};this.renderBufferImmediate=function(object,program,material){if(object.hasPositions&&!object.__webglVertexBuffer)object.__webglVertexBuffer=_gl.createBuffer();if(object.hasNormals&&!object.__webglNormalBuffer)object.__webglNormalBuffer=_gl.createBuffer();if(object.hasUvs&&!object.__webglUvBuffer)object.__webglUvBuffer=_gl.createBuffer();if(object.hasColors&&!object.__webglColorBuffer)object.__webglColorBuffer=_gl.createBuffer();if(object.hasPositions){_gl.bindBuffer(_gl.ARRAY_BUFFER,object.__webglVertexBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,object.positionArray,_gl.DYNAMIC_DRAW);_gl.enableVertexAttribArray(program.attributes.position);_gl.vertexAttribPointer(program.attributes.position,3,_gl.FLOAT,false,0,0);}
if(object.hasNormals){_gl.bindBuffer(_gl.ARRAY_BUFFER,object.__webglNormalBuffer);if(material.shading===THREE.FlatShading){var nx,ny,nz,nax,nbx,ncx,nay,nby,ncy,naz,nbz,ncz,normalArray,i,il=object.count*3;for(i=0;i<il;i+=9){normalArray=object.normalArray;nax=normalArray[i];nay=normalArray[i+1];naz=normalArray[i+2];nbx=normalArray[i+3];nby=normalArray[i+4];nbz=normalArray[i+5];ncx=normalArray[i+6];ncy=normalArray[i+7];ncz=normalArray[i+8];nx=(nax+nbx+ncx)/3;ny=(nay+nby+ncy)/3;nz=(naz+nbz+ncz)/3;normalArray[i]=nx;normalArray[i+1]=ny;normalArray[i+2]=nz;normalArray[i+3]=nx;normalArray[i+4]=ny;normalArray[i+5]=nz;normalArray[i+6]=nx;normalArray[i+7]=ny;normalArray[i+8]=nz;}}
_gl.bufferData(_gl.ARRAY_BUFFER,object.normalArray,_gl.DYNAMIC_DRAW);_gl.enableVertexAttribArray(program.attributes.normal);_gl.vertexAttribPointer(program.attributes.normal,3,_gl.FLOAT,false,0,0);}
if(object.hasUvs&&material.map){_gl.bindBuffer(_gl.ARRAY_BUFFER,object.__webglUvBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,object.uvArray,_gl.DYNAMIC_DRAW);_gl.enableVertexAttribArray(program.attributes.uv);_gl.vertexAttribPointer(program.attributes.uv,2,_gl.FLOAT,false,0,0);}
if(object.hasColors&&material.vertexColors!==THREE.NoColors){_gl.bindBuffer(_gl.ARRAY_BUFFER,object.__webglColorBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,object.colorArray,_gl.DYNAMIC_DRAW);_gl.enableVertexAttribArray(program.attributes.color);_gl.vertexAttribPointer(program.attributes.color,3,_gl.FLOAT,false,0,0);}
_gl.drawArrays(_gl.TRIANGLES,0,object.count);object.count=0;};this.renderBufferDirect=function(camera,lights,fog,material,geometry,object){if(material.visible===false)return;var program,attributes,linewidth,primitives,a,attribute;program=setProgram(camera,lights,fog,material,object);attributes=program.attributes;var updateBuffers=false,wireframeBit=material.wireframe?1:0,geometryHash=(geometry.id*0xffffff)+(program.id*2)+wireframeBit;if(geometryHash!==_currentGeometryGroupHash){_currentGeometryGroupHash=geometryHash;updateBuffers=true;}
if(object instanceof THREE.Mesh){var offsets=geometry.offsets;if(offsets.length>1)updateBuffers=true;for(var i=0,il=offsets.length;i<il;++i){var startIndex=offsets[i].index;if(updateBuffers){var position=geometry.attributes["position"];var positionSize=position.itemSize;_gl.bindBuffer(_gl.ARRAY_BUFFER,position.buffer);_gl.vertexAttribPointer(attributes.position,positionSize,_gl.FLOAT,false,0,startIndex*positionSize*4);var normal=geometry.attributes["normal"];if(attributes.normal>=0&&normal){var normalSize=normal.itemSize;_gl.bindBuffer(_gl.ARRAY_BUFFER,normal.buffer);_gl.vertexAttribPointer(attributes.normal,normalSize,_gl.FLOAT,false,0,startIndex*normalSize*4);}
var uv=geometry.attributes["uv"];if(attributes.uv>=0&&uv){if(uv.buffer){var uvSize=uv.itemSize;_gl.bindBuffer(_gl.ARRAY_BUFFER,uv.buffer);_gl.vertexAttribPointer(attributes.uv,uvSize,_gl.FLOAT,false,0,startIndex*uvSize*4);_gl.enableVertexAttribArray(attributes.uv);}else{_gl.disableVertexAttribArray(attributes.uv);}}
var color=geometry.attributes["color"];if(attributes.color>=0&&color){var colorSize=color.itemSize;_gl.bindBuffer(_gl.ARRAY_BUFFER,color.buffer);_gl.vertexAttribPointer(attributes.color,colorSize,_gl.FLOAT,false,0,startIndex*colorSize*4);}
var tangent=geometry.attributes["tangent"];if(attributes.tangent>=0&&tangent){var tangentSize=tangent.itemSize;_gl.bindBuffer(_gl.ARRAY_BUFFER,tangent.buffer);_gl.vertexAttribPointer(attributes.tangent,tangentSize,_gl.FLOAT,false,0,startIndex*tangentSize*4);}
var index=geometry.attributes["index"];_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,index.buffer);}
_gl.drawElements(_gl.TRIANGLES,offsets[i].count,_gl.UNSIGNED_SHORT,offsets[i].start*2);_this.info.render.calls++;_this.info.render.vertices+=offsets[i].count;_this.info.render.faces+=offsets[i].count/3;}}else if(object instanceof THREE.ParticleSystem){if(updateBuffers){var position=geometry.attributes["position"];var positionSize=position.itemSize;_gl.bindBuffer(_gl.ARRAY_BUFFER,position.buffer);_gl.vertexAttribPointer(attributes.position,positionSize,_gl.FLOAT,false,0,0);var color=geometry.attributes["color"];if(attributes.color>=0&&color){var colorSize=color.itemSize;_gl.bindBuffer(_gl.ARRAY_BUFFER,color.buffer);_gl.vertexAttribPointer(attributes.color,colorSize,_gl.FLOAT,false,0,0);}
_gl.drawArrays(_gl.POINTS,0,position.numItems/3);_this.info.render.calls++;_this.info.render.points+=position.numItems/3;}}};this.renderBuffer=function(camera,lights,fog,material,geometryGroup,object){if(material.visible===false)return;var program,attributes,linewidth,primitives,a,attribute,i,il;program=setProgram(camera,lights,fog,material,object);attributes=program.attributes;var updateBuffers=false,wireframeBit=material.wireframe?1:0,geometryGroupHash=(geometryGroup.id*0xffffff)+(program.id*2)+wireframeBit;if(geometryGroupHash!==_currentGeometryGroupHash){_currentGeometryGroupHash=geometryGroupHash;updateBuffers=true;}
if(!material.morphTargets&&attributes.position>=0){if(updateBuffers){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglVertexBuffer);_gl.vertexAttribPointer(attributes.position,3,_gl.FLOAT,false,0,0);}}else{if(object.morphTargetBase){setupMorphTargets(material,geometryGroup,object);}}
if(updateBuffers){if(geometryGroup.__webglCustomAttributesList){for(i=0,il=geometryGroup.__webglCustomAttributesList.length;i<il;i++){attribute=geometryGroup.__webglCustomAttributesList[i];if(attributes[attribute.buffer.belongsToAttribute]>=0){_gl.bindBuffer(_gl.ARRAY_BUFFER,attribute.buffer);_gl.vertexAttribPointer(attributes[attribute.buffer.belongsToAttribute],attribute.size,_gl.FLOAT,false,0,0);}}}
if(attributes.color>=0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglColorBuffer);_gl.vertexAttribPointer(attributes.color,3,_gl.FLOAT,false,0,0);}
if(attributes.normal>=0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglNormalBuffer);_gl.vertexAttribPointer(attributes.normal,3,_gl.FLOAT,false,0,0);}
if(attributes.tangent>=0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglTangentBuffer);_gl.vertexAttribPointer(attributes.tangent,4,_gl.FLOAT,false,0,0);}
if(attributes.uv>=0){if(geometryGroup.__webglUVBuffer){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglUVBuffer);_gl.vertexAttribPointer(attributes.uv,2,_gl.FLOAT,false,0,0);_gl.enableVertexAttribArray(attributes.uv);}else{_gl.disableVertexAttribArray(attributes.uv);}}
if(attributes.uv2>=0){if(geometryGroup.__webglUV2Buffer){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglUV2Buffer);_gl.vertexAttribPointer(attributes.uv2,2,_gl.FLOAT,false,0,0);_gl.enableVertexAttribArray(attributes.uv2);}else{_gl.disableVertexAttribArray(attributes.uv2);}}
if(material.skinning&&attributes.skinIndex>=0&&attributes.skinWeight>=0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglSkinIndicesBuffer);_gl.vertexAttribPointer(attributes.skinIndex,4,_gl.FLOAT,false,0,0);_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglSkinWeightsBuffer);_gl.vertexAttribPointer(attributes.skinWeight,4,_gl.FLOAT,false,0,0);}}
if(object instanceof THREE.Mesh){if(material.wireframe){setLineWidth(material.wireframeLinewidth);if(updateBuffers)_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,geometryGroup.__webglLineBuffer);_gl.drawElements(_gl.LINES,geometryGroup.__webglLineCount,_gl.UNSIGNED_SHORT,0);}else{if(updateBuffers)_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,geometryGroup.__webglFaceBuffer);_gl.drawElements(_gl.TRIANGLES,geometryGroup.__webglFaceCount,_gl.UNSIGNED_SHORT,0);}
_this.info.render.calls++;_this.info.render.vertices+=geometryGroup.__webglFaceCount;_this.info.render.faces+=geometryGroup.__webglFaceCount/3;}else if(object instanceof THREE.Line){primitives=(object.type===THREE.LineStrip)?_gl.LINE_STRIP:_gl.LINES;setLineWidth(material.linewidth);_gl.drawArrays(primitives,0,geometryGroup.__webglLineCount);_this.info.render.calls++;}else if(object instanceof THREE.ParticleSystem){_gl.drawArrays(_gl.POINTS,0,geometryGroup.__webglParticleCount);_this.info.render.calls++;_this.info.render.points+=geometryGroup.__webglParticleCount;}else if(object instanceof THREE.Ribbon){_gl.drawArrays(_gl.TRIANGLE_STRIP,0,geometryGroup.__webglVertexCount);_this.info.render.calls++;}};function setupMorphTargets(material,geometryGroup,object){var attributes=material.program.attributes;if(object.morphTargetBase!==-1){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglMorphTargetsBuffers[object.morphTargetBase]);_gl.vertexAttribPointer(attributes.position,3,_gl.FLOAT,false,0,0);}else if(attributes.position>=0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglVertexBuffer);_gl.vertexAttribPointer(attributes.position,3,_gl.FLOAT,false,0,0);}
if(object.morphTargetForcedOrder.length){var m=0;var order=object.morphTargetForcedOrder;var influences=object.morphTargetInfluences;while(m<material.numSupportedMorphTargets&&m<order.length){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglMorphTargetsBuffers[order[m]]);_gl.vertexAttribPointer(attributes["morphTarget"+m],3,_gl.FLOAT,false,0,0);if(material.morphNormals){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglMorphNormalsBuffers[order[m]]);_gl.vertexAttribPointer(attributes["morphNormal"+m],3,_gl.FLOAT,false,0,0);}
object.__webglMorphTargetInfluences[m]=influences[order[m]];m++;}}else{var influence,activeInfluenceIndices=[];var influences=object.morphTargetInfluences;var i,il=influences.length;for(i=0;i<il;i++){influence=influences[i];if(influence>0){activeInfluenceIndices.push([i,influence]);}}
if(activeInfluenceIndices.length>material.numSupportedMorphTargets){activeInfluenceIndices.sort(numericalSort);activeInfluenceIndices.length=material.numSupportedMorphTargets;}else if(activeInfluenceIndices.length>material.numSupportedMorphNormals){activeInfluenceIndices.sort(numericalSort);}else if(activeInfluenceIndices.length===0){activeInfluenceIndices.push([0,0]);};var influenceIndex,m=0;while(m<material.numSupportedMorphTargets){if(activeInfluenceIndices[m]){influenceIndex=activeInfluenceIndices[m][0];_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglMorphTargetsBuffers[influenceIndex]);_gl.vertexAttribPointer(attributes["morphTarget"+m],3,_gl.FLOAT,false,0,0);if(material.morphNormals){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglMorphNormalsBuffers[influenceIndex]);_gl.vertexAttribPointer(attributes["morphNormal"+m],3,_gl.FLOAT,false,0,0);}
object.__webglMorphTargetInfluences[m]=influences[influenceIndex];}else{_gl.vertexAttribPointer(attributes["morphTarget"+m],3,_gl.FLOAT,false,0,0);if(material.morphNormals){_gl.vertexAttribPointer(attributes["morphNormal"+m],3,_gl.FLOAT,false,0,0);}
object.__webglMorphTargetInfluences[m]=0;}
m++;}}
if(material.program.uniforms.morphTargetInfluences!==null){_gl.uniform1fv(material.program.uniforms.morphTargetInfluences,object.__webglMorphTargetInfluences);}};function painterSort(a,b){return b.z-a.z;};function numericalSort(a,b){return b[1]-a[1];};this.render=function(scene,camera,renderTarget,forceClear){if(camera instanceof THREE.Camera===false){console.error('THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.');return;}
var i,il,webglObject,object,renderList,lights=scene.__lights,fog=scene.fog;_currentMaterialId=-1;_lightsNeedUpdate=true;if(this.autoUpdateScene)scene.updateMatrixWorld();if(camera.parent===undefined)camera.updateMatrixWorld();if(!camera._viewMatrixArray)camera._viewMatrixArray=new Float32Array(16);if(!camera._projectionMatrixArray)camera._projectionMatrixArray=new Float32Array(16);camera.matrixWorldInverse.getInverse(camera.matrixWorld);camera.matrixWorldInverse.flattenToArray(camera._viewMatrixArray);camera.projectionMatrix.flattenToArray(camera._projectionMatrixArray);_projScreenMatrix.multiply(camera.projectionMatrix,camera.matrixWorldInverse);_frustum.setFromMatrix(_projScreenMatrix);if(this.autoUpdateObjects)this.initWebGLObjects(scene);renderPlugins(this.renderPluginsPre,scene,camera);_this.info.render.calls=0;_this.info.render.vertices=0;_this.info.render.faces=0;_this.info.render.points=0;this.setRenderTarget(renderTarget);if(this.autoClear||forceClear){this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);}
renderList=scene.__webglObjects;for(i=0,il=renderList.length;i<il;i++){webglObject=renderList[i];object=webglObject.object;webglObject.render=false;if(object.visible){if(!(object instanceof THREE.Mesh||object instanceof THREE.ParticleSystem)||!(object.frustumCulled)||_frustum.contains(object)){setupMatrices(object,camera);unrollBufferMaterial(webglObject);webglObject.render=true;if(this.sortObjects===true){if(object.renderDepth!==null){webglObject.z=object.renderDepth;}else{_vector3.copy(object.matrixWorld.getPosition());_projScreenMatrix.multiplyVector3(_vector3);webglObject.z=_vector3.z;}}}}}
if(this.sortObjects){renderList.sort(painterSort);}
renderList=scene.__webglObjectsImmediate;for(i=0,il=renderList.length;i<il;i++){webglObject=renderList[i];object=webglObject.object;if(object.visible){setupMatrices(object,camera);unrollImmediateBufferMaterial(webglObject);}}
if(scene.overrideMaterial){var material=scene.overrideMaterial;this.setBlending(material.blending,material.blendEquation,material.blendSrc,material.blendDst);this.setDepthTest(material.depthTest);this.setDepthWrite(material.depthWrite);setPolygonOffset(material.polygonOffset,material.polygonOffsetFactor,material.polygonOffsetUnits);renderObjects(scene.__webglObjects,false,"",camera,lights,fog,true,material);renderObjectsImmediate(scene.__webglObjectsImmediate,"",camera,lights,fog,false,material);}else{this.setBlending(THREE.NormalBlending);renderObjects(scene.__webglObjects,true,"opaque",camera,lights,fog,false);renderObjectsImmediate(scene.__webglObjectsImmediate,"opaque",camera,lights,fog,false);renderObjects(scene.__webglObjects,false,"transparent",camera,lights,fog,true);renderObjectsImmediate(scene.__webglObjectsImmediate,"transparent",camera,lights,fog,true);}
renderPlugins(this.renderPluginsPost,scene,camera);if(renderTarget&&renderTarget.generateMipmaps&&renderTarget.minFilter!==THREE.NearestFilter&&renderTarget.minFilter!==THREE.LinearFilter){updateRenderTargetMipmap(renderTarget);}
this.setDepthTest(true);this.setDepthWrite(true);};function renderPlugins(plugins,scene,camera){if(!plugins.length)return;for(var i=0,il=plugins.length;i<il;i++){_currentProgram=null;_currentCamera=null;_oldBlending=-1;_oldDepthTest=-1;_oldDepthWrite=-1;_oldDoubleSided=-1;_oldFlipSided=-1;_currentGeometryGroupHash=-1;_currentMaterialId=-1;_lightsNeedUpdate=true;plugins[i].render(scene,camera,_currentWidth,_currentHeight);_currentProgram=null;_currentCamera=null;_oldBlending=-1;_oldDepthTest=-1;_oldDepthWrite=-1;_oldDoubleSided=-1;_oldFlipSided=-1;_currentGeometryGroupHash=-1;_currentMaterialId=-1;_lightsNeedUpdate=true;}};function renderObjects(renderList,reverse,materialType,camera,lights,fog,useBlending,overrideMaterial){var webglObject,object,buffer,material,start,end,delta;if(reverse){start=renderList.length-1;end=-1;delta=-1;}else{start=0;end=renderList.length;delta=1;}
for(var i=start;i!==end;i+=delta){webglObject=renderList[i];if(webglObject.render){object=webglObject.object;buffer=webglObject.buffer;if(overrideMaterial){material=overrideMaterial;}else{material=webglObject[materialType];if(!material)continue;if(useBlending)_this.setBlending(material.blending,material.blendEquation,material.blendSrc,material.blendDst);_this.setDepthTest(material.depthTest);_this.setDepthWrite(material.depthWrite);setPolygonOffset(material.polygonOffset,material.polygonOffsetFactor,material.polygonOffsetUnits);}
_this.setMaterialFaces(material);if(buffer instanceof THREE.BufferGeometry){_this.renderBufferDirect(camera,lights,fog,material,buffer,object);}else{_this.renderBuffer(camera,lights,fog,material,buffer,object);}}}};function renderObjectsImmediate(renderList,materialType,camera,lights,fog,useBlending,overrideMaterial){var webglObject,object,material,program;for(var i=0,il=renderList.length;i<il;i++){webglObject=renderList[i];object=webglObject.object;if(object.visible){if(overrideMaterial){material=overrideMaterial;}else{material=webglObject[materialType];if(!material)continue;if(useBlending)_this.setBlending(material.blending,material.blendEquation,material.blendSrc,material.blendDst);_this.setDepthTest(material.depthTest);_this.setDepthWrite(material.depthWrite);setPolygonOffset(material.polygonOffset,material.polygonOffsetFactor,material.polygonOffsetUnits);}
_this.renderImmediateObject(camera,lights,fog,material,object);}}};this.renderImmediateObject=function(camera,lights,fog,material,object){var program=setProgram(camera,lights,fog,material,object);_currentGeometryGroupHash=-1;_this.setMaterialFaces(material);if(object.immediateRenderCallback){object.immediateRenderCallback(program,_gl,_frustum);}else{object.render(function(object){_this.renderBufferImmediate(object,program,material);});}};function unrollImmediateBufferMaterial(globject){var object=globject.object,material=object.material;if(material.transparent){globject.transparent=material;globject.opaque=null;}else{globject.opaque=material;globject.transparent=null;}};function unrollBufferMaterial(globject){var object=globject.object,buffer=globject.buffer,material,materialIndex,meshMaterial;meshMaterial=object.material;if(meshMaterial instanceof THREE.MeshFaceMaterial){materialIndex=buffer.materialIndex;if(materialIndex>=0){material=object.geometry.materials[materialIndex];if(material.transparent){globject.transparent=material;globject.opaque=null;}else{globject.opaque=material;globject.transparent=null;}}}else{material=meshMaterial;if(material){if(material.transparent){globject.transparent=material;globject.opaque=null;}else{globject.opaque=material;globject.transparent=null;}}}};function sortFacesByMaterial(geometry){var f,fl,face,materialIndex,vertices,materialHash,groupHash,hash_map={};var numMorphTargets=geometry.morphTargets.length;var numMorphNormals=geometry.morphNormals.length;geometry.geometryGroups={};for(f=0,fl=geometry.faces.length;f<fl;f++){face=geometry.faces[f];materialIndex=face.materialIndex;materialHash=(materialIndex!==undefined)?materialIndex:-1;if(hash_map[materialHash]===undefined){hash_map[materialHash]={'hash':materialHash,'counter':0};}
groupHash=hash_map[materialHash].hash+'_'+hash_map[materialHash].counter;if(geometry.geometryGroups[groupHash]===undefined){geometry.geometryGroups[groupHash]={'faces3':[],'faces4':[],'materialIndex':materialIndex,'vertices':0,'numMorphTargets':numMorphTargets,'numMorphNormals':numMorphNormals};}
vertices=face instanceof THREE.Face3?3:4;if(geometry.geometryGroups[groupHash].vertices+vertices>65535){hash_map[materialHash].counter+=1;groupHash=hash_map[materialHash].hash+'_'+hash_map[materialHash].counter;if(geometry.geometryGroups[groupHash]===undefined){geometry.geometryGroups[groupHash]={'faces3':[],'faces4':[],'materialIndex':materialIndex,'vertices':0,'numMorphTargets':numMorphTargets,'numMorphNormals':numMorphNormals};}}
if(face instanceof THREE.Face3){geometry.geometryGroups[groupHash].faces3.push(f);}else{geometry.geometryGroups[groupHash].faces4.push(f);}
geometry.geometryGroups[groupHash].vertices+=vertices;}
geometry.geometryGroupsList=[];for(var g in geometry.geometryGroups){geometry.geometryGroups[g].id=_geometryGroupCounter++;geometry.geometryGroupsList.push(geometry.geometryGroups[g]);}};this.initWebGLObjects=function(scene){if(!scene.__webglObjects){scene.__webglObjects=[];scene.__webglObjectsImmediate=[];scene.__webglSprites=[];scene.__webglFlares=[];}
while(scene.__objectsAdded.length){addObject(scene.__objectsAdded[0],scene);scene.__objectsAdded.splice(0,1);}
while(scene.__objectsRemoved.length){removeObject(scene.__objectsRemoved[0],scene);scene.__objectsRemoved.splice(0,1);}
for(var o=0,ol=scene.__webglObjects.length;o<ol;o++){updateObject(scene.__webglObjects[o].object);}};function addObject(object,scene){var g,geometry,geometryGroup;if(!object.__webglInit){object.__webglInit=true;object._modelViewMatrix=new THREE.Matrix4();object._normalMatrix=new THREE.Matrix3();if(object instanceof THREE.Mesh){geometry=object.geometry;if(geometry instanceof THREE.Geometry){if(geometry.geometryGroups===undefined){sortFacesByMaterial(geometry);}
for(g in geometry.geometryGroups){geometryGroup=geometry.geometryGroups[g];if(!geometryGroup.__webglVertexBuffer){createMeshBuffers(geometryGroup);initMeshBuffers(geometryGroup,object);geometry.verticesNeedUpdate=true;geometry.morphTargetsNeedUpdate=true;geometry.elementsNeedUpdate=true;geometry.uvsNeedUpdate=true;geometry.normalsNeedUpdate=true;geometry.tangentsNeedUpdate=true;geometry.colorsNeedUpdate=true;}}}else if(geometry instanceof THREE.BufferGeometry){initDirectBuffers(geometry);}}else if(object instanceof THREE.Ribbon){geometry=object.geometry;if(!geometry.__webglVertexBuffer){createRibbonBuffers(geometry);initRibbonBuffers(geometry);geometry.verticesNeedUpdate=true;geometry.colorsNeedUpdate=true;}}else if(object instanceof THREE.Line){geometry=object.geometry;if(!geometry.__webglVertexBuffer){createLineBuffers(geometry);initLineBuffers(geometry,object);geometry.verticesNeedUpdate=true;geometry.colorsNeedUpdate=true;}}else if(object instanceof THREE.ParticleSystem){geometry=object.geometry;if(!geometry.__webglVertexBuffer){if(geometry instanceof THREE.Geometry){createParticleBuffers(geometry);initParticleBuffers(geometry,object);geometry.verticesNeedUpdate=true;geometry.colorsNeedUpdate=true;}else if(geometry instanceof THREE.BufferGeometry){initDirectBuffers(geometry);}}}}
if(!object.__webglActive){if(object instanceof THREE.Mesh){geometry=object.geometry;if(geometry instanceof THREE.BufferGeometry){addBuffer(scene.__webglObjects,geometry,object);}else{for(g in geometry.geometryGroups){geometryGroup=geometry.geometryGroups[g];addBuffer(scene.__webglObjects,geometryGroup,object);}}}else if(object instanceof THREE.Ribbon||object instanceof THREE.Line||object instanceof THREE.ParticleSystem){geometry=object.geometry;addBuffer(scene.__webglObjects,geometry,object);}else if(object instanceof THREE.ImmediateRenderObject||object.immediateRenderCallback){addBufferImmediate(scene.__webglObjectsImmediate,object);}else if(object instanceof THREE.Sprite){scene.__webglSprites.push(object);}else if(object instanceof THREE.LensFlare){scene.__webglFlares.push(object);}
object.__webglActive=true;}};function addBuffer(objlist,buffer,object){objlist.push({buffer:buffer,object:object,opaque:null,transparent:null});};function addBufferImmediate(objlist,object){objlist.push({object:object,opaque:null,transparent:null});};function updateObject(object){var geometry=object.geometry,geometryGroup,customAttributesDirty,material;if(object instanceof THREE.Mesh){if(geometry instanceof THREE.BufferGeometry){if(geometry.verticesNeedUpdate||geometry.elementsNeedUpdate||geometry.uvsNeedUpdate||geometry.normalsNeedUpdate||geometry.colorsNeedUpdate||geometry.tangentsNeedUpdate){setDirectBuffers(geometry,_gl.DYNAMIC_DRAW,!geometry.dynamic);}
geometry.verticesNeedUpdate=false;geometry.elementsNeedUpdate=false;geometry.uvsNeedUpdate=false;geometry.normalsNeedUpdate=false;geometry.colorsNeedUpdate=false;geometry.tangentsNeedUpdate=false;}else{for(var i=0,il=geometry.geometryGroupsList.length;i<il;i++){geometryGroup=geometry.geometryGroupsList[i];material=getBufferMaterial(object,geometryGroup);customAttributesDirty=material.attributes&&areCustomAttributesDirty(material);if(geometry.verticesNeedUpdate||geometry.morphTargetsNeedUpdate||geometry.elementsNeedUpdate||geometry.uvsNeedUpdate||geometry.normalsNeedUpdate||geometry.colorsNeedUpdate||geometry.tangentsNeedUpdate||customAttributesDirty){setMeshBuffers(geometryGroup,object,_gl.DYNAMIC_DRAW,!geometry.dynamic,material);}}
geometry.verticesNeedUpdate=false;geometry.morphTargetsNeedUpdate=false;geometry.elementsNeedUpdate=false;geometry.uvsNeedUpdate=false;geometry.normalsNeedUpdate=false;geometry.colorsNeedUpdate=false;geometry.tangentsNeedUpdate=false;material.attributes&&clearCustomAttributes(material);}}else if(object instanceof THREE.Ribbon){if(geometry.verticesNeedUpdate||geometry.colorsNeedUpdate){setRibbonBuffers(geometry,_gl.DYNAMIC_DRAW);}
geometry.verticesNeedUpdate=false;geometry.colorsNeedUpdate=false;}else if(object instanceof THREE.Line){material=getBufferMaterial(object,geometryGroup);customAttributesDirty=material.attributes&&areCustomAttributesDirty(material);if(geometry.verticesNeedUpdate||geometry.colorsNeedUpdate||customAttributesDirty){setLineBuffers(geometry,_gl.DYNAMIC_DRAW);}
geometry.verticesNeedUpdate=false;geometry.colorsNeedUpdate=false;material.attributes&&clearCustomAttributes(material);}else if(object instanceof THREE.ParticleSystem){if(geometry instanceof THREE.BufferGeometry){if(geometry.verticesNeedUpdate||geometry.colorsNeedUpdate){setDirectBuffers(geometry,_gl.DYNAMIC_DRAW,!geometry.dynamic);}
geometry.verticesNeedUpdate=false;geometry.colorsNeedUpdate=false;}else{material=getBufferMaterial(object,geometryGroup);customAttributesDirty=material.attributes&&areCustomAttributesDirty(material);if(geometry.verticesNeedUpdate||geometry.colorsNeedUpdate||object.sortParticles||customAttributesDirty){setParticleBuffers(geometry,_gl.DYNAMIC_DRAW,object);}
geometry.verticesNeedUpdate=false;geometry.colorsNeedUpdate=false;material.attributes&&clearCustomAttributes(material);}}};function areCustomAttributesDirty(material){for(var a in material.attributes){if(material.attributes[a].needsUpdate)return true;}
return false;};function clearCustomAttributes(material){for(var a in material.attributes){material.attributes[a].needsUpdate=false;}};function removeObject(object,scene){if(object instanceof THREE.Mesh||object instanceof THREE.ParticleSystem||object instanceof THREE.Ribbon||object instanceof THREE.Line){removeInstances(scene.__webglObjects,object);}else if(object instanceof THREE.Sprite){removeInstancesDirect(scene.__webglSprites,object);}else if(object instanceof THREE.LensFlare){removeInstancesDirect(scene.__webglFlares,object);}else if(object instanceof THREE.ImmediateRenderObject||object.immediateRenderCallback){removeInstances(scene.__webglObjectsImmediate,object);}
object.__webglActive=false;};function removeInstances(objlist,object){for(var o=objlist.length-1;o>=0;o--){if(objlist[o].object===object){objlist.splice(o,1);}}};function removeInstancesDirect(objlist,object){for(var o=objlist.length-1;o>=0;o--){if(objlist[o]===object){objlist.splice(o,1);}}};this.initMaterial=function(material,lights,fog,object){var u,a,identifiers,i,parameters,maxLightCount,maxBones,maxShadows,shaderID;if(material instanceof THREE.MeshDepthMaterial){shaderID='depth';}else if(material instanceof THREE.MeshNormalMaterial){shaderID='normal';}else if(material instanceof THREE.MeshBasicMaterial){shaderID='basic';}else if(material instanceof THREE.MeshLambertMaterial){shaderID='lambert';}else if(material instanceof THREE.MeshPhongMaterial){shaderID='phong';}else if(material instanceof THREE.LineBasicMaterial){shaderID='basic';}else if(material instanceof THREE.ParticleBasicMaterial){shaderID='particle_basic';}
if(shaderID){setMaterialShaders(material,THREE.ShaderLib[shaderID]);}
maxLightCount=allocateLights(lights);maxShadows=allocateShadows(lights);maxBones=allocateBones(object);parameters={map:!!material.map,envMap:!!material.envMap,lightMap:!!material.lightMap,bumpMap:!!material.bumpMap,normalMap:!!material.normalMap,specularMap:!!material.specularMap,vertexColors:material.vertexColors,fog:fog,useFog:material.fog,sizeAttenuation:material.sizeAttenuation,skinning:material.skinning,maxBones:maxBones,useVertexTexture:_supportsBoneTextures&&object&&object.useVertexTexture,boneTextureWidth:object&&object.boneTextureWidth,boneTextureHeight:object&&object.boneTextureHeight,morphTargets:material.morphTargets,morphNormals:material.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:maxLightCount.directional,maxPointLights:maxLightCount.point,maxSpotLights:maxLightCount.spot,maxHemiLights:maxLightCount.hemi,maxShadows:maxShadows,shadowMapEnabled:this.shadowMapEnabled&&object.receiveShadow,shadowMapSoft:this.shadowMapSoft,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:material.alphaTest,metal:material.metal,perPixel:material.perPixel,wrapAround:material.wrapAround,doubleSided:material.side===THREE.DoubleSide,flipSided:material.side===THREE.BackSide};material.program=buildProgram(shaderID,material.fragmentShader,material.vertexShader,material.uniforms,material.attributes,material.defines,parameters);var attributes=material.program.attributes;if(attributes.position>=0)_gl.enableVertexAttribArray(attributes.position);if(attributes.color>=0)_gl.enableVertexAttribArray(attributes.color);if(attributes.normal>=0)_gl.enableVertexAttribArray(attributes.normal);if(attributes.tangent>=0)_gl.enableVertexAttribArray(attributes.tangent);if(material.skinning&&attributes.skinIndex>=0&&attributes.skinWeight>=0){_gl.enableVertexAttribArray(attributes.skinIndex);_gl.enableVertexAttribArray(attributes.skinWeight);}
if(material.attributes){for(a in material.attributes){if(attributes[a]!==undefined&&attributes[a]>=0)_gl.enableVertexAttribArray(attributes[a]);}}
if(material.morphTargets){material.numSupportedMorphTargets=0;var id,base="morphTarget";for(i=0;i<this.maxMorphTargets;i++){id=base+i;if(attributes[id]>=0){_gl.enableVertexAttribArray(attributes[id]);material.numSupportedMorphTargets++;}}}
if(material.morphNormals){material.numSupportedMorphNormals=0;var id,base="morphNormal";for(i=0;i<this.maxMorphNormals;i++){id=base+i;if(attributes[id]>=0){_gl.enableVertexAttribArray(attributes[id]);material.numSupportedMorphNormals++;}}}
material.uniformsList=[];for(u in material.uniforms){material.uniformsList.push([material.uniforms[u],u]);}};function setMaterialShaders(material,shaders){material.uniforms=THREE.UniformsUtils.clone(shaders.uniforms);material.vertexShader=shaders.vertexShader;material.fragmentShader=shaders.fragmentShader;};function setProgram(camera,lights,fog,material,object){_usedTextureUnits=0;if(material.needsUpdate){if(material.program)_this.deallocateMaterial(material);_this.initMaterial(material,lights,fog,object);material.needsUpdate=false;}
if(material.morphTargets){if(!object.__webglMorphTargetInfluences){object.__webglMorphTargetInfluences=new Float32Array(_this.maxMorphTargets);}}
var refreshMaterial=false;var program=material.program,p_uniforms=program.uniforms,m_uniforms=material.uniforms;if(program!==_currentProgram){_gl.useProgram(program);_currentProgram=program;refreshMaterial=true;}
if(material.id!==_currentMaterialId){_currentMaterialId=material.id;refreshMaterial=true;}
if(refreshMaterial||camera!==_currentCamera){_gl.uniformMatrix4fv(p_uniforms.projectionMatrix,false,camera._projectionMatrixArray);if(camera!==_currentCamera)_currentCamera=camera;}
if(material.skinning){if(_supportsBoneTextures&&object.useVertexTexture){if(p_uniforms.boneTexture!==null){var textureUnit=getTextureUnit();_gl.uniform1i(p_uniforms.boneTexture,textureUnit);_this.setTexture(object.boneTexture,textureUnit);}}else{if(p_uniforms.boneGlobalMatrices!==null){_gl.uniformMatrix4fv(p_uniforms.boneGlobalMatrices,false,object.boneMatrices);}}}
if(refreshMaterial){if(fog&&material.fog){refreshUniformsFog(m_uniforms,fog);}
if(material instanceof THREE.MeshPhongMaterial||material instanceof THREE.MeshLambertMaterial||material.lights){if(_lightsNeedUpdate){setupLights(program,lights);_lightsNeedUpdate=false;}
refreshUniformsLights(m_uniforms,_lights);}
if(material instanceof THREE.MeshBasicMaterial||material instanceof THREE.MeshLambertMaterial||material instanceof THREE.MeshPhongMaterial){refreshUniformsCommon(m_uniforms,material);}
if(material instanceof THREE.LineBasicMaterial){refreshUniformsLine(m_uniforms,material);}else if(material instanceof THREE.ParticleBasicMaterial){refreshUniformsParticle(m_uniforms,material);}else if(material instanceof THREE.MeshPhongMaterial){refreshUniformsPhong(m_uniforms,material);}else if(material instanceof THREE.MeshLambertMaterial){refreshUniformsLambert(m_uniforms,material);}else if(material instanceof THREE.MeshDepthMaterial){m_uniforms.mNear.value=camera.near;m_uniforms.mFar.value=camera.far;m_uniforms.opacity.value=material.opacity;}else if(material instanceof THREE.MeshNormalMaterial){m_uniforms.opacity.value=material.opacity;}
if(object.receiveShadow&&!material._shadowPass){refreshUniformsShadow(m_uniforms,lights);}
loadUniformsGeneric(program,material.uniformsList);if(material instanceof THREE.ShaderMaterial||material instanceof THREE.MeshPhongMaterial||material.envMap){if(p_uniforms.cameraPosition!==null){var position=camera.matrixWorld.getPosition();_gl.uniform3f(p_uniforms.cameraPosition,position.x,position.y,position.z);}}
if(material instanceof THREE.MeshPhongMaterial||material instanceof THREE.MeshLambertMaterial||material instanceof THREE.ShaderMaterial||material.skinning){if(p_uniforms.viewMatrix!==null){_gl.uniformMatrix4fv(p_uniforms.viewMatrix,false,camera._viewMatrixArray);}}}
loadUniformsMatrices(p_uniforms,object);if(p_uniforms.modelMatrix!==null){_gl.uniformMatrix4fv(p_uniforms.modelMatrix,false,object.matrixWorld.elements);}
return program;};function refreshUniformsCommon(uniforms,material){uniforms.opacity.value=material.opacity;if(_this.gammaInput){uniforms.diffuse.value.copyGammaToLinear(material.color);}else{uniforms.diffuse.value=material.color;}
uniforms.map.value=material.map;uniforms.lightMap.value=material.lightMap;uniforms.specularMap.value=material.specularMap;if(material.bumpMap){uniforms.bumpMap.value=material.bumpMap;uniforms.bumpScale.value=material.bumpScale;}
if(material.normalMap){uniforms.normalMap.value=material.normalMap;uniforms.normalScale.value.copy(material.normalScale);}
var uvScaleMap;if(material.map){uvScaleMap=material.map;}else if(material.specularMap){uvScaleMap=material.specularMap;}else if(material.normalMap){uvScaleMap=material.normalMap;}else if(material.bumpMap){uvScaleMap=material.bumpMap;}
if(uvScaleMap!==undefined){var offset=uvScaleMap.offset;var repeat=uvScaleMap.repeat;uniforms.offsetRepeat.value.set(offset.x,offset.y,repeat.x,repeat.y);}
uniforms.envMap.value=material.envMap;uniforms.flipEnvMap.value=(material.envMap instanceof THREE.WebGLRenderTargetCube)?1:-1;if(_this.gammaInput){uniforms.reflectivity.value=material.reflectivity;}else{uniforms.reflectivity.value=material.reflectivity;}
uniforms.refractionRatio.value=material.refractionRatio;uniforms.combine.value=material.combine;uniforms.useRefract.value=material.envMap&&material.envMap.mapping instanceof THREE.CubeRefractionMapping;};function refreshUniformsLine(uniforms,material){uniforms.diffuse.value=material.color;uniforms.opacity.value=material.opacity;};function refreshUniformsParticle(uniforms,material){uniforms.psColor.value=material.color;uniforms.opacity.value=material.opacity;uniforms.size.value=material.size;uniforms.scale.value=_canvas.height/2.0;uniforms.map.value=material.map;};function refreshUniformsFog(uniforms,fog){uniforms.fogColor.value=fog.color;if(fog instanceof THREE.Fog){uniforms.fogNear.value=fog.near;uniforms.fogFar.value=fog.far;}else if(fog instanceof THREE.FogExp2){uniforms.fogDensity.value=fog.density;}};function refreshUniformsPhong(uniforms,material){uniforms.shininess.value=material.shininess;if(_this.gammaInput){uniforms.ambient.value.copyGammaToLinear(material.ambient);uniforms.emissive.value.copyGammaToLinear(material.emissive);uniforms.specular.value.copyGammaToLinear(material.specular);}else{uniforms.ambient.value=material.ambient;uniforms.emissive.value=material.emissive;uniforms.specular.value=material.specular;}
if(material.wrapAround){uniforms.wrapRGB.value.copy(material.wrapRGB);}};function refreshUniformsLambert(uniforms,material){if(_this.gammaInput){uniforms.ambient.value.copyGammaToLinear(material.ambient);uniforms.emissive.value.copyGammaToLinear(material.emissive);}else{uniforms.ambient.value=material.ambient;uniforms.emissive.value=material.emissive;}
if(material.wrapAround){uniforms.wrapRGB.value.copy(material.wrapRGB);}};function refreshUniformsLights(uniforms,lights){uniforms.ambientLightColor.value=lights.ambient;uniforms.directionalLightColor.value=lights.directional.colors;uniforms.directionalLightDirection.value=lights.directional.positions;uniforms.pointLightColor.value=lights.point.colors;uniforms.pointLightPosition.value=lights.point.positions;uniforms.pointLightDistance.value=lights.point.distances;uniforms.spotLightColor.value=lights.spot.colors;uniforms.spotLightPosition.value=lights.spot.positions;uniforms.spotLightDistance.value=lights.spot.distances;uniforms.spotLightDirection.value=lights.spot.directions;uniforms.spotLightAngle.value=lights.spot.angles;uniforms.spotLightExponent.value=lights.spot.exponents;uniforms.hemisphereLightSkyColor.value=lights.hemi.skyColors;uniforms.hemisphereLightGroundColor.value=lights.hemi.groundColors;uniforms.hemisphereLightPosition.value=lights.hemi.positions;};function refreshUniformsShadow(uniforms,lights){if(uniforms.shadowMatrix){var j=0;for(var i=0,il=lights.length;i<il;i++){var light=lights[i];if(!light.castShadow)continue;if(light instanceof THREE.SpotLight||(light instanceof THREE.DirectionalLight&&!light.shadowCascade)){uniforms.shadowMap.value[j]=light.shadowMap;uniforms.shadowMapSize.value[j]=light.shadowMapSize;uniforms.shadowMatrix.value[j]=light.shadowMatrix;uniforms.shadowDarkness.value[j]=light.shadowDarkness;uniforms.shadowBias.value[j]=light.shadowBias;j++;}}}};function loadUniformsMatrices(uniforms,object){_gl.uniformMatrix4fv(uniforms.modelViewMatrix,false,object._modelViewMatrix.elements);if(uniforms.normalMatrix){_gl.uniformMatrix3fv(uniforms.normalMatrix,false,object._normalMatrix.elements);}};function getTextureUnit(){var textureUnit=_usedTextureUnits;if(textureUnit>=_maxTextures){console.warn("Trying to use "+textureUnit+" texture units while this GPU supports only "+_maxTextures);}
_usedTextureUnits+=1;return textureUnit;};function loadUniformsGeneric(program,uniforms){var uniform,value,type,location,texture,textureUnit,i,il,j,jl,offset;for(j=0,jl=uniforms.length;j<jl;j++){location=program.uniforms[uniforms[j][1]];if(!location)continue;uniform=uniforms[j][0];type=uniform.type;value=uniform.value;if(type==="i"){_gl.uniform1i(location,value);}else if(type==="f"){_gl.uniform1f(location,value);}else if(type==="v2"){_gl.uniform2f(location,value.x,value.y);}else if(type==="v3"){_gl.uniform3f(location,value.x,value.y,value.z);}else if(type==="v4"){_gl.uniform4f(location,value.x,value.y,value.z,value.w);}else if(type==="c"){_gl.uniform3f(location,value.r,value.g,value.b);}else if(type==="iv1"){_gl.uniform1iv(location,value);}else if(type==="iv"){_gl.uniform3iv(location,value);}else if(type==="fv1"){_gl.uniform1fv(location,value);}else if(type==="fv"){_gl.uniform3fv(location,value);}else if(type==="v2v"){if(uniform._array===undefined){uniform._array=new Float32Array(2*value.length);}
for(i=0,il=value.length;i<il;i++){offset=i*2;uniform._array[offset]=value[i].x;uniform._array[offset+1]=value[i].y;}
_gl.uniform2fv(location,uniform._array);}else if(type==="v3v"){if(uniform._array===undefined){uniform._array=new Float32Array(3*value.length);}
for(i=0,il=value.length;i<il;i++){offset=i*3;uniform._array[offset]=value[i].x;uniform._array[offset+1]=value[i].y;uniform._array[offset+2]=value[i].z;}
_gl.uniform3fv(location,uniform._array);}else if(type==="v4v"){if(uniform._array===undefined){uniform._array=new Float32Array(4*value.length);}
for(i=0,il=value.length;i<il;i++){offset=i*4;uniform._array[offset]=value[i].x;uniform._array[offset+1]=value[i].y;uniform._array[offset+2]=value[i].z;uniform._array[offset+3]=value[i].w;}
_gl.uniform4fv(location,uniform._array);}else if(type==="m4"){if(uniform._array===undefined){uniform._array=new Float32Array(16);}
value.flattenToArray(uniform._array);_gl.uniformMatrix4fv(location,false,uniform._array);}else if(type==="m4v"){if(uniform._array===undefined){uniform._array=new Float32Array(16*value.length);}
for(i=0,il=value.length;i<il;i++){value[i].flattenToArrayOffset(uniform._array,i*16);}
_gl.uniformMatrix4fv(location,false,uniform._array);}else if(type==="t"){texture=value;textureUnit=getTextureUnit();_gl.uniform1i(location,textureUnit);if(!texture)continue;if(texture.image instanceof Array&&texture.image.length===6){setCubeTexture(texture,textureUnit);}else if(texture instanceof THREE.WebGLRenderTargetCube){setCubeTextureDynamic(texture,textureUnit);}else{_this.setTexture(texture,textureUnit);}}else if(type==="tv"){if(uniform._array===undefined){uniform._array=[];}
for(i=0,il=uniform.value.length;i<il;i++){uniform._array[i]=getTextureUnit();}
_gl.uniform1iv(location,uniform._array);for(i=0,il=uniform.value.length;i<il;i++){texture=uniform.value[i];textureUnit=uniform._array[i];if(!texture)continue;_this.setTexture(texture,textureUnit);}}}};function setupMatrices(object,camera){object._modelViewMatrix.multiply(camera.matrixWorldInverse,object.matrixWorld);object._normalMatrix.getInverse(object._modelViewMatrix);object._normalMatrix.transpose();};function setColorGamma(array,offset,color,intensitySq){array[offset]=color.r*color.r*intensitySq;array[offset+1]=color.g*color.g*intensitySq;array[offset+2]=color.b*color.b*intensitySq;};function setColorLinear(array,offset,color,intensity){array[offset]=color.r*intensity;array[offset+1]=color.g*intensity;array[offset+2]=color.b*intensity;};function setupLights(program,lights){var l,ll,light,n,r=0,g=0,b=0,color,skyColor,groundColor,intensity,intensitySq,position,distance,zlights=_lights,dirColors=zlights.directional.colors,dirPositions=zlights.directional.positions,pointColors=zlights.point.colors,pointPositions=zlights.point.positions,pointDistances=zlights.point.distances,spotColors=zlights.spot.colors,spotPositions=zlights.spot.positions,spotDistances=zlights.spot.distances,spotDirections=zlights.spot.directions,spotAngles=zlights.spot.angles,spotExponents=zlights.spot.exponents,hemiSkyColors=zlights.hemi.skyColors,hemiGroundColors=zlights.hemi.groundColors,hemiPositions=zlights.hemi.positions,dirLength=0,pointLength=0,spotLength=0,hemiLength=0,dirOffset=0,pointOffset=0,spotOffset=0,hemiOffset=0;for(l=0,ll=lights.length;l<ll;l++){light=lights[l];if(light.onlyShadow||!light.visible)continue;color=light.color;intensity=light.intensity;distance=light.distance;if(light instanceof THREE.AmbientLight){if(_this.gammaInput){r+=color.r*color.r;g+=color.g*color.g;b+=color.b*color.b;}else{r+=color.r;g+=color.g;b+=color.b;}}else if(light instanceof THREE.DirectionalLight){dirOffset=dirLength*3;if(_this.gammaInput){setColorGamma(dirColors,dirOffset,color,intensity*intensity);}else{setColorLinear(dirColors,dirOffset,color,intensity);}
_direction.copy(light.matrixWorld.getPosition());_direction.subSelf(light.target.matrixWorld.getPosition());_direction.normalize();dirPositions[dirOffset]=_direction.x;dirPositions[dirOffset+1]=_direction.y;dirPositions[dirOffset+2]=_direction.z;dirLength+=1;}else if(light instanceof THREE.PointLight){pointOffset=pointLength*3;if(_this.gammaInput){setColorGamma(pointColors,pointOffset,color,intensity*intensity);}else{setColorLinear(pointColors,pointOffset,color,intensity);}
position=light.matrixWorld.getPosition();pointPositions[pointOffset]=position.x;pointPositions[pointOffset+1]=position.y;pointPositions[pointOffset+2]=position.z;pointDistances[pointLength]=distance;pointLength+=1;}else if(light instanceof THREE.SpotLight){spotOffset=spotLength*3;if(_this.gammaInput){setColorGamma(spotColors,spotOffset,color,intensity*intensity);}else{setColorLinear(spotColors,spotOffset,color,intensity);}
position=light.matrixWorld.getPosition();spotPositions[spotOffset]=position.x;spotPositions[spotOffset+1]=position.y;spotPositions[spotOffset+2]=position.z;spotDistances[spotLength]=distance;_direction.copy(position);_direction.subSelf(light.target.matrixWorld.getPosition());_direction.normalize();spotDirections[spotOffset]=_direction.x;spotDirections[spotOffset+1]=_direction.y;spotDirections[spotOffset+2]=_direction.z;spotAngles[spotLength]=Math.cos(light.angle);spotExponents[spotLength]=light.exponent;spotLength+=1;}else if(light instanceof THREE.HemisphereLight){skyColor=light.color;groundColor=light.groundColor;hemiOffset=hemiLength*3;if(_this.gammaInput){intensitySq=intensity*intensity;setColorGamma(hemiSkyColors,hemiOffset,skyColor,intensitySq);setColorGamma(hemiGroundColors,hemiOffset,groundColor,intensitySq);}else{setColorLinear(hemiSkyColors,hemiOffset,skyColor,intensity);setColorLinear(hemiGroundColors,hemiOffset,groundColor,intensity);}
position=light.matrixWorld.getPosition();hemiPositions[hemiOffset]=position.x;hemiPositions[hemiOffset+1]=position.y;hemiPositions[hemiOffset+2]=position.z;hemiLength+=1;}}
for(l=dirLength*3,ll=dirColors.length;l<ll;l++)dirColors[l]=0.0;for(l=pointLength*3,ll=pointColors.length;l<ll;l++)pointColors[l]=0.0;for(l=spotLength*3,ll=spotColors.length;l<ll;l++)spotColors[l]=0.0;for(l=hemiLength*3,ll=hemiSkyColors.length;l<ll;l++)hemiSkyColors[l]=0.0;for(l=hemiLength*3,ll=hemiGroundColors.length;l<ll;l++)hemiGroundColors[l]=0.0;zlights.directional.length=dirLength;zlights.point.length=pointLength;zlights.spot.length=spotLength;zlights.hemi.length=hemiLength;zlights.ambient[0]=r;zlights.ambient[1]=g;zlights.ambient[2]=b;};this.setFaceCulling=function(cullFace,frontFace){if(cullFace){if(!frontFace||frontFace==="ccw"){_gl.frontFace(_gl.CCW);}else{_gl.frontFace(_gl.CW);}
if(cullFace==="back"){_gl.cullFace(_gl.BACK);}else if(cullFace==="front"){_gl.cullFace(_gl.FRONT);}else{_gl.cullFace(_gl.FRONT_AND_BACK);}
_gl.enable(_gl.CULL_FACE);}else{_gl.disable(_gl.CULL_FACE);}};this.setMaterialFaces=function(material){var doubleSided=material.side===THREE.DoubleSide;var flipSided=material.side===THREE.BackSide;if(_oldDoubleSided!==doubleSided){if(doubleSided){_gl.disable(_gl.CULL_FACE);}else{_gl.enable(_gl.CULL_FACE);}
_oldDoubleSided=doubleSided;}
if(_oldFlipSided!==flipSided){if(flipSided){_gl.frontFace(_gl.CW);}else{_gl.frontFace(_gl.CCW);}
_oldFlipSided=flipSided;}};this.setDepthTest=function(depthTest){if(_oldDepthTest!==depthTest){if(depthTest){_gl.enable(_gl.DEPTH_TEST);}else{_gl.disable(_gl.DEPTH_TEST);}
_oldDepthTest=depthTest;}};this.setDepthWrite=function(depthWrite){if(_oldDepthWrite!==depthWrite){_gl.depthMask(depthWrite);_oldDepthWrite=depthWrite;}};function setLineWidth(width){if(width!==_oldLineWidth){_gl.lineWidth(width);_oldLineWidth=width;}};function setPolygonOffset(polygonoffset,factor,units){if(_oldPolygonOffset!==polygonoffset){if(polygonoffset){_gl.enable(_gl.POLYGON_OFFSET_FILL);}else{_gl.disable(_gl.POLYGON_OFFSET_FILL);}
_oldPolygonOffset=polygonoffset;}
if(polygonoffset&&(_oldPolygonOffsetFactor!==factor||_oldPolygonOffsetUnits!==units)){_gl.polygonOffset(factor,units);_oldPolygonOffsetFactor=factor;_oldPolygonOffsetUnits=units;}};this.setBlending=function(blending,blendEquation,blendSrc,blendDst){if(blending!==_oldBlending){if(blending===THREE.NoBlending){_gl.disable(_gl.BLEND);}else if(blending===THREE.AdditiveBlending){_gl.enable(_gl.BLEND);_gl.blendEquation(_gl.FUNC_ADD);_gl.blendFunc(_gl.SRC_ALPHA,_gl.ONE);}else if(blending===THREE.SubtractiveBlending){_gl.enable(_gl.BLEND);_gl.blendEquation(_gl.FUNC_ADD);_gl.blendFunc(_gl.ZERO,_gl.ONE_MINUS_SRC_COLOR);}else if(blending===THREE.MultiplyBlending){_gl.enable(_gl.BLEND);_gl.blendEquation(_gl.FUNC_ADD);_gl.blendFunc(_gl.ZERO,_gl.SRC_COLOR);}else if(blending===THREE.CustomBlending){_gl.enable(_gl.BLEND);}else{_gl.enable(_gl.BLEND);_gl.blendEquationSeparate(_gl.FUNC_ADD,_gl.FUNC_ADD);_gl.blendFuncSeparate(_gl.SRC_ALPHA,_gl.ONE_MINUS_SRC_ALPHA,_gl.ONE,_gl.ONE_MINUS_SRC_ALPHA);}
_oldBlending=blending;}
if(blending===THREE.CustomBlending){if(blendEquation!==_oldBlendEquation){_gl.blendEquation(paramThreeToGL(blendEquation));_oldBlendEquation=blendEquation;}
if(blendSrc!==_oldBlendSrc||blendDst!==_oldBlendDst){_gl.blendFunc(paramThreeToGL(blendSrc),paramThreeToGL(blendDst));_oldBlendSrc=blendSrc;_oldBlendDst=blendDst;}}else{_oldBlendEquation=null;_oldBlendSrc=null;_oldBlendDst=null;}};function generateDefines(defines){var value,chunk,chunks=[];for(var d in defines){value=defines[d];if(value===false)continue;chunk="#define "+d+" "+value;chunks.push(chunk);}
return chunks.join("\n");};function buildProgram(shaderID,fragmentShader,vertexShader,uniforms,attributes,defines,parameters){var p,pl,d,program,code;var chunks=[];if(shaderID){chunks.push(shaderID);}else{chunks.push(fragmentShader);chunks.push(vertexShader);}
for(d in defines){chunks.push(d);chunks.push(defines[d]);}
for(p in parameters){chunks.push(p);chunks.push(parameters[p]);}
code=chunks.join();for(p=0,pl=_programs.length;p<pl;p++){var programInfo=_programs[p];if(programInfo.code===code){programInfo.usedTimes++;return programInfo.program;}}
var customDefines=generateDefines(defines);program=_gl.createProgram();var prefix_vertex=["precision "+_precision+" float;",customDefines,_supportsVertexTextures?"#define VERTEX_TEXTURES":"",_this.gammaInput?"#define GAMMA_INPUT":"",_this.gammaOutput?"#define GAMMA_OUTPUT":"",_this.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+parameters.maxDirLights,"#define MAX_POINT_LIGHTS "+parameters.maxPointLights,"#define MAX_SPOT_LIGHTS "+parameters.maxSpotLights,"#define MAX_HEMI_LIGHTS "+parameters.maxHemiLights,"#define MAX_SHADOWS "+parameters.maxShadows,"#define MAX_BONES "+parameters.maxBones,parameters.map?"#define USE_MAP":"",parameters.envMap?"#define USE_ENVMAP":"",parameters.lightMap?"#define USE_LIGHTMAP":"",parameters.bumpMap?"#define USE_BUMPMAP":"",parameters.normalMap?"#define USE_NORMALMAP":"",parameters.specularMap?"#define USE_SPECULARMAP":"",parameters.vertexColors?"#define USE_COLOR":"",parameters.skinning?"#define USE_SKINNING":"",parameters.useVertexTexture?"#define BONE_TEXTURE":"",parameters.boneTextureWidth?"#define N_BONE_PIXEL_X "+parameters.boneTextureWidth.toFixed(1):"",parameters.boneTextureHeight?"#define N_BONE_PIXEL_Y "+parameters.boneTextureHeight.toFixed(1):"",parameters.morphTargets?"#define USE_MORPHTARGETS":"",parameters.morphNormals?"#define USE_MORPHNORMALS":"",parameters.perPixel?"#define PHONG_PER_PIXEL":"",parameters.wrapAround?"#define WRAP_AROUND":"",parameters.doubleSided?"#define DOUBLE_SIDED":"",parameters.flipSided?"#define FLIP_SIDED":"",parameters.shadowMapEnabled?"#define USE_SHADOWMAP":"",parameters.shadowMapSoft?"#define SHADOWMAP_SOFT":"",parameters.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",parameters.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",parameters.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","attribute vec3 morphTarget0;","attribute vec3 morphTarget1;","attribute vec3 morphTarget2;","attribute vec3 morphTarget3;","#ifdef USE_MORPHNORMALS","attribute vec3 morphNormal0;","attribute vec3 morphNormal1;","attribute vec3 morphNormal2;","attribute vec3 morphNormal3;","#else","attribute vec3 morphTarget4;","attribute vec3 morphTarget5;","attribute vec3 morphTarget6;","attribute vec3 morphTarget7;","#endif","#endif","#ifdef USE_SKINNING","attribute vec4 skinIndex;","attribute vec4 skinWeight;","#endif",""].join("\n");var prefix_fragment=["precision "+_precision+" float;",(parameters.bumpMap||parameters.normalMap)?"#extension GL_OES_standard_derivatives : enable":"",customDefines,"#define MAX_DIR_LIGHTS "+parameters.maxDirLights,"#define MAX_POINT_LIGHTS "+parameters.maxPointLights,"#define MAX_SPOT_LIGHTS "+parameters.maxSpotLights,"#define MAX_HEMI_LIGHTS "+parameters.maxHemiLights,"#define MAX_SHADOWS "+parameters.maxShadows,parameters.alphaTest?"#define ALPHATEST "+parameters.alphaTest:"",_this.gammaInput?"#define GAMMA_INPUT":"",_this.gammaOutput?"#define GAMMA_OUTPUT":"",_this.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",(parameters.useFog&&parameters.fog)?"#define USE_FOG":"",(parameters.useFog&&parameters.fog instanceof THREE.FogExp2)?"#define FOG_EXP2":"",parameters.map?"#define USE_MAP":"",parameters.envMap?"#define USE_ENVMAP":"",parameters.lightMap?"#define USE_LIGHTMAP":"",parameters.bumpMap?"#define USE_BUMPMAP":"",parameters.normalMap?"#define USE_NORMALMAP":"",parameters.specularMap?"#define USE_SPECULARMAP":"",parameters.vertexColors?"#define USE_COLOR":"",parameters.metal?"#define METAL":"",parameters.perPixel?"#define PHONG_PER_PIXEL":"",parameters.wrapAround?"#define WRAP_AROUND":"",parameters.doubleSided?"#define DOUBLE_SIDED":"",parameters.flipSided?"#define FLIP_SIDED":"",parameters.shadowMapEnabled?"#define USE_SHADOWMAP":"",parameters.shadowMapSoft?"#define SHADOWMAP_SOFT":"",parameters.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",parameters.shadowMapCascade?"#define SHADOWMAP_CASCADE":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n");var glFragmentShader=getShader("fragment",prefix_fragment+fragmentShader);var glVertexShader=getShader("vertex",prefix_vertex+vertexShader);_gl.attachShader(program,glVertexShader);_gl.attachShader(program,glFragmentShader);_gl.linkProgram(program);if(!_gl.getProgramParameter(program,_gl.LINK_STATUS)){console.error("Could not initialise shader\n"+"VALIDATE_STATUS: "+_gl.getProgramParameter(program,_gl.VALIDATE_STATUS)+", gl error ["+_gl.getError()+"]");}
_gl.deleteShader(glFragmentShader);_gl.deleteShader(glVertexShader);program.uniforms={};program.attributes={};var identifiers,u,a,i;identifiers=['viewMatrix','modelViewMatrix','projectionMatrix','normalMatrix','modelMatrix','cameraPosition','morphTargetInfluences'];if(parameters.useVertexTexture){identifiers.push('boneTexture');}else{identifiers.push('boneGlobalMatrices');}
for(u in uniforms){identifiers.push(u);}
cacheUniformLocations(program,identifiers);identifiers=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight"];for(i=0;i<parameters.maxMorphTargets;i++){identifiers.push("morphTarget"+i);}
for(i=0;i<parameters.maxMorphNormals;i++){identifiers.push("morphNormal"+i);}
for(a in attributes){identifiers.push(a);}
cacheAttributeLocations(program,identifiers);program.id=_programs_counter++;_programs.push({program:program,code:code,usedTimes:1});_this.info.memory.programs=_programs.length;return program;};function cacheUniformLocations(program,identifiers){var i,l,id;for(i=0,l=identifiers.length;i<l;i++){id=identifiers[i];program.uniforms[id]=_gl.getUniformLocation(program,id);}};function cacheAttributeLocations(program,identifiers){var i,l,id;for(i=0,l=identifiers.length;i<l;i++){id=identifiers[i];program.attributes[id]=_gl.getAttribLocation(program,id);}};function addLineNumbers(string){var chunks=string.split("\n");for(var i=0,il=chunks.length;i<il;i++){chunks[i]=(i+1)+": "+chunks[i];}
return chunks.join("\n");};function getShader(type,string){var shader;if(type==="fragment"){shader=_gl.createShader(_gl.FRAGMENT_SHADER);}else if(type==="vertex"){shader=_gl.createShader(_gl.VERTEX_SHADER);}
_gl.shaderSource(shader,string);_gl.compileShader(shader);if(!_gl.getShaderParameter(shader,_gl.COMPILE_STATUS)){console.error(_gl.getShaderInfoLog(shader));console.error(addLineNumbers(string));return null;}
return shader;};function isPowerOfTwo(value){return(value&(value-1))===0;};function setTextureParameters(textureType,texture,isImagePowerOfTwo){if(isImagePowerOfTwo){_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_S,paramThreeToGL(texture.wrapS));_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_T,paramThreeToGL(texture.wrapT));_gl.texParameteri(textureType,_gl.TEXTURE_MAG_FILTER,paramThreeToGL(texture.magFilter));_gl.texParameteri(textureType,_gl.TEXTURE_MIN_FILTER,paramThreeToGL(texture.minFilter));}else{_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_S,_gl.CLAMP_TO_EDGE);_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_T,_gl.CLAMP_TO_EDGE);_gl.texParameteri(textureType,_gl.TEXTURE_MAG_FILTER,filterFallback(texture.magFilter));_gl.texParameteri(textureType,_gl.TEXTURE_MIN_FILTER,filterFallback(texture.minFilter));}
if(_glExtensionTextureFilterAnisotropic&&texture.type!==THREE.FloatType){if(texture.anisotropy>1||texture.__oldAnisotropy){_gl.texParameterf(textureType,_glExtensionTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(texture.anisotropy,_maxAnisotropy));texture.__oldAnisotropy=texture.anisotropy;}}};this.setTexture=function(texture,slot){if(texture.needsUpdate){if(!texture.__webglInit){texture.__webglInit=true;texture.__webglTexture=_gl.createTexture();_this.info.memory.textures++;}
_gl.activeTexture(_gl.TEXTURE0+slot);_gl.bindTexture(_gl.TEXTURE_2D,texture.__webglTexture);_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,texture.flipY);_gl.pixelStorei(_gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,texture.premultiplyAlpha);var image=texture.image,isImagePowerOfTwo=isPowerOfTwo(image.width)&&isPowerOfTwo(image.height),glFormat=paramThreeToGL(texture.format),glType=paramThreeToGL(texture.type);setTextureParameters(_gl.TEXTURE_2D,texture,isImagePowerOfTwo);if(texture instanceof THREE.CompressedTexture){var mipmap,mipmaps=texture.mipmaps;for(var i=0,il=mipmaps.length;i<il;i++){mipmap=mipmaps[i];_gl.compressedTexImage2D(_gl.TEXTURE_2D,i,glFormat,mipmap.width,mipmap.height,0,mipmap.data);}}else if(texture instanceof THREE.DataTexture){_gl.texImage2D(_gl.TEXTURE_2D,0,glFormat,image.width,image.height,0,glFormat,glType,image.data);}else{_gl.texImage2D(_gl.TEXTURE_2D,0,glFormat,glFormat,glType,texture.image);}
if(texture.generateMipmaps&&isImagePowerOfTwo)_gl.generateMipmap(_gl.TEXTURE_2D);texture.needsUpdate=false;if(texture.onUpdate)texture.onUpdate();}else{_gl.activeTexture(_gl.TEXTURE0+slot);_gl.bindTexture(_gl.TEXTURE_2D,texture.__webglTexture);}};function clampToMaxSize(image,maxSize){if(image.width<=maxSize&&image.height<=maxSize){return image;}
var maxDimension=Math.max(image.width,image.height);var newWidth=Math.floor(image.width*maxSize/maxDimension);var newHeight=Math.floor(image.height*maxSize/maxDimension);var canvas=document.createElement('canvas');canvas.width=newWidth;canvas.height=newHeight;var ctx=canvas.getContext("2d");ctx.drawImage(image,0,0,image.width,image.height,0,0,newWidth,newHeight);return canvas;}
function setCubeTexture(texture,slot){if(texture.image.length===6){if(texture.needsUpdate){if(!texture.image.__webglTextureCube){texture.image.__webglTextureCube=_gl.createTexture();}
_gl.activeTexture(_gl.TEXTURE0+slot);_gl.bindTexture(_gl.TEXTURE_CUBE_MAP,texture.image.__webglTextureCube);_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,texture.flipY);var isCompressed=texture instanceof THREE.CompressedTexture;var cubeImage=[];for(var i=0;i<6;i++){if(_this.autoScaleCubemaps&&!isCompressed){cubeImage[i]=clampToMaxSize(texture.image[i],_maxCubemapSize);}else{cubeImage[i]=texture.image[i];}}
var image=cubeImage[0],isImagePowerOfTwo=isPowerOfTwo(image.width)&&isPowerOfTwo(image.height),glFormat=paramThreeToGL(texture.format),glType=paramThreeToGL(texture.type);setTextureParameters(_gl.TEXTURE_CUBE_MAP,texture,isImagePowerOfTwo);for(var i=0;i<6;i++){if(isCompressed){var mipmap,mipmaps=cubeImage[i].mipmaps;for(var j=0,jl=mipmaps.length;j<jl;j++){mipmap=mipmaps[j];_gl.compressedTexImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,j,glFormat,mipmap.width,mipmap.height,0,mipmap.data);}}else{_gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,glFormat,glFormat,glType,cubeImage[i]);}}
if(texture.generateMipmaps&&isImagePowerOfTwo){_gl.generateMipmap(_gl.TEXTURE_CUBE_MAP);}
texture.needsUpdate=false;if(texture.onUpdate)texture.onUpdate();}else{_gl.activeTexture(_gl.TEXTURE0+slot);_gl.bindTexture(_gl.TEXTURE_CUBE_MAP,texture.image.__webglTextureCube);}}};function setCubeTextureDynamic(texture,slot){_gl.activeTexture(_gl.TEXTURE0+slot);_gl.bindTexture(_gl.TEXTURE_CUBE_MAP,texture.__webglTexture);};function setupFrameBuffer(framebuffer,renderTarget,textureTarget){_gl.bindFramebuffer(_gl.FRAMEBUFFER,framebuffer);_gl.framebufferTexture2D(_gl.FRAMEBUFFER,_gl.COLOR_ATTACHMENT0,textureTarget,renderTarget.__webglTexture,0);};function setupRenderBuffer(renderbuffer,renderTarget){_gl.bindRenderbuffer(_gl.RENDERBUFFER,renderbuffer);if(renderTarget.depthBuffer&&!renderTarget.stencilBuffer){_gl.renderbufferStorage(_gl.RENDERBUFFER,_gl.DEPTH_COMPONENT16,renderTarget.width,renderTarget.height);_gl.framebufferRenderbuffer(_gl.FRAMEBUFFER,_gl.DEPTH_ATTACHMENT,_gl.RENDERBUFFER,renderbuffer);}else if(renderTarget.depthBuffer&&renderTarget.stencilBuffer){_gl.renderbufferStorage(_gl.RENDERBUFFER,_gl.DEPTH_STENCIL,renderTarget.width,renderTarget.height);_gl.framebufferRenderbuffer(_gl.FRAMEBUFFER,_gl.DEPTH_STENCIL_ATTACHMENT,_gl.RENDERBUFFER,renderbuffer);}else{_gl.renderbufferStorage(_gl.RENDERBUFFER,_gl.RGBA4,renderTarget.width,renderTarget.height);}};this.setRenderTarget=function(renderTarget){var isCube=(renderTarget instanceof THREE.WebGLRenderTargetCube);if(renderTarget&&!renderTarget.__webglFramebuffer){if(renderTarget.depthBuffer===undefined)renderTarget.depthBuffer=true;if(renderTarget.stencilBuffer===undefined)renderTarget.stencilBuffer=true;renderTarget.__webglTexture=_gl.createTexture();var isTargetPowerOfTwo=isPowerOfTwo(renderTarget.width)&&isPowerOfTwo(renderTarget.height),glFormat=paramThreeToGL(renderTarget.format),glType=paramThreeToGL(renderTarget.type);if(isCube){renderTarget.__webglFramebuffer=[];renderTarget.__webglRenderbuffer=[];_gl.bindTexture(_gl.TEXTURE_CUBE_MAP,renderTarget.__webglTexture);setTextureParameters(_gl.TEXTURE_CUBE_MAP,renderTarget,isTargetPowerOfTwo);for(var i=0;i<6;i++){renderTarget.__webglFramebuffer[i]=_gl.createFramebuffer();renderTarget.__webglRenderbuffer[i]=_gl.createRenderbuffer();_gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,glFormat,renderTarget.width,renderTarget.height,0,glFormat,glType,null);setupFrameBuffer(renderTarget.__webglFramebuffer[i],renderTarget,_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i);setupRenderBuffer(renderTarget.__webglRenderbuffer[i],renderTarget);}
if(isTargetPowerOfTwo)_gl.generateMipmap(_gl.TEXTURE_CUBE_MAP);}else{renderTarget.__webglFramebuffer=_gl.createFramebuffer();renderTarget.__webglRenderbuffer=_gl.createRenderbuffer();_gl.bindTexture(_gl.TEXTURE_2D,renderTarget.__webglTexture);setTextureParameters(_gl.TEXTURE_2D,renderTarget,isTargetPowerOfTwo);_gl.texImage2D(_gl.TEXTURE_2D,0,glFormat,renderTarget.width,renderTarget.height,0,glFormat,glType,null);setupFrameBuffer(renderTarget.__webglFramebuffer,renderTarget,_gl.TEXTURE_2D);setupRenderBuffer(renderTarget.__webglRenderbuffer,renderTarget);if(isTargetPowerOfTwo)_gl.generateMipmap(_gl.TEXTURE_2D);}
if(isCube){_gl.bindTexture(_gl.TEXTURE_CUBE_MAP,null);}else{_gl.bindTexture(_gl.TEXTURE_2D,null);}
_gl.bindRenderbuffer(_gl.RENDERBUFFER,null);_gl.bindFramebuffer(_gl.FRAMEBUFFER,null);}
var framebuffer,width,height,vx,vy;if(renderTarget){if(isCube){framebuffer=renderTarget.__webglFramebuffer[renderTarget.activeCubeFace];}else{framebuffer=renderTarget.__webglFramebuffer;}
width=renderTarget.width;height=renderTarget.height;vx=0;vy=0;}else{framebuffer=null;width=_viewportWidth;height=_viewportHeight;vx=_viewportX;vy=_viewportY;}
if(framebuffer!==_currentFramebuffer){_gl.bindFramebuffer(_gl.FRAMEBUFFER,framebuffer);_gl.viewport(vx,vy,width,height);_currentFramebuffer=framebuffer;}
_currentWidth=width;_currentHeight=height;};function updateRenderTargetMipmap(renderTarget){if(renderTarget instanceof THREE.WebGLRenderTargetCube){_gl.bindTexture(_gl.TEXTURE_CUBE_MAP,renderTarget.__webglTexture);_gl.generateMipmap(_gl.TEXTURE_CUBE_MAP);_gl.bindTexture(_gl.TEXTURE_CUBE_MAP,null);}else{_gl.bindTexture(_gl.TEXTURE_2D,renderTarget.__webglTexture);_gl.generateMipmap(_gl.TEXTURE_2D);_gl.bindTexture(_gl.TEXTURE_2D,null);}};function filterFallback(f){if(f===THREE.NearestFilter||f===THREE.NearestMipMapNearestFilter||f===THREE.NearestMipMapLinearFilter){return _gl.NEAREST;}
return _gl.LINEAR;};function paramThreeToGL(p){if(p===THREE.RepeatWrapping)return _gl.REPEAT;if(p===THREE.ClampToEdgeWrapping)return _gl.CLAMP_TO_EDGE;if(p===THREE.MirroredRepeatWrapping)return _gl.MIRRORED_REPEAT;if(p===THREE.NearestFilter)return _gl.NEAREST;if(p===THREE.NearestMipMapNearestFilter)return _gl.NEAREST_MIPMAP_NEAREST;if(p===THREE.NearestMipMapLinearFilter)return _gl.NEAREST_MIPMAP_LINEAR;if(p===THREE.LinearFilter)return _gl.LINEAR;if(p===THREE.LinearMipMapNearestFilter)return _gl.LINEAR_MIPMAP_NEAREST;if(p===THREE.LinearMipMapLinearFilter)return _gl.LINEAR_MIPMAP_LINEAR;if(p===THREE.UnsignedByteType)return _gl.UNSIGNED_BYTE;if(p===THREE.UnsignedShort4444Type)return _gl.UNSIGNED_SHORT_4_4_4_4;if(p===THREE.UnsignedShort5551Type)return _gl.UNSIGNED_SHORT_5_5_5_1;if(p===THREE.UnsignedShort565Type)return _gl.UNSIGNED_SHORT_5_6_5;if(p===THREE.ByteType)return _gl.BYTE;if(p===THREE.ShortType)return _gl.SHORT;if(p===THREE.UnsignedShortType)return _gl.UNSIGNED_SHORT;if(p===THREE.IntType)return _gl.INT;if(p===THREE.UnsignedIntType)return _gl.UNSIGNED_INT;if(p===THREE.FloatType)return _gl.FLOAT;if(p===THREE.AlphaFormat)return _gl.ALPHA;if(p===THREE.RGBFormat)return _gl.RGB;if(p===THREE.RGBAFormat)return _gl.RGBA;if(p===THREE.LuminanceFormat)return _gl.LUMINANCE;if(p===THREE.LuminanceAlphaFormat)return _gl.LUMINANCE_ALPHA;if(p===THREE.AddEquation)return _gl.FUNC_ADD;if(p===THREE.SubtractEquation)return _gl.FUNC_SUBTRACT;if(p===THREE.ReverseSubtractEquation)return _gl.FUNC_REVERSE_SUBTRACT;if(p===THREE.ZeroFactor)return _gl.ZERO;if(p===THREE.OneFactor)return _gl.ONE;if(p===THREE.SrcColorFactor)return _gl.SRC_COLOR;if(p===THREE.OneMinusSrcColorFactor)return _gl.ONE_MINUS_SRC_COLOR;if(p===THREE.SrcAlphaFactor)return _gl.SRC_ALPHA;if(p===THREE.OneMinusSrcAlphaFactor)return _gl.ONE_MINUS_SRC_ALPHA;if(p===THREE.DstAlphaFactor)return _gl.DST_ALPHA;if(p===THREE.OneMinusDstAlphaFactor)return _gl.ONE_MINUS_DST_ALPHA;if(p===THREE.DstColorFactor)return _gl.DST_COLOR;if(p===THREE.OneMinusDstColorFactor)return _gl.ONE_MINUS_DST_COLOR;if(p===THREE.SrcAlphaSaturateFactor)return _gl.SRC_ALPHA_SATURATE;if(_glExtensionCompressedTextureS3TC!==undefined){if(p===THREE.RGB_S3TC_DXT1_Format)return _glExtensionCompressedTextureS3TC.COMPRESSED_RGB_S3TC_DXT1_EXT;if(p===THREE.RGBA_S3TC_DXT1_Format)return _glExtensionCompressedTextureS3TC.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(p===THREE.RGBA_S3TC_DXT3_Format)return _glExtensionCompressedTextureS3TC.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(p===THREE.RGBA_S3TC_DXT5_Format)return _glExtensionCompressedTextureS3TC.COMPRESSED_RGBA_S3TC_DXT5_EXT;}
return 0;};function allocateBones(object){if(_supportsBoneTextures&&object&&object.useVertexTexture){return 1024;}else{var nVertexUniforms=_gl.getParameter(_gl.MAX_VERTEX_UNIFORM_VECTORS);var nVertexMatrices=Math.floor((nVertexUniforms-20)/4);var maxBones=nVertexMatrices;if(object!==undefined&&object instanceof THREE.SkinnedMesh){maxBones=Math.min(object.bones.length,maxBones);if(maxBones<object.bones.length){console.warn("WebGLRenderer: too many bones - "+object.bones.length+", this GPU supports just "+maxBones+" (try OpenGL instead of ANGLE)");}}
return maxBones;}};function allocateLights(lights){var l,ll,light,dirLights,pointLights,spotLights,hemiLights,maxDirLights,maxPointLights,maxSpotLights,maxHemiLights;dirLights=pointLights=spotLights=hemiLights=maxDirLights=maxPointLights=maxSpotLights=maxHemiLights=0;for(l=0,ll=lights.length;l<ll;l++){light=lights[l];if(light.onlyShadow)continue;if(light instanceof THREE.DirectionalLight)dirLights++;if(light instanceof THREE.PointLight)pointLights++;if(light instanceof THREE.SpotLight)spotLights++;if(light instanceof THREE.HemisphereLight)hemiLights++;}
if((pointLights+spotLights+dirLights+hemiLights)<=_maxLights){maxDirLights=dirLights;maxPointLights=pointLights;maxSpotLights=spotLights;maxHemiLights=hemiLights;}else{maxDirLights=Math.ceil(_maxLights*dirLights/(pointLights+dirLights));maxPointLights=_maxLights-maxDirLights;maxSpotLights=maxPointLights;maxHemiLights=maxDirLights;}
return{'directional':maxDirLights,'point':maxPointLights,'spot':maxSpotLights,'hemi':maxHemiLights};};function allocateShadows(lights){var l,ll,light,maxShadows=0;for(l=0,ll=lights.length;l<ll;l++){light=lights[l];if(!light.castShadow)continue;if(light instanceof THREE.SpotLight)maxShadows++;if(light instanceof THREE.DirectionalLight&&!light.shadowCascade)maxShadows++;}
return maxShadows;};function initGL(){try{if(!(_gl=_canvas.getContext('experimental-webgl',{alpha:_alpha,premultipliedAlpha:_premultipliedAlpha,antialias:_antialias,stencil:_stencil,preserveDrawingBuffer:_preserveDrawingBuffer}))){throw'Error creating WebGL context.';}}catch(error){console.error(error);}
_glExtensionTextureFloat=_gl.getExtension('OES_texture_float');_glExtensionStandardDerivatives=_gl.getExtension('OES_standard_derivatives');_glExtensionTextureFilterAnisotropic=_gl.getExtension('EXT_texture_filter_anisotropic')||_gl.getExtension('MOZ_EXT_texture_filter_anisotropic')||_gl.getExtension('WEBKIT_EXT_texture_filter_anisotropic');_glExtensionCompressedTextureS3TC=_gl.getExtension('WEBGL_compressed_texture_s3tc')||_gl.getExtension('MOZ_WEBGL_compressed_texture_s3tc')||_gl.getExtension('WEBKIT_WEBGL_compressed_texture_s3tc');if(!_glExtensionTextureFloat){console.log('THREE.WebGLRenderer: Float textures not supported.');}
if(!_glExtensionStandardDerivatives){console.log('THREE.WebGLRenderer: Standard derivatives not supported.');}
if(!_glExtensionTextureFilterAnisotropic){console.log('THREE.WebGLRenderer: Anisotropic texture filtering not supported.');}
if(!_glExtensionCompressedTextureS3TC){console.log('THREE.WebGLRenderer: S3TC compressed textures not supported.');}};function setDefaultGLState(){_gl.clearColor(0,0,0,1);_gl.clearDepth(1);_gl.clearStencil(0);_gl.enable(_gl.DEPTH_TEST);_gl.depthFunc(_gl.LEQUAL);_gl.frontFace(_gl.CCW);_gl.cullFace(_gl.BACK);_gl.enable(_gl.CULL_FACE);_gl.enable(_gl.BLEND);_gl.blendEquation(_gl.FUNC_ADD);_gl.blendFunc(_gl.SRC_ALPHA,_gl.ONE_MINUS_SRC_ALPHA);_gl.clearColor(_clearColor.r,_clearColor.g,_clearColor.b,_clearAlpha);};this.shadowMapPlugin=new THREE.ShadowMapPlugin();this.addPrePlugin(this.shadowMapPlugin);this.addPostPlugin(new THREE.SpritePlugin());this.addPostPlugin(new THREE.LensFlarePlugin());};THREE.WebGLRenderTarget=function(width,height,options){this.width=width;this.height=height;options=options||{};this.wrapS=options.wrapS!==undefined?options.wrapS:THREE.ClampToEdgeWrapping;this.wrapT=options.wrapT!==undefined?options.wrapT:THREE.ClampToEdgeWrapping;this.magFilter=options.magFilter!==undefined?options.magFilter:THREE.LinearFilter;this.minFilter=options.minFilter!==undefined?options.minFilter:THREE.LinearMipMapLinearFilter;this.anisotropy=options.anisotropy!==undefined?options.anisotropy:1;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.format=options.format!==undefined?options.format:THREE.RGBAFormat;this.type=options.type!==undefined?options.type:THREE.UnsignedByteType;this.depthBuffer=options.depthBuffer!==undefined?options.depthBuffer:true;this.stencilBuffer=options.stencilBuffer!==undefined?options.stencilBuffer:true;this.generateMipmaps=true;};THREE.WebGLRenderTarget.prototype.clone=function(){var tmp=new THREE.WebGLRenderTarget(this.width,this.height);tmp.wrapS=this.wrapS;tmp.wrapT=this.wrapT;tmp.magFilter=this.magFilter;tmp.anisotropy=this.anisotropy;tmp.minFilter=this.minFilter;tmp.offset.copy(this.offset);tmp.repeat.copy(this.repeat);tmp.format=this.format;tmp.type=this.type;tmp.depthBuffer=this.depthBuffer;tmp.stencilBuffer=this.stencilBuffer;tmp.generateMipmaps=this.generateMipmaps;return tmp;};THREE.WebGLRenderTargetCube=function(width,height,options){THREE.WebGLRenderTarget.call(this,width,height,options);this.activeCubeFace=0;};THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype);THREE.RenderableVertex=function(){this.positionWorld=new THREE.Vector3();this.positionScreen=new THREE.Vector4();this.visible=true;};THREE.RenderableVertex.prototype.copy=function(vertex){this.positionWorld.copy(vertex.positionWorld);this.positionScreen.copy(vertex.positionScreen);}
THREE.RenderableFace3=function(){this.v1=new THREE.RenderableVertex();this.v2=new THREE.RenderableVertex();this.v3=new THREE.RenderableVertex();this.centroidWorld=new THREE.Vector3();this.centroidScreen=new THREE.Vector3();this.normalWorld=new THREE.Vector3();this.vertexNormalsWorld=[new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3()];this.vertexNormalsLength=0;this.color=null;this.material=null;this.uvs=[[]];this.z=null;};THREE.RenderableFace4=function(){this.v1=new THREE.RenderableVertex();this.v2=new THREE.RenderableVertex();this.v3=new THREE.RenderableVertex();this.v4=new THREE.RenderableVertex();this.centroidWorld=new THREE.Vector3();this.centroidScreen=new THREE.Vector3();this.normalWorld=new THREE.Vector3();this.vertexNormalsWorld=[new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3()];this.vertexNormalsLength=0;this.color=null;this.material=null;this.uvs=[[]];this.z=null;};THREE.RenderableObject=function(){this.object=null;this.z=null;};THREE.RenderableParticle=function(){this.object=null;this.x=null;this.y=null;this.z=null;this.rotation=null;this.scale=new THREE.Vector2();this.material=null;};THREE.RenderableLine=function(){this.z=null;this.v1=new THREE.RenderableVertex();this.v2=new THREE.RenderableVertex();this.material=null;};THREE.ColorUtils={adjustHSV:function(color,h,s,v){var hsv=THREE.ColorUtils.__hsv;THREE.ColorUtils.rgbToHsv(color,hsv);hsv.h=THREE.Math.clamp(hsv.h+h,0,1);hsv.s=THREE.Math.clamp(hsv.s+s,0,1);hsv.v=THREE.Math.clamp(hsv.v+v,0,1);color.setHSV(hsv.h,hsv.s,hsv.v);},rgbToHsv:function(color,hsv){var r=color.r;var g=color.g;var b=color.b;var max=Math.max(Math.max(r,g),b);var min=Math.min(Math.min(r,g),b);var hue;var saturation;var value=max;if(min===max){hue=0;saturation=0;}else{var delta=(max-min);saturation=delta/max;if(r===max){hue=(g-b)/delta;}else if(g===max){hue=2+((b-r)/delta);}else{hue=4+((r-g)/delta);}
hue/=6;if(hue<0){hue+=1;}
if(hue>1){hue-=1;}}
if(hsv===undefined){hsv={h:0,s:0,v:0};}
hsv.h=hue;hsv.s=saturation;hsv.v=value;return hsv;}};THREE.ColorUtils.__hsv={h:0,s:0,v:0};THREE.GeometryUtils={merge:function(geometry1,object2){var matrix,matrixRotation,vertexOffset=geometry1.vertices.length,uvPosition=geometry1.faceVertexUvs[0].length,geometry2=object2 instanceof THREE.Mesh?object2.geometry:object2,vertices1=geometry1.vertices,vertices2=geometry2.vertices,faces1=geometry1.faces,faces2=geometry2.faces,uvs1=geometry1.faceVertexUvs[0],uvs2=geometry2.faceVertexUvs[0];var geo1MaterialsMap={};for(var i=0;i<geometry1.materials.length;i++){var id=geometry1.materials[i].id;geo1MaterialsMap[id]=i;}
if(object2 instanceof THREE.Mesh){object2.matrixAutoUpdate&&object2.updateMatrix();matrix=object2.matrix;matrixRotation=new THREE.Matrix4();matrixRotation.extractRotation(matrix,object2.scale);}
for(var i=0,il=vertices2.length;i<il;i++){var vertex=vertices2[i];var vertexCopy=vertex.clone();if(matrix)matrix.multiplyVector3(vertexCopy);vertices1.push(vertexCopy);}
for(i=0,il=faces2.length;i<il;i++){var face=faces2[i],faceCopy,normal,color,faceVertexNormals=face.vertexNormals,faceVertexColors=face.vertexColors;if(face instanceof THREE.Face3){faceCopy=new THREE.Face3(face.a+vertexOffset,face.b+vertexOffset,face.c+vertexOffset);}else if(face instanceof THREE.Face4){faceCopy=new THREE.Face4(face.a+vertexOffset,face.b+vertexOffset,face.c+vertexOffset,face.d+vertexOffset);}
faceCopy.normal.copy(face.normal);if(matrixRotation)matrixRotation.multiplyVector3(faceCopy.normal);for(var j=0,jl=faceVertexNormals.length;j<jl;j++){normal=faceVertexNormals[j].clone();if(matrixRotation)matrixRotation.multiplyVector3(normal);faceCopy.vertexNormals.push(normal);}
faceCopy.color.copy(face.color);for(var j=0,jl=faceVertexColors.length;j<jl;j++){color=faceVertexColors[j];faceCopy.vertexColors.push(color.clone());}
if(face.materialIndex!==undefined){var material2=geometry2.materials[face.materialIndex];var materialId2=material2.id;var materialIndex=geo1MaterialsMap[materialId2];if(materialIndex===undefined){materialIndex=geometry1.materials.length;geo1MaterialsMap[materialId2]=materialIndex;geometry1.materials.push(material2);}
faceCopy.materialIndex=materialIndex;}
faceCopy.centroid.copy(face.centroid);if(matrix)matrix.multiplyVector3(faceCopy.centroid);faces1.push(faceCopy);}
for(i=0,il=uvs2.length;i<il;i++){var uv=uvs2[i],uvCopy=[];for(var j=0,jl=uv.length;j<jl;j++){uvCopy.push(new THREE.UV(uv[j].u,uv[j].v));}
uvs1.push(uvCopy);}},clone:function(geometry){var cloneGeo=new THREE.Geometry();var i,il;var vertices=geometry.vertices,faces=geometry.faces,uvs=geometry.faceVertexUvs[0];if(geometry.materials){cloneGeo.materials=geometry.materials.slice();}
for(i=0,il=vertices.length;i<il;i++){var vertex=vertices[i];cloneGeo.vertices.push(vertex.clone());}
for(i=0,il=faces.length;i<il;i++){var face=faces[i];cloneGeo.faces.push(face.clone());}
for(i=0,il=uvs.length;i<il;i++){var uv=uvs[i],uvCopy=[];for(var j=0,jl=uv.length;j<jl;j++){uvCopy.push(new THREE.UV(uv[j].u,uv[j].v));}
cloneGeo.faceVertexUvs[0].push(uvCopy);}
return cloneGeo;},randomPointInTriangle:function(vectorA,vectorB,vectorC){var a,b,c,point=new THREE.Vector3(),tmp=THREE.GeometryUtils.__v1;a=THREE.GeometryUtils.random();b=THREE.GeometryUtils.random();if((a+b)>1){a=1-a;b=1-b;}
c=1-a-b;point.copy(vectorA);point.multiplyScalar(a);tmp.copy(vectorB);tmp.multiplyScalar(b);point.addSelf(tmp);tmp.copy(vectorC);tmp.multiplyScalar(c);point.addSelf(tmp);return point;},randomPointInFace:function(face,geometry,useCachedAreas){var vA,vB,vC,vD;if(face instanceof THREE.Face3){vA=geometry.vertices[face.a];vB=geometry.vertices[face.b];vC=geometry.vertices[face.c];return THREE.GeometryUtils.randomPointInTriangle(vA,vB,vC);}else if(face instanceof THREE.Face4){vA=geometry.vertices[face.a];vB=geometry.vertices[face.b];vC=geometry.vertices[face.c];vD=geometry.vertices[face.d];var area1,area2;if(useCachedAreas){if(face._area1&&face._area2){area1=face._area1;area2=face._area2;}else{area1=THREE.GeometryUtils.triangleArea(vA,vB,vD);area2=THREE.GeometryUtils.triangleArea(vB,vC,vD);face._area1=area1;face._area2=area2;}}else{area1=THREE.GeometryUtils.triangleArea(vA,vB,vD),area2=THREE.GeometryUtils.triangleArea(vB,vC,vD);}
var r=THREE.GeometryUtils.random()*(area1+area2);if(r<area1){return THREE.GeometryUtils.randomPointInTriangle(vA,vB,vD);}else{return THREE.GeometryUtils.randomPointInTriangle(vB,vC,vD);}}},randomPointsInGeometry:function(geometry,n){var face,i,faces=geometry.faces,vertices=geometry.vertices,il=faces.length,totalArea=0,cumulativeAreas=[],vA,vB,vC,vD;for(i=0;i<il;i++){face=faces[i];if(face instanceof THREE.Face3){vA=vertices[face.a];vB=vertices[face.b];vC=vertices[face.c];face._area=THREE.GeometryUtils.triangleArea(vA,vB,vC);}else if(face instanceof THREE.Face4){vA=vertices[face.a];vB=vertices[face.b];vC=vertices[face.c];vD=vertices[face.d];face._area1=THREE.GeometryUtils.triangleArea(vA,vB,vD);face._area2=THREE.GeometryUtils.triangleArea(vB,vC,vD);face._area=face._area1+face._area2;}
totalArea+=face._area;cumulativeAreas[i]=totalArea;}
function binarySearchIndices(value){function binarySearch(start,end){if(end<start)
return start;var mid=start+Math.floor((end-start)/2);if(cumulativeAreas[mid]>value){return binarySearch(start,mid-1);}else if(cumulativeAreas[mid]<value){return binarySearch(mid+1,end);}else{return mid;}}
var result=binarySearch(0,cumulativeAreas.length-1)
return result;}
var r,index,result=[];var stats={};for(i=0;i<n;i++){r=THREE.GeometryUtils.random()*totalArea;index=binarySearchIndices(r);result[i]=THREE.GeometryUtils.randomPointInFace(faces[index],geometry,true);if(!stats[index]){stats[index]=1;}else{stats[index]+=1;}}
return result;},triangleArea:function(vectorA,vectorB,vectorC){var s,a,b,c,tmp=THREE.GeometryUtils.__v1;tmp.sub(vectorA,vectorB);a=tmp.length();tmp.sub(vectorA,vectorC);b=tmp.length();tmp.sub(vectorB,vectorC);c=tmp.length();s=0.5*(a+b+c);return Math.sqrt(s*(s-a)*(s-b)*(s-c));},center:function(geometry){geometry.computeBoundingBox();var bb=geometry.boundingBox;var offset=new THREE.Vector3();offset.add(bb.min,bb.max);offset.multiplyScalar(-0.5);geometry.applyMatrix(new THREE.Matrix4().makeTranslation(offset.x,offset.y,offset.z));geometry.computeBoundingBox();return offset;},normalizeUVs:function(geometry){var uvSet=geometry.faceVertexUvs[0];for(var i=0,il=uvSet.length;i<il;i++){var uvs=uvSet[i];for(var j=0,jl=uvs.length;j<jl;j++){if(uvs[j].u!==1.0)uvs[j].u=uvs[j].u-Math.floor(uvs[j].u);if(uvs[j].v!==1.0)uvs[j].v=uvs[j].v-Math.floor(uvs[j].v);}}},triangulateQuads:function(geometry){var i,il,j,jl;var faces=[];var faceUvs=[];var faceVertexUvs=[];for(i=0,il=geometry.faceUvs.length;i<il;i++){faceUvs[i]=[];}
for(i=0,il=geometry.faceVertexUvs.length;i<il;i++){faceVertexUvs[i]=[];}
for(i=0,il=geometry.faces.length;i<il;i++){var face=geometry.faces[i];if(face instanceof THREE.Face4){var a=face.a;var b=face.b;var c=face.c;var d=face.d;var triA=new THREE.Face3();var triB=new THREE.Face3();triA.color.copy(face.color);triB.color.copy(face.color);triA.materialIndex=face.materialIndex;triB.materialIndex=face.materialIndex;triA.a=a;triA.b=b;triA.c=d;triB.a=b;triB.b=c;triB.c=d;if(face.vertexColors.length===4){triA.vertexColors[0]=face.vertexColors[0].clone();triA.vertexColors[1]=face.vertexColors[1].clone();triA.vertexColors[2]=face.vertexColors[3].clone();triB.vertexColors[0]=face.vertexColors[1].clone();triB.vertexColors[1]=face.vertexColors[2].clone();triB.vertexColors[2]=face.vertexColors[3].clone();}
faces.push(triA,triB);for(j=0,jl=geometry.faceVertexUvs.length;j<jl;j++){if(geometry.faceVertexUvs[j].length){var uvs=geometry.faceVertexUvs[j][i];var uvA=uvs[0];var uvB=uvs[1];var uvC=uvs[2];var uvD=uvs[3];var uvsTriA=[uvA.clone(),uvB.clone(),uvD.clone()];var uvsTriB=[uvB.clone(),uvC.clone(),uvD.clone()];faceVertexUvs[j].push(uvsTriA,uvsTriB);}}
for(j=0,jl=geometry.faceUvs.length;j<jl;j++){if(geometry.faceUvs[j].length){var faceUv=geometry.faceUvs[j][i];faceUvs[j].push(faceUv,faceUv);}}}else{faces.push(face);for(j=0,jl=geometry.faceUvs.length;j<jl;j++){faceUvs[j].push(geometry.faceUvs[j][i]);}
for(j=0,jl=geometry.faceVertexUvs.length;j<jl;j++){faceVertexUvs[j].push(geometry.faceVertexUvs[j][i]);}}}
geometry.faces=faces;geometry.faceUvs=faceUvs;geometry.faceVertexUvs=faceVertexUvs;geometry.computeCentroids();geometry.computeFaceNormals();geometry.computeVertexNormals();if(geometry.hasTangents)geometry.computeTangents();},explode:function(geometry){var vertices=[];for(var i=0,il=geometry.faces.length;i<il;i++){var n=vertices.length;var face=geometry.faces[i];if(face instanceof THREE.Face4){var a=face.a;var b=face.b;var c=face.c;var d=face.d;var va=geometry.vertices[a];var vb=geometry.vertices[b];var vc=geometry.vertices[c];var vd=geometry.vertices[d];vertices.push(va.clone());vertices.push(vb.clone());vertices.push(vc.clone());vertices.push(vd.clone());face.a=n;face.b=n+1;face.c=n+2;face.d=n+3;}else{var a=face.a;var b=face.b;var c=face.c;var va=geometry.vertices[a];var vb=geometry.vertices[b];var vc=geometry.vertices[c];vertices.push(va.clone());vertices.push(vb.clone());vertices.push(vc.clone());face.a=n;face.b=n+1;face.c=n+2;}}
geometry.vertices=vertices;delete geometry.__tmpVertices;},tessellate:function(geometry,maxEdgeLength){var i,il,face,a,b,c,d,va,vb,vc,vd,dab,dbc,dac,dcd,dad,m,m1,m2,vm,vm1,vm2,vnm,vnm1,vnm2,vcm,vcm1,vcm2,triA,triB,quadA,quadB,edge;var faces=[];var faceVertexUvs=[];for(i=0,il=geometry.faceVertexUvs.length;i<il;i++){faceVertexUvs[i]=[];}
for(i=0,il=geometry.faces.length;i<il;i++){face=geometry.faces[i];if(face instanceof THREE.Face3){a=face.a;b=face.b;c=face.c;va=geometry.vertices[a];vb=geometry.vertices[b];vc=geometry.vertices[c];dab=va.distanceTo(vb);dbc=vb.distanceTo(vc);dac=va.distanceTo(vc);if(dab>maxEdgeLength||dbc>maxEdgeLength||dac>maxEdgeLength){m=geometry.vertices.length;triA=face.clone();triB=face.clone();if(dab>=dbc&&dab>=dac){vm=va.clone();vm.lerpSelf(vb,0.5);triA.a=a;triA.b=m;triA.c=c;triB.a=m;triB.b=b;triB.c=c;if(face.vertexNormals.length===3){vnm=face.vertexNormals[0].clone();vnm.lerpSelf(face.vertexNormals[1],0.5);triA.vertexNormals[1].copy(vnm);triB.vertexNormals[0].copy(vnm);}
if(face.vertexColors.length===3){vcm=face.vertexColors[0].clone();vcm.lerpSelf(face.vertexColors[1],0.5);triA.vertexColors[1].copy(vcm);triB.vertexColors[0].copy(vcm);}
edge=0;}else if(dbc>=dab&&dbc>=dac){vm=vb.clone();vm.lerpSelf(vc,0.5);triA.a=a;triA.b=b;triA.c=m;triB.a=m;triB.b=c;triB.c=a;if(face.vertexNormals.length===3){vnm=face.vertexNormals[1].clone();vnm.lerpSelf(face.vertexNormals[2],0.5);triA.vertexNormals[2].copy(vnm);triB.vertexNormals[0].copy(vnm);triB.vertexNormals[1].copy(face.vertexNormals[2]);triB.vertexNormals[2].copy(face.vertexNormals[0]);}
if(face.vertexColors.length===3){vcm=face.vertexColors[1].clone();vcm.lerpSelf(face.vertexColors[2],0.5);triA.vertexColors[2].copy(vcm);triB.vertexColors[0].copy(vcm);triB.vertexColors[1].copy(face.vertexColors[2]);triB.vertexColors[2].copy(face.vertexColors[0]);}
edge=1;}else{vm=va.clone();vm.lerpSelf(vc,0.5);triA.a=a;triA.b=b;triA.c=m;triB.a=m;triB.b=b;triB.c=c;if(face.vertexNormals.length===3){vnm=face.vertexNormals[0].clone();vnm.lerpSelf(face.vertexNormals[2],0.5);triA.vertexNormals[2].copy(vnm);triB.vertexNormals[0].copy(vnm);}
if(face.vertexColors.length===3){vcm=face.vertexColors[0].clone();vcm.lerpSelf(face.vertexColors[2],0.5);triA.vertexColors[2].copy(vcm);triB.vertexColors[0].copy(vcm);}
edge=2;}
faces.push(triA,triB);geometry.vertices.push(vm);var j,jl,uvs,uvA,uvB,uvC,uvM,uvsTriA,uvsTriB;for(j=0,jl=geometry.faceVertexUvs.length;j<jl;j++){if(geometry.faceVertexUvs[j].length){uvs=geometry.faceVertexUvs[j][i];uvA=uvs[0];uvB=uvs[1];uvC=uvs[2];if(edge===0){uvM=uvA.clone();uvM.lerpSelf(uvB,0.5);uvsTriA=[uvA.clone(),uvM.clone(),uvC.clone()];uvsTriB=[uvM.clone(),uvB.clone(),uvC.clone()];}else if(edge===1){uvM=uvB.clone();uvM.lerpSelf(uvC,0.5);uvsTriA=[uvA.clone(),uvB.clone(),uvM.clone()];uvsTriB=[uvM.clone(),uvC.clone(),uvA.clone()];}else{uvM=uvA.clone();uvM.lerpSelf(uvC,0.5);uvsTriA=[uvA.clone(),uvB.clone(),uvM.clone()];uvsTriB=[uvM.clone(),uvB.clone(),uvC.clone()];}
faceVertexUvs[j].push(uvsTriA,uvsTriB);}}}else{faces.push(face);for(j=0,jl=geometry.faceVertexUvs.length;j<jl;j++){faceVertexUvs[j].push(geometry.faceVertexUvs[j][i]);}}}else{a=face.a;b=face.b;c=face.c;d=face.d;va=geometry.vertices[a];vb=geometry.vertices[b];vc=geometry.vertices[c];vd=geometry.vertices[d];dab=va.distanceTo(vb);dbc=vb.distanceTo(vc);dcd=vc.distanceTo(vd);dad=va.distanceTo(vd);if(dab>maxEdgeLength||dbc>maxEdgeLength||dcd>maxEdgeLength||dad>maxEdgeLength){m1=geometry.vertices.length;m2=geometry.vertices.length+1;quadA=face.clone();quadB=face.clone();if((dab>=dbc&&dab>=dcd&&dab>=dad)||(dcd>=dbc&&dcd>=dab&&dcd>=dad)){vm1=va.clone();vm1.lerpSelf(vb,0.5);vm2=vc.clone();vm2.lerpSelf(vd,0.5);quadA.a=a;quadA.b=m1;quadA.c=m2;quadA.d=d;quadB.a=m1;quadB.b=b;quadB.c=c;quadB.d=m2;if(face.vertexNormals.length===4){vnm1=face.vertexNormals[0].clone();vnm1.lerpSelf(face.vertexNormals[1],0.5);vnm2=face.vertexNormals[2].clone();vnm2.lerpSelf(face.vertexNormals[3],0.5);quadA.vertexNormals[1].copy(vnm1);quadA.vertexNormals[2].copy(vnm2);quadB.vertexNormals[0].copy(vnm1);quadB.vertexNormals[3].copy(vnm2);}
if(face.vertexColors.length===4){vcm1=face.vertexColors[0].clone();vcm1.lerpSelf(face.vertexColors[1],0.5);vcm2=face.vertexColors[2].clone();vcm2.lerpSelf(face.vertexColors[3],0.5);quadA.vertexColors[1].copy(vcm1);quadA.vertexColors[2].copy(vcm2);quadB.vertexColors[0].copy(vcm1);quadB.vertexColors[3].copy(vcm2);}
edge=0;}else{vm1=vb.clone();vm1.lerpSelf(vc,0.5);vm2=vd.clone();vm2.lerpSelf(va,0.5);quadA.a=a;quadA.b=b;quadA.c=m1;quadA.d=m2;quadB.a=m2;quadB.b=m1;quadB.c=c;quadB.d=d;if(face.vertexNormals.length===4){vnm1=face.vertexNormals[1].clone();vnm1.lerpSelf(face.vertexNormals[2],0.5);vnm2=face.vertexNormals[3].clone();vnm2.lerpSelf(face.vertexNormals[0],0.5);quadA.vertexNormals[2].copy(vnm1);quadA.vertexNormals[3].copy(vnm2);quadB.vertexNormals[0].copy(vnm2);quadB.vertexNormals[1].copy(vnm1);}
if(face.vertexColors.length===4){vcm1=face.vertexColors[1].clone();vcm1.lerpSelf(face.vertexColors[2],0.5);vcm2=face.vertexColors[3].clone();vcm2.lerpSelf(face.vertexColors[0],0.5);quadA.vertexColors[2].copy(vcm1);quadA.vertexColors[3].copy(vcm2);quadB.vertexColors[0].copy(vcm2);quadB.vertexColors[1].copy(vcm1);}
edge=1;}
faces.push(quadA,quadB);geometry.vertices.push(vm1,vm2);var j,jl,uvs,uvA,uvB,uvC,uvD,uvM1,uvM2,uvsQuadA,uvsQuadB;for(j=0,jl=geometry.faceVertexUvs.length;j<jl;j++){if(geometry.faceVertexUvs[j].length){uvs=geometry.faceVertexUvs[j][i];uvA=uvs[0];uvB=uvs[1];uvC=uvs[2];uvD=uvs[3];if(edge===0){uvM1=uvA.clone();uvM1.lerpSelf(uvB,0.5);uvM2=uvC.clone();uvM2.lerpSelf(uvD,0.5);uvsQuadA=[uvA.clone(),uvM1.clone(),uvM2.clone(),uvD.clone()];uvsQuadB=[uvM1.clone(),uvB.clone(),uvC.clone(),uvM2.clone()];}else{uvM1=uvB.clone();uvM1.lerpSelf(uvC,0.5);uvM2=uvD.clone();uvM2.lerpSelf(uvA,0.5);uvsQuadA=[uvA.clone(),uvB.clone(),uvM1.clone(),uvM2.clone()];uvsQuadB=[uvM2.clone(),uvM1.clone(),uvC.clone(),uvD.clone()];}
faceVertexUvs[j].push(uvsQuadA,uvsQuadB);}}}else{faces.push(face);for(j=0,jl=geometry.faceVertexUvs.length;j<jl;j++){faceVertexUvs[j].push(geometry.faceVertexUvs[j][i]);}}}}
geometry.faces=faces;geometry.faceVertexUvs=faceVertexUvs;}};THREE.GeometryUtils.random=THREE.Math.random16;THREE.GeometryUtils.__v1=new THREE.Vector3();THREE.ImageUtils={crossOrigin:'anonymous',loadTexture:function(url,mapping,onLoad,onError){var image=new Image();var texture=new THREE.Texture(image,mapping);var loader=new THREE.ImageLoader();loader.addEventListener('load',function(event){texture.image=event.content;texture.needsUpdate=true;if(onLoad)onLoad(texture);});loader.addEventListener('error',function(event){if(onError)onError(event.message);});loader.crossOrigin=this.crossOrigin;loader.load(url,image);return texture;},loadCompressedTexture:function(url,mapping,onLoad,onError){var texture=new THREE.CompressedTexture();texture.mapping=mapping;var request=new XMLHttpRequest();request.onload=function(){var buffer=request.response;var dds=THREE.ImageUtils.parseDDS(buffer,true);texture.format=dds.format;texture.mipmaps=dds.mipmaps;texture.image.width=dds.width;texture.image.height=dds.height;texture.generateMipmaps=false;texture.needsUpdate=true;if(onLoad)onLoad(texture);}
request.onerror=onError;request.open('GET',url,true);request.responseType="arraybuffer";request.send(null);return texture;},loadTextureCube:function(array,mapping,onLoad,onError){var images=[];images.loadCount=0;var texture=new THREE.Texture();texture.image=images;if(mapping!==undefined)texture.mapping=mapping;texture.flipY=false;for(var i=0,il=array.length;i<il;++i){var cubeImage=new Image();images[i]=cubeImage;cubeImage.onload=function(){images.loadCount+=1;if(images.loadCount===6){texture.needsUpdate=true;if(onLoad)onLoad();}};cubeImage.onerror=onError;cubeImage.crossOrigin=this.crossOrigin;cubeImage.src=array[i];}
return texture;},loadCompressedTextureCube:function(array,mapping,onLoad,onError){var images=[];images.loadCount=0;var texture=new THREE.CompressedTexture();texture.image=images;if(mapping!==undefined)texture.mapping=mapping;texture.flipY=false;texture.generateMipmaps=false;var generateCubeFaceCallback=function(rq,img){return function(){var buffer=rq.response;var dds=THREE.ImageUtils.parseDDS(buffer,true);img.format=dds.format;img.mipmaps=dds.mipmaps;img.width=dds.width;img.height=dds.height;images.loadCount+=1;if(images.loadCount===6){texture.format=dds.format;texture.needsUpdate=true;if(onLoad)onLoad();}}}
for(var i=0,il=array.length;i<il;++i){var cubeImage={};images[i]=cubeImage;var request=new XMLHttpRequest();request.onload=generateCubeFaceCallback(request,cubeImage);request.onerror=onError;var url=array[i];request.open('GET',url,true);request.responseType="arraybuffer";request.send(null);}
return texture;},parseDDS:function(buffer,loadMipmaps){var dds={mipmaps:[],width:0,height:0,format:null,mipmapCount:1};var DDS_MAGIC=0x20534444;var DDSD_CAPS=0x1,DDSD_HEIGHT=0x2,DDSD_WIDTH=0x4,DDSD_PITCH=0x8,DDSD_PIXELFORMAT=0x1000,DDSD_MIPMAPCOUNT=0x20000,DDSD_LINEARSIZE=0x80000,DDSD_DEPTH=0x800000;var DDSCAPS_COMPLEX=0x8,DDSCAPS_MIPMAP=0x400000,DDSCAPS_TEXTURE=0x1000;var DDSCAPS2_CUBEMAP=0x200,DDSCAPS2_CUBEMAP_POSITIVEX=0x400,DDSCAPS2_CUBEMAP_NEGATIVEX=0x800,DDSCAPS2_CUBEMAP_POSITIVEY=0x1000,DDSCAPS2_CUBEMAP_NEGATIVEY=0x2000,DDSCAPS2_CUBEMAP_POSITIVEZ=0x4000,DDSCAPS2_CUBEMAP_NEGATIVEZ=0x8000,DDSCAPS2_VOLUME=0x200000;var DDPF_ALPHAPIXELS=0x1,DDPF_ALPHA=0x2,DDPF_FOURCC=0x4,DDPF_RGB=0x40,DDPF_YUV=0x200,DDPF_LUMINANCE=0x20000;function fourCCToInt32(value){return value.charCodeAt(0)+
(value.charCodeAt(1)<<8)+
(value.charCodeAt(2)<<16)+
(value.charCodeAt(3)<<24);}
function int32ToFourCC(value){return String.fromCharCode(value&0xff,(value>>8)&0xff,(value>>16)&0xff,(value>>24)&0xff);}
var FOURCC_DXT1=fourCCToInt32("DXT1");var FOURCC_DXT3=fourCCToInt32("DXT3");var FOURCC_DXT5=fourCCToInt32("DXT5");var headerLengthInt=31;var off_magic=0;var off_size=1;var off_flags=2;var off_height=3;var off_width=4;var off_mipmapCount=7;var off_pfFlags=20;var off_pfFourCC=21;var header=new Int32Array(buffer,0,headerLengthInt);if(header[off_magic]!==DDS_MAGIC){console.error("ImageUtils.parseDDS(): Invalid magic number in DDS header");return dds;}
if(!header[off_pfFlags]&DDPF_FOURCC){console.error("ImageUtils.parseDDS(): Unsupported format, must contain a FourCC code");return dds;}
var blockBytes;var fourCC=header[off_pfFourCC];switch(fourCC){case FOURCC_DXT1:blockBytes=8;dds.format=THREE.RGB_S3TC_DXT1_Format;break;case FOURCC_DXT3:blockBytes=16;dds.format=THREE.RGBA_S3TC_DXT3_Format;break;case FOURCC_DXT5:blockBytes=16;dds.format=THREE.RGBA_S3TC_DXT5_Format;break;default:console.error("ImageUtils.parseDDS(): Unsupported FourCC code: ",int32ToFourCC(fourCC));return dds;}
dds.mipmapCount=1;if(header[off_flags]&DDSD_MIPMAPCOUNT&&loadMipmaps!==false){dds.mipmapCount=Math.max(1,header[off_mipmapCount]);}
dds.width=header[off_width];dds.height=header[off_height];var dataOffset=header[off_size]+4;var width=dds.width;var height=dds.height;for(var i=0;i<dds.mipmapCount;i++){var dataLength=Math.max(4,width)/4*Math.max(4,height)/4*blockBytes;var byteArray=new Uint8Array(buffer,dataOffset,dataLength);var mipmap={"data":byteArray,"width":width,"height":height};dds.mipmaps.push(mipmap);dataOffset+=dataLength;width=Math.max(width*0.5,1);height=Math.max(height*0.5,1);}
return dds;},getNormalMap:function(image,depth){var cross=function(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]];}
var subtract=function(a,b){return[a[0]-b[0],a[1]-b[1],a[2]-b[2]];}
var normalize=function(a){var l=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);return[a[0]/l,a[1]/l,a[2]/l];}
depth=depth|1;var width=image.width;var height=image.height;var canvas=document.createElement('canvas');canvas.width=width;canvas.height=height;var context=canvas.getContext('2d');context.drawImage(image,0,0);var data=context.getImageData(0,0,width,height).data;var imageData=context.createImageData(width,height);var output=imageData.data;for(var x=0;x<width;x++){for(var y=0;y<height;y++){var ly=y-1<0?0:y-1;var uy=y+1>height-1?height-1:y+1;var lx=x-1<0?0:x-1;var ux=x+1>width-1?width-1:x+1;var points=[];var origin=[0,0,data[(y*width+x)*4]/255*depth];points.push([-1,0,data[(y*width+lx)*4]/255*depth]);points.push([-1,-1,data[(ly*width+lx)*4]/255*depth]);points.push([0,-1,data[(ly*width+x)*4]/255*depth]);points.push([1,-1,data[(ly*width+ux)*4]/255*depth]);points.push([1,0,data[(y*width+ux)*4]/255*depth]);points.push([1,1,data[(uy*width+ux)*4]/255*depth]);points.push([0,1,data[(uy*width+x)*4]/255*depth]);points.push([-1,1,data[(uy*width+lx)*4]/255*depth]);var normals=[];var num_points=points.length;for(var i=0;i<num_points;i++){var v1=points[i];var v2=points[(i+1)%num_points];v1=subtract(v1,origin);v2=subtract(v2,origin);normals.push(normalize(cross(v1,v2)));}
var normal=[0,0,0];for(var i=0;i<normals.length;i++){normal[0]+=normals[i][0];normal[1]+=normals[i][1];normal[2]+=normals[i][2];}
normal[0]/=normals.length;normal[1]/=normals.length;normal[2]/=normals.length;var idx=(y*width+x)*4;output[idx]=((normal[0]+1.0)/2.0*255)|0;output[idx+1]=((normal[1]+1.0)/2.0*255)|0;output[idx+2]=(normal[2]*255)|0;output[idx+3]=255;}}
context.putImageData(imageData,0,0);return canvas;},generateDataTexture:function(width,height,color){var size=width*height;var data=new Uint8Array(3*size);var r=Math.floor(color.r*255);var g=Math.floor(color.g*255);var b=Math.floor(color.b*255);for(var i=0;i<size;i++){data[i*3]=r;data[i*3+1]=g;data[i*3+2]=b;}
var texture=new THREE.DataTexture(data,width,height,THREE.RGBFormat);texture.needsUpdate=true;return texture;}};THREE.SceneUtils={createMultiMaterialObject:function(geometry,materials){var group=new THREE.Object3D();for(var i=0,l=materials.length;i<l;i++){group.add(new THREE.Mesh(geometry,materials[i]));}
return group;},detach:function(child,parent,scene){child.applyMatrix(parent.matrixWorld);parent.remove(child);scene.add(child);},attach:function(child,scene,parent){var matrixWorldInverse=new THREE.Matrix4();matrixWorldInverse.getInverse(parent.matrixWorld);child.applyMatrix(matrixWorldInverse);scene.remove(child);parent.add(child);}};if(THREE.WebGLRenderer){THREE.ShaderUtils={lib:{'fresnel':{uniforms:{"mRefractionRatio":{type:"f",value:1.02},"mFresnelBias":{type:"f",value:0.1},"mFresnelPower":{type:"f",value:2.0},"mFresnelScale":{type:"f",value:1.0},"tCube":{type:"t",value:null}},fragmentShader:["uniform samplerCube tCube;","varying vec3 vReflect;","varying vec3 vRefract[3];","varying float vReflectionFactor;","void main() {","vec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","vec4 refractedColor = vec4( 1.0, 1.0, 1.0, 1.0 );","refractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;","refractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;","refractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;","refractedColor.a = 1.0;","gl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );","}"].join("\n"),vertexShader:["uniform float mRefractionRatio;","uniform float mFresnelBias;","uniform float mFresnelScale;","uniform float mFresnelPower;","varying vec3 vReflect;","varying vec3 vRefract[3];","varying float vReflectionFactor;","void main() {","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vec4 mPosition = modelMatrix * vec4( position, 1.0 );","vec3 nWorld = normalize( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );","vec3 I = mPosition.xyz - cameraPosition;","vReflect = reflect( I, nWorld );","vRefract[0] = refract( normalize( I ), nWorld, mRefractionRatio );","vRefract[1] = refract( normalize( I ), nWorld, mRefractionRatio * 0.99 );","vRefract[2] = refract( normalize( I ), nWorld, mRefractionRatio * 0.98 );","vReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), nWorld ), mFresnelPower );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n")},'normal':{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["fog"],THREE.UniformsLib["lights"],THREE.UniformsLib["shadowmap"],{"enableAO":{type:"i",value:0},"enableDiffuse":{type:"i",value:0},"enableSpecular":{type:"i",value:0},"enableReflection":{type:"i",value:0},"enableDisplacement":{type:"i",value:0},"tDisplacement":{type:"t",value:null},"tDiffuse":{type:"t",value:null},"tCube":{type:"t",value:null},"tNormal":{type:"t",value:null},"tSpecular":{type:"t",value:null},"tAO":{type:"t",value:null},"uNormalScale":{type:"v2",value:new THREE.Vector2(1,1)},"uDisplacementBias":{type:"f",value:0.0},"uDisplacementScale":{type:"f",value:1.0},"uDiffuseColor":{type:"c",value:new THREE.Color(0xffffff)},"uSpecularColor":{type:"c",value:new THREE.Color(0x111111)},"uAmbientColor":{type:"c",value:new THREE.Color(0xffffff)},"uShininess":{type:"f",value:30},"uOpacity":{type:"f",value:1},"useRefract":{type:"i",value:0},"uRefractionRatio":{type:"f",value:0.98},"uReflectivity":{type:"f",value:0.5},"uOffset":{type:"v2",value:new THREE.Vector2(0,0)},"uRepeat":{type:"v2",value:new THREE.Vector2(1,1)},"wrapRGB":{type:"v3",value:new THREE.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;","uniform vec3 uDiffuseColor;","uniform vec3 uSpecularColor;","uniform float uShininess;","uniform float uOpacity;","uniform bool enableDiffuse;","uniform bool enableSpecular;","uniform bool enableAO;","uniform bool enableReflection;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tAO;","uniform samplerCube tCube;","uniform vec2 uNormalScale;","uniform bool useRefract;","uniform float uRefractionRatio;","uniform float uReflectivity;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightPosition[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngle[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",THREE.ShaderChunk["shadowmap_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],"void main() {","gl_FragColor = vec4( vec3( 1.0 ), uOpacity );","vec3 specularTex = vec3( 1.0 );","vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( enableDiffuse ) {","#ifdef GAMMA_INPUT","vec4 texelColor = texture2D( tDiffuse, vUv );","texelColor.xyz *= texelColor.xyz;","gl_FragColor = gl_FragColor * texelColor;","#else","gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );","#endif","}","if( enableAO ) {","#ifdef GAMMA_INPUT","vec4 aoColor = texture2D( tAO, vUv );","aoColor.xyz *= aoColor.xyz;","gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;","#else","gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;","#endif","}","if( enableSpecular )","specularTex = texture2D( tSpecular, vUv ).xyz;","mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );","vec3 finalNormal = tsb * normalTex;","#ifdef FLIP_SIDED","finalNormal = -finalNormal;","#endif","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 pointVector = lPosition.xyz + vViewPosition.xyz;","float pointDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );","pointVector = normalize( pointVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","#endif","pointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;","vec3 pointHalfVector = normalize( pointVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;","#else","pointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 spotVector = lPosition.xyz + vViewPosition.xyz;","float spotDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );","spotVector = normalize( spotVector );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngle[ i ] ) {","spotEffect = pow( spotEffect, spotLightExponent[ i ] );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );","#endif","spotDiffuse += spotDistance * spotLightColor[ i ] * uDiffuseColor * spotDiffuseWeight * spotEffect;","vec3 spotHalfVector = normalize( spotVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;","#else","spotSpecular += spotDistance * spotLightColor[ i ] * uSpecularColor * spotSpecularWeight * spotDiffuseWeight * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","#ifdef WRAP_AROUND","float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );","float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","#endif","dirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( hemisphereLightPosition[ i ], 1.0 );","vec3 lVector = normalize( lPosition.xyz + vViewPosition.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += uDiffuseColor * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, uShininess ), 0.0 );","vec3 lVectorGround = normalize( -lPosition.xyz + vViewPosition.xyz );","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlickSky = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += uSpecularColor * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor ) + totalSpecular;","#endif","if ( enableReflection ) {","vec3 vReflect;","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, normal, uRefractionRatio );","} else {","vReflect = reflect( cameraToVertex, normal );","}","vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * uReflectivity );","}",THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["linear_to_gamma_fragment"],THREE.ShaderChunk["fog_fragment"],"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uOffset;","uniform vec2 uRepeat;","uniform bool enableDisplacement;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",THREE.ShaderChunk["skinning_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],"void main() {",THREE.ShaderChunk["skinbase_vertex"],THREE.ShaderChunk["skinnormal_vertex"],"#ifdef USE_SKINNING","vNormal = normalMatrix * skinnedNormal.xyz;","vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );","vTangent = normalMatrix * skinnedTangent.xyz;","#else","vNormal = normalMatrix * normal;","vTangent = normalMatrix * tangent.xyz;","#endif","vBinormal = cross( vNormal, vTangent ) * tangent.w;","vUv = uv * uRepeat + uOffset;","vec3 displacedPosition;","#ifdef VERTEX_TEXTURES","if ( enableDisplacement ) {","vec3 dv = texture2D( tDisplacement, uv ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","displacedPosition = position + normalize( normal ) * df;","} else {","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned    += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","}","#else","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned    += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","#endif","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","vec4 mPosition = modelMatrix * vec4( displacedPosition, 1.0 );","gl_Position = projectionMatrix * mvPosition;","vWorldPosition = mPosition.xyz;","vViewPosition = -mvPosition.xyz;","#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * mPosition;","}","#endif","}"].join("\n")},'cube':{uniforms:{"tCube":{type:"t",value:null},"tFlip":{type:"f",value:-1}},vertexShader:["varying vec3 vViewPosition;","void main() {","vec4 mPosition = modelMatrix * vec4( position, 1.0 );","vViewPosition = cameraPosition - mPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vViewPosition;","void main() {","vec3 wPos = cameraPosition - vViewPosition;","gl_FragColor = textureCube( tCube, vec3( tFlip * wPos.x, wPos.yz ) );","}"].join("\n")}}};};THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style];},loadFace:function(data){var family=data.familyName.toLowerCase();var ThreeFont=this;ThreeFont.faces[family]=ThreeFont.faces[family]||{};ThreeFont.faces[family][data.cssFontWeight]=ThreeFont.faces[family][data.cssFontWeight]||{};ThreeFont.faces[family][data.cssFontWeight][data.cssFontStyle]=data;var face=ThreeFont.faces[family][data.cssFontWeight][data.cssFontStyle]=data;return data;},drawText:function(text){var characterPts=[],allPts=[];var i,p,face=this.getFace(),scale=this.size/face.resolution,offset=0,chars=String(text).split(''),length=chars.length;var fontPaths=[];for(i=0;i<length;i++){var path=new THREE.Path();var ret=this.extractGlyphPoints(chars[i],face,scale,offset,path);offset+=ret.offset;fontPaths.push(ret.path);}
var width=offset/2;return{paths:fontPaths,offset:width};},extractGlyphPoints:function(c,face,scale,offset,path){var pts=[];var i,i2,divisions,outline,action,length,scaleX,scaleY,x,y,cpx,cpy,cpx0,cpy0,cpx1,cpy1,cpx2,cpy2,laste,glyph=face.glyphs[c]||face.glyphs['?'];if(!glyph)return;if(glyph.o){outline=glyph._cachedOutline||(glyph._cachedOutline=glyph.o.split(' '));length=outline.length;scaleX=scale;scaleY=scale;for(i=0;i<length;){action=outline[i++];switch(action){case'm':x=outline[i++]*scaleX+offset;y=outline[i++]*scaleY;path.moveTo(x,y);break;case'l':x=outline[i++]*scaleX+offset;y=outline[i++]*scaleY;path.lineTo(x,y);break;case'q':cpx=outline[i++]*scaleX+offset;cpy=outline[i++]*scaleY;cpx1=outline[i++]*scaleX+offset;cpy1=outline[i++]*scaleY;path.quadraticCurveTo(cpx1,cpy1,cpx,cpy);laste=pts[pts.length-1];if(laste){cpx0=laste.x;cpy0=laste.y;for(i2=1,divisions=this.divisions;i2<=divisions;i2++){var t=i2/divisions;var tx=THREE.Shape.Utils.b2(t,cpx0,cpx1,cpx);var ty=THREE.Shape.Utils.b2(t,cpy0,cpy1,cpy);}}
break;case'b':cpx=outline[i++]*scaleX+offset;cpy=outline[i++]*scaleY;cpx1=outline[i++]*scaleX+offset;cpy1=outline[i++]*-scaleY;cpx2=outline[i++]*scaleX+offset;cpy2=outline[i++]*-scaleY;path.bezierCurveTo(cpx,cpy,cpx1,cpy1,cpx2,cpy2);laste=pts[pts.length-1];if(laste){cpx0=laste.x;cpy0=laste.y;for(i2=1,divisions=this.divisions;i2<=divisions;i2++){var t=i2/divisions;var tx=THREE.Shape.Utils.b3(t,cpx0,cpx1,cpx2,cpx);var ty=THREE.Shape.Utils.b3(t,cpy0,cpy1,cpy2,cpy);}}
break;}}}
return{offset:glyph.ha*scale,path:path};}};THREE.FontUtils.generateShapes=function(text,parameters){parameters=parameters||{};var size=parameters.size!==undefined?parameters.size:100;var curveSegments=parameters.curveSegments!==undefined?parameters.curveSegments:4;var font=parameters.font!==undefined?parameters.font:"helvetiker";var weight=parameters.weight!==undefined?parameters.weight:"normal";var style=parameters.style!==undefined?parameters.style:"normal";THREE.FontUtils.size=size;THREE.FontUtils.divisions=curveSegments;THREE.FontUtils.face=font;THREE.FontUtils.weight=weight;THREE.FontUtils.style=style;var data=THREE.FontUtils.drawText(text);var paths=data.paths;var shapes=[];for(var p=0,pl=paths.length;p<pl;p++){Array.prototype.push.apply(shapes,paths[p].toShapes());}
return shapes;};(function(namespace){var EPSILON=0.0000000001;var process=function(contour,indices){var n=contour.length;if(n<3)return null;var result=[],verts=[],vertIndices=[];var u,v,w;if(area(contour)>0.0){for(v=0;v<n;v++)verts[v]=v;}else{for(v=0;v<n;v++)verts[v]=(n-1)-v;}
var nv=n;var count=2*nv;for(v=nv-1;nv>2;){if((count--)<=0){console.log("Warning, unable to triangulate polygon!");if(indices)return vertIndices;return result;}
u=v;if(nv<=u)u=0;v=u+1;if(nv<=v)v=0;w=v+1;if(nv<=w)w=0;if(snip(contour,u,v,w,nv,verts)){var a,b,c,s,t;a=verts[u];b=verts[v];c=verts[w];result.push([contour[a],contour[b],contour[c]]);vertIndices.push([verts[u],verts[v],verts[w]]);for(s=v,t=v+1;t<nv;s++,t++){verts[s]=verts[t];}
nv--;count=2*nv;}}
if(indices)return vertIndices;return result;};var area=function(contour){var n=contour.length;var a=0.0;for(var p=n-1,q=0;q<n;p=q++){a+=contour[p].x*contour[q].y-contour[q].x*contour[p].y;}
return a*0.5;};var insideTriangle=function(ax,ay,bx,by,cx,cy,px,py){var aX,aY,bX,bY;var cX,cY,apx,apy;var bpx,bpy,cpx,cpy;var cCROSSap,bCROSScp,aCROSSbp;aX=cx-bx;aY=cy-by;bX=ax-cx;bY=ay-cy;cX=bx-ax;cY=by-ay;apx=px-ax;apy=py-ay;bpx=px-bx;bpy=py-by;cpx=px-cx;cpy=py-cy;aCROSSbp=aX*bpy-aY*bpx;cCROSSap=cX*apy-cY*apx;bCROSScp=bX*cpy-bY*cpx;return((aCROSSbp>=0.0)&&(bCROSScp>=0.0)&&(cCROSSap>=0.0));};var snip=function(contour,u,v,w,n,verts){var p;var ax,ay,bx,by;var cx,cy,px,py;ax=contour[verts[u]].x;ay=contour[verts[u]].y;bx=contour[verts[v]].x;by=contour[verts[v]].y;cx=contour[verts[w]].x;cy=contour[verts[w]].y;if(EPSILON>(((bx-ax)*(cy-ay))-((by-ay)*(cx-ax))))return false;for(p=0;p<n;p++){if((p==u)||(p==v)||(p==w))continue;px=contour[verts[p]].x
py=contour[verts[p]].y
if(insideTriangle(ax,ay,bx,by,cx,cy,px,py))return false;}
return true;};namespace.Triangulate=process;namespace.Triangulate.area=area;return namespace;})(THREE.FontUtils);self._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace};THREE.Curve=function(){};THREE.Curve.prototype.getPoint=function(t){console.log("Warning, getPoint() not implemented!");return null;};THREE.Curve.prototype.getPointAt=function(u){var t=this.getUtoTmapping(u);return this.getPoint(t);};THREE.Curve.prototype.getPoints=function(divisions){if(!divisions)divisions=5;var d,pts=[];for(d=0;d<=divisions;d++){pts.push(this.getPoint(d/divisions));}
return pts;};THREE.Curve.prototype.getSpacedPoints=function(divisions){if(!divisions)divisions=5;var d,pts=[];for(d=0;d<=divisions;d++){pts.push(this.getPointAt(d/divisions));}
return pts;};THREE.Curve.prototype.getLength=function(){var lengths=this.getLengths();return lengths[lengths.length-1];};THREE.Curve.prototype.getLengths=function(divisions){if(!divisions)divisions=(this.__arcLengthDivisions)?(this.__arcLengthDivisions):200;if(this.cacheArcLengths&&(this.cacheArcLengths.length==divisions+1)&&!this.needsUpdate){return this.cacheArcLengths;}
this.needsUpdate=false;var cache=[];var current,last=this.getPoint(0);var p,sum=0;cache.push(0);for(p=1;p<=divisions;p++){current=this.getPoint(p/divisions);sum+=current.distanceTo(last);cache.push(sum);last=current;}
this.cacheArcLengths=cache;return cache;};THREE.Curve.prototype.updateArcLengths=function(){this.needsUpdate=true;this.getLengths();};THREE.Curve.prototype.getUtoTmapping=function(u,distance){var arcLengths=this.getLengths();var i=0,il=arcLengths.length;var targetArcLength;if(distance){targetArcLength=distance;}else{targetArcLength=u*arcLengths[il-1];}
var low=0,high=il-1,comparison;while(low<=high){i=Math.floor(low+(high-low)/2);comparison=arcLengths[i]-targetArcLength;if(comparison<0){low=i+1;continue;}else if(comparison>0){high=i-1;continue;}else{high=i;break;}}
i=high;if(arcLengths[i]==targetArcLength){var t=i/(il-1);return t;}
var lengthBefore=arcLengths[i];var lengthAfter=arcLengths[i+1];var segmentLength=lengthAfter-lengthBefore;var segmentFraction=(targetArcLength-lengthBefore)/segmentLength;var t=(i+segmentFraction)/(il-1);return t;};THREE.Curve.prototype.getNormalVector=function(t){var vec=this.getTangent(t);return new THREE.Vector2(-vec.y,vec.x);};THREE.Curve.prototype.getTangent=function(t){var delta=0.0001;var t1=t-delta;var t2=t+delta;if(t1<0)t1=0;if(t2>1)t2=1;var pt1=this.getPoint(t1);var pt2=this.getPoint(t2);var vec=pt2.clone().subSelf(pt1);return vec.normalize();};THREE.Curve.prototype.getTangentAt=function(u){var t=this.getUtoTmapping(u);return this.getTangent(t);};THREE.LineCurve=function(v1,v2){this.v1=v1;this.v2=v2;};THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.LineCurve.prototype.getPoint=function(t){var point=this.v2.clone().subSelf(this.v1);point.multiplyScalar(t).addSelf(this.v1);return point;};THREE.LineCurve.prototype.getPointAt=function(u){return this.getPoint(u);};THREE.LineCurve.prototype.getTangent=function(t){var tangent=this.v2.clone().subSelf(this.v1);return tangent.normalize();};THREE.QuadraticBezierCurve=function(v0,v1,v2){this.v0=v0;this.v1=v1;this.v2=v2;};THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.QuadraticBezierCurve.prototype.getPoint=function(t){var tx,ty;tx=THREE.Shape.Utils.b2(t,this.v0.x,this.v1.x,this.v2.x);ty=THREE.Shape.Utils.b2(t,this.v0.y,this.v1.y,this.v2.y);return new THREE.Vector2(tx,ty);};THREE.QuadraticBezierCurve.prototype.getTangent=function(t){var tx,ty;tx=THREE.Curve.Utils.tangentQuadraticBezier(t,this.v0.x,this.v1.x,this.v2.x);ty=THREE.Curve.Utils.tangentQuadraticBezier(t,this.v0.y,this.v1.y,this.v2.y);var tangent=new THREE.Vector2(tx,ty);tangent.normalize();return tangent;};THREE.CubicBezierCurve=function(v0,v1,v2,v3){this.v0=v0;this.v1=v1;this.v2=v2;this.v3=v3;};THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.CubicBezierCurve.prototype.getPoint=function(t){var tx,ty;tx=THREE.Shape.Utils.b3(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x);ty=THREE.Shape.Utils.b3(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y);return new THREE.Vector2(tx,ty);};THREE.CubicBezierCurve.prototype.getTangent=function(t){var tx,ty;tx=THREE.Curve.Utils.tangentCubicBezier(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x);ty=THREE.Curve.Utils.tangentCubicBezier(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var tangent=new THREE.Vector2(tx,ty);tangent.normalize();return tangent;};THREE.SplineCurve=function(points){this.points=(points==undefined)?[]:points;};THREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.SplineCurve.prototype.getPoint=function(t){var v=new THREE.Vector2();var c=[];var points=this.points,point,intPoint,weight;point=(points.length-1)*t;intPoint=Math.floor(point);weight=point-intPoint;c[0]=intPoint==0?intPoint:intPoint-1;c[1]=intPoint;c[2]=intPoint>points.length-2?points.length-1:intPoint+1;c[3]=intPoint>points.length-3?points.length-1:intPoint+2;v.x=THREE.Curve.Utils.interpolate(points[c[0]].x,points[c[1]].x,points[c[2]].x,points[c[3]].x,weight);v.y=THREE.Curve.Utils.interpolate(points[c[0]].y,points[c[1]].y,points[c[2]].y,points[c[3]].y,weight);return v;};THREE.EllipseCurve=function(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise){this.aX=aX;this.aY=aY;this.xRadius=xRadius;this.yRadius=yRadius;this.aStartAngle=aStartAngle;this.aEndAngle=aEndAngle;this.aClockwise=aClockwise;};THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype);THREE.EllipseCurve.prototype.getPoint=function(t){var deltaAngle=this.aEndAngle-this.aStartAngle;if(!this.aClockwise){t=1-t;}
var angle=this.aStartAngle+t*deltaAngle;var tx=this.aX+this.xRadius*Math.cos(angle);var ty=this.aY+this.yRadius*Math.sin(angle);return new THREE.Vector2(tx,ty);};THREE.ArcCurve=function(aX,aY,aRadius,aStartAngle,aEndAngle,aClockwise){THREE.EllipseCurve.call(this,aX,aY,aRadius,aRadius,aStartAngle,aEndAngle,aClockwise);};THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype);THREE.Curve.Utils={tangentQuadraticBezier:function(t,p0,p1,p2){return 2*(1-t)*(p1-p0)+2*t*(p2-p1);},tangentCubicBezier:function(t,p0,p1,p2,p3){return-3*p0*(1-t)*(1-t)+
3*p1*(1-t)*(1-t)-6*t*p1*(1-t)+
6*t*p2*(1-t)-3*t*t*p2+
3*t*t*p3;},tangentSpline:function(t,p0,p1,p2,p3){var h00=6*t*t-6*t;var h10=3*t*t-4*t+1;var h01=-6*t*t+6*t;var h11=3*t*t-2*t;return h00+h10+h01+h11;},interpolate:function(p0,p1,p2,p3,t){var v0=(p2-p0)*0.5;var v1=(p3-p1)*0.5;var t2=t*t;var t3=t*t2;return(2*p1-2*p2+v0+v1)*t3+(-3*p1+3*p2-2*v0-v1)*t2+v0*t+p1;}};THREE.Curve.create=function(constructor,getPointFunc){constructor.prototype=Object.create(THREE.Curve.prototype);constructor.prototype.getPoint=getPointFunc;return constructor;};THREE.LineCurve3=THREE.Curve.create(function(v1,v2){this.v1=v1;this.v2=v2;},function(t){var r=new THREE.Vector3();r.sub(this.v2,this.v1);r.multiplyScalar(t);r.addSelf(this.v1);return r;});THREE.QuadraticBezierCurve3=THREE.Curve.create(function(v0,v1,v2){this.v0=v0;this.v1=v1;this.v2=v2;},function(t){var tx,ty,tz;tx=THREE.Shape.Utils.b2(t,this.v0.x,this.v1.x,this.v2.x);ty=THREE.Shape.Utils.b2(t,this.v0.y,this.v1.y,this.v2.y);tz=THREE.Shape.Utils.b2(t,this.v0.z,this.v1.z,this.v2.z);return new THREE.Vector3(tx,ty,tz);});THREE.CubicBezierCurve3=THREE.Curve.create(function(v0,v1,v2,v3){this.v0=v0;this.v1=v1;this.v2=v2;this.v3=v3;},function(t){var tx,ty,tz;tx=THREE.Shape.Utils.b3(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x);ty=THREE.Shape.Utils.b3(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y);tz=THREE.Shape.Utils.b3(t,this.v0.z,this.v1.z,this.v2.z,this.v3.z);return new THREE.Vector3(tx,ty,tz);});THREE.SplineCurve3=THREE.Curve.create(function(points){this.points=(points==undefined)?[]:points;},function(t){var v=new THREE.Vector3();var c=[];var points=this.points,point,intPoint,weight;point=(points.length-1)*t;intPoint=Math.floor(point);weight=point-intPoint;c[0]=intPoint==0?intPoint:intPoint-1;c[1]=intPoint;c[2]=intPoint>points.length-2?points.length-1:intPoint+1;c[3]=intPoint>points.length-3?points.length-1:intPoint+2;var pt0=points[c[0]],pt1=points[c[1]],pt2=points[c[2]],pt3=points[c[3]];v.x=THREE.Curve.Utils.interpolate(pt0.x,pt1.x,pt2.x,pt3.x,weight);v.y=THREE.Curve.Utils.interpolate(pt0.y,pt1.y,pt2.y,pt3.y,weight);v.z=THREE.Curve.Utils.interpolate(pt0.z,pt1.z,pt2.z,pt3.z,weight);return v;});THREE.ClosedSplineCurve3=THREE.Curve.create(function(points){this.points=(points==undefined)?[]:points;},function(t){var v=new THREE.Vector3();var c=[];var points=this.points,point,intPoint,weight;point=(points.length-0)*t;intPoint=Math.floor(point);weight=point-intPoint;intPoint+=intPoint>0?0:(Math.floor(Math.abs(intPoint)/points.length)+1)*points.length;c[0]=(intPoint-1)%points.length;c[1]=(intPoint)%points.length;c[2]=(intPoint+1)%points.length;c[3]=(intPoint+2)%points.length;v.x=THREE.Curve.Utils.interpolate(points[c[0]].x,points[c[1]].x,points[c[2]].x,points[c[3]].x,weight);v.y=THREE.Curve.Utils.interpolate(points[c[0]].y,points[c[1]].y,points[c[2]].y,points[c[3]].y,weight);v.z=THREE.Curve.Utils.interpolate(points[c[0]].z,points[c[1]].z,points[c[2]].z,points[c[3]].z,weight);return v;});THREE.CurvePath=function(){this.curves=[];this.bends=[];this.autoClose=false;};THREE.CurvePath.prototype=Object.create(THREE.Curve.prototype);THREE.CurvePath.prototype.add=function(curve){this.curves.push(curve);};THREE.CurvePath.prototype.checkConnection=function(){};THREE.CurvePath.prototype.closePath=function(){var startPoint=this.curves[0].getPoint(0);var endPoint=this.curves[this.curves.length-1].getPoint(1);if(!startPoint.equals(endPoint)){this.curves.push(new THREE.LineCurve(endPoint,startPoint));}};THREE.CurvePath.prototype.getPoint=function(t){var d=t*this.getLength();var curveLengths=this.getCurveLengths();var i=0,diff,curve;while(i<curveLengths.length){if(curveLengths[i]>=d){diff=curveLengths[i]-d;curve=this.curves[i];var u=1-diff/curve.getLength();return curve.getPointAt(u);break;}
i++;}
return null;};THREE.CurvePath.prototype.getLength=function(){var lens=this.getCurveLengths();return lens[lens.length-1];};THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length){return this.cacheLengths;};var lengths=[],sums=0;var i,il=this.curves.length;for(i=0;i<il;i++){sums+=this.curves[i].getLength();lengths.push(sums);}
this.cacheLengths=lengths;return lengths;};THREE.CurvePath.prototype.getBoundingBox=function(){var points=this.getPoints();var maxX,maxY,maxZ;var minX,minY,minZ;maxX=maxY=Number.NEGATIVE_INFINITY;minX=minY=Number.POSITIVE_INFINITY;var p,i,il,sum;var v3=points[0]instanceof THREE.Vector3;sum=v3?new THREE.Vector3():new THREE.Vector2();for(i=0,il=points.length;i<il;i++){p=points[i];if(p.x>maxX)maxX=p.x;else if(p.x<minX)minX=p.x;if(p.y>maxY)maxY=p.y;else if(p.y<minY)minY=p.y;if(v3){if(p.z>maxZ)maxZ=p.z;else if(p.z<minZ)minZ=p.z;}
sum.addSelf(p);}
var ret={minX:minX,minY:minY,maxX:maxX,maxY:maxY,centroid:sum.divideScalar(il)};if(v3){ret.maxZ=maxZ;ret.minZ=minZ;}
return ret;};THREE.CurvePath.prototype.createPointsGeometry=function(divisions){var pts=this.getPoints(divisions,true);return this.createGeometry(pts);};THREE.CurvePath.prototype.createSpacedPointsGeometry=function(divisions){var pts=this.getSpacedPoints(divisions,true);return this.createGeometry(pts);};THREE.CurvePath.prototype.createGeometry=function(points){var geometry=new THREE.Geometry();for(var i=0;i<points.length;i++){geometry.vertices.push(new THREE.Vector3(points[i].x,points[i].y,points[i].z||0));}
return geometry;};THREE.CurvePath.prototype.addWrapPath=function(bendpath){this.bends.push(bendpath);};THREE.CurvePath.prototype.getTransformedPoints=function(segments,bends){var oldPts=this.getPoints(segments);var i,il;if(!bends){bends=this.bends;}
for(i=0,il=bends.length;i<il;i++){oldPts=this.getWrapPoints(oldPts,bends[i]);}
return oldPts;};THREE.CurvePath.prototype.getTransformedSpacedPoints=function(segments,bends){var oldPts=this.getSpacedPoints(segments);var i,il;if(!bends){bends=this.bends;}
for(i=0,il=bends.length;i<il;i++){oldPts=this.getWrapPoints(oldPts,bends[i]);}
return oldPts;};THREE.CurvePath.prototype.getWrapPoints=function(oldPts,path){var bounds=this.getBoundingBox();var i,il,p,oldX,oldY,xNorm;for(i=0,il=oldPts.length;i<il;i++){p=oldPts[i];oldX=p.x;oldY=p.y;xNorm=oldX/bounds.maxX;xNorm=path.getUtoTmapping(xNorm,oldX);var pathPt=path.getPoint(xNorm);var normal=path.getNormalVector(xNorm).multiplyScalar(oldY);p.x=pathPt.x+normal.x;p.y=pathPt.y+normal.y;}
return oldPts;};THREE.Gyroscope=function(){THREE.Object3D.call(this);};THREE.Gyroscope.prototype=Object.create(THREE.Object3D.prototype);THREE.Gyroscope.prototype.updateMatrixWorld=function(force){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||force){if(this.parent){this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix);this.matrixWorld.decompose(this.translationWorld,this.rotationWorld,this.scaleWorld);this.matrix.decompose(this.translationObject,this.rotationObject,this.scaleObject);this.matrixWorld.compose(this.translationWorld,this.rotationObject,this.scaleWorld);}else{this.matrixWorld.copy(this.matrix);}
this.matrixWorldNeedsUpdate=false;force=true;}
for(var i=0,l=this.children.length;i<l;i++){this.children[i].updateMatrixWorld(force);}};THREE.Gyroscope.prototype.translationWorld=new THREE.Vector3();THREE.Gyroscope.prototype.translationObject=new THREE.Vector3();THREE.Gyroscope.prototype.rotationWorld=new THREE.Quaternion();THREE.Gyroscope.prototype.rotationObject=new THREE.Quaternion();THREE.Gyroscope.prototype.scaleWorld=new THREE.Vector3();THREE.Gyroscope.prototype.scaleObject=new THREE.Vector3();THREE.Path=function(points){THREE.CurvePath.call(this);this.actions=[];if(points){this.fromPoints(points);}};THREE.Path.prototype=Object.create(THREE.CurvePath.prototype);THREE.PathActions={MOVE_TO:'moveTo',LINE_TO:'lineTo',QUADRATIC_CURVE_TO:'quadraticCurveTo',BEZIER_CURVE_TO:'bezierCurveTo',CSPLINE_THRU:'splineThru',ARC:'arc',ELLIPSE:'ellipse'};THREE.Path.prototype.fromPoints=function(vectors){this.moveTo(vectors[0].x,vectors[0].y);for(var v=1,vlen=vectors.length;v<vlen;v++){this.lineTo(vectors[v].x,vectors[v].y);};};THREE.Path.prototype.moveTo=function(x,y){var args=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:args});};THREE.Path.prototype.lineTo=function(x,y){var args=Array.prototype.slice.call(arguments);var lastargs=this.actions[this.actions.length-1].args;var x0=lastargs[lastargs.length-2];var y0=lastargs[lastargs.length-1];var curve=new THREE.LineCurve(new THREE.Vector2(x0,y0),new THREE.Vector2(x,y));this.curves.push(curve);this.actions.push({action:THREE.PathActions.LINE_TO,args:args});};THREE.Path.prototype.quadraticCurveTo=function(aCPx,aCPy,aX,aY){var args=Array.prototype.slice.call(arguments);var lastargs=this.actions[this.actions.length-1].args;var x0=lastargs[lastargs.length-2];var y0=lastargs[lastargs.length-1];var curve=new THREE.QuadraticBezierCurve(new THREE.Vector2(x0,y0),new THREE.Vector2(aCPx,aCPy),new THREE.Vector2(aX,aY));this.curves.push(curve);this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:args});};THREE.Path.prototype.bezierCurveTo=function(aCP1x,aCP1y,aCP2x,aCP2y,aX,aY){var args=Array.prototype.slice.call(arguments);var lastargs=this.actions[this.actions.length-1].args;var x0=lastargs[lastargs.length-2];var y0=lastargs[lastargs.length-1];var curve=new THREE.CubicBezierCurve(new THREE.Vector2(x0,y0),new THREE.Vector2(aCP1x,aCP1y),new THREE.Vector2(aCP2x,aCP2y),new THREE.Vector2(aX,aY));this.curves.push(curve);this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:args});};THREE.Path.prototype.splineThru=function(pts){var args=Array.prototype.slice.call(arguments);var lastargs=this.actions[this.actions.length-1].args;var x0=lastargs[lastargs.length-2];var y0=lastargs[lastargs.length-1];var npts=[new THREE.Vector2(x0,y0)];Array.prototype.push.apply(npts,pts);var curve=new THREE.SplineCurve(npts);this.curves.push(curve);this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:args});};THREE.Path.prototype.arc=function(aX,aY,aRadius,aStartAngle,aEndAngle,aClockwise){var lastargs=this.actions[this.actions.length-1].args;var x0=lastargs[lastargs.length-2];var y0=lastargs[lastargs.length-1];this.absarc(aX+x0,aY+y0,aRadius,aStartAngle,aEndAngle,aClockwise);};THREE.Path.prototype.absarc=function(aX,aY,aRadius,aStartAngle,aEndAngle,aClockwise){this.absellipse(aX,aY,aRadius,aRadius,aStartAngle,aEndAngle,aClockwise);};THREE.Path.prototype.ellipse=function(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise){var lastargs=this.actions[this.actions.length-1].args;var x0=lastargs[lastargs.length-2];var y0=lastargs[lastargs.length-1];this.absellipse(aX+x0,aY+y0,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise);};THREE.Path.prototype.absellipse=function(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise){var args=Array.prototype.slice.call(arguments);var curve=new THREE.EllipseCurve(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise);this.curves.push(curve);var lastPoint=curve.getPoint(aClockwise?1:0);args.push(lastPoint.x);args.push(lastPoint.y);this.actions.push({action:THREE.PathActions.ELLIPSE,args:args});};THREE.Path.prototype.getSpacedPoints=function(divisions,closedPath){if(!divisions)divisions=40;var points=[];for(var i=0;i<divisions;i++){points.push(this.getPoint(i/divisions));}
return points;};THREE.Path.prototype.getPoints=function(divisions,closedPath){if(this.useSpacedPoints){console.log('tata');return this.getSpacedPoints(divisions,closedPath);}
divisions=divisions||12;var points=[];var i,il,item,action,args;var cpx,cpy,cpx2,cpy2,cpx1,cpy1,cpx0,cpy0,laste,j,t,tx,ty;for(i=0,il=this.actions.length;i<il;i++){item=this.actions[i];action=item.action;args=item.args;switch(action){case THREE.PathActions.MOVE_TO:points.push(new THREE.Vector2(args[0],args[1]));break;case THREE.PathActions.LINE_TO:points.push(new THREE.Vector2(args[0],args[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:cpx=args[2];cpy=args[3];cpx1=args[0];cpy1=args[1];if(points.length>0){laste=points[points.length-1];cpx0=laste.x;cpy0=laste.y;}else{laste=this.actions[i-1].args;cpx0=laste[laste.length-2];cpy0=laste[laste.length-1];}
for(j=1;j<=divisions;j++){t=j/divisions;tx=THREE.Shape.Utils.b2(t,cpx0,cpx1,cpx);ty=THREE.Shape.Utils.b2(t,cpy0,cpy1,cpy);points.push(new THREE.Vector2(tx,ty));}
break;case THREE.PathActions.BEZIER_CURVE_TO:cpx=args[4];cpy=args[5];cpx1=args[0];cpy1=args[1];cpx2=args[2];cpy2=args[3];if(points.length>0){laste=points[points.length-1];cpx0=laste.x;cpy0=laste.y;}else{laste=this.actions[i-1].args;cpx0=laste[laste.length-2];cpy0=laste[laste.length-1];}
for(j=1;j<=divisions;j++){t=j/divisions;tx=THREE.Shape.Utils.b3(t,cpx0,cpx1,cpx2,cpx);ty=THREE.Shape.Utils.b3(t,cpy0,cpy1,cpy2,cpy);points.push(new THREE.Vector2(tx,ty));}
break;case THREE.PathActions.CSPLINE_THRU:laste=this.actions[i-1].args;var last=new THREE.Vector2(laste[laste.length-2],laste[laste.length-1]);var spts=[last];var n=divisions*args[0].length;spts=spts.concat(args[0]);var spline=new THREE.SplineCurve(spts);for(j=1;j<=n;j++){points.push(spline.getPointAt(j/n));}
break;case THREE.PathActions.ARC:var aX=args[0],aY=args[1],aRadius=args[2],aStartAngle=args[3],aEndAngle=args[4],aClockwise=!!args[5];var deltaAngle=aEndAngle-aStartAngle;var angle;var tdivisions=divisions*2;for(j=1;j<=tdivisions;j++){t=j/tdivisions;if(!aClockwise){t=1-t;}
angle=aStartAngle+t*deltaAngle;tx=aX+aRadius*Math.cos(angle);ty=aY+aRadius*Math.sin(angle);points.push(new THREE.Vector2(tx,ty));}
break;case THREE.PathActions.ELLIPSE:var aX=args[0],aY=args[1],xRadius=args[2],yRadius=args[3],aStartAngle=args[4],aEndAngle=args[5],aClockwise=!!args[6];var deltaAngle=aEndAngle-aStartAngle;var angle;var tdivisions=divisions*2;for(j=1;j<=tdivisions;j++){t=j/tdivisions;if(!aClockwise){t=1-t;}
angle=aStartAngle+t*deltaAngle;tx=aX+xRadius*Math.cos(angle);ty=aY+yRadius*Math.sin(angle);points.push(new THREE.Vector2(tx,ty));}
break;}}
var lastPoint=points[points.length-1];var EPSILON=0.0000000001;if(Math.abs(lastPoint.x-points[0].x)<EPSILON&&Math.abs(lastPoint.y-points[0].y)<EPSILON)
points.splice(points.length-1,1);if(closedPath){points.push(points[0]);}
return points;};THREE.Path.prototype.toShapes=function(){var i,il,item,action,args;var subPaths=[],lastPath=new THREE.Path();for(i=0,il=this.actions.length;i<il;i++){item=this.actions[i];args=item.args;action=item.action;if(action==THREE.PathActions.MOVE_TO){if(lastPath.actions.length!=0){subPaths.push(lastPath);lastPath=new THREE.Path();}}
lastPath[action].apply(lastPath,args);}
if(lastPath.actions.length!=0){subPaths.push(lastPath);}
if(subPaths.length==0)return[];var tmpPath,tmpShape,shapes=[];var holesFirst=!THREE.Shape.Utils.isClockWise(subPaths[0].getPoints());if(subPaths.length==1){tmpPath=subPaths[0];tmpShape=new THREE.Shape();tmpShape.actions=tmpPath.actions;tmpShape.curves=tmpPath.curves;shapes.push(tmpShape);return shapes;};if(holesFirst){tmpShape=new THREE.Shape();for(i=0,il=subPaths.length;i<il;i++){tmpPath=subPaths[i];if(THREE.Shape.Utils.isClockWise(tmpPath.getPoints())){tmpShape.actions=tmpPath.actions;tmpShape.curves=tmpPath.curves;shapes.push(tmpShape);tmpShape=new THREE.Shape();}else{tmpShape.holes.push(tmpPath);}}}else{for(i=0,il=subPaths.length;i<il;i++){tmpPath=subPaths[i];if(THREE.Shape.Utils.isClockWise(tmpPath.getPoints())){if(tmpShape)shapes.push(tmpShape);tmpShape=new THREE.Shape();tmpShape.actions=tmpPath.actions;tmpShape.curves=tmpPath.curves;}else{tmpShape.holes.push(tmpPath);}}
shapes.push(tmpShape);}
return shapes;};THREE.Shape=function(){THREE.Path.apply(this,arguments);this.holes=[];};THREE.Shape.prototype=Object.create(THREE.Path.prototype);THREE.Shape.prototype.extrude=function(options){var extruded=new THREE.ExtrudeGeometry(this,options);return extruded;};THREE.Shape.prototype.makeGeometry=function(options){var geometry=new THREE.ShapeGeometry(this,options);return geometry;};THREE.Shape.prototype.getPointsHoles=function(divisions){var i,il=this.holes.length,holesPts=[];for(i=0;i<il;i++){holesPts[i]=this.holes[i].getTransformedPoints(divisions,this.bends);}
return holesPts;};THREE.Shape.prototype.getSpacedPointsHoles=function(divisions){var i,il=this.holes.length,holesPts=[];for(i=0;i<il;i++){holesPts[i]=this.holes[i].getTransformedSpacedPoints(divisions,this.bends);}
return holesPts;};THREE.Shape.prototype.extractAllPoints=function(divisions){return{shape:this.getTransformedPoints(divisions),holes:this.getPointsHoles(divisions)};};THREE.Shape.prototype.extractPoints=function(divisions){if(this.useSpacedPoints){return this.extractAllSpacedPoints(divisions);}
return this.extractAllPoints(divisions);};THREE.Shape.prototype.extractAllSpacedPoints=function(divisions){return{shape:this.getTransformedSpacedPoints(divisions),holes:this.getSpacedPointsHoles(divisions)};};THREE.Shape.Utils={removeHoles:function(contour,holes){var shape=contour.concat();var allpoints=shape.concat();var prevShapeVert,nextShapeVert,prevHoleVert,nextHoleVert,holeIndex,shapeIndex,shapeId,shapeGroup,h,h2,hole,shortest,d,p,pts1,pts2,tmpShape1,tmpShape2,tmpHole1,tmpHole2,verts=[];for(h=0;h<holes.length;h++){hole=holes[h];Array.prototype.push.apply(allpoints,hole);shortest=Number.POSITIVE_INFINITY;for(h2=0;h2<hole.length;h2++){pts1=hole[h2];var dist=[];for(p=0;p<shape.length;p++){pts2=shape[p];d=pts1.distanceToSquared(pts2);dist.push(d);if(d<shortest){shortest=d;holeIndex=h2;shapeIndex=p;}}}
prevShapeVert=(shapeIndex-1)>=0?shapeIndex-1:shape.length-1;prevHoleVert=(holeIndex-1)>=0?holeIndex-1:hole.length-1;var areaapts=[hole[holeIndex],shape[shapeIndex],shape[prevShapeVert]];var areaa=THREE.FontUtils.Triangulate.area(areaapts);var areabpts=[hole[holeIndex],hole[prevHoleVert],shape[shapeIndex]];var areab=THREE.FontUtils.Triangulate.area(areabpts);var shapeOffset=1;var holeOffset=-1;var oldShapeIndex=shapeIndex,oldHoleIndex=holeIndex;shapeIndex+=shapeOffset;holeIndex+=holeOffset;if(shapeIndex<0){shapeIndex+=shape.length;}
shapeIndex%=shape.length;if(holeIndex<0){holeIndex+=hole.length;}
holeIndex%=hole.length;prevShapeVert=(shapeIndex-1)>=0?shapeIndex-1:shape.length-1;prevHoleVert=(holeIndex-1)>=0?holeIndex-1:hole.length-1;areaapts=[hole[holeIndex],shape[shapeIndex],shape[prevShapeVert]];var areaa2=THREE.FontUtils.Triangulate.area(areaapts);areabpts=[hole[holeIndex],hole[prevHoleVert],shape[shapeIndex]];var areab2=THREE.FontUtils.Triangulate.area(areabpts);if((areaa+areab)>(areaa2+areab2)){shapeIndex=oldShapeIndex;holeIndex=oldHoleIndex;if(shapeIndex<0){shapeIndex+=shape.length;}
shapeIndex%=shape.length;if(holeIndex<0){holeIndex+=hole.length;}
holeIndex%=hole.length;prevShapeVert=(shapeIndex-1)>=0?shapeIndex-1:shape.length-1;prevHoleVert=(holeIndex-1)>=0?holeIndex-1:hole.length-1;}else{}
tmpShape1=shape.slice(0,shapeIndex);tmpShape2=shape.slice(shapeIndex);tmpHole1=hole.slice(holeIndex);tmpHole2=hole.slice(0,holeIndex);var trianglea=[hole[holeIndex],shape[shapeIndex],shape[prevShapeVert]];var triangleb=[hole[holeIndex],hole[prevHoleVert],shape[shapeIndex]];verts.push(trianglea);verts.push(triangleb);shape=tmpShape1.concat(tmpHole1).concat(tmpHole2).concat(tmpShape2);}
return{shape:shape,isolatedPts:verts,allpoints:allpoints}},triangulateShape:function(contour,holes){var shapeWithoutHoles=THREE.Shape.Utils.removeHoles(contour,holes);var shape=shapeWithoutHoles.shape,allpoints=shapeWithoutHoles.allpoints,isolatedPts=shapeWithoutHoles.isolatedPts;var triangles=THREE.FontUtils.Triangulate(shape,false);var i,il,f,face,key,index,allPointsMap={},isolatedPointsMap={};for(i=0,il=allpoints.length;i<il;i++){key=allpoints[i].x+":"+allpoints[i].y;if(allPointsMap[key]!==undefined){console.log("Duplicate point",key);}
allPointsMap[key]=i;}
for(i=0,il=triangles.length;i<il;i++){face=triangles[i];for(f=0;f<3;f++){key=face[f].x+":"+face[f].y;index=allPointsMap[key];if(index!==undefined){face[f]=index;}}}
for(i=0,il=isolatedPts.length;i<il;i++){face=isolatedPts[i];for(f=0;f<3;f++){key=face[f].x+":"+face[f].y;index=allPointsMap[key];if(index!==undefined){face[f]=index;}}}
return triangles.concat(isolatedPts);},isClockWise:function(pts){return THREE.FontUtils.Triangulate.area(pts)<0;},b2p0:function(t,p){var k=1-t;return k*k*p;},b2p1:function(t,p){return 2*(1-t)*t*p;},b2p2:function(t,p){return t*t*p;},b2:function(t,p0,p1,p2){return this.b2p0(t,p0)+this.b2p1(t,p1)+this.b2p2(t,p2);},b3p0:function(t,p){var k=1-t;return k*k*k*p;},b3p1:function(t,p){var k=1-t;return 3*k*k*t*p;},b3p2:function(t,p){var k=1-t;return 3*k*t*t*p;},b3p3:function(t,p){return t*t*t*p;},b3:function(t,p0,p1,p2,p3){return this.b3p0(t,p0)+this.b3p1(t,p1)+this.b3p2(t,p2)+this.b3p3(t,p3);}};THREE.AnimationHandler=(function(){var playing=[];var library={};var that={};that.update=function(deltaTimeMS){for(var i=0;i<playing.length;i++)
playing[i].update(deltaTimeMS);};that.addToUpdate=function(animation){if(playing.indexOf(animation)===-1)
playing.push(animation);};that.removeFromUpdate=function(animation){var index=playing.indexOf(animation);if(index!==-1)
playing.splice(index,1);};that.add=function(data){if(library[data.name]!==undefined)
console.log("THREE.AnimationHandler.add: Warning! "+data.name+" already exists in library. Overwriting.");library[data.name]=data;initData(data);};that.get=function(name){if(typeof name==="string"){if(library[name]){return library[name];}else{console.log("THREE.AnimationHandler.get: Couldn't find animation "+name);return null;}}else{}};that.parse=function(root){var hierarchy=[];if(root instanceof THREE.SkinnedMesh){for(var b=0;b<root.bones.length;b++){hierarchy.push(root.bones[b]);}}else{parseRecurseHierarchy(root,hierarchy);}
return hierarchy;};var parseRecurseHierarchy=function(root,hierarchy){hierarchy.push(root);for(var c=0;c<root.children.length;c++)
parseRecurseHierarchy(root.children[c],hierarchy);}
var initData=function(data){if(data.initialized===true)
return;for(var h=0;h<data.hierarchy.length;h++){for(var k=0;k<data.hierarchy[h].keys.length;k++){if(data.hierarchy[h].keys[k].time<0)
data.hierarchy[h].keys[k].time=0;if(data.hierarchy[h].keys[k].rot!==undefined&&!(data.hierarchy[h].keys[k].rot instanceof THREE.Quaternion)){var quat=data.hierarchy[h].keys[k].rot;data.hierarchy[h].keys[k].rot=new THREE.Quaternion(quat[0],quat[1],quat[2],quat[3]);}}
if(data.hierarchy[h].keys.length&&data.hierarchy[h].keys[0].morphTargets!==undefined){var usedMorphTargets={};for(var k=0;k<data.hierarchy[h].keys.length;k++){for(var m=0;m<data.hierarchy[h].keys[k].morphTargets.length;m++){var morphTargetName=data.hierarchy[h].keys[k].morphTargets[m];usedMorphTargets[morphTargetName]=-1;}}
data.hierarchy[h].usedMorphTargets=usedMorphTargets;for(var k=0;k<data.hierarchy[h].keys.length;k++){var influences={};for(var morphTargetName in usedMorphTargets){for(var m=0;m<data.hierarchy[h].keys[k].morphTargets.length;m++){if(data.hierarchy[h].keys[k].morphTargets[m]===morphTargetName){influences[morphTargetName]=data.hierarchy[h].keys[k].morphTargetsInfluences[m];break;}}
if(m===data.hierarchy[h].keys[k].morphTargets.length){influences[morphTargetName]=0;}}
data.hierarchy[h].keys[k].morphTargetsInfluences=influences;}}
for(var k=1;k<data.hierarchy[h].keys.length;k++){if(data.hierarchy[h].keys[k].time===data.hierarchy[h].keys[k-1].time){data.hierarchy[h].keys.splice(k,1);k--;}}
for(var k=0;k<data.hierarchy[h].keys.length;k++){data.hierarchy[h].keys[k].index=k;}}
var lengthInFrames=parseInt(data.length*data.fps,10);data.JIT={};data.JIT.hierarchy=[];for(var h=0;h<data.hierarchy.length;h++)
data.JIT.hierarchy.push(new Array(lengthInFrames));data.initialized=true;};that.LINEAR=0;that.CATMULLROM=1;that.CATMULLROM_FORWARD=2;return that;}());THREE.Animation=function(root,name,interpolationType){this.root=root;this.data=THREE.AnimationHandler.get(name);this.hierarchy=THREE.AnimationHandler.parse(root);this.currentTime=0;this.timeScale=1;this.isPlaying=false;this.isPaused=true;this.loop=true;this.interpolationType=interpolationType!==undefined?interpolationType:THREE.AnimationHandler.LINEAR;this.points=[];this.target=new THREE.Vector3();};THREE.Animation.prototype.play=function(loop,startTimeMS){if(this.isPlaying===false){this.isPlaying=true;this.loop=loop!==undefined?loop:true;this.currentTime=startTimeMS!==undefined?startTimeMS:0;var h,hl=this.hierarchy.length,object;for(h=0;h<hl;h++){object=this.hierarchy[h];if(this.interpolationType!==THREE.AnimationHandler.CATMULLROM_FORWARD){object.useQuaternion=true;}
object.matrixAutoUpdate=true;if(object.animationCache===undefined){object.animationCache={};object.animationCache.prevKey={pos:0,rot:0,scl:0};object.animationCache.nextKey={pos:0,rot:0,scl:0};object.animationCache.originalMatrix=object instanceof THREE.Bone?object.skinMatrix:object.matrix;}
var prevKey=object.animationCache.prevKey;var nextKey=object.animationCache.nextKey;prevKey.pos=this.data.hierarchy[h].keys[0];prevKey.rot=this.data.hierarchy[h].keys[0];prevKey.scl=this.data.hierarchy[h].keys[0];nextKey.pos=this.getNextKeyWith("pos",h,1);nextKey.rot=this.getNextKeyWith("rot",h,1);nextKey.scl=this.getNextKeyWith("scl",h,1);}
this.update(0);}
this.isPaused=false;THREE.AnimationHandler.addToUpdate(this);};THREE.Animation.prototype.pause=function(){if(this.isPaused===true){THREE.AnimationHandler.addToUpdate(this);}else{THREE.AnimationHandler.removeFromUpdate(this);}
this.isPaused=!this.isPaused;};THREE.Animation.prototype.stop=function(){this.isPlaying=false;this.isPaused=false;THREE.AnimationHandler.removeFromUpdate(this);};THREE.Animation.prototype.update=function(deltaTimeMS){if(this.isPlaying===false)return;var types=["pos","rot","scl"];var type;var scale;var vector;var prevXYZ,nextXYZ;var prevKey,nextKey;var object;var animationCache;var frame;var JIThierarchy=this.data.JIT.hierarchy;var currentTime,unloopedCurrentTime;var currentPoint,forwardPoint,angle;this.currentTime+=deltaTimeMS*this.timeScale;unloopedCurrentTime=this.currentTime;currentTime=this.currentTime=this.currentTime%this.data.length;frame=parseInt(Math.min(currentTime*this.data.fps,this.data.length*this.data.fps),10);for(var h=0,hl=this.hierarchy.length;h<hl;h++){object=this.hierarchy[h];animationCache=object.animationCache;for(var t=0;t<3;t++){type=types[t];prevKey=animationCache.prevKey[type];nextKey=animationCache.nextKey[type];if(nextKey.time<=unloopedCurrentTime){if(currentTime<unloopedCurrentTime){if(this.loop){prevKey=this.data.hierarchy[h].keys[0];nextKey=this.getNextKeyWith(type,h,1);while(nextKey.time<currentTime){prevKey=nextKey;nextKey=this.getNextKeyWith(type,h,nextKey.index+1);}}else{this.stop();return;}}else{do{prevKey=nextKey;nextKey=this.getNextKeyWith(type,h,nextKey.index+1);}while(nextKey.time<currentTime)}
animationCache.prevKey[type]=prevKey;animationCache.nextKey[type]=nextKey;}
object.matrixAutoUpdate=true;object.matrixWorldNeedsUpdate=true;scale=(currentTime-prevKey.time)/(nextKey.time-prevKey.time);prevXYZ=prevKey[type];nextXYZ=nextKey[type];if(scale<0||scale>1){console.log("THREE.Animation.update: Warning! Scale out of bounds:"+scale+" on bone "+h);scale=scale<0?0:1;}
if(type==="pos"){vector=object.position;if(this.interpolationType===THREE.AnimationHandler.LINEAR){vector.x=prevXYZ[0]+(nextXYZ[0]-prevXYZ[0])*scale;vector.y=prevXYZ[1]+(nextXYZ[1]-prevXYZ[1])*scale;vector.z=prevXYZ[2]+(nextXYZ[2]-prevXYZ[2])*scale;}else if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){this.points[0]=this.getPrevKeyWith("pos",h,prevKey.index-1)["pos"];this.points[1]=prevXYZ;this.points[2]=nextXYZ;this.points[3]=this.getNextKeyWith("pos",h,nextKey.index+1)["pos"];scale=scale*0.33+0.33;currentPoint=this.interpolateCatmullRom(this.points,scale);vector.x=currentPoint[0];vector.y=currentPoint[1];vector.z=currentPoint[2];if(this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){forwardPoint=this.interpolateCatmullRom(this.points,scale*1.01);this.target.set(forwardPoint[0],forwardPoint[1],forwardPoint[2]);this.target.subSelf(vector);this.target.y=0;this.target.normalize();angle=Math.atan2(this.target.x,this.target.z);object.rotation.set(0,angle,0);}}}else if(type==="rot"){THREE.Quaternion.slerp(prevXYZ,nextXYZ,object.quaternion,scale);}else if(type==="scl"){vector=object.scale;vector.x=prevXYZ[0]+(nextXYZ[0]-prevXYZ[0])*scale;vector.y=prevXYZ[1]+(nextXYZ[1]-prevXYZ[1])*scale;vector.z=prevXYZ[2]+(nextXYZ[2]-prevXYZ[2])*scale;}}}};THREE.Animation.prototype.interpolateCatmullRom=function(points,scale){var c=[],v3=[],point,intPoint,weight,w2,w3,pa,pb,pc,pd;point=(points.length-1)*scale;intPoint=Math.floor(point);weight=point-intPoint;c[0]=intPoint===0?intPoint:intPoint-1;c[1]=intPoint;c[2]=intPoint>points.length-2?intPoint:intPoint+1;c[3]=intPoint>points.length-3?intPoint:intPoint+2;pa=points[c[0]];pb=points[c[1]];pc=points[c[2]];pd=points[c[3]];w2=weight*weight;w3=weight*w2;v3[0]=this.interpolate(pa[0],pb[0],pc[0],pd[0],weight,w2,w3);v3[1]=this.interpolate(pa[1],pb[1],pc[1],pd[1],weight,w2,w3);v3[2]=this.interpolate(pa[2],pb[2],pc[2],pd[2],weight,w2,w3);return v3;};THREE.Animation.prototype.interpolate=function(p0,p1,p2,p3,t,t2,t3){var v0=(p2-p0)*0.5,v1=(p3-p1)*0.5;return(2*(p1-p2)+v0+v1)*t3+(-3*(p1-p2)-2*v0-v1)*t2+v0*t+p1;};THREE.Animation.prototype.getNextKeyWith=function(type,h,key){var keys=this.data.hierarchy[h].keys;if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){key=key<keys.length-1?key:keys.length-1;}else{key=key%keys.length;}
for(;key<keys.length;key++){if(keys[key][type]!==undefined){return keys[key];}}
return this.data.hierarchy[h].keys[0];};THREE.Animation.prototype.getPrevKeyWith=function(type,h,key){var keys=this.data.hierarchy[h].keys;if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){key=key>0?key:0;}else{key=key>=0?key:key+keys.length;}
for(;key>=0;key--){if(keys[key][type]!==undefined){return keys[key];}}
return this.data.hierarchy[h].keys[keys.length-1];};THREE.KeyFrameAnimation=function(root,data,JITCompile){this.root=root;this.data=THREE.AnimationHandler.get(data);this.hierarchy=THREE.AnimationHandler.parse(root);this.currentTime=0;this.timeScale=0.001;this.isPlaying=false;this.isPaused=true;this.loop=true;this.JITCompile=JITCompile!==undefined?JITCompile:true;for(var h=0,hl=this.hierarchy.length;h<hl;h++){var keys=this.data.hierarchy[h].keys,sids=this.data.hierarchy[h].sids,obj=this.hierarchy[h];if(keys.length&&sids){for(var s=0;s<sids.length;s++){var sid=sids[s],next=this.getNextKeyWith(sid,h,0);if(next){next.apply(sid);}}
obj.matrixAutoUpdate=false;this.data.hierarchy[h].node.updateMatrix();obj.matrixWorldNeedsUpdate=true;}}};THREE.KeyFrameAnimation.prototype.play=function(loop,startTimeMS){if(!this.isPlaying){this.isPlaying=true;this.loop=loop!==undefined?loop:true;this.currentTime=startTimeMS!==undefined?startTimeMS:0;this.startTimeMs=startTimeMS;this.startTime=10000000;this.endTime=-this.startTime;var h,hl=this.hierarchy.length,object,node;for(h=0;h<hl;h++){object=this.hierarchy[h];node=this.data.hierarchy[h];object.useQuaternion=true;if(node.animationCache===undefined){node.animationCache={};node.animationCache.prevKey=null;node.animationCache.nextKey=null;node.animationCache.originalMatrix=object instanceof THREE.Bone?object.skinMatrix:object.matrix;}
var keys=this.data.hierarchy[h].keys;if(keys.length){node.animationCache.prevKey=keys[0];node.animationCache.nextKey=keys[1];this.startTime=Math.min(keys[0].time,this.startTime);this.endTime=Math.max(keys[keys.length-1].time,this.endTime);}}
this.update(0);}
this.isPaused=false;THREE.AnimationHandler.addToUpdate(this);};THREE.KeyFrameAnimation.prototype.pause=function(){if(this.isPaused){THREE.AnimationHandler.addToUpdate(this);}else{THREE.AnimationHandler.removeFromUpdate(this);}
this.isPaused=!this.isPaused;};THREE.KeyFrameAnimation.prototype.stop=function(){this.isPlaying=false;this.isPaused=false;THREE.AnimationHandler.removeFromUpdate(this);for(var h=0;h<this.data.hierarchy.length;h++){var obj=this.hierarchy[h];var node=this.data.hierarchy[h];if(node.animationCache!==undefined){var original=node.animationCache.originalMatrix;if(obj instanceof THREE.Bone){original.copy(obj.skinMatrix);obj.skinMatrix=original;}else{original.copy(obj.matrix);obj.matrix=original;}
delete node.animationCache;}}};THREE.KeyFrameAnimation.prototype.update=function(deltaTimeMS){if(!this.isPlaying)return;var prevKey,nextKey;var object;var node;var frame;var JIThierarchy=this.data.JIT.hierarchy;var currentTime,unloopedCurrentTime;var looped;this.currentTime+=deltaTimeMS*this.timeScale;unloopedCurrentTime=this.currentTime;currentTime=this.currentTime=this.currentTime%this.data.length;if(currentTime<this.startTimeMs){currentTime=this.currentTime=this.startTimeMs+currentTime;}
frame=parseInt(Math.min(currentTime*this.data.fps,this.data.length*this.data.fps),10);looped=currentTime<unloopedCurrentTime;if(looped&&!this.loop){for(var h=0,hl=this.hierarchy.length;h<hl;h++){var keys=this.data.hierarchy[h].keys,sids=this.data.hierarchy[h].sids,end=keys.length-1,obj=this.hierarchy[h];if(keys.length){for(var s=0;s<sids.length;s++){var sid=sids[s],prev=this.getPrevKeyWith(sid,h,end);if(prev){prev.apply(sid);}}
this.data.hierarchy[h].node.updateMatrix();obj.matrixWorldNeedsUpdate=true;}}
this.stop();return;}
if(currentTime<this.startTime){return;}
for(var h=0,hl=this.hierarchy.length;h<hl;h++){object=this.hierarchy[h];node=this.data.hierarchy[h];var keys=node.keys,animationCache=node.animationCache;if(this.JITCompile&&JIThierarchy[h][frame]!==undefined){if(object instanceof THREE.Bone){object.skinMatrix=JIThierarchy[h][frame];object.matrixWorldNeedsUpdate=false;}else{object.matrix=JIThierarchy[h][frame];object.matrixWorldNeedsUpdate=true;}}else if(keys.length){if(this.JITCompile&&animationCache){if(object instanceof THREE.Bone){object.skinMatrix=animationCache.originalMatrix;}else{object.matrix=animationCache.originalMatrix;}}
prevKey=animationCache.prevKey;nextKey=animationCache.nextKey;if(prevKey&&nextKey){if(nextKey.time<=unloopedCurrentTime){if(looped&&this.loop){prevKey=keys[0];nextKey=keys[1];while(nextKey.time<currentTime){prevKey=nextKey;nextKey=keys[prevKey.index+1];}}else if(!looped){var lastIndex=keys.length-1;while(nextKey.time<currentTime&&nextKey.index!==lastIndex){prevKey=nextKey;nextKey=keys[prevKey.index+1];}}
animationCache.prevKey=prevKey;animationCache.nextKey=nextKey;}
if(nextKey.time>=currentTime)
prevKey.interpolate(nextKey,currentTime);else
prevKey.interpolate(nextKey,nextKey.time);}
this.data.hierarchy[h].node.updateMatrix();object.matrixWorldNeedsUpdate=true;}}
if(this.JITCompile){if(JIThierarchy[0][frame]===undefined){this.hierarchy[0].updateMatrixWorld(true);for(var h=0;h<this.hierarchy.length;h++){if(this.hierarchy[h]instanceof THREE.Bone){JIThierarchy[h][frame]=this.hierarchy[h].skinMatrix.clone();}else{JIThierarchy[h][frame]=this.hierarchy[h].matrix.clone();}}}}};THREE.KeyFrameAnimation.prototype.getNextKeyWith=function(sid,h,key){var keys=this.data.hierarchy[h].keys;key=key%keys.length;for(;key<keys.length;key++){if(keys[key].hasTarget(sid)){return keys[key];}}
return keys[0];};THREE.KeyFrameAnimation.prototype.getPrevKeyWith=function(sid,h,key){var keys=this.data.hierarchy[h].keys;key=key>=0?key:key+keys.length;for(;key>=0;key--){if(keys[key].hasTarget(sid)){return keys[key];}}
return keys[keys.length-1];};THREE.CubeCamera=function(near,far,cubeResolution){THREE.Object3D.call(this);var fov=90,aspect=1;var cameraPX=new THREE.PerspectiveCamera(fov,aspect,near,far);cameraPX.up.set(0,-1,0);cameraPX.lookAt(new THREE.Vector3(1,0,0));this.add(cameraPX);var cameraNX=new THREE.PerspectiveCamera(fov,aspect,near,far);cameraNX.up.set(0,-1,0);cameraNX.lookAt(new THREE.Vector3(-1,0,0));this.add(cameraNX);var cameraPY=new THREE.PerspectiveCamera(fov,aspect,near,far);cameraPY.up.set(0,0,1);cameraPY.lookAt(new THREE.Vector3(0,1,0));this.add(cameraPY);var cameraNY=new THREE.PerspectiveCamera(fov,aspect,near,far);cameraNY.up.set(0,0,-1);cameraNY.lookAt(new THREE.Vector3(0,-1,0));this.add(cameraNY);var cameraPZ=new THREE.PerspectiveCamera(fov,aspect,near,far);cameraPZ.up.set(0,-1,0);cameraPZ.lookAt(new THREE.Vector3(0,0,1));this.add(cameraPZ);var cameraNZ=new THREE.PerspectiveCamera(fov,aspect,near,far);cameraNZ.up.set(0,-1,0);cameraNZ.lookAt(new THREE.Vector3(0,0,-1));this.add(cameraNZ);this.renderTarget=new THREE.WebGLRenderTargetCube(cubeResolution,cubeResolution,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter});this.updateCubeMap=function(renderer,scene){var renderTarget=this.renderTarget;var generateMipmaps=renderTarget.generateMipmaps;renderTarget.generateMipmaps=false;renderTarget.activeCubeFace=0;renderer.render(scene,cameraPX,renderTarget);renderTarget.activeCubeFace=1;renderer.render(scene,cameraNX,renderTarget);renderTarget.activeCubeFace=2;renderer.render(scene,cameraPY,renderTarget);renderTarget.activeCubeFace=3;renderer.render(scene,cameraNY,renderTarget);renderTarget.activeCubeFace=4;renderer.render(scene,cameraPZ,renderTarget);renderTarget.generateMipmaps=generateMipmaps;renderTarget.activeCubeFace=5;renderer.render(scene,cameraNZ,renderTarget);};};THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype);THREE.CombinedCamera=function(width,height,fov,near,far,orthoNear,orthoFar){THREE.Camera.call(this);this.fov=fov;this.left=-width/2;this.right=width/2
this.top=height/2;this.bottom=-height/2;this.cameraO=new THREE.OrthographicCamera(width/-2,width/2,height/2,height/-2,orthoNear,orthoFar);this.cameraP=new THREE.PerspectiveCamera(fov,width/height,near,far);this.zoom=1;this.toPerspective();var aspect=width/height;};THREE.CombinedCamera.prototype=Object.create(THREE.Camera.prototype);THREE.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near;this.far=this.cameraP.far;this.cameraP.fov=this.fov/this.zoom;this.cameraP.updateProjectionMatrix();this.projectionMatrix=this.cameraP.projectionMatrix;this.inPerspectiveMode=true;this.inOrthographicMode=false;};THREE.CombinedCamera.prototype.toOrthographic=function(){var fov=this.fov;var aspect=this.cameraP.aspect;var near=this.cameraP.near;var far=this.cameraP.far;var hyperfocus=(near+far)/2;var halfHeight=Math.tan(fov/2)*hyperfocus;var planeHeight=2*halfHeight;var planeWidth=planeHeight*aspect;var halfWidth=planeWidth/2;halfHeight/=this.zoom;halfWidth/=this.zoom;this.cameraO.left=-halfWidth;this.cameraO.right=halfWidth;this.cameraO.top=halfHeight;this.cameraO.bottom=-halfHeight;this.cameraO.updateProjectionMatrix();this.near=this.cameraO.near;this.far=this.cameraO.far;this.projectionMatrix=this.cameraO.projectionMatrix;this.inPerspectiveMode=false;this.inOrthographicMode=true;};THREE.CombinedCamera.prototype.setSize=function(width,height){this.cameraP.aspect=width/height;this.left=-width/2;this.right=width/2
this.top=height/2;this.bottom=-height/2;};THREE.CombinedCamera.prototype.setFov=function(fov){this.fov=fov;if(this.inPerspectiveMode){this.toPerspective();}else{this.toOrthographic();}};THREE.CombinedCamera.prototype.updateProjectionMatrix=function(){if(this.inPerspectiveMode){this.toPerspective();}else{this.toPerspective();this.toOrthographic();}};THREE.CombinedCamera.prototype.setLens=function(focalLength,frameHeight){if(frameHeight===undefined)frameHeight=24;var fov=2*Math.atan(frameHeight/(focalLength*2))*(180/Math.PI);this.setFov(fov);return fov;};THREE.CombinedCamera.prototype.setZoom=function(zoom){this.zoom=zoom;if(this.inPerspectiveMode){this.toPerspective();}else{this.toOrthographic();}};THREE.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=false;};THREE.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0;this.rotation.y=Math.PI;this.rotation.z=0;this.rotationAutoUpdate=false;};THREE.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0;this.rotation.y=-Math.PI/2;this.rotation.z=0;this.rotationAutoUpdate=false;};THREE.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0;this.rotation.y=Math.PI/2;this.rotation.z=0;this.rotationAutoUpdate=false;};THREE.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=false;};THREE.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=false;};THREE.CircleGeometry=function(radius,segments,thetaStart,thetaLength){THREE.Geometry.call(this);radius=radius||50;thetaStart=thetaStart!==undefined?thetaStart:0;thetaLength=thetaLength!==undefined?thetaLength:Math.PI*2;segments=segments!==undefined?Math.max(3,segments):8;var i,uvs=[],center=new THREE.Vector3(),centerUV=new THREE.UV(0.5,0.5);this.vertices.push(center);uvs.push(centerUV);for(i=0;i<=segments;i++){var vertex=new THREE.Vector3();vertex.x=radius*Math.cos(thetaStart+i/segments*thetaLength);vertex.y=radius*Math.sin(thetaStart+i/segments*thetaLength);this.vertices.push(vertex);uvs.push(new THREE.UV((vertex.x/radius+1)/2,-(vertex.y/radius+1)/2+1));}
var n=new THREE.Vector3(0,0,-1);for(i=1;i<=segments;i++){var v1=i;var v2=i+1;var v3=0;this.faces.push(new THREE.Face3(v1,v2,v3,[n,n,n]));this.faceVertexUvs[0].push([uvs[i],uvs[i+1],centerUV]);}
this.computeCentroids();this.computeFaceNormals();this.boundingSphere={radius:radius};};THREE.CircleGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CubeGeometry=function(width,height,depth,segmentsWidth,segmentsHeight,segmentsDepth,materials,sides){THREE.Geometry.call(this);var scope=this,width_half=width/2,height_half=height/2,depth_half=depth/2;var mpx,mpy,mpz,mnx,mny,mnz;if(materials!==undefined){if(materials instanceof Array){this.materials=materials;}else{this.materials=[];for(var i=0;i<6;i++){this.materials.push(materials);}}
mpx=0;mnx=1;mpy=2;mny=3;mpz=4;mnz=5;}else{this.materials=[];}
this.sides={px:true,nx:true,py:true,ny:true,pz:true,nz:true};if(sides!=undefined){for(var s in sides){if(this.sides[s]!==undefined){this.sides[s]=sides[s];}}}
this.sides.px&&buildPlane('z','y',-1,-1,depth,height,width_half,mpx);this.sides.nx&&buildPlane('z','y',1,-1,depth,height,-width_half,mnx);this.sides.py&&buildPlane('x','z',1,1,width,depth,height_half,mpy);this.sides.ny&&buildPlane('x','z',1,-1,width,depth,-height_half,mny);this.sides.pz&&buildPlane('x','y',1,-1,width,height,depth_half,mpz);this.sides.nz&&buildPlane('x','y',-1,-1,width,height,-depth_half,mnz);function buildPlane(u,v,udir,vdir,width,height,depth,material){var w,ix,iy,gridX=segmentsWidth||1,gridY=segmentsHeight||1,width_half=width/2,height_half=height/2,offset=scope.vertices.length;if((u==='x'&&v==='y')||(u==='y'&&v==='x')){w='z';}else if((u==='x'&&v==='z')||(u==='z'&&v==='x')){w='y';gridY=segmentsDepth||1;}else if((u==='z'&&v==='y')||(u==='y'&&v==='z')){w='x';gridX=segmentsDepth||1;}
var gridX1=gridX+1,gridY1=gridY+1,segment_width=width/gridX,segment_height=height/gridY,normal=new THREE.Vector3();normal[w]=depth>0?1:-1;for(iy=0;iy<gridY1;iy++){for(ix=0;ix<gridX1;ix++){var vector=new THREE.Vector3();vector[u]=(ix*segment_width-width_half)*udir;vector[v]=(iy*segment_height-height_half)*vdir;vector[w]=depth;scope.vertices.push(vector);}}
for(iy=0;iy<gridY;iy++){for(ix=0;ix<gridX;ix++){var a=ix+gridX1*iy;var b=ix+gridX1*(iy+1);var c=(ix+1)+gridX1*(iy+1);var d=(ix+1)+gridX1*iy;var face=new THREE.Face4(a+offset,b+offset,c+offset,d+offset);face.normal.copy(normal);face.vertexNormals.push(normal.clone(),normal.clone(),normal.clone(),normal.clone());face.materialIndex=material;scope.faces.push(face);scope.faceVertexUvs[0].push([new THREE.UV(ix/gridX,1-iy/gridY),new THREE.UV(ix/gridX,1-(iy+1)/gridY),new THREE.UV((ix+1)/gridX,1-(iy+1)/gridY),new THREE.UV((ix+1)/gridX,1-iy/gridY)]);}}}
this.computeCentroids();this.mergeVertices();};THREE.CubeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CylinderGeometry=function(radiusTop,radiusBottom,height,radiusSegments,heightSegments,openEnded){THREE.Geometry.call(this);radiusTop=radiusTop!==undefined?radiusTop:20;radiusBottom=radiusBottom!==undefined?radiusBottom:20;height=height!==undefined?height:100;var heightHalf=height/2;var segmentsX=radiusSegments||8;var segmentsY=heightSegments||1;var x,y,vertices=[],uvs=[];for(y=0;y<=segmentsY;y++){var verticesRow=[];var uvsRow=[];var v=y/segmentsY;var radius=v*(radiusBottom-radiusTop)+radiusTop;for(x=0;x<=segmentsX;x++){var u=x/segmentsX;var vertex=new THREE.Vector3();vertex.x=radius*Math.sin(u*Math.PI*2);vertex.y=-v*height+heightHalf;vertex.z=radius*Math.cos(u*Math.PI*2);this.vertices.push(vertex);verticesRow.push(this.vertices.length-1);uvsRow.push(new THREE.UV(u,1-v));}
vertices.push(verticesRow);uvs.push(uvsRow);}
var tanTheta=(radiusBottom-radiusTop)/height;var na,nb;for(x=0;x<segmentsX;x++){if(radiusTop!==0){na=this.vertices[vertices[0][x]].clone();nb=this.vertices[vertices[0][x+1]].clone();}else{na=this.vertices[vertices[1][x]].clone();nb=this.vertices[vertices[1][x+1]].clone();}
na.setY(Math.sqrt(na.x*na.x+na.z*na.z)*tanTheta).normalize();nb.setY(Math.sqrt(nb.x*nb.x+nb.z*nb.z)*tanTheta).normalize();for(y=0;y<segmentsY;y++){var v1=vertices[y][x];var v2=vertices[y+1][x];var v3=vertices[y+1][x+1];var v4=vertices[y][x+1];var n1=na.clone();var n2=na.clone();var n3=nb.clone();var n4=nb.clone();var uv1=uvs[y][x].clone();var uv2=uvs[y+1][x].clone();var uv3=uvs[y+1][x+1].clone();var uv4=uvs[y][x+1].clone();this.faces.push(new THREE.Face4(v1,v2,v3,v4,[n1,n2,n3,n4]));this.faceVertexUvs[0].push([uv1,uv2,uv3,uv4]);}}
if(!openEnded&&radiusTop>0){this.vertices.push(new THREE.Vector3(0,heightHalf,0));for(x=0;x<segmentsX;x++){var v1=vertices[0][x];var v2=vertices[0][x+1];var v3=this.vertices.length-1;var n1=new THREE.Vector3(0,1,0);var n2=new THREE.Vector3(0,1,0);var n3=new THREE.Vector3(0,1,0);var uv1=uvs[0][x].clone();var uv2=uvs[0][x+1].clone();var uv3=new THREE.UV(uv2.u,0);this.faces.push(new THREE.Face3(v1,v2,v3,[n1,n2,n3]));this.faceVertexUvs[0].push([uv1,uv2,uv3]);}}
if(!openEnded&&radiusBottom>0){this.vertices.push(new THREE.Vector3(0,-heightHalf,0));for(x=0;x<segmentsX;x++){var v1=vertices[y][x+1];var v2=vertices[y][x];var v3=this.vertices.length-1;var n1=new THREE.Vector3(0,-1,0);var n2=new THREE.Vector3(0,-1,0);var n3=new THREE.Vector3(0,-1,0);var uv1=uvs[y][x+1].clone();var uv2=uvs[y][x].clone();var uv3=new THREE.UV(uv2.u,1);this.faces.push(new THREE.Face3(v1,v2,v3,[n1,n2,n3]));this.faceVertexUvs[0].push([uv1,uv2,uv3]);}}
this.computeCentroids();this.computeFaceNormals();}
THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ExtrudeGeometry=function(shapes,options){if(typeof(shapes)==="undefined"){shapes=[];return;}
THREE.Geometry.call(this);shapes=shapes instanceof Array?shapes:[shapes];this.shapebb=shapes[shapes.length-1].getBoundingBox();this.addShapeList(shapes,options);this.computeCentroids();this.computeFaceNormals();};THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ExtrudeGeometry.prototype.addShapeList=function(shapes,options){var sl=shapes.length;for(var s=0;s<sl;s++){var shape=shapes[s];this.addShape(shape,options);}};THREE.ExtrudeGeometry.prototype.addShape=function(shape,options){var amount=options.amount!==undefined?options.amount:100;var bevelThickness=options.bevelThickness!==undefined?options.bevelThickness:6;var bevelSize=options.bevelSize!==undefined?options.bevelSize:bevelThickness-2;var bevelSegments=options.bevelSegments!==undefined?options.bevelSegments:3;var bevelEnabled=options.bevelEnabled!==undefined?options.bevelEnabled:true;var curveSegments=options.curveSegments!==undefined?options.curveSegments:12;var steps=options.steps!==undefined?options.steps:1;var extrudePath=options.extrudePath;var extrudePts,extrudeByPath=false;var material=options.material;var extrudeMaterial=options.extrudeMaterial;var uvgen=options.UVGenerator!==undefined?options.UVGenerator:THREE.ExtrudeGeometry.WorldUVGenerator;var shapebb=this.shapebb;var splineTube,binormal,normal,position2;if(extrudePath){extrudePts=extrudePath.getSpacedPoints(steps);extrudeByPath=true;bevelEnabled=false;splineTube=options.frames!==undefined?options.frames:new THREE.TubeGeometry.FrenetFrames(extrudePath,steps,false);binormal=new THREE.Vector3();normal=new THREE.Vector3();position2=new THREE.Vector3();}
if(!bevelEnabled){bevelSegments=0;bevelThickness=0;bevelSize=0;}
var ahole,h,hl;var scope=this;var bevelPoints=[];var shapesOffset=this.vertices.length;var shapePoints=shape.extractPoints();var vertices=shapePoints.shape;var holes=shapePoints.holes;var reverse=!THREE.Shape.Utils.isClockWise(vertices);if(reverse){vertices=vertices.reverse();for(h=0,hl=holes.length;h<hl;h++){ahole=holes[h];if(THREE.Shape.Utils.isClockWise(ahole)){holes[h]=ahole.reverse();}}
reverse=false;}
var faces=THREE.Shape.Utils.triangulateShape(vertices,holes);var contour=vertices;for(h=0,hl=holes.length;h<hl;h++){ahole=holes[h];vertices=vertices.concat(ahole);}
function scalePt2(pt,vec,size){if(!vec)console.log("die");return vec.clone().multiplyScalar(size).addSelf(pt);}
var b,bs,t,z,vert,vlen=vertices.length,face,flen=faces.length,cont,clen=contour.length;var RAD_TO_DEGREES=180/Math.PI;function getBevelVec(pt_i,pt_j,pt_k){return getBevelVec2(pt_i,pt_j,pt_k);}
function getBevelVec1(pt_i,pt_j,pt_k){var anglea=Math.atan2(pt_j.y-pt_i.y,pt_j.x-pt_i.x);var angleb=Math.atan2(pt_k.y-pt_i.y,pt_k.x-pt_i.x);if(anglea>angleb){angleb+=Math.PI*2;}
var anglec=(anglea+angleb)/2;var x=-Math.cos(anglec);var y=-Math.sin(anglec);var vec=new THREE.Vector2(x,y);return vec;}
function getBevelVec2(pt_i,pt_j,pt_k){var a=THREE.ExtrudeGeometry.__v1,b=THREE.ExtrudeGeometry.__v2,v_hat=THREE.ExtrudeGeometry.__v3,w_hat=THREE.ExtrudeGeometry.__v4,p=THREE.ExtrudeGeometry.__v5,q=THREE.ExtrudeGeometry.__v6,v,w,v_dot_w_hat,q_sub_p_dot_w_hat,s,intersection;a.set(pt_i.x-pt_j.x,pt_i.y-pt_j.y);b.set(pt_i.x-pt_k.x,pt_i.y-pt_k.y);v=a.normalize();w=b.normalize();v_hat.set(-v.y,v.x);w_hat.set(w.y,-w.x);p.copy(pt_i).addSelf(v_hat);q.copy(pt_i).addSelf(w_hat);if(p.equals(q)){return w_hat.clone();}
p.copy(pt_j).addSelf(v_hat);q.copy(pt_k).addSelf(w_hat);v_dot_w_hat=v.dot(w_hat);q_sub_p_dot_w_hat=q.subSelf(p).dot(w_hat);if(v_dot_w_hat===0){console.log("Either infinite or no solutions!");if(q_sub_p_dot_w_hat===0){console.log("Its finite solutions.");}else{console.log("Too bad, no solutions.");}}
s=q_sub_p_dot_w_hat/v_dot_w_hat;if(s<0){return getBevelVec1(pt_i,pt_j,pt_k);}
intersection=v.multiplyScalar(s).addSelf(p);return intersection.subSelf(pt_i).clone();}
var contourMovements=[];for(var i=0,il=contour.length,j=il-1,k=i+1;i<il;i++,j++,k++){if(j===il)j=0;if(k===il)k=0;var pt_i=contour[i];var pt_j=contour[j];var pt_k=contour[k];contourMovements[i]=getBevelVec(contour[i],contour[j],contour[k]);}
var holesMovements=[],oneHoleMovements,verticesMovements=contourMovements.concat();for(h=0,hl=holes.length;h<hl;h++){ahole=holes[h];oneHoleMovements=[];for(i=0,il=ahole.length,j=il-1,k=i+1;i<il;i++,j++,k++){if(j===il)j=0;if(k===il)k=0;oneHoleMovements[i]=getBevelVec(ahole[i],ahole[j],ahole[k]);}
holesMovements.push(oneHoleMovements);verticesMovements=verticesMovements.concat(oneHoleMovements);}
for(b=0;b<bevelSegments;b++){t=b/bevelSegments;z=bevelThickness*(1-t);bs=bevelSize*(Math.sin(t*Math.PI/2));for(i=0,il=contour.length;i<il;i++){vert=scalePt2(contour[i],contourMovements[i],bs);v(vert.x,vert.y,-z);}
for(h=0,hl=holes.length;h<hl;h++){ahole=holes[h];oneHoleMovements=holesMovements[h];for(i=0,il=ahole.length;i<il;i++){vert=scalePt2(ahole[i],oneHoleMovements[i],bs);v(vert.x,vert.y,-z);}}}
bs=bevelSize;for(i=0;i<vlen;i++){vert=bevelEnabled?scalePt2(vertices[i],verticesMovements[i],bs):vertices[i];if(!extrudeByPath){v(vert.x,vert.y,0);}else{normal.copy(splineTube.normals[0]).multiplyScalar(vert.x);binormal.copy(splineTube.binormals[0]).multiplyScalar(vert.y);position2.copy(extrudePts[0]).addSelf(normal).addSelf(binormal);v(position2.x,position2.y,position2.z);}}
var s;for(s=1;s<=steps;s++){for(i=0;i<vlen;i++){vert=bevelEnabled?scalePt2(vertices[i],verticesMovements[i],bs):vertices[i];if(!extrudeByPath){v(vert.x,vert.y,amount/steps*s);}else{normal.copy(splineTube.normals[s]).multiplyScalar(vert.x);binormal.copy(splineTube.binormals[s]).multiplyScalar(vert.y);position2.copy(extrudePts[s]).addSelf(normal).addSelf(binormal);v(position2.x,position2.y,position2.z);}}}
for(b=bevelSegments-1;b>=0;b--){t=b/bevelSegments;z=bevelThickness*(1-t);bs=bevelSize*Math.sin(t*Math.PI/2);for(i=0,il=contour.length;i<il;i++){vert=scalePt2(contour[i],contourMovements[i],bs);v(vert.x,vert.y,amount+z);}
for(h=0,hl=holes.length;h<hl;h++){ahole=holes[h];oneHoleMovements=holesMovements[h];for(i=0,il=ahole.length;i<il;i++){vert=scalePt2(ahole[i],oneHoleMovements[i],bs);if(!extrudeByPath){v(vert.x,vert.y,amount+z);}else{v(vert.x,vert.y+extrudePts[steps-1].y,extrudePts[steps-1].x+z);}}}}
buildLidFaces();buildSideFaces();function buildLidFaces(){if(bevelEnabled){var layer=0;var offset=vlen*layer;for(i=0;i<flen;i++){face=faces[i];f3(face[2]+offset,face[1]+offset,face[0]+offset,true);}
layer=steps+bevelSegments*2;offset=vlen*layer;for(i=0;i<flen;i++){face=faces[i];f3(face[0]+offset,face[1]+offset,face[2]+offset,false);}}else{for(i=0;i<flen;i++){face=faces[i];f3(face[2],face[1],face[0],true);}
for(i=0;i<flen;i++){face=faces[i];f3(face[0]+vlen*steps,face[1]+vlen*steps,face[2]+vlen*steps,false);}}}
function buildSideFaces(){var layeroffset=0;sidewalls(contour,layeroffset);layeroffset+=contour.length;for(h=0,hl=holes.length;h<hl;h++){ahole=holes[h];sidewalls(ahole,layeroffset);layeroffset+=ahole.length;}}
function sidewalls(contour,layeroffset){var j,k;i=contour.length;while(--i>=0){j=i;k=i-1;if(k<0)k=contour.length-1;var s=0,sl=steps+bevelSegments*2;for(s=0;s<sl;s++){var slen1=vlen*s;var slen2=vlen*(s+1);var a=layeroffset+j+slen1,b=layeroffset+k+slen1,c=layeroffset+k+slen2,d=layeroffset+j+slen2;f4(a,b,c,d,contour,s,sl,j,k);}}}
function v(x,y,z){scope.vertices.push(new THREE.Vector3(x,y,z));}
function f3(a,b,c,isBottom){a+=shapesOffset;b+=shapesOffset;c+=shapesOffset;scope.faces.push(new THREE.Face3(a,b,c,null,null,material));var uvs=isBottom?uvgen.generateBottomUV(scope,shape,options,a,b,c):uvgen.generateTopUV(scope,shape,options,a,b,c);scope.faceVertexUvs[0].push(uvs);}
function f4(a,b,c,d,wallContour,stepIndex,stepsLength,contourIndex1,contourIndex2){a+=shapesOffset;b+=shapesOffset;c+=shapesOffset;d+=shapesOffset;scope.faces.push(new THREE.Face4(a,b,c,d,null,null,extrudeMaterial));var uvs=uvgen.generateSideWallUV(scope,shape,wallContour,options,a,b,c,d,stepIndex,stepsLength,contourIndex1,contourIndex2);scope.faceVertexUvs[0].push(uvs);}};THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(geometry,extrudedShape,extrudeOptions,indexA,indexB,indexC){var ax=geometry.vertices[indexA].x,ay=geometry.vertices[indexA].y,bx=geometry.vertices[indexB].x,by=geometry.vertices[indexB].y,cx=geometry.vertices[indexC].x,cy=geometry.vertices[indexC].y;return[new THREE.UV(ax,ay),new THREE.UV(bx,by),new THREE.UV(cx,cy)];},generateBottomUV:function(geometry,extrudedShape,extrudeOptions,indexA,indexB,indexC){return this.generateTopUV(geometry,extrudedShape,extrudeOptions,indexA,indexB,indexC);},generateSideWallUV:function(geometry,extrudedShape,wallContour,extrudeOptions,indexA,indexB,indexC,indexD,stepIndex,stepsLength,contourIndex1,contourIndex2){var ax=geometry.vertices[indexA].x,ay=geometry.vertices[indexA].y,az=geometry.vertices[indexA].z,bx=geometry.vertices[indexB].x,by=geometry.vertices[indexB].y,bz=geometry.vertices[indexB].z,cx=geometry.vertices[indexC].x,cy=geometry.vertices[indexC].y,cz=geometry.vertices[indexC].z,dx=geometry.vertices[indexD].x,dy=geometry.vertices[indexD].y,dz=geometry.vertices[indexD].z;if(Math.abs(ay-by)<0.01){return[new THREE.UV(ax,1-az),new THREE.UV(bx,1-bz),new THREE.UV(cx,1-cz),new THREE.UV(dx,1-dz)];}else{return[new THREE.UV(ay,1-az),new THREE.UV(by,1-bz),new THREE.UV(cy,1-cz),new THREE.UV(dy,1-dz)];}}};THREE.ExtrudeGeometry.__v1=new THREE.Vector2();THREE.ExtrudeGeometry.__v2=new THREE.Vector2();THREE.ExtrudeGeometry.__v3=new THREE.Vector2();THREE.ExtrudeGeometry.__v4=new THREE.Vector2();THREE.ExtrudeGeometry.__v5=new THREE.Vector2();THREE.ExtrudeGeometry.__v6=new THREE.Vector2();THREE.ShapeGeometry=function(shapes,options){THREE.Geometry.call(this);if(shapes instanceof Array===false)shapes=[shapes];this.shapebb=shapes[shapes.length-1].getBoundingBox();this.addShapeList(shapes,options);this.computeCentroids();this.computeFaceNormals();};THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ShapeGeometry.prototype.addShapeList=function(shapes,options){for(var i=0,l=shapes.length;i<l;i++){this.addShape(shapes[i],options);}
return this;};THREE.ShapeGeometry.prototype.addShape=function(shape,options){if(options===undefined)options={};var material=options.material;var uvgen=options.UVGenerator===undefined?THREE.ExtrudeGeometry.WorldUVGenerator:options.UVGenerator;var shapebb=this.shapebb;var i,l,hole,s;var shapesOffset=this.vertices.length;var shapePoints=shape.extractPoints();var vertices=shapePoints.shape;var holes=shapePoints.holes;var reverse=!THREE.Shape.Utils.isClockWise(vertices);if(reverse){vertices=vertices.reverse();for(i=0,l=holes.length;i<l;i++){hole=holes[i];if(THREE.Shape.Utils.isClockWise(hole)){holes[i]=hole.reverse();}}
reverse=false;}
var faces=THREE.Shape.Utils.triangulateShape(vertices,holes);var contour=vertices;for(i=0,l=holes.length;i<l;i++){hole=holes[i];vertices=vertices.concat(hole);}
var vert,vlen=vertices.length;var face,flen=faces.length;var cont,clen=contour.length;for(i=0;i<vlen;i++){vert=vertices[i];this.vertices.push(new THREE.Vector3(vert.x,vert.y,0));}
for(i=0;i<flen;i++){face=faces[i];var a=face[0]+shapesOffset;var b=face[1]+shapesOffset;var c=face[2]+shapesOffset;this.faces.push(new THREE.Face3(a,b,c,null,null,material));this.faceVertexUvs[0].push(uvgen.generateBottomUV(this,shape,options,a,b,c));}};THREE.LatheGeometry=function(points,steps,angle){THREE.Geometry.call(this);var _steps=steps||12;var _angle=angle||2*Math.PI;var _newV=[];var _matrix=new THREE.Matrix4().makeRotationZ(_angle/_steps);for(var j=0;j<points.length;j++){_newV[j]=points[j].clone();this.vertices.push(_newV[j]);}
var i,il=_steps+1;for(i=0;i<il;i++){for(var j=0;j<_newV.length;j++){_newV[j]=_matrix.multiplyVector3(_newV[j].clone());this.vertices.push(_newV[j]);}}
for(i=0;i<_steps;i++){for(var k=0,kl=points.length;k<kl-1;k++){var a=i*kl+k;var b=((i+1)%il)*kl+k;var c=((i+1)%il)*kl+(k+1)%kl;var d=i*kl+(k+1)%kl;this.faces.push(new THREE.Face4(a,b,c,d));this.faceVertexUvs[0].push([new THREE.UV(1-i/_steps,k/kl),new THREE.UV(1-(i+1)/_steps,k/kl),new THREE.UV(1-(i+1)/_steps,(k+1)/kl),new THREE.UV(1-i/_steps,(k+1)/kl)]);}}
this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals();};THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.PlaneGeometry=function(width,height,widthSegments,heightSegments){THREE.Geometry.call(this);var ix,iz,width_half=width/2,height_half=height/2,gridX=widthSegments||1,gridZ=heightSegments||1,gridX1=gridX+1,gridZ1=gridZ+1,segment_width=width/gridX,segment_height=height/gridZ,normal=new THREE.Vector3(0,0,1);for(iz=0;iz<gridZ1;iz++){for(ix=0;ix<gridX1;ix++){var x=ix*segment_width-width_half;var y=iz*segment_height-height_half;this.vertices.push(new THREE.Vector3(x,-y,0));}}
for(iz=0;iz<gridZ;iz++){for(ix=0;ix<gridX;ix++){var a=ix+gridX1*iz;var b=ix+gridX1*(iz+1);var c=(ix+1)+gridX1*(iz+1);var d=(ix+1)+gridX1*iz;var face=new THREE.Face4(a,b,c,d);face.normal.copy(normal);face.vertexNormals.push(normal.clone(),normal.clone(),normal.clone(),normal.clone());this.faces.push(face);this.faceVertexUvs[0].push([new THREE.UV(ix/gridX,1-iz/gridZ),new THREE.UV(ix/gridX,1-(iz+1)/gridZ),new THREE.UV((ix+1)/gridX,1-(iz+1)/gridZ),new THREE.UV((ix+1)/gridX,1-iz/gridZ)]);}}
this.computeCentroids();};THREE.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.SphereGeometry=function(radius,widthSegments,heightSegments,phiStart,phiLength,thetaStart,thetaLength){THREE.Geometry.call(this);radius=radius||50;phiStart=phiStart!==undefined?phiStart:0;phiLength=phiLength!==undefined?phiLength:Math.PI*2;thetaStart=thetaStart!==undefined?thetaStart:0;thetaLength=thetaLength!==undefined?thetaLength:Math.PI;var segmentsX=Math.max(3,Math.floor(widthSegments)||8);var segmentsY=Math.max(2,Math.floor(heightSegments)||6);var x,y,vertices=[],uvs=[];for(y=0;y<=segmentsY;y++){var verticesRow=[];var uvsRow=[];for(x=0;x<=segmentsX;x++){var u=x/segmentsX;var v=y/segmentsY;var vertex=new THREE.Vector3();vertex.x=-radius*Math.cos(phiStart+u*phiLength)*Math.sin(thetaStart+v*thetaLength);vertex.y=radius*Math.cos(thetaStart+v*thetaLength);vertex.z=radius*Math.sin(phiStart+u*phiLength)*Math.sin(thetaStart+v*thetaLength);this.vertices.push(vertex);verticesRow.push(this.vertices.length-1);uvsRow.push(new THREE.UV(u,1-v));}
vertices.push(verticesRow);uvs.push(uvsRow);}
for(y=0;y<segmentsY;y++){for(x=0;x<segmentsX;x++){var v1=vertices[y][x+1];var v2=vertices[y][x];var v3=vertices[y+1][x];var v4=vertices[y+1][x+1];var n1=this.vertices[v1].clone().normalize();var n2=this.vertices[v2].clone().normalize();var n3=this.vertices[v3].clone().normalize();var n4=this.vertices[v4].clone().normalize();var uv1=uvs[y][x+1].clone();var uv2=uvs[y][x].clone();var uv3=uvs[y+1][x].clone();var uv4=uvs[y+1][x+1].clone();if(Math.abs(this.vertices[v1].y)==radius){this.faces.push(new THREE.Face3(v1,v3,v4,[n1,n3,n4]));this.faceVertexUvs[0].push([uv1,uv3,uv4]);}else if(Math.abs(this.vertices[v3].y)==radius){this.faces.push(new THREE.Face3(v1,v2,v3,[n1,n2,n3]));this.faceVertexUvs[0].push([uv1,uv2,uv3]);}else{this.faces.push(new THREE.Face4(v1,v2,v3,v4,[n1,n2,n3,n4]));this.faceVertexUvs[0].push([uv1,uv2,uv3,uv4]);}}}
this.computeCentroids();this.computeFaceNormals();this.boundingSphere={radius:radius};};THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TextGeometry=function(text,parameters){var textShapes=THREE.FontUtils.generateShapes(text,parameters);parameters.amount=parameters.height!==undefined?parameters.height:50;if(parameters.bevelThickness===undefined)parameters.bevelThickness=10;if(parameters.bevelSize===undefined)parameters.bevelSize=8;if(parameters.bevelEnabled===undefined)parameters.bevelEnabled=false;THREE.ExtrudeGeometry.call(this,textShapes,parameters);};THREE.TextGeometry.prototype=Object.create(THREE.ExtrudeGeometry.prototype);THREE.TorusGeometry=function(radius,tube,radialSegments,tubularSegments,arc){THREE.Geometry.call(this);var scope=this;this.radius=radius||100;this.tube=tube||40;this.radialSegments=radialSegments||8;this.tubularSegments=tubularSegments||6;this.arc=arc||Math.PI*2;var center=new THREE.Vector3(),uvs=[],normals=[];for(var j=0;j<=this.radialSegments;j++){for(var i=0;i<=this.tubularSegments;i++){var u=i/this.tubularSegments*this.arc;var v=j/this.radialSegments*Math.PI*2;center.x=this.radius*Math.cos(u);center.y=this.radius*Math.sin(u);var vertex=new THREE.Vector3();vertex.x=(this.radius+this.tube*Math.cos(v))*Math.cos(u);vertex.y=(this.radius+this.tube*Math.cos(v))*Math.sin(u);vertex.z=this.tube*Math.sin(v);this.vertices.push(vertex);uvs.push(new THREE.UV(i/this.tubularSegments,j/this.radialSegments));normals.push(vertex.clone().subSelf(center).normalize());}}
for(var j=1;j<=this.radialSegments;j++){for(var i=1;i<=this.tubularSegments;i++){var a=(this.tubularSegments+1)*j+i-1;var b=(this.tubularSegments+1)*(j-1)+i-1;var c=(this.tubularSegments+1)*(j-1)+i;var d=(this.tubularSegments+1)*j+i;var face=new THREE.Face4(a,b,c,d,[normals[a],normals[b],normals[c],normals[d]]);face.normal.addSelf(normals[a]);face.normal.addSelf(normals[b]);face.normal.addSelf(normals[c]);face.normal.addSelf(normals[d]);face.normal.normalize();this.faces.push(face);this.faceVertexUvs[0].push([uvs[a].clone(),uvs[b].clone(),uvs[c].clone(),uvs[d].clone()]);}}
this.computeCentroids();};THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TorusKnotGeometry=function(radius,tube,radialSegments,tubularSegments,p,q,heightScale){THREE.Geometry.call(this);var scope=this;this.radius=radius||200;this.tube=tube||40;this.radialSegments=radialSegments||64;this.tubularSegments=tubularSegments||8;this.p=p||2;this.q=q||3;this.heightScale=heightScale||1;this.grid=new Array(this.radialSegments);var tang=new THREE.Vector3();var n=new THREE.Vector3();var bitan=new THREE.Vector3();for(var i=0;i<this.radialSegments;++i){this.grid[i]=new Array(this.tubularSegments);for(var j=0;j<this.tubularSegments;++j){var u=i/this.radialSegments*2*this.p*Math.PI;var v=j/this.tubularSegments*2*Math.PI;var p1=getPos(u,v,this.q,this.p,this.radius,this.heightScale);var p2=getPos(u+0.01,v,this.q,this.p,this.radius,this.heightScale);var cx,cy;tang.sub(p2,p1);n.add(p2,p1);bitan.cross(tang,n);n.cross(bitan,tang);bitan.normalize();n.normalize();cx=-this.tube*Math.cos(v);cy=this.tube*Math.sin(v);p1.x+=cx*n.x+cy*bitan.x;p1.y+=cx*n.y+cy*bitan.y;p1.z+=cx*n.z+cy*bitan.z;this.grid[i][j]=vert(p1.x,p1.y,p1.z);}}
for(var i=0;i<this.radialSegments;++i){for(var j=0;j<this.tubularSegments;++j){var ip=(i+1)%this.radialSegments;var jp=(j+1)%this.tubularSegments;var a=this.grid[i][j];var b=this.grid[ip][j];var c=this.grid[ip][jp];var d=this.grid[i][jp];var uva=new THREE.UV(i/this.radialSegments,j/this.tubularSegments);var uvb=new THREE.UV((i+1)/this.radialSegments,j/this.tubularSegments);var uvc=new THREE.UV((i+1)/this.radialSegments,(j+1)/this.tubularSegments);var uvd=new THREE.UV(i/this.radialSegments,(j+1)/this.tubularSegments);this.faces.push(new THREE.Face4(a,b,c,d));this.faceVertexUvs[0].push([uva,uvb,uvc,uvd]);}}
this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals();function vert(x,y,z){return scope.vertices.push(new THREE.Vector3(x,y,z))-1;}
function getPos(u,v,in_q,in_p,radius,heightScale){var cu=Math.cos(u);var cv=Math.cos(v);var su=Math.sin(u);var quOverP=in_q/in_p*u;var cs=Math.cos(quOverP);var tx=radius*(2+cs)*0.5*cu;var ty=radius*(2+cs)*su*0.5;var tz=heightScale*radius*Math.sin(quOverP)*0.5;return new THREE.Vector3(tx,ty,tz);}};THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TubeGeometry=function(path,segments,radius,radiusSegments,closed,debug){THREE.Geometry.call(this);this.path=path;this.segments=segments||64;this.radius=radius||1;this.radiusSegments=radiusSegments||8;this.closed=closed||false;if(debug)this.debug=new THREE.Object3D();this.grid=[];var scope=this,tangent,normal,binormal,numpoints=this.segments+1,x,y,z,tx,ty,tz,u,v,cx,cy,pos,pos2=new THREE.Vector3(),i,j,ip,jp,a,b,c,d,uva,uvb,uvc,uvd;var frames=new THREE.TubeGeometry.FrenetFrames(path,segments,closed),tangents=frames.tangents,normals=frames.normals,binormals=frames.binormals;this.tangents=tangents;this.normals=normals;this.binormals=binormals;function vert(x,y,z){return scope.vertices.push(new THREE.Vector3(x,y,z))-1;}
for(i=0;i<numpoints;i++){this.grid[i]=[];u=i/(numpoints-1);pos=path.getPointAt(u);tangent=tangents[i];normal=normals[i];binormal=binormals[i];if(this.debug){this.debug.add(new THREE.ArrowHelper(tangent,pos,radius,0x0000ff));this.debug.add(new THREE.ArrowHelper(normal,pos,radius,0xff0000));this.debug.add(new THREE.ArrowHelper(binormal,pos,radius,0x00ff00));}
for(j=0;j<this.radiusSegments;j++){v=j/this.radiusSegments*2*Math.PI;cx=-this.radius*Math.cos(v);cy=this.radius*Math.sin(v);pos2.copy(pos);pos2.x+=cx*normal.x+cy*binormal.x;pos2.y+=cx*normal.y+cy*binormal.y;pos2.z+=cx*normal.z+cy*binormal.z;this.grid[i][j]=vert(pos2.x,pos2.y,pos2.z);}}
for(i=0;i<this.segments;i++){for(j=0;j<this.radiusSegments;j++){ip=(closed)?(i+1)%this.segments:i+1;jp=(j+1)%this.radiusSegments;a=this.grid[i][j];b=this.grid[ip][j];c=this.grid[ip][jp];d=this.grid[i][jp];uva=new THREE.UV(i/this.segments,j/this.radiusSegments);uvb=new THREE.UV((i+1)/this.segments,j/this.radiusSegments);uvc=new THREE.UV((i+1)/this.segments,(j+1)/this.radiusSegments);uvd=new THREE.UV(i/this.segments,(j+1)/this.radiusSegments);this.faces.push(new THREE.Face4(a,b,c,d));this.faceVertexUvs[0].push([uva,uvb,uvc,uvd]);}}
this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals();};THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TubeGeometry.FrenetFrames=function(path,segments,closed){var
tangent=new THREE.Vector3(),normal=new THREE.Vector3(),binormal=new THREE.Vector3(),tangents=[],normals=[],binormals=[],vec=new THREE.Vector3(),mat=new THREE.Matrix4(),numpoints=segments+1,theta,epsilon=0.0001,smallest,tx,ty,tz,i,u,v;this.tangents=tangents;this.normals=normals;this.binormals=binormals;for(i=0;i<numpoints;i++){u=i/(numpoints-1);tangents[i]=path.getTangentAt(u);tangents[i].normalize();}
initialNormal3();function initialNormal1(lastBinormal){normals[0]=new THREE.Vector3();binormals[0]=new THREE.Vector3();if(lastBinormal===undefined)lastBinormal=new THREE.Vector3(0,0,1);normals[0].cross(lastBinormal,tangents[0]).normalize();binormals[0].cross(tangents[0],normals[0]).normalize();}
function initialNormal2(){var t2=path.getTangentAt(epsilon);normals[0]=new THREE.Vector3().sub(t2,tangents[0]).normalize();binormals[0]=new THREE.Vector3().cross(tangents[0],normals[0]);normals[0].cross(binormals[0],tangents[0]).normalize();binormals[0].cross(tangents[0],normals[0]).normalize();}
function initialNormal3(){normals[0]=new THREE.Vector3();binormals[0]=new THREE.Vector3();smallest=Number.MAX_VALUE;tx=Math.abs(tangents[0].x);ty=Math.abs(tangents[0].y);tz=Math.abs(tangents[0].z);if(tx<=smallest){smallest=tx;normal.set(1,0,0);}
if(ty<=smallest){smallest=ty;normal.set(0,1,0);}
if(tz<=smallest){normal.set(0,0,1);}
vec.cross(tangents[0],normal).normalize();normals[0].cross(tangents[0],vec);binormals[0].cross(tangents[0],normals[0]);}
for(i=1;i<numpoints;i++){normals[i]=normals[i-1].clone();binormals[i]=binormals[i-1].clone();vec.cross(tangents[i-1],tangents[i]);if(vec.length()>epsilon){vec.normalize();theta=Math.acos(tangents[i-1].dot(tangents[i]));mat.makeRotationAxis(vec,theta).multiplyVector3(normals[i]);}
binormals[i].cross(tangents[i],normals[i]);}
if(closed){theta=Math.acos(normals[0].dot(normals[numpoints-1]));theta/=(numpoints-1);if(tangents[0].dot(vec.cross(normals[0],normals[numpoints-1]))>0){theta=-theta;}
for(i=1;i<numpoints;i++){mat.makeRotationAxis(tangents[i],theta*i).multiplyVector3(normals[i]);binormals[i].cross(tangents[i],normals[i]);}}};THREE.PolyhedronGeometry=function(vertices,faces,radius,detail){THREE.Geometry.call(this);radius=radius||1;detail=detail||0;var that=this;for(var i=0,l=vertices.length;i<l;i++){prepare(new THREE.Vector3(vertices[i][0],vertices[i][1],vertices[i][2]));}
var midpoints=[],p=this.vertices;for(var i=0,l=faces.length;i<l;i++){make(p[faces[i][0]],p[faces[i][1]],p[faces[i][2]],detail);}
this.mergeVertices();for(var i=0,l=this.vertices.length;i<l;i++){this.vertices[i].multiplyScalar(radius);}
function prepare(vector){var vertex=vector.normalize().clone();vertex.index=that.vertices.push(vertex)-1;var u=azimuth(vector)/2/Math.PI+0.5;var v=inclination(vector)/Math.PI+0.5;vertex.uv=new THREE.UV(u,1-v);return vertex;}
function make(v1,v2,v3,detail){if(detail<1){var face=new THREE.Face3(v1.index,v2.index,v3.index,[v1.clone(),v2.clone(),v3.clone()]);face.centroid.addSelf(v1).addSelf(v2).addSelf(v3).divideScalar(3);face.normal=face.centroid.clone().normalize();that.faces.push(face);var azi=azimuth(face.centroid);that.faceVertexUvs[0].push([correctUV(v1.uv,v1,azi),correctUV(v2.uv,v2,azi),correctUV(v3.uv,v3,azi)]);}else{detail-=1;make(v1,midpoint(v1,v2),midpoint(v1,v3),detail);make(midpoint(v1,v2),v2,midpoint(v2,v3),detail);make(midpoint(v1,v3),midpoint(v2,v3),v3,detail);make(midpoint(v1,v2),midpoint(v2,v3),midpoint(v1,v3),detail);}}
function midpoint(v1,v2){if(!midpoints[v1.index])midpoints[v1.index]=[];if(!midpoints[v2.index])midpoints[v2.index]=[];var mid=midpoints[v1.index][v2.index];if(mid===undefined){midpoints[v1.index][v2.index]=midpoints[v2.index][v1.index]=mid=prepare(new THREE.Vector3().add(v1,v2).divideScalar(2));}
return mid;}
function azimuth(vector){return Math.atan2(vector.z,-vector.x);}
function inclination(vector){return Math.atan2(-vector.y,Math.sqrt((vector.x*vector.x)+(vector.z*vector.z)));}
function correctUV(uv,vector,azimuth){if((azimuth<0)&&(uv.u===1))uv=new THREE.UV(uv.u-1,uv.v);if((vector.x===0)&&(vector.z===0))uv=new THREE.UV(azimuth/2/Math.PI+0.5,uv.v);return uv;}
this.computeCentroids();this.boundingSphere={radius:radius};};THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.IcosahedronGeometry=function(radius,detail){var t=(1+Math.sqrt(5))/2;var vertices=[[-1,t,0],[1,t,0],[-1,-t,0],[1,-t,0],[0,-1,t],[0,1,t],[0,-1,-t],[0,1,-t],[t,0,-1],[t,0,1],[-t,0,-1],[-t,0,1]];var faces=[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]];THREE.PolyhedronGeometry.call(this,vertices,faces,radius,detail);};THREE.IcosahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.OctahedronGeometry=function(radius,detail){var vertices=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]];var faces=[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]];THREE.PolyhedronGeometry.call(this,vertices,faces,radius,detail);};THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TetrahedronGeometry=function(radius,detail){var vertices=[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]];var faces=[[2,1,0],[0,3,2],[1,3,0],[2,3,1]];THREE.PolyhedronGeometry.call(this,vertices,faces,radius,detail);};THREE.TetrahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ParametricGeometry=function(func,slices,stacks,useTris){THREE.Geometry.call(this);var verts=this.vertices;var faces=this.faces;var uvs=this.faceVertexUvs[0];useTris=(useTris===undefined)?false:useTris;var i,il,j,p;var u,v;var stackCount=stacks+1;var sliceCount=slices+1;for(i=0;i<=stacks;i++){v=i/stacks;for(j=0;j<=slices;j++){u=j/slices;p=func(u,v);verts.push(p);}}
var a,b,c,d;var uva,uvb,uvc,uvd;for(i=0;i<stacks;i++){for(j=0;j<slices;j++){a=i*sliceCount+j;b=i*sliceCount+j+1;c=(i+1)*sliceCount+j;d=(i+1)*sliceCount+j+1;uva=new THREE.UV(j/slices,i/stacks);uvb=new THREE.UV((j+1)/slices,i/stacks);uvc=new THREE.UV(j/slices,(i+1)/stacks);uvd=new THREE.UV((j+1)/slices,(i+1)/stacks);if(useTris){faces.push(new THREE.Face3(a,b,c));faces.push(new THREE.Face3(b,d,c));uvs.push([uva,uvb,uvc]);uvs.push([uvb,uvd,uvc]);}else{faces.push(new THREE.Face4(a,b,d,c));uvs.push([uva,uvb,uvd,uvc]);}}}
this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals();};THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ConvexGeometry=function(vertices){THREE.Geometry.call(this);var faces=[[0,1,2],[0,2,1]];for(var i=3;i<vertices.length;i++){addPoint(i);}
function addPoint(vertexId){var vertex=vertices[vertexId].clone();var mag=vertex.length();vertex.x+=mag*randomOffset();vertex.y+=mag*randomOffset();vertex.z+=mag*randomOffset();var hole=[];for(var f=0;f<faces.length;){var face=faces[f];if(visible(face,vertex)){for(var e=0;e<3;e++){var edge=[face[e],face[(e+1)%3]];var boundary=true;for(var h=0;h<hole.length;h++){if(equalEdge(hole[h],edge)){hole[h]=hole[hole.length-1];hole.pop();boundary=false;break;}}
if(boundary){hole.push(edge);}}
faces[f]=faces[faces.length-1];faces.pop();}else{f++;}}
for(var h=0;h<hole.length;h++){faces.push([hole[h][0],hole[h][1],vertexId]);}}
function visible(face,vertex){var va=vertices[face[0]];var vb=vertices[face[1]];var vc=vertices[face[2]];var n=normal(va,vb,vc);var dist=n.dot(va);return n.dot(vertex)>=dist;}
function normal(va,vb,vc){var cb=new THREE.Vector3();var ab=new THREE.Vector3();cb.sub(vc,vb);ab.sub(va,vb);cb.crossSelf(ab);if(!cb.isZero()){cb.normalize();}
return cb;}
function equalEdge(ea,eb){return ea[0]===eb[1]&&ea[1]===eb[0];}
function randomOffset(){return(Math.random()-0.5)*2*1e-6;}
function vertexUv(vertex){var mag=vertex.length();return new THREE.UV(vertex.x/mag,vertex.y/mag);}
var id=0;var newId=new Array(vertices.length);for(var i=0;i<faces.length;i++){var face=faces[i];for(var j=0;j<3;j++){if(newId[face[j]]===undefined){newId[face[j]]=id++;this.vertices.push(vertices[face[j]]);}
face[j]=newId[face[j]];}}
for(var i=0;i<faces.length;i++){this.faces.push(new THREE.Face3(faces[i][0],faces[i][1],faces[i][2]));}
for(var i=0;i<this.faces.length;i++){var face=this.faces[i];this.faceVertexUvs[0].push([vertexUv(this.vertices[face.a]),vertexUv(this.vertices[face.b]),vertexUv(this.vertices[face.c])]);}
this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals();};THREE.ConvexGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.AxisHelper=function(size){var geometry=new THREE.Geometry();geometry.vertices.push(new THREE.Vector3(),new THREE.Vector3(size||1,0,0),new THREE.Vector3(),new THREE.Vector3(0,size||1,0),new THREE.Vector3(),new THREE.Vector3(0,0,size||1));geometry.colors.push(new THREE.Color(0xff0000),new THREE.Color(0xffaa00),new THREE.Color(0x00ff00),new THREE.Color(0xaaff00),new THREE.Color(0x0000ff),new THREE.Color(0x00aaff));var material=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});THREE.Line.call(this,geometry,material,THREE.LinePieces);};THREE.AxisHelper.prototype=Object.create(THREE.Line.prototype);THREE.ArrowHelper=function(dir,origin,length,hex){THREE.Object3D.call(this);if(hex===undefined)hex=0xffff00;if(length===undefined)length=20;var lineGeometry=new THREE.Geometry();lineGeometry.vertices.push(new THREE.Vector3(0,0,0));lineGeometry.vertices.push(new THREE.Vector3(0,1,0));this.line=new THREE.Line(lineGeometry,new THREE.LineBasicMaterial({color:hex}));this.add(this.line);var coneGeometry=new THREE.CylinderGeometry(0,0.05,0.25,5,1);this.cone=new THREE.Mesh(coneGeometry,new THREE.MeshBasicMaterial({color:hex}));this.cone.position.set(0,1,0);this.add(this.cone);if(origin instanceof THREE.Vector3)this.position=origin;this.setDirection(dir);this.setLength(length);};THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.ArrowHelper.prototype.setDirection=function(dir){var axis=new THREE.Vector3(0,1,0).crossSelf(dir);var radians=Math.acos(new THREE.Vector3(0,1,0).dot(dir.clone().normalize()));this.matrix=new THREE.Matrix4().makeRotationAxis(axis.normalize(),radians);this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder);};THREE.ArrowHelper.prototype.setLength=function(length){this.scale.set(length,length,length);};THREE.ArrowHelper.prototype.setColor=function(hex){this.line.material.color.setHex(hex);this.cone.material.color.setHex(hex);};THREE.CameraHelper=function(camera){THREE.Line.call(this);var scope=this;this.geometry=new THREE.Geometry();this.material=new THREE.LineBasicMaterial({color:0xffffff,vertexColors:THREE.FaceColors});this.type=THREE.LinePieces;this.matrixWorld=camera.matrixWorld;this.matrixAutoUpdate=false;this.pointMap={};var hexFrustum=0xffaa00;var hexCone=0xff0000;var hexUp=0x00aaff;var hexTarget=0xffffff;var hexCross=0x333333;addLine("n1","n2",hexFrustum);addLine("n2","n4",hexFrustum);addLine("n4","n3",hexFrustum);addLine("n3","n1",hexFrustum);addLine("f1","f2",hexFrustum);addLine("f2","f4",hexFrustum);addLine("f4","f3",hexFrustum);addLine("f3","f1",hexFrustum);addLine("n1","f1",hexFrustum);addLine("n2","f2",hexFrustum);addLine("n3","f3",hexFrustum);addLine("n4","f4",hexFrustum);addLine("p","n1",hexCone);addLine("p","n2",hexCone);addLine("p","n3",hexCone);addLine("p","n4",hexCone);addLine("u1","u2",hexUp);addLine("u2","u3",hexUp);addLine("u3","u1",hexUp);addLine("c","t",hexTarget);addLine("p","c",hexCross);addLine("cn1","cn2",hexCross);addLine("cn3","cn4",hexCross);addLine("cf1","cf2",hexCross);addLine("cf3","cf4",hexCross);this.camera=camera;function addLine(a,b,hex){addPoint(a,hex);addPoint(b,hex);}
function addPoint(id,hex){scope.geometry.vertices.push(new THREE.Vector3());scope.geometry.colors.push(new THREE.Color(hex));if(scope.pointMap[id]===undefined)scope.pointMap[id]=[];scope.pointMap[id].push(scope.geometry.vertices.length-1);}
this.update(camera);};THREE.CameraHelper.prototype=Object.create(THREE.Line.prototype);THREE.CameraHelper.prototype.update=function(){var scope=this;var w=1,h=1;THREE.CameraHelper.__c.projectionMatrix.copy(this.camera.projectionMatrix);setPoint("c",0,0,-1);setPoint("t",0,0,1);setPoint("n1",-w,-h,-1);setPoint("n2",w,-h,-1);setPoint("n3",-w,h,-1);setPoint("n4",w,h,-1);setPoint("f1",-w,-h,1);setPoint("f2",w,-h,1);setPoint("f3",-w,h,1);setPoint("f4",w,h,1);setPoint("u1",w*0.7,h*1.1,-1);setPoint("u2",-w*0.7,h*1.1,-1);setPoint("u3",0,h*2,-1);setPoint("cf1",-w,0,1);setPoint("cf2",w,0,1);setPoint("cf3",0,-h,1);setPoint("cf4",0,h,1);setPoint("cn1",-w,0,-1);setPoint("cn2",w,0,-1);setPoint("cn3",0,-h,-1);setPoint("cn4",0,h,-1);function setPoint(point,x,y,z){THREE.CameraHelper.__v.set(x,y,z);THREE.CameraHelper.__projector.unprojectVector(THREE.CameraHelper.__v,THREE.CameraHelper.__c);var points=scope.pointMap[point];if(points!==undefined){for(var i=0,il=points.length;i<il;i++){scope.geometry.vertices[points[i]].copy(THREE.CameraHelper.__v);}}}
this.geometry.verticesNeedUpdate=true;};THREE.CameraHelper.__projector=new THREE.Projector();THREE.CameraHelper.__v=new THREE.Vector3();THREE.CameraHelper.__c=new THREE.Camera();THREE.SubdivisionModifier=function(subdivisions){this.subdivisions=(subdivisions===undefined)?1:subdivisions;this.useOldVertexColors=false;this.supportUVs=true;this.debug=false;};THREE.SubdivisionModifier.prototype.modify=function(geometry){var repeats=this.subdivisions;while(repeats-->0){this.smooth(geometry);}};THREE.GeometryUtils.orderedKey=function(a,b){return Math.min(a,b)+"_"+Math.max(a,b);};THREE.GeometryUtils.computeEdgeFaces=function(geometry){var i,il,v1,v2,j,k,face,faceIndices,faceIndex,edge,hash,edgeFaceMap={};var orderedKey=THREE.GeometryUtils.orderedKey;function mapEdgeHash(hash,i){if(edgeFaceMap[hash]===undefined){edgeFaceMap[hash]=[];}
edgeFaceMap[hash].push(i);}
for(i=0,il=geometry.faces.length;i<il;i++){face=geometry.faces[i];if(face instanceof THREE.Face3){hash=orderedKey(face.a,face.b);mapEdgeHash(hash,i);hash=orderedKey(face.b,face.c);mapEdgeHash(hash,i);hash=orderedKey(face.c,face.a);mapEdgeHash(hash,i);}else if(face instanceof THREE.Face4){hash=orderedKey(face.a,face.b);mapEdgeHash(hash,i);hash=orderedKey(face.b,face.c);mapEdgeHash(hash,i);hash=orderedKey(face.c,face.d);mapEdgeHash(hash,i);hash=orderedKey(face.d,face.a);mapEdgeHash(hash,i);}}
return edgeFaceMap;}
THREE.SubdivisionModifier.prototype.smooth=function(oldGeometry){var newVertices=[],newFaces=[],newUVs=[];function v(x,y,z){newVertices.push(new THREE.Vector3(x,y,z));}
var scope=this;var orderedKey=THREE.GeometryUtils.orderedKey;var computeEdgeFaces=THREE.GeometryUtils.computeEdgeFaces;function assert(){if(scope.debug&&console&&console.assert)console.assert.apply(console,arguments);}
function debug(){if(scope.debug)console.log.apply(console,arguments);}
function warn(){if(console)
console.log.apply(console,arguments);}
function f4(a,b,c,d,oldFace,orders,facei){var newFace=new THREE.Face4(a,b,c,d,null,oldFace.color,oldFace.materialIndex);if(scope.useOldVertexColors){newFace.vertexColors=[];var color,tmpColor,order;for(var i=0;i<4;i++){order=orders[i];color=new THREE.Color(),color.setRGB(0,0,0);for(var j=0,jl=0;j<order.length;j++){tmpColor=oldFace.vertexColors[order[j]-1];color.r+=tmpColor.r;color.g+=tmpColor.g;color.b+=tmpColor.b;}
color.r/=order.length;color.g/=order.length;color.b/=order.length;newFace.vertexColors[i]=color;}}
newFaces.push(newFace);if(scope.supportUVs){var aUv=[getUV(a,''),getUV(b,facei),getUV(c,facei),getUV(d,facei)];if(!aUv[0])debug('a :( ',a+':'+facei);else if(!aUv[1])debug('b :( ',b+':'+facei);else if(!aUv[2])debug('c :( ',c+':'+facei);else if(!aUv[3])debug('d :( ',d+':'+facei);else
newUVs.push(aUv);}}
var originalPoints=oldGeometry.vertices;var originalFaces=oldGeometry.faces;var originalVerticesLength=originalPoints.length;var newPoints=originalPoints.concat();var facePoints=[],edgePoints={};var sharpEdges={},sharpVertices=[];var uvForVertices={};function debugCoreStuff(){console.log('facePoints',facePoints,'edgePoints',edgePoints);console.log('edgeFaceMap',edgeFaceMap,'vertexEdgeMap',vertexEdgeMap);}
function getUV(vertexNo,oldFaceNo){var j,jl;var key=vertexNo+':'+oldFaceNo;var theUV=uvForVertices[key];if(!theUV){if(vertexNo>=originalVerticesLength&&vertexNo<(originalVerticesLength+originalFaces.length)){debug('face pt');}else{debug('edge pt');}
warn('warning, UV not found for',key);return null;}
return theUV;}
function addUV(vertexNo,oldFaceNo,value){var key=vertexNo+':'+oldFaceNo;if(!(key in uvForVertices)){uvForVertices[key]=value;}else{warn('dup vertexNo',vertexNo,'oldFaceNo',oldFaceNo,'value',value,'key',key,uvForVertices[key]);}}
var i,il,j,jl,face;var uvs=oldGeometry.faceVertexUvs[0];var abcd='abcd',vertice;debug('originalFaces, uvs, originalVerticesLength',originalFaces.length,uvs.length,originalVerticesLength);if(scope.supportUVs)
for(i=0,il=uvs.length;i<il;i++){for(j=0,jl=uvs[i].length;j<jl;j++){vertice=originalFaces[i][abcd.charAt(j)];addUV(vertice,i,uvs[i][j]);}}
if(uvs.length==0)scope.supportUVs=false;var uvCount=0;for(var u in uvForVertices){uvCount++;}
if(!uvCount){scope.supportUVs=false;debug('no uvs');}
var avgUv;for(i=0,il=originalFaces.length;i<il;i++){face=originalFaces[i];facePoints.push(face.centroid);newPoints.push(face.centroid);if(!scope.supportUVs)continue;avgUv=new THREE.UV();if(face instanceof THREE.Face3){avgUv.u=getUV(face.a,i).u+getUV(face.b,i).u+getUV(face.c,i).u;avgUv.v=getUV(face.a,i).v+getUV(face.b,i).v+getUV(face.c,i).v;avgUv.u/=3;avgUv.v/=3;}else if(face instanceof THREE.Face4){avgUv.u=getUV(face.a,i).u+getUV(face.b,i).u+getUV(face.c,i).u+getUV(face.d,i).u;avgUv.v=getUV(face.a,i).v+getUV(face.b,i).v+getUV(face.c,i).v+getUV(face.d,i).v;avgUv.u/=4;avgUv.v/=4;}
addUV(originalVerticesLength+i,'',avgUv);}
var edgeFaceMap=computeEdgeFaces(oldGeometry);var edge,faceIndexA,faceIndexB,avg;var edgeCount=0;var edgeVertex,edgeVertexA,edgeVertexB;var vertexEdgeMap={};var vertexFaceMap={};function addVertexEdgeMap(vertex,edge){if(vertexEdgeMap[vertex]===undefined){vertexEdgeMap[vertex]=[];}
vertexEdgeMap[vertex].push(edge);}
function addVertexFaceMap(vertex,face,edge){if(vertexFaceMap[vertex]===undefined){vertexFaceMap[vertex]={};}
vertexFaceMap[vertex][face]=edge;}
for(i in edgeFaceMap){edge=edgeFaceMap[i];edgeVertex=i.split('_');edgeVertexA=edgeVertex[0];edgeVertexB=edgeVertex[1];addVertexEdgeMap(edgeVertexA,[edgeVertexA,edgeVertexB]);addVertexEdgeMap(edgeVertexB,[edgeVertexA,edgeVertexB]);for(j=0,jl=edge.length;j<jl;j++){face=edge[j];addVertexFaceMap(edgeVertexA,face,i);addVertexFaceMap(edgeVertexB,face,i);}
if(edge.length<2){sharpEdges[i]=true;sharpVertices[edgeVertexA]=true;sharpVertices[edgeVertexB]=true;}}
for(i in edgeFaceMap){edge=edgeFaceMap[i];faceIndexA=edge[0];faceIndexB=edge[1];edgeVertex=i.split('_');edgeVertexA=edgeVertex[0];edgeVertexB=edgeVertex[1];avg=new THREE.Vector3();assert(edge.length>0,'an edge without faces?!');if(edge.length==1){avg.addSelf(originalPoints[edgeVertexA]);avg.addSelf(originalPoints[edgeVertexB]);avg.multiplyScalar(0.5);sharpVertices[newPoints.length]=true;}else{avg.addSelf(facePoints[faceIndexA]);avg.addSelf(facePoints[faceIndexB]);avg.addSelf(originalPoints[edgeVertexA]);avg.addSelf(originalPoints[edgeVertexB]);avg.multiplyScalar(0.25);}
edgePoints[i]=originalVerticesLength+originalFaces.length+edgeCount;newPoints.push(avg);edgeCount++;if(!scope.supportUVs){continue;}
avgUv=new THREE.UV();avgUv.u=getUV(edgeVertexA,faceIndexA).u+getUV(edgeVertexB,faceIndexA).u;avgUv.v=getUV(edgeVertexA,faceIndexA).v+getUV(edgeVertexB,faceIndexA).v;avgUv.u/=2;avgUv.v/=2;addUV(edgePoints[i],faceIndexA,avgUv);if(edge.length>=2){assert(edge.length==2,'did we plan for more than 2 edges?');avgUv=new THREE.UV();avgUv.u=getUV(edgeVertexA,faceIndexB).u+getUV(edgeVertexB,faceIndexB).u;avgUv.v=getUV(edgeVertexA,faceIndexB).v+getUV(edgeVertexB,faceIndexB).v;avgUv.u/=2;avgUv.v/=2;addUV(edgePoints[i],faceIndexB,avgUv);}}
debug('-- Step 2 done');var facePt,currentVerticeIndex;var hashAB,hashBC,hashCD,hashDA,hashCA;var abc123=['123','12','2','23'];var bca123=['123','23','3','31'];var cab123=['123','31','1','12'];var abc1234=['1234','12','2','23'];var bcd1234=['1234','23','3','34'];var cda1234=['1234','34','4','41'];var dab1234=['1234','41','1','12'];for(i=0,il=facePoints.length;i<il;i++){facePt=facePoints[i];face=originalFaces[i];currentVerticeIndex=originalVerticesLength+i;if(face instanceof THREE.Face3){hashAB=orderedKey(face.a,face.b);hashBC=orderedKey(face.b,face.c);hashCA=orderedKey(face.c,face.a);f4(currentVerticeIndex,edgePoints[hashAB],face.b,edgePoints[hashBC],face,abc123,i);f4(currentVerticeIndex,edgePoints[hashBC],face.c,edgePoints[hashCA],face,bca123,i);f4(currentVerticeIndex,edgePoints[hashCA],face.a,edgePoints[hashAB],face,cab123,i);}else if(face instanceof THREE.Face4){hashAB=orderedKey(face.a,face.b);hashBC=orderedKey(face.b,face.c);hashCD=orderedKey(face.c,face.d);hashDA=orderedKey(face.d,face.a);f4(currentVerticeIndex,edgePoints[hashAB],face.b,edgePoints[hashBC],face,abc1234,i);f4(currentVerticeIndex,edgePoints[hashBC],face.c,edgePoints[hashCD],face,bcd1234,i);f4(currentVerticeIndex,edgePoints[hashCD],face.d,edgePoints[hashDA],face,cda1234,i);f4(currentVerticeIndex,edgePoints[hashDA],face.a,edgePoints[hashAB],face,dab1234,i);}else{debug('face should be a face!',face);}}
newVertices=newPoints;var F=new THREE.Vector3();var R=new THREE.Vector3();var n;for(i=0,il=originalPoints.length;i<il;i++){if(vertexEdgeMap[i]===undefined)continue;F.set(0,0,0);R.set(0,0,0);var newPos=new THREE.Vector3(0,0,0);var f=0;for(j in vertexFaceMap[i]){F.addSelf(facePoints[j]);f++;}
var sharpEdgeCount=0;n=vertexEdgeMap[i].length;var boundary_case=f!=n;for(j=0;j<n;j++){if(sharpEdges[orderedKey(vertexEdgeMap[i][j][0],vertexEdgeMap[i][j][1])]){sharpEdgeCount++;}}
F.divideScalar(f);var boundary_edges=0;if(boundary_case){var bb_edge;for(j=0;j<n;j++){edge=vertexEdgeMap[i][j];bb_edge=edgeFaceMap[orderedKey(edge[0],edge[1])].length==1
if(bb_edge){var midPt=originalPoints[edge[0]].clone().addSelf(originalPoints[edge[1]]).divideScalar(2);R.addSelf(midPt);boundary_edges++;}}
R.divideScalar(4);assert(boundary_edges==2,'should have only 2 boundary edges');}else{for(j=0;j<n;j++){edge=vertexEdgeMap[i][j];var midPt=originalPoints[edge[0]].clone().addSelf(originalPoints[edge[1]]).divideScalar(2);R.addSelf(midPt);}
R.divideScalar(n);}
newPos.addSelf(originalPoints[i]);if(boundary_case){newPos.divideScalar(2);newPos.addSelf(R);}else{newPos.multiplyScalar(n-3);newPos.addSelf(F);newPos.addSelf(R.multiplyScalar(2));newPos.divideScalar(n);}
newVertices[i]=newPos;}
var newGeometry=oldGeometry;newGeometry.vertices=newVertices;newGeometry.faces=newFaces;newGeometry.faceVertexUvs[0]=newUVs;delete newGeometry.__tmpVertices;newGeometry.computeCentroids();newGeometry.computeFaceNormals();newGeometry.computeVertexNormals();};THREE.ImmediateRenderObject=function(){THREE.Object3D.call(this);this.render=function(renderCallback){};};THREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype);THREE.LensFlare=function(texture,size,distance,blending,color){THREE.Object3D.call(this);this.lensFlares=[];this.positionScreen=new THREE.Vector3();this.customUpdateCallback=undefined;if(texture!==undefined){this.add(texture,size,distance,blending,color);}};THREE.LensFlare.prototype=Object.create(THREE.Object3D.prototype);THREE.LensFlare.prototype.add=function(texture,size,distance,blending,color,opacity){if(size===undefined)size=-1;if(distance===undefined)distance=0;if(opacity===undefined)opacity=1;if(color===undefined)color=new THREE.Color(0xffffff);if(blending===undefined)blending=THREE.NormalBlending;distance=Math.min(distance,Math.max(0,distance));this.lensFlares.push({texture:texture,size:size,distance:distance,x:0,y:0,z:0,scale:1,rotation:1,opacity:opacity,color:color,blending:blending});};THREE.LensFlare.prototype.updateLensFlares=function(){var f,fl=this.lensFlares.length;var flare;var vecX=-this.positionScreen.x*2;var vecY=-this.positionScreen.y*2;for(f=0;f<fl;f++){flare=this.lensFlares[f];flare.x=this.positionScreen.x+vecX*flare.distance;flare.y=this.positionScreen.y+vecY*flare.distance;flare.wantedRotation=flare.x*Math.PI*0.25;flare.rotation+=(flare.wantedRotation-flare.rotation)*0.25;}};THREE.MorphBlendMesh=function(geometry,material){THREE.Mesh.call(this,geometry,material);this.animationsMap={};this.animationsList=[];var numFrames=this.geometry.morphTargets.length;var name="__default";var startFrame=0;var endFrame=numFrames-1;var fps=numFrames/1;this.createAnimation(name,startFrame,endFrame,fps);this.setAnimationWeight(name,1);};THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.MorphBlendMesh.prototype.createAnimation=function(name,start,end,fps){var animation={startFrame:start,endFrame:end,length:end-start+1,fps:fps,duration:(end-start)/fps,lastFrame:0,currentFrame:0,active:false,time:0,direction:1,weight:1,directionBackwards:false,mirroredLoop:false};this.animationsMap[name]=animation;this.animationsList.push(animation);};THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(fps){var pattern=/([a-z]+)(\d+)/;var firstAnimation,frameRanges={};var geometry=this.geometry;for(var i=0,il=geometry.morphTargets.length;i<il;i++){var morph=geometry.morphTargets[i];var chunks=morph.name.match(pattern);if(chunks&&chunks.length>1){var name=chunks[1];var num=chunks[2];if(!frameRanges[name])frameRanges[name]={start:Infinity,end:-Infinity};var range=frameRanges[name];if(i<range.start)range.start=i;if(i>range.end)range.end=i;if(!firstAnimation)firstAnimation=name;}}
for(var name in frameRanges){var range=frameRanges[name];this.createAnimation(name,range.start,range.end,fps);}
this.firstAnimation=firstAnimation;};THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(name){var animation=this.animationsMap[name];if(animation){animation.direction=1;animation.directionBackwards=false;}};THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(name){var animation=this.animationsMap[name];if(animation){animation.direction=-1;animation.directionBackwards=true;}};THREE.MorphBlendMesh.prototype.setAnimationFPS=function(name,fps){var animation=this.animationsMap[name];if(animation){animation.fps=fps;animation.duration=(animation.end-animation.start)/animation.fps;}};THREE.MorphBlendMesh.prototype.setAnimationDuration=function(name,duration){var animation=this.animationsMap[name];if(animation){animation.duration=duration;animation.fps=(animation.end-animation.start)/animation.duration;}};THREE.MorphBlendMesh.prototype.setAnimationWeight=function(name,weight){var animation=this.animationsMap[name];if(animation){animation.weight=weight;}};THREE.MorphBlendMesh.prototype.setAnimationTime=function(name,time){var animation=this.animationsMap[name];if(animation){animation.time=time;}};THREE.MorphBlendMesh.prototype.getAnimationTime=function(name){var time=0;var animation=this.animationsMap[name];if(animation){time=animation.time;}
return time;};THREE.MorphBlendMesh.prototype.getAnimationDuration=function(name){var duration=-1;var animation=this.animationsMap[name];if(animation){duration=animation.duration;}
return duration;};THREE.MorphBlendMesh.prototype.playAnimation=function(name){var animation=this.animationsMap[name];if(animation){animation.time=0;animation.active=true;}else{console.warn("animation["+name+"] undefined");}};THREE.MorphBlendMesh.prototype.stopAnimation=function(name){var animation=this.animationsMap[name];if(animation){animation.active=false;}};THREE.MorphBlendMesh.prototype.update=function(delta){for(var i=0,il=this.animationsList.length;i<il;i++){var animation=this.animationsList[i];if(!animation.active)continue;var frameTime=animation.duration/animation.length;animation.time+=animation.direction*delta;if(animation.mirroredLoop){if(animation.time>animation.duration||animation.time<0){animation.direction*=-1;if(animation.time>animation.duration){animation.time=animation.duration;animation.directionBackwards=true;}
if(animation.time<0){animation.time=0;animation.directionBackwards=false;}}}else{animation.time=animation.time%animation.duration;if(animation.time<0)animation.time+=animation.duration;}
var keyframe=animation.startFrame+THREE.Math.clamp(Math.floor(animation.time/frameTime),0,animation.length-1);var weight=animation.weight;if(keyframe!==animation.currentFrame){this.morphTargetInfluences[animation.lastFrame]=0;this.morphTargetInfluences[animation.currentFrame]=1*weight;this.morphTargetInfluences[keyframe]=0;animation.lastFrame=animation.currentFrame;animation.currentFrame=keyframe;}
var mix=(animation.time%frameTime)/frameTime;if(animation.directionBackwards)mix=1-mix;this.morphTargetInfluences[animation.currentFrame]=mix*weight;this.morphTargetInfluences[animation.lastFrame]=(1-mix)*weight;}};THREE.LensFlarePlugin=function(){var _gl,_renderer,_lensFlare={};this.init=function(renderer){_gl=renderer.context;_renderer=renderer;_lensFlare.vertices=new Float32Array(8+8);_lensFlare.faces=new Uint16Array(6);var i=0;_lensFlare.vertices[i++]=-1;_lensFlare.vertices[i++]=-1;_lensFlare.vertices[i++]=0;_lensFlare.vertices[i++]=0;_lensFlare.vertices[i++]=1;_lensFlare.vertices[i++]=-1;_lensFlare.vertices[i++]=1;_lensFlare.vertices[i++]=0;_lensFlare.vertices[i++]=1;_lensFlare.vertices[i++]=1;_lensFlare.vertices[i++]=1;_lensFlare.vertices[i++]=1;_lensFlare.vertices[i++]=-1;_lensFlare.vertices[i++]=1;_lensFlare.vertices[i++]=0;_lensFlare.vertices[i++]=1;i=0;_lensFlare.faces[i++]=0;_lensFlare.faces[i++]=1;_lensFlare.faces[i++]=2;_lensFlare.faces[i++]=0;_lensFlare.faces[i++]=2;_lensFlare.faces[i++]=3;_lensFlare.vertexBuffer=_gl.createBuffer();_lensFlare.elementBuffer=_gl.createBuffer();_gl.bindBuffer(_gl.ARRAY_BUFFER,_lensFlare.vertexBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,_lensFlare.vertices,_gl.STATIC_DRAW);_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,_lensFlare.elementBuffer);_gl.bufferData(_gl.ELEMENT_ARRAY_BUFFER,_lensFlare.faces,_gl.STATIC_DRAW);_lensFlare.tempTexture=_gl.createTexture();_lensFlare.occlusionTexture=_gl.createTexture();_gl.bindTexture(_gl.TEXTURE_2D,_lensFlare.tempTexture);_gl.texImage2D(_gl.TEXTURE_2D,0,_gl.RGB,16,16,0,_gl.RGB,_gl.UNSIGNED_BYTE,null);_gl.texParameteri(_gl.TEXTURE_2D,_gl.TEXTURE_WRAP_S,_gl.CLAMP_TO_EDGE);_gl.texParameteri(_gl.TEXTURE_2D,_gl.TEXTURE_WRAP_T,_gl.CLAMP_TO_EDGE);_gl.texParameteri(_gl.TEXTURE_2D,_gl.TEXTURE_MAG_FILTER,_gl.NEAREST);_gl.texParameteri(_gl.TEXTURE_2D,_gl.TEXTURE_MIN_FILTER,_gl.NEAREST);_gl.bindTexture(_gl.TEXTURE_2D,_lensFlare.occlusionTexture);_gl.texImage2D(_gl.TEXTURE_2D,0,_gl.RGBA,16,16,0,_gl.RGBA,_gl.UNSIGNED_BYTE,null);_gl.texParameteri(_gl.TEXTURE_2D,_gl.TEXTURE_WRAP_S,_gl.CLAMP_TO_EDGE);_gl.texParameteri(_gl.TEXTURE_2D,_gl.TEXTURE_WRAP_T,_gl.CLAMP_TO_EDGE);_gl.texParameteri(_gl.TEXTURE_2D,_gl.TEXTURE_MAG_FILTER,_gl.NEAREST);_gl.texParameteri(_gl.TEXTURE_2D,_gl.TEXTURE_MIN_FILTER,_gl.NEAREST);if(_gl.getParameter(_gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0){_lensFlare.hasVertexTexture=false;_lensFlare.program=createProgram(THREE.ShaderFlares["lensFlare"]);}else{_lensFlare.hasVertexTexture=true;_lensFlare.program=createProgram(THREE.ShaderFlares["lensFlareVertexTexture"]);}
_lensFlare.attributes={};_lensFlare.uniforms={};_lensFlare.attributes.vertex=_gl.getAttribLocation(_lensFlare.program,"position");_lensFlare.attributes.uv=_gl.getAttribLocation(_lensFlare.program,"uv");_lensFlare.uniforms.renderType=_gl.getUniformLocation(_lensFlare.program,"renderType");_lensFlare.uniforms.map=_gl.getUniformLocation(_lensFlare.program,"map");_lensFlare.uniforms.occlusionMap=_gl.getUniformLocation(_lensFlare.program,"occlusionMap");_lensFlare.uniforms.opacity=_gl.getUniformLocation(_lensFlare.program,"opacity");_lensFlare.uniforms.color=_gl.getUniformLocation(_lensFlare.program,"color");_lensFlare.uniforms.scale=_gl.getUniformLocation(_lensFlare.program,"scale");_lensFlare.uniforms.rotation=_gl.getUniformLocation(_lensFlare.program,"rotation");_lensFlare.uniforms.screenPosition=_gl.getUniformLocation(_lensFlare.program,"screenPosition");_lensFlare.attributesEnabled=false;};this.render=function(scene,camera,viewportWidth,viewportHeight){var flares=scene.__webglFlares,nFlares=flares.length;if(!nFlares)return;var tempPosition=new THREE.Vector3();var invAspect=viewportHeight/viewportWidth,halfViewportWidth=viewportWidth*0.5,halfViewportHeight=viewportHeight*0.5;var size=16/viewportHeight,scale=new THREE.Vector2(size*invAspect,size);var screenPosition=new THREE.Vector3(1,1,0),screenPositionPixels=new THREE.Vector2(1,1);var uniforms=_lensFlare.uniforms,attributes=_lensFlare.attributes;_gl.useProgram(_lensFlare.program);if(!_lensFlare.attributesEnabled){_gl.enableVertexAttribArray(_lensFlare.attributes.vertex);_gl.enableVertexAttribArray(_lensFlare.attributes.uv);_lensFlare.attributesEnabled=true;}
_gl.uniform1i(uniforms.occlusionMap,0);_gl.uniform1i(uniforms.map,1);_gl.bindBuffer(_gl.ARRAY_BUFFER,_lensFlare.vertexBuffer);_gl.vertexAttribPointer(attributes.vertex,2,_gl.FLOAT,false,2*8,0);_gl.vertexAttribPointer(attributes.uv,2,_gl.FLOAT,false,2*8,8);_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,_lensFlare.elementBuffer);_gl.disable(_gl.CULL_FACE);_gl.depthMask(false);var i,j,jl,flare,sprite;for(i=0;i<nFlares;i++){size=16/viewportHeight;scale.set(size*invAspect,size);flare=flares[i];tempPosition.set(flare.matrixWorld.elements[12],flare.matrixWorld.elements[13],flare.matrixWorld.elements[14]);camera.matrixWorldInverse.multiplyVector3(tempPosition);camera.projectionMatrix.multiplyVector3(tempPosition);screenPosition.copy(tempPosition)
screenPositionPixels.x=screenPosition.x*halfViewportWidth+halfViewportWidth;screenPositionPixels.y=screenPosition.y*halfViewportHeight+halfViewportHeight;if(_lensFlare.hasVertexTexture||(screenPositionPixels.x>0&&screenPositionPixels.x<viewportWidth&&screenPositionPixels.y>0&&screenPositionPixels.y<viewportHeight)){_gl.activeTexture(_gl.TEXTURE1);_gl.bindTexture(_gl.TEXTURE_2D,_lensFlare.tempTexture);_gl.copyTexImage2D(_gl.TEXTURE_2D,0,_gl.RGB,screenPositionPixels.x-8,screenPositionPixels.y-8,16,16,0);_gl.uniform1i(uniforms.renderType,0);_gl.uniform2f(uniforms.scale,scale.x,scale.y);_gl.uniform3f(uniforms.screenPosition,screenPosition.x,screenPosition.y,screenPosition.z);_gl.disable(_gl.BLEND);_gl.enable(_gl.DEPTH_TEST);_gl.drawElements(_gl.TRIANGLES,6,_gl.UNSIGNED_SHORT,0);_gl.activeTexture(_gl.TEXTURE0);_gl.bindTexture(_gl.TEXTURE_2D,_lensFlare.occlusionTexture);_gl.copyTexImage2D(_gl.TEXTURE_2D,0,_gl.RGBA,screenPositionPixels.x-8,screenPositionPixels.y-8,16,16,0);_gl.uniform1i(uniforms.renderType,1);_gl.disable(_gl.DEPTH_TEST);_gl.activeTexture(_gl.TEXTURE1);_gl.bindTexture(_gl.TEXTURE_2D,_lensFlare.tempTexture);_gl.drawElements(_gl.TRIANGLES,6,_gl.UNSIGNED_SHORT,0);flare.positionScreen.copy(screenPosition)
if(flare.customUpdateCallback){flare.customUpdateCallback(flare);}else{flare.updateLensFlares();}
_gl.uniform1i(uniforms.renderType,2);_gl.enable(_gl.BLEND);for(j=0,jl=flare.lensFlares.length;j<jl;j++){sprite=flare.lensFlares[j];if(sprite.opacity>0.001&&sprite.scale>0.001){screenPosition.x=sprite.x;screenPosition.y=sprite.y;screenPosition.z=sprite.z;size=sprite.size*sprite.scale/viewportHeight;scale.x=size*invAspect;scale.y=size;_gl.uniform3f(uniforms.screenPosition,screenPosition.x,screenPosition.y,screenPosition.z);_gl.uniform2f(uniforms.scale,scale.x,scale.y);_gl.uniform1f(uniforms.rotation,sprite.rotation);_gl.uniform1f(uniforms.opacity,sprite.opacity);_gl.uniform3f(uniforms.color,sprite.color.r,sprite.color.g,sprite.color.b);_renderer.setBlending(sprite.blending,sprite.blendEquation,sprite.blendSrc,sprite.blendDst);_renderer.setTexture(sprite.texture,1);_gl.drawElements(_gl.TRIANGLES,6,_gl.UNSIGNED_SHORT,0);}}}}
_gl.enable(_gl.CULL_FACE);_gl.enable(_gl.DEPTH_TEST);_gl.depthMask(true);};function createProgram(shader){var program=_gl.createProgram();var fragmentShader=_gl.createShader(_gl.FRAGMENT_SHADER);var vertexShader=_gl.createShader(_gl.VERTEX_SHADER);_gl.shaderSource(fragmentShader,shader.fragmentShader);_gl.shaderSource(vertexShader,shader.vertexShader);_gl.compileShader(fragmentShader);_gl.compileShader(vertexShader);_gl.attachShader(program,fragmentShader);_gl.attachShader(program,vertexShader);_gl.linkProgram(program);return program;};};THREE.ShadowMapPlugin=function(){var _gl,_renderer,_depthMaterial,_depthMaterialMorph,_depthMaterialSkin,_depthMaterialMorphSkin,_frustum=new THREE.Frustum(),_projScreenMatrix=new THREE.Matrix4(),_min=new THREE.Vector3(),_max=new THREE.Vector3();this.init=function(renderer){_gl=renderer.context;_renderer=renderer;var depthShader=THREE.ShaderLib["depthRGBA"];var depthUniforms=THREE.UniformsUtils.clone(depthShader.uniforms);_depthMaterial=new THREE.ShaderMaterial({fragmentShader:depthShader.fragmentShader,vertexShader:depthShader.vertexShader,uniforms:depthUniforms});_depthMaterialMorph=new THREE.ShaderMaterial({fragmentShader:depthShader.fragmentShader,vertexShader:depthShader.vertexShader,uniforms:depthUniforms,morphTargets:true});_depthMaterialSkin=new THREE.ShaderMaterial({fragmentShader:depthShader.fragmentShader,vertexShader:depthShader.vertexShader,uniforms:depthUniforms,skinning:true});_depthMaterialMorphSkin=new THREE.ShaderMaterial({fragmentShader:depthShader.fragmentShader,vertexShader:depthShader.vertexShader,uniforms:depthUniforms,morphTargets:true,skinning:true});_depthMaterial._shadowPass=true;_depthMaterialMorph._shadowPass=true;_depthMaterialSkin._shadowPass=true;_depthMaterialMorphSkin._shadowPass=true;};this.render=function(scene,camera){if(!(_renderer.shadowMapEnabled&&_renderer.shadowMapAutoUpdate))return;this.update(scene,camera);};this.update=function(scene,camera){var i,il,j,jl,n,shadowMap,shadowMatrix,shadowCamera,program,buffer,material,webglObject,object,light,renderList,lights=[],k=0,fog=null;_gl.clearColor(1,1,1,1);_gl.disable(_gl.BLEND);_gl.enable(_gl.CULL_FACE);_gl.frontFace(_gl.CCW);if(_renderer.shadowMapCullFrontFaces){_gl.cullFace(_gl.FRONT);}else{_gl.cullFace(_gl.BACK);}
_renderer.setDepthTest(true);for(i=0,il=scene.__lights.length;i<il;i++){light=scene.__lights[i];if(!light.castShadow)continue;if((light instanceof THREE.DirectionalLight)&&light.shadowCascade){for(n=0;n<light.shadowCascadeCount;n++){var virtualLight;if(!light.shadowCascadeArray[n]){virtualLight=createVirtualLight(light,n);virtualLight.originalCamera=camera;var gyro=new THREE.Gyroscope();gyro.position=light.shadowCascadeOffset;gyro.add(virtualLight);gyro.add(virtualLight.target);camera.add(gyro);light.shadowCascadeArray[n]=virtualLight;console.log("Created virtualLight",virtualLight);}else{virtualLight=light.shadowCascadeArray[n];}
updateVirtualLight(light,n);lights[k]=virtualLight;k++;}}else{lights[k]=light;k++;}}
for(i=0,il=lights.length;i<il;i++){light=lights[i];if(!light.shadowMap){var pars={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat};light.shadowMap=new THREE.WebGLRenderTarget(light.shadowMapWidth,light.shadowMapHeight,pars);light.shadowMapSize=new THREE.Vector2(light.shadowMapWidth,light.shadowMapHeight);light.shadowMatrix=new THREE.Matrix4();}
if(!light.shadowCamera){if(light instanceof THREE.SpotLight){light.shadowCamera=new THREE.PerspectiveCamera(light.shadowCameraFov,light.shadowMapWidth/light.shadowMapHeight,light.shadowCameraNear,light.shadowCameraFar);}else if(light instanceof THREE.DirectionalLight){light.shadowCamera=new THREE.OrthographicCamera(light.shadowCameraLeft,light.shadowCameraRight,light.shadowCameraTop,light.shadowCameraBottom,light.shadowCameraNear,light.shadowCameraFar);}else{console.error("Unsupported light type for shadow");continue;}
scene.add(light.shadowCamera);if(_renderer.autoUpdateScene)scene.updateMatrixWorld();}
if(light.shadowCameraVisible&&!light.cameraHelper){light.cameraHelper=new THREE.CameraHelper(light.shadowCamera);light.shadowCamera.add(light.cameraHelper);}
if(light.isVirtual&&virtualLight.originalCamera==camera){updateShadowCamera(camera,light);}
shadowMap=light.shadowMap;shadowMatrix=light.shadowMatrix;shadowCamera=light.shadowCamera;shadowCamera.position.copy(light.matrixWorld.getPosition());shadowCamera.lookAt(light.target.matrixWorld.getPosition());shadowCamera.updateMatrixWorld();shadowCamera.matrixWorldInverse.getInverse(shadowCamera.matrixWorld);if(light.cameraHelper)light.cameraHelper.visible=light.shadowCameraVisible;if(light.shadowCameraVisible)light.cameraHelper.update();shadowMatrix.set(0.5,0.0,0.0,0.5,0.0,0.5,0.0,0.5,0.0,0.0,0.5,0.5,0.0,0.0,0.0,1.0);shadowMatrix.multiplySelf(shadowCamera.projectionMatrix);shadowMatrix.multiplySelf(shadowCamera.matrixWorldInverse);if(!shadowCamera._viewMatrixArray)shadowCamera._viewMatrixArray=new Float32Array(16);if(!shadowCamera._projectionMatrixArray)shadowCamera._projectionMatrixArray=new Float32Array(16);shadowCamera.matrixWorldInverse.flattenToArray(shadowCamera._viewMatrixArray);shadowCamera.projectionMatrix.flattenToArray(shadowCamera._projectionMatrixArray);_projScreenMatrix.multiply(shadowCamera.projectionMatrix,shadowCamera.matrixWorldInverse);_frustum.setFromMatrix(_projScreenMatrix);_renderer.setRenderTarget(shadowMap);_renderer.clear();renderList=scene.__webglObjects;for(j=0,jl=renderList.length;j<jl;j++){webglObject=renderList[j];object=webglObject.object;webglObject.render=false;if(object.visible&&object.castShadow){if(!(object instanceof THREE.Mesh)||!(object.frustumCulled)||_frustum.contains(object)){object._modelViewMatrix.multiply(shadowCamera.matrixWorldInverse,object.matrixWorld);webglObject.render=true;}}}
var objectMaterial,useMorphing,useSkinning;for(j=0,jl=renderList.length;j<jl;j++){webglObject=renderList[j];if(webglObject.render){object=webglObject.object;buffer=webglObject.buffer;objectMaterial=getObjectMaterial(object);useMorphing=object.geometry.morphTargets.length>0&&objectMaterial.morphTargets;useSkinning=object instanceof THREE.SkinnedMesh&&objectMaterial.skinning;if(object.customDepthMaterial){material=object.customDepthMaterial;}else if(useSkinning){material=useMorphing?_depthMaterialMorphSkin:_depthMaterialSkin;}else if(useMorphing){material=_depthMaterialMorph;}else{material=_depthMaterial;}
if(buffer instanceof THREE.BufferGeometry){_renderer.renderBufferDirect(shadowCamera,scene.__lights,fog,material,buffer,object);}else{_renderer.renderBuffer(shadowCamera,scene.__lights,fog,material,buffer,object);}}}
renderList=scene.__webglObjectsImmediate;for(j=0,jl=renderList.length;j<jl;j++){webglObject=renderList[j];object=webglObject.object;if(object.visible&&object.castShadow){object._modelViewMatrix.multiply(shadowCamera.matrixWorldInverse,object.matrixWorld);_renderer.renderImmediateObject(shadowCamera,scene.__lights,fog,_depthMaterial,object);}}}
var clearColor=_renderer.getClearColor(),clearAlpha=_renderer.getClearAlpha();_gl.clearColor(clearColor.r,clearColor.g,clearColor.b,clearAlpha);_gl.enable(_gl.BLEND);if(_renderer.shadowMapCullFrontFaces){_gl.cullFace(_gl.BACK);}};function createVirtualLight(light,cascade){var virtualLight=new THREE.DirectionalLight();virtualLight.isVirtual=true;virtualLight.onlyShadow=true;virtualLight.castShadow=true;virtualLight.shadowCameraNear=light.shadowCameraNear;virtualLight.shadowCameraFar=light.shadowCameraFar;virtualLight.shadowCameraLeft=light.shadowCameraLeft;virtualLight.shadowCameraRight=light.shadowCameraRight;virtualLight.shadowCameraBottom=light.shadowCameraBottom;virtualLight.shadowCameraTop=light.shadowCameraTop;virtualLight.shadowCameraVisible=light.shadowCameraVisible;virtualLight.shadowDarkness=light.shadowDarkness;virtualLight.shadowBias=light.shadowCascadeBias[cascade];virtualLight.shadowMapWidth=light.shadowCascadeWidth[cascade];virtualLight.shadowMapHeight=light.shadowCascadeHeight[cascade];virtualLight.pointsWorld=[];virtualLight.pointsFrustum=[];var pointsWorld=virtualLight.pointsWorld,pointsFrustum=virtualLight.pointsFrustum;for(var i=0;i<8;i++){pointsWorld[i]=new THREE.Vector3();pointsFrustum[i]=new THREE.Vector3();}
var nearZ=light.shadowCascadeNearZ[cascade];var farZ=light.shadowCascadeFarZ[cascade];pointsFrustum[0].set(-1,-1,nearZ);pointsFrustum[1].set(1,-1,nearZ);pointsFrustum[2].set(-1,1,nearZ);pointsFrustum[3].set(1,1,nearZ);pointsFrustum[4].set(-1,-1,farZ);pointsFrustum[5].set(1,-1,farZ);pointsFrustum[6].set(-1,1,farZ);pointsFrustum[7].set(1,1,farZ);return virtualLight;}
function updateVirtualLight(light,cascade){var virtualLight=light.shadowCascadeArray[cascade];virtualLight.position.copy(light.position);virtualLight.target.position.copy(light.target.position);virtualLight.lookAt(virtualLight.target);virtualLight.shadowCameraVisible=light.shadowCameraVisible;virtualLight.shadowDarkness=light.shadowDarkness;virtualLight.shadowBias=light.shadowCascadeBias[cascade];var nearZ=light.shadowCascadeNearZ[cascade];var farZ=light.shadowCascadeFarZ[cascade];var pointsFrustum=virtualLight.pointsFrustum;pointsFrustum[0].z=nearZ;pointsFrustum[1].z=nearZ;pointsFrustum[2].z=nearZ;pointsFrustum[3].z=nearZ;pointsFrustum[4].z=farZ;pointsFrustum[5].z=farZ;pointsFrustum[6].z=farZ;pointsFrustum[7].z=farZ;}
function updateShadowCamera(camera,light){var shadowCamera=light.shadowCamera,pointsFrustum=light.pointsFrustum,pointsWorld=light.pointsWorld;_min.set(Infinity,Infinity,Infinity);_max.set(-Infinity,-Infinity,-Infinity);for(var i=0;i<8;i++){var p=pointsWorld[i];p.copy(pointsFrustum[i]);THREE.ShadowMapPlugin.__projector.unprojectVector(p,camera);shadowCamera.matrixWorldInverse.multiplyVector3(p);if(p.x<_min.x)_min.x=p.x;if(p.x>_max.x)_max.x=p.x;if(p.y<_min.y)_min.y=p.y;if(p.y>_max.y)_max.y=p.y;if(p.z<_min.z)_min.z=p.z;if(p.z>_max.z)_max.z=p.z;}
shadowCamera.left=_min.x;shadowCamera.right=_max.x;shadowCamera.top=_max.y;shadowCamera.bottom=_min.y;shadowCamera.updateProjectionMatrix();}
function getObjectMaterial(object){return object.material instanceof THREE.MeshFaceMaterial?object.geometry.materials[0]:object.material;}};THREE.ShadowMapPlugin.__projector=new THREE.Projector();THREE.SpritePlugin=function(){var _gl,_renderer,_sprite={};this.init=function(renderer){_gl=renderer.context;_renderer=renderer;_sprite.vertices=new Float32Array(8+8);_sprite.faces=new Uint16Array(6);var i=0;_sprite.vertices[i++]=-1;_sprite.vertices[i++]=-1;_sprite.vertices[i++]=0;_sprite.vertices[i++]=0;_sprite.vertices[i++]=1;_sprite.vertices[i++]=-1;_sprite.vertices[i++]=1;_sprite.vertices[i++]=0;_sprite.vertices[i++]=1;_sprite.vertices[i++]=1;_sprite.vertices[i++]=1;_sprite.vertices[i++]=1;_sprite.vertices[i++]=-1;_sprite.vertices[i++]=1;_sprite.vertices[i++]=0;_sprite.vertices[i++]=1;i=0;_sprite.faces[i++]=0;_sprite.faces[i++]=1;_sprite.faces[i++]=2;_sprite.faces[i++]=0;_sprite.faces[i++]=2;_sprite.faces[i++]=3;_sprite.vertexBuffer=_gl.createBuffer();_sprite.elementBuffer=_gl.createBuffer();_gl.bindBuffer(_gl.ARRAY_BUFFER,_sprite.vertexBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,_sprite.vertices,_gl.STATIC_DRAW);_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,_sprite.elementBuffer);_gl.bufferData(_gl.ELEMENT_ARRAY_BUFFER,_sprite.faces,_gl.STATIC_DRAW);_sprite.program=createProgram(THREE.ShaderSprite["sprite"]);_sprite.attributes={};_sprite.uniforms={};_sprite.attributes.position=_gl.getAttribLocation(_sprite.program,"position");_sprite.attributes.uv=_gl.getAttribLocation(_sprite.program,"uv");_sprite.uniforms.uvOffset=_gl.getUniformLocation(_sprite.program,"uvOffset");_sprite.uniforms.uvScale=_gl.getUniformLocation(_sprite.program,"uvScale");_sprite.uniforms.rotation=_gl.getUniformLocation(_sprite.program,"rotation");_sprite.uniforms.scale=_gl.getUniformLocation(_sprite.program,"scale");_sprite.uniforms.alignment=_gl.getUniformLocation(_sprite.program,"alignment");_sprite.uniforms.color=_gl.getUniformLocation(_sprite.program,"color");_sprite.uniforms.map=_gl.getUniformLocation(_sprite.program,"map");_sprite.uniforms.opacity=_gl.getUniformLocation(_sprite.program,"opacity");_sprite.uniforms.useScreenCoordinates=_gl.getUniformLocation(_sprite.program,"useScreenCoordinates");_sprite.uniforms.affectedByDistance=_gl.getUniformLocation(_sprite.program,"affectedByDistance");_sprite.uniforms.screenPosition=_gl.getUniformLocation(_sprite.program,"screenPosition");_sprite.uniforms.modelViewMatrix=_gl.getUniformLocation(_sprite.program,"modelViewMatrix");_sprite.uniforms.projectionMatrix=_gl.getUniformLocation(_sprite.program,"projectionMatrix");_sprite.attributesEnabled=false;};this.render=function(scene,camera,viewportWidth,viewportHeight){var sprites=scene.__webglSprites,nSprites=sprites.length;if(!nSprites)return;var attributes=_sprite.attributes,uniforms=_sprite.uniforms;var invAspect=viewportHeight/viewportWidth;var halfViewportWidth=viewportWidth*0.5,halfViewportHeight=viewportHeight*0.5;var mergeWith3D=true;_gl.useProgram(_sprite.program);if(!_sprite.attributesEnabled){_gl.enableVertexAttribArray(attributes.position);_gl.enableVertexAttribArray(attributes.uv);_sprite.attributesEnabled=true;}
_gl.disable(_gl.CULL_FACE);_gl.enable(_gl.BLEND);_gl.depthMask(true);_gl.bindBuffer(_gl.ARRAY_BUFFER,_sprite.vertexBuffer);_gl.vertexAttribPointer(attributes.position,2,_gl.FLOAT,false,2*8,0);_gl.vertexAttribPointer(attributes.uv,2,_gl.FLOAT,false,2*8,8);_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,_sprite.elementBuffer);_gl.uniformMatrix4fv(uniforms.projectionMatrix,false,camera._projectionMatrixArray);_gl.activeTexture(_gl.TEXTURE0);_gl.uniform1i(uniforms.map,0);var i,sprite,screenPosition,size,scale=[];for(i=0;i<nSprites;i++){sprite=sprites[i];if(!sprite.visible||sprite.opacity===0)continue;if(!sprite.useScreenCoordinates){sprite._modelViewMatrix.multiply(camera.matrixWorldInverse,sprite.matrixWorld);sprite.z=-sprite._modelViewMatrix.elements[14];}else{sprite.z=-sprite.position.z;}}
sprites.sort(painterSort);for(i=0;i<nSprites;i++){sprite=sprites[i];if(!sprite.visible||sprite.opacity===0)continue;if(sprite.map&&sprite.map.image&&sprite.map.image.width){if(sprite.useScreenCoordinates){_gl.uniform1i(uniforms.useScreenCoordinates,1);_gl.uniform3f(uniforms.screenPosition,(sprite.position.x-halfViewportWidth)/halfViewportWidth,(halfViewportHeight-sprite.position.y)/halfViewportHeight,Math.max(0,Math.min(1,sprite.position.z)));}else{_gl.uniform1i(uniforms.useScreenCoordinates,0);_gl.uniform1i(uniforms.affectedByDistance,sprite.affectedByDistance?1:0);_gl.uniformMatrix4fv(uniforms.modelViewMatrix,false,sprite._modelViewMatrix.elements);}
size=sprite.map.image.width/(sprite.scaleByViewport?viewportHeight:1);scale[0]=size*invAspect*sprite.scale.x;scale[1]=size*sprite.scale.y;_gl.uniform2f(uniforms.uvScale,sprite.uvScale.x,sprite.uvScale.y);_gl.uniform2f(uniforms.uvOffset,sprite.uvOffset.x,sprite.uvOffset.y);_gl.uniform2f(uniforms.alignment,sprite.alignment.x,sprite.alignment.y);_gl.uniform1f(uniforms.opacity,sprite.opacity);_gl.uniform3f(uniforms.color,sprite.color.r,sprite.color.g,sprite.color.b);_gl.uniform1f(uniforms.rotation,sprite.rotation);_gl.uniform2fv(uniforms.scale,scale);if(sprite.mergeWith3D&&!mergeWith3D){_gl.enable(_gl.DEPTH_TEST);mergeWith3D=true;}else if(!sprite.mergeWith3D&&mergeWith3D){_gl.disable(_gl.DEPTH_TEST);mergeWith3D=false;}
_renderer.setBlending(sprite.blending,sprite.blendEquation,sprite.blendSrc,sprite.blendDst);_renderer.setTexture(sprite.map,0);_gl.drawElements(_gl.TRIANGLES,6,_gl.UNSIGNED_SHORT,0);}}
_gl.enable(_gl.CULL_FACE);_gl.enable(_gl.DEPTH_TEST);_gl.depthMask(true);};function createProgram(shader){var program=_gl.createProgram();var fragmentShader=_gl.createShader(_gl.FRAGMENT_SHADER);var vertexShader=_gl.createShader(_gl.VERTEX_SHADER);_gl.shaderSource(fragmentShader,shader.fragmentShader);_gl.shaderSource(vertexShader,shader.vertexShader);_gl.compileShader(fragmentShader);_gl.compileShader(vertexShader);_gl.attachShader(program,fragmentShader);_gl.attachShader(program,vertexShader);_gl.linkProgram(program);return program;};function painterSort(a,b){return b.z-a.z;};};THREE.DepthPassPlugin=function(){this.enabled=false;this.renderTarget=null;var _gl,_renderer,_depthMaterial,_depthMaterialMorph,_frustum=new THREE.Frustum(),_projScreenMatrix=new THREE.Matrix4();this.init=function(renderer){_gl=renderer.context;_renderer=renderer;var depthShader=THREE.ShaderLib["depthRGBA"];var depthUniforms=THREE.UniformsUtils.clone(depthShader.uniforms);_depthMaterial=new THREE.ShaderMaterial({fragmentShader:depthShader.fragmentShader,vertexShader:depthShader.vertexShader,uniforms:depthUniforms});_depthMaterialMorph=new THREE.ShaderMaterial({fragmentShader:depthShader.fragmentShader,vertexShader:depthShader.vertexShader,uniforms:depthUniforms,morphTargets:true});_depthMaterial._shadowPass=true;_depthMaterialMorph._shadowPass=true;};this.render=function(scene,camera){if(!this.enabled)return;this.update(scene,camera);};this.update=function(scene,camera){var i,il,j,jl,n,program,buffer,material,webglObject,object,light,renderList,fog=null;_gl.clearColor(1,1,1,1);_gl.disable(_gl.BLEND);_renderer.setDepthTest(true);if(_renderer.autoUpdateScene)scene.updateMatrixWorld();if(!camera._viewMatrixArray)camera._viewMatrixArray=new Float32Array(16);if(!camera._projectionMatrixArray)camera._projectionMatrixArray=new Float32Array(16);camera.matrixWorldInverse.getInverse(camera.matrixWorld);camera.matrixWorldInverse.flattenToArray(camera._viewMatrixArray);camera.projectionMatrix.flattenToArray(camera._projectionMatrixArray);_projScreenMatrix.multiply(camera.projectionMatrix,camera.matrixWorldInverse);_frustum.setFromMatrix(_projScreenMatrix);_renderer.setRenderTarget(this.renderTarget);_renderer.clear();renderList=scene.__webglObjects;for(j=0,jl=renderList.length;j<jl;j++){webglObject=renderList[j];object=webglObject.object;webglObject.render=false;if(object.visible){if(!(object instanceof THREE.Mesh)||!(object.frustumCulled)||_frustum.contains(object)){object._modelViewMatrix.multiply(camera.matrixWorldInverse,object.matrixWorld);webglObject.render=true;}}}
for(j=0,jl=renderList.length;j<jl;j++){webglObject=renderList[j];if(webglObject.render){object=webglObject.object;buffer=webglObject.buffer;if(object.material)_renderer.setMaterialFaces(object.material);if(object.customDepthMaterial){material=object.customDepthMaterial;}else if(object.geometry.morphTargets.length){material=_depthMaterialMorph;}else{material=_depthMaterial;}
if(buffer instanceof THREE.BufferGeometry){_renderer.renderBufferDirect(camera,scene.__lights,fog,material,buffer,object);}else{_renderer.renderBuffer(camera,scene.__lights,fog,material,buffer,object);}}}
renderList=scene.__webglObjectsImmediate;for(j=0,jl=renderList.length;j<jl;j++){webglObject=renderList[j];object=webglObject.object;if(object.visible&&object.castShadow){object._modelViewMatrix.multiply(camera.matrixWorldInverse,object.matrixWorld);_renderer.renderImmediateObject(camera,scene.__lights,fog,_depthMaterial,object);}}
var clearColor=_renderer.getClearColor(),clearAlpha=_renderer.getClearAlpha();_gl.clearColor(clearColor.r,clearColor.g,clearColor.b,clearAlpha);_gl.enable(_gl.BLEND);};};THREE.ShaderFlares={'lensFlareVertexTexture':{vertexShader:["uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform int renderType;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) ) +","texture2D( occlusionMap, vec2( 0.5, 0.1 ) ) +","texture2D( occlusionMap, vec2( 0.9, 0.1 ) ) +","texture2D( occlusionMap, vec2( 0.9, 0.5 ) ) +","texture2D( occlusionMap, vec2( 0.9, 0.9 ) ) +","texture2D( occlusionMap, vec2( 0.5, 0.9 ) ) +","texture2D( occlusionMap, vec2( 0.1, 0.9 ) ) +","texture2D( occlusionMap, vec2( 0.1, 0.5 ) ) +","texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility = (       visibility.r / 9.0 ) *","( 1.0 - visibility.g / 9.0 ) *","(       visibility.b / 9.0 ) *","( 1.0 - visibility.a / 9.0 );","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform sampler2D map;","uniform float opacity;","uniform int renderType;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},'lensFlare':{vertexShader:["uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform int renderType;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform int renderType;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a +","texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a +","texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a +","texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}};THREE.ShaderSprite={'sprite':{vertexShader:["uniform int useScreenCoordinates;","uniform int affectedByDistance;","uniform vec3 screenPosition;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 alignment;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position + alignment;","vec2 rotatedPosition;","rotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;","rotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;","vec4 finalPosition;","if( useScreenCoordinates != 0 ) {","finalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );","} else {","finalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition * ( affectedByDistance == 1 ? 1.0 : finalPosition.z );","}","gl_Position = finalPosition;","}"].join("\n"),fragmentShader:["precision mediump float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","}"].join("\n")}};if(!window.requestAnimationFrame){window.requestAnimationFrame=(function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback,element){window.setTimeout(callback,1000/60);};})();}
if(!d3||!jQuery||!THREE||!requestAnimationFrame){throw"D3GL requires D3, JQuery, ThreeJS, and RequestAnimationFrame";}
d3.gl={};d3.gl.globe=function(){var width=400;var height=400;var fnTex,fnTransparency;var fnAtmosphere=function(d){return false;};var eventHandlers={'mousedown':[],'mousemove':[],'mouseup':[],'click':[],'dblclick':[],'update':[]};var zoom=2.0,rotation={"lat":0,"lon":0};var overlayTex=[];var overlay3D=[];var shaders={};var anim={};var VIEW_ANGLE=45,NEAR=0.01,FAR=100;var MOUSE_SENSITIVITY=0.15;var ZOOM_SENSITIVITY=0.1;var MIN_ZOOM=0.5,MAX_ZOOM=4;function initMaterial(shaders,textures){var uniforms={texBase:{type:"t",value:textures.base},texOverlay:{type:"t",value:textures.overlay},texShapes:{type:"t",value:0},texColorLookup:{type:"t",value:0},lookupShapes:{type:"i",value:0},transparency:{type:"f",value:1.0}};var material=new THREE.ShaderMaterial({vertexShader:shaders.vertex,fragmentShader:shaders.fragment,uniforms:uniforms,transparent:true,blending:THREE.CustomBlending,blendSrc:THREE.SrcAlphaFactor,blendDst:THREE.OneMinusSrcAlphaFactor,blendEquation:THREE.AddEquation});return material;};function initAtmosphereMaterial(gl){var uniforms={atmosphereFlag:{type:"i",value:gl.atmosphere?1:0},atmosphereColor:{type:"c",value:gl.atmosphere?new THREE.Color('0x'+gl.atmosphere.slice(1)):0,}};var atmosphereMaterial=new THREE.ShaderMaterial({vertexShader:shaders.atmosphere.vertex,fragmentShader:shaders.atmosphere.fragment,uniforms:uniforms,transparent:true,side:THREE.BackSide});return atmosphereMaterial;}
function initGL(gl){var scene=new THREE.Scene();var camera=new THREE.PerspectiveCamera(VIEW_ANGLE,width/height,NEAR,FAR);camera.position.z=2;scene.add(camera);var canvas=document.createElement("canvas");canvas.width=4000;canvas.height=2000;gl.textures.overlay=new THREE.Texture(canvas);var sphereMaterial=initMaterial(gl.shaders,gl.textures);var sphereMaterialBack=initMaterial(gl.shaders,gl.textures);sphereMaterialBack.side=THREE.BackSide;var radius=1.0,segments=80,rings=40;var geom=new THREE.SphereGeometry(radius,segments,rings);var sphere=new THREE.Mesh(geom,sphereMaterial);var sphereBack=new THREE.Mesh(geom,sphereMaterialBack);sphere.orientation=new THREE.Vector3(0,0,0);sphereBack.orientation=new THREE.Vector3(0,0,0);scene.add(sphereBack);scene.add(sphere);var atmosphereMaterial=initAtmosphereMaterial(gl);var atmosphere=new THREE.Mesh(geom,atmosphereMaterial);atmosphere.scale.x=1.1;atmosphere.scale.y=1.1;atmosphere.scale.z=1.1;scene.add(atmosphere);var pointLight=new THREE.PointLight(0xFFFFFF);pointLight.position.x=1;pointLight.position.y=5;pointLight.position.z=13;scene.add(pointLight);var renderer=new THREE.WebGLRenderer({antialias:true});renderer.setSize(width,height);if(!sphere||!canvas||!sphereMaterial.uniforms||!renderer||!scene||!camera){throw"Initialization failed.";}
gl.meshes={globe:[sphere,sphereBack],bars:[],arcs:[]};gl.overlayCanvas=canvas;gl.material=sphereMaterial;gl.uniforms=sphereMaterial.uniforms;gl.renderer=renderer;gl.scene=scene;gl.camera=camera;gl.projector=new THREE.Projector();window.gl=gl;}
function initControls(gl,elem){var dragStart;var latlon=null;$(elem).mousedown(function(evt){fireMouseEvent("mousedown",gl,evt);evt.preventDefault();dragStart=[evt.pageX,evt.pageY];}).mousemove(function(evt){fireMouseEvent("mousemove",gl,evt);if(!dragStart)return;dragUpdate(evt);dragStart=[evt.pageX,evt.pageY];}).mouseup(function(evt){fireMouseEvent("mouseup",gl,evt);if(!dragStart)return;dragUpdate(evt);dragStart=null;}).mouseleave(function(evt){if(!dragStart)return;dragUpdate(evt);dragStart=null;}).click(function(evt){fireMouseEvent("click",gl,evt);}).dblclick(function(evt){fireMouseEvent("dblclick",gl,evt);}).mousewheel(function(evt,delta,dx,dy){zoomUpdate(Math.pow(1-ZOOM_SENSITIVITY,dy));evt.preventDefault();});$(document).keydown(function(evt){var key=String.fromCharCode(evt.which).toLowerCase();if(key=="w")zoomUpdate(1/1.2);else if(key=="s")zoomUpdate(1.2);else if(key=="a")rotation.lon-=10;else if(key=="d")rotation.lon+=10;else return;evt.preventDefault();});function zoomUpdate(z){zoom*=z;zoom=Math.min(MAX_ZOOM,Math.max(MIN_ZOOM,zoom));}
function dragUpdate(evt){rotation.lon-=(evt.pageX-dragStart[0])*MOUSE_SENSITIVITY*zoom;rotation.lat+=(evt.pageY-dragStart[1])*MOUSE_SENSITIVITY*zoom;}}
function initStyle(elem){elem.style.cursor="pointer";}
function intersect(gl,evt){var vector=new THREE.Vector3((evt.offsetX/width)*2-1,-(evt.offsetY/height)*2+1,1.0);gl.projector.unprojectVector(vector,gl.camera);var ray=new THREE.Ray(gl.camera.position,vector.subSelf(gl.camera.position).normalize());var a=ray.direction.dot(ray.direction);var b=2*ray.origin.dot(ray.direction)
var c=ray.origin.dot(ray.origin)-1;var det=b*b-4*a*c;if(det<0)return null;var t=(-b-Math.sqrt(det))/(2*a);var point=ray.direction.clone().multiplyScalar(t).addSelf(ray.origin);var rlat=rotation.lat*Math.PI/180;var rlon=rotation.lon*Math.PI/180;var rot=new THREE.Matrix4();rot.rotateY(rlon);rot.rotateX(-rlat);point=rot.multiplyVector3(point);var lat=Math.asin(point.y);var lon=Math.atan2(point.x,point.z);lat=180/Math.PI*lat;lon=180/Math.PI*lon-90;while(lon<-180)lon+=360;while(lon>180)lon-=360;while(lat<-90)lat+=360;while(lat>270)lat-=360;if(lat>90)lat=180-lat;if(lat<-90||lat>90||lon<-180||lon>180)throw"lat/lon error "+lat+"/"+lon;return[lat,lon];}
function fireMouseEvent(name,gl,evt){var handlers=eventHandlers[name];if(handlers.length==0)return;evt.latlon=intersect(gl,evt);evt.datum=gl.datum;for(var i=0;i<handlers.length;i++){handlers[i](evt);}}
function fireEvent(name,evt){var handlers=eventHandlers[name];if(handlers.length==0)return;for(var i=0;i<handlers.length;i++){handlers[i](evt);}}
function updateAnimations(){var now=new Date().getTime();if(anim.rotation){var dt=now-anim.rotation.startTime;var duration=anim.rotation.duration;if(dt<0){throw"wtf";}else if(dt>duration){rotation=anim.rotation.end;anim.rotation=null;}else{var ease=anim.rotation.easing||d3.ease("cubic-in-out");var t=ease(dt/duration);var dlat=anim.rotation.end.lat-anim.rotation.start.lat;var lat=anim.rotation.start.lat+dlat*t;var dlon=anim.rotation.end.lon-anim.rotation.start.lon;if(dlon<-180)dlon+=360;if(dlon>180)dlon-=360;var lon=(anim.rotation.start.lon+dlon*t+180+360)%360-180;rotation={"lat":lat,"lon":lon};}}}
function globe(g){g.each(globeRender);}
function globeRender(d,i){if(this.tagName=="canvas")throw"D3GL creates its own canvas elements. "+"Render into a <div>, not directly into a <canvas>."
var gl={};gl.element=this;gl.datum=d;gl.index=i;gl.shaders=shaders.globe;gl.textures={};console.log("loading textures");var canvas=document.createElement("canvas");canvas.width=128;canvas.height=128;var texUrl=fnTex(d);gl.textures.base=THREE.ImageUtils.loadTexture(texUrl,null,function(){console.log("textures loaded");start();});gl.atmosphere=fnAtmosphere(d);function start(){initGL(gl);initControls(gl,gl.renderer.domElement);initStyle(gl.renderer.domElement);gl.element.appendChild(gl.renderer.domElement);function render(){fireEvent("update",null);updateAnimations();if(fnTransparency)gl.uniforms.transparency.value=fnTransparency(d);for(var i=0;i<overlay3D.length;i++){overlay3D[i](gl,d);}
var context=gl.overlayCanvas.getContext("2d");context.setTransform(1,0,0,1,0,0);context.width=gl.overlayCanvas.width;context.height=gl.overlayCanvas.height;context.clearRect(0,0,context.width,context.height);for(var i=0;i<overlayTex.length;i++){overlayTex[i](gl,context,d);}
gl.textures.overlay.needsUpdate=true;Object.keys(gl.meshes).forEach(function(key){var meshes=gl.meshes[key];meshes.forEach(function(m){m.matrixAutoUpdate=false;m.matrixWorld=new THREE.Matrix4();m.matrixWorld.rotateX(rotation.lat*Math.PI/180);m.matrixWorld.rotateY(-rotation.lon*Math.PI/180);m.matrixWorld.rotateY(m.orientation.y);m.matrixWorld.rotateX(m.orientation.x);});});gl.camera.position.z=1+zoom;gl.renderer.sortObjects=false;gl.renderer.sortElements=false;gl.renderer.render(gl.scene,gl.camera);requestAnimationFrame(render);}
render();}}
globe.width=function(val){if(!arguments.length)return width;width=val;return globe;}
globe.height=function(val){if(!arguments.length)return height;height=val;return globe;}
globe.latitude=function(val){if(!arguments.length)return fnLat;if(typeof val==="function")fnLat=val;else fnLat=function(){return val;}
return globe;}
globe.longitude=function(val){if(!arguments.length)return fnLon;if(typeof val==="function")fnLon=val;else fnLon=function(){return val;}
return globe;}
globe.texture=function(val){if(!arguments.length)return fnTex;if(typeof val==="function")fnTex=val;else fnTex=function(){return val;}
return globe;}
globe.transparency=function(val){if(!arguments.length)return fnTransparency;if(typeof val==="function")fnTransparency=val;else fnTransparency=function(){return val;}
return globe;}
globe.atmosphere=function(val){if(!arguments.length)return fnAtmosphere;if(typeof val==="function")fnAtmosphere=val;else fnAtmosphere=function(){return val;}
return globe;}
globe.on=function(eventName,callback){if(typeof(eventHandlers[eventName])==="undefined"){throw"unsupported event "+eventName;}
eventHandlers[eventName].push(callback);return globe;}
globe.rotation=function(latlon){if(!arguments.length)return rotation;if(!latlon||!latlon.lat||!latlon.lon)throw"Invalid rotation()";rotation=latlon;return globe;}
globe.zoom=function(z){if(!arguments.length)return zoom;if(!z||z<0)throw"Invalid zoom()";zoom=z;return globe;}
globe.rotateTo=function(latlon,ms){console.log("rotateTo(["+latlon.join(",")+"], "+ms+")");if(!ms)ms=400;else if(ms=="fast")ms=200;else if(ms=="slow")ms=600;anim.rotation={start:rotation,end:{"lat":latlon[0],"lon":latlon[1]+90},startTime:new Date().getTime(),duration:ms};}
globe.shapes=function(idMapUrl){var fnData=function(d){return d;};var fnColor,fnId;if(idMapUrl=="countries")idMapUrl="http://dcpos.ch/d3gl/img/country-codes.png";var idMapImageData=null;function shapes(gl,context,datum){gl.uniforms.lookupShapes.value=1;if(!idMapUrl)throw"The id map for shapes has not been defined.";if(gl.uniforms.texShapes.value==0){gl.uniforms.texShapes.value=1;loadIdMap(gl);}
var array=fnData(datum);var textureHeight=1;var textureWidth=1024*3;var colorLookup=new Uint8Array(textureWidth*4);for(var i=0;i<array.length;i++){var id=fnId(array[i]);var idx=id*4*3;var color=fnColor(array[i]);if(color.length<4)throw"Color function for shapes "+"does not return color of valid format [r, g, b, a]";for(var j=0;j<3;j++){colorLookup[idx+j*4]=color[0];colorLookup[idx+j*4+1]=color[1];colorLookup[idx+j*4+2]=color[2];colorLookup[idx+j*4+3]=color[3];}}
gl.uniforms.texColorLookup.value=new THREE.DataTexture(colorLookup,textureWidth,textureHeight,THREE.RGBAFormat);gl.uniforms.texColorLookup.value.needsUpdate=true;}
function loadIdMap(gl){var map=new Image();map.crossOrigin='';map.src=idMapUrl;map.onload=function(){var idCanvas=document.createElement("canvas");idCanvas.width=map.width;idCanvas.height=map.height;var idContext=idCanvas.getContext("2d");idContext.drawImage(map,0,0);idMapImageData=idContext.getImageData(0,0,idCanvas.width,idCanvas.height);gl.uniforms.texShapes.value=new THREE.Texture();gl.uniforms.texShapes.value.image=map;gl.uniforms.texShapes.value.needsUpdate=true;}}
shapes.data=function(val){if(arguments.length==0)return fnData;if(typeof val=="function")fnData=val;else fnData=function(){return val;};return shapes;}
shapes.map=function(val){if(arguments.length==0)return fnMap;if(typeof val=="function")fnMap=val;else fnMap=function(){return val;};return shapes;}
shapes.id=function(val){if(arguments.length==0)return fnId;if(typeof val=="function")fnId=val;else fnId=function(){return val;};return shapes;}
shapes.color=function(val){if(arguments.length==0)return fnColor;if(typeof val=="function")fnColor=val;else fnColor=function(){return val;};return shapes;}
shapes.on=function(eventName,callback){globe.on(eventName,function(evt){if(!idMapImageData)return;var data=fnData(evt.datum);var latlon=evt.latlon;if(latlon==null)return;var x,y;x=Math.floor(idMapImageData.width*(latlon[1]+180)/360);y=idMapImageData.height-
Math.floor(idMapImageData.height*(latlon[0]+90)/180);var idx,r,g,b;idx=(y*idMapImageData.width+x)*4;r=idMapImageData.data[idx];g=idMapImageData.data[idx+1];b=idMapImageData.data[idx+2];var shapeId=shapeIdFromColor(r,g,b);for(var i=0;i<data.length;i++){if(fnId(data[i])==shapeId){evt.shape=data[i];break;}}
callback(evt);});function shapeIdFromColor(r,g,b){var dr=Math.floor((r/25.5)+0.5);var dg=Math.floor((g/25.5)+0.5);var db=Math.floor((b/25.5)+0.5);return dr*10*10+dg*10+db;}
return shapes;}
overlayTex.push(shapes);return shapes;}
globe.points=function(){var fnData=function(d){return d;};var fnLat,fnLon,fnColor,fnRadius;var fnStrokeColor=function(){return"#000";};var fnLineWidth=function(){return 0;};function drawCircle(context,plat,plon,pradius,color,strokeColor,lineWidth){context.beginPath();context.arc(plon,plat,pradius,0,2*Math.PI,false);context.fillStyle=color;context.fill();context.strokeStyle=strokeColor;context.lineWidth=lineWidth;context.stroke();}
function points(gl,context,datum){var array=fnData(datum);for(var i=0;i<array.length;i++){var elem=array[i];var lat=parseFloat(fnLat(elem,i));var lon=parseFloat(fnLon(elem,i));if(lat<-90||lat>90||lon<-180||lon>180){throw"invalid lat/lon: "+lat+","+lon;}
var color=fnColor(elem,i);var strokeColor=fnStrokeColor(elem,i);var lineWidth=fnLineWidth(elem,i);var radius=fnRadius(elem,i);if(radius<=0)return;var pradius=radius*context.width/360.0;var plat=context.height*(1-(lat+90)/180);var plon=context.width*(lon+180)/360;var xscale=1/(Math.cos(lat*Math.PI/180)+0.01);plon/=xscale;context.save();context.scale(xscale,1.0);if(plon<pradius){drawCircle(context,plat,plon+context.width/xscale,pradius,color,strokeColor,lineWidth);}else if(plon>context.width/xscale-pradius){drawCircle(context,plat,plon-context.width/xscale,pradius,color,strokeColor,lineWidth);}
drawCircle(context,plat,plon,pradius,color,strokeColor,lineWidth);context.restore();}}
points.latitude=function(val){if(arguments.length==0)return fnLat;if(typeof val=="function")fnLat=val;else fnLat=function(){return val;};return points;}
points.longitude=function(val){if(arguments.length==0)return fnLon;if(typeof val=="function")fnLon=val;else fnLon=function(){return val;};return points;}
points.color=function(val){if(arguments.length==0)return fnColor;if(typeof val=="function")fnColor=val;else fnColor=function(){return val;};return points;}
points.strokeColor=function(val){if(arguments.length==0)return fnStrokeColor;if(typeof val=="function")fnStrokeColor=val;else fnStrokeColor=function(){return val;};return points;}
points.lineWidth=function(val){if(arguments.length==0)return fnLineWidth;if(typeof val=="function")fnLineWidth=val;else fnLineWidth=function(){return val;};return points;}
points.radius=function(val){if(arguments.length==0)return fnRadius;if(typeof val=="function")fnRadius=val;else fnRadius=function(){return val;};return points;}
points.data=function(val){if(arguments.length==0)return fnData;if(typeof val=="function")fnData=val;else fnData=function(){return val;};return points;}
points.on=function(eventName,callback){globe.on(eventName,function(evt){var latlon=evt.latlon;if(latlon==null)return;evt.point=null;var data=fnData(evt.datum);var mind=null;for(var i=0;i<data.length;i++){var lat=parseFloat(fnLat(data[i],i));var lon=parseFloat(fnLon(data[i],i));var rad=parseFloat(fnRadius(data[i],i));var dlat=lat-latlon[0];var dlon=(lon-latlon[1])*Math.cos(lat*Math.PI/180);var d=Math.sqrt(dlat*dlat+dlon*dlon);if(d>Math.max(2,rad+2))continue;if(!mind||(d<mind)){mind=d;evt.point=data[i];}}
callback(evt);});return points;}
overlayTex.push(points);return points;};globe.bars=function(){var identityFn=function(d){return d;};var fns={fnData:identityFn,prevFnData:false,};var transitions=[];var barsFs,barsVs;var barObjs={};function bars(gl,datum){removePreviousBars(gl,datum);bars.transition.update();var array=fns.fnData(datum);array.forEach(function(elem){var state={latRad:(Math.PI/180)*fns.fnLat(elem),lonRad:(Math.PI/180)*fns.fnLon(elem)+Math.PI/2,color:fns.fnColor(elem),height:fns.fnHeight(elem),width:fns.fnWidth(elem)}
var elemId=fns.fnId(elem);var bar=barObjs[elemId];if(!bar){var uniforms={color:{type:"c",value:new THREE.Color("0x"+state.color.slice(1))}};bar=new THREE.Mesh(new THREE.CubeGeometry(1,1,1),new THREE.ShaderMaterial({vertexShader:shaders.bars.vertex,fragmentShader:shaders.bars.fragment,uniforms:uniforms}));bar.uniforms=uniforms;bar.state={latRad:0,lonRad:0,color:0,height:0,width:0,};barObjs[elemId]=bar;gl.scene.add(bar);gl.meshes.bars.push(bar);}
bar.state=state;bars.transition.updateBarState(bar,elem);var x0=-bar.state.width/2,x1=bar.state.width/2;var y0=-bar.state.width/2,y1=bar.state.width/2;var z0=1,z1=1+bar.state.height;bar.geometry.vertices[0]=new THREE.Vector3(x1,y1,z1);bar.geometry.vertices[1]=new THREE.Vector3(x1,y1,z0);bar.geometry.vertices[2]=new THREE.Vector3(x1,y0,z1);bar.geometry.vertices[3]=new THREE.Vector3(x1,y0,z0);bar.geometry.vertices[4]=new THREE.Vector3(x0,y1,z0);bar.geometry.vertices[5]=new THREE.Vector3(x0,y1,z1);bar.geometry.vertices[6]=new THREE.Vector3(x0,y0,z0);bar.geometry.vertices[7]=new THREE.Vector3(x0,y0,z1);bar.geometry.verticesNeedUpdate=true;bar.uniforms.color.value=new THREE.Color("0x"+bar.state.color.slice(1));bar.orientation=new THREE.Vector3(-bar.state.latRad,bar.state.lonRad,0);});}
bars.id=function(val){if(arguments.length==0)return fnId;var fn=(typeof val=="function")?val:function(){return val};if(transitions.length>0){transitions[transitions.length-1].fnId=fn;}else{fns.fnId=fn;}
return bars;}
bars.latitude=function(val){if(arguments.length==0)return fnLat;var fn=(typeof val=="function")?val:function(){return val};if(transitions.length>0){transitions[transitions.length-1].fnLat=fn;}else{fns.fnLat=fn;}
return bars;}
bars.longitude=function(val){if(arguments.length==0)return fns.fnLon;var fn=(typeof val=="function")?val:function(){return val};if(transitions.length>0){transitions[transitions.length-1].fnLon=fn;}else{fns.fnLon=fn;}
return bars;}
bars.color=function(val){if(arguments.length==0)return fns.fnColor;var fn=(typeof val=="function")?val:function(){return val};if(transitions.length>0){transitions[transitions.length-1].fnColor=fn;}else{fns.fnColor=fn;}
return bars;}
bars.width=function(val){if(arguments.length==0)return fns.fnWidth;var fn=(typeof val=="function")?val:function(){return val};if(transitions.length>0){transitions[transitions.length-1].fnWidth=fn;}else{fns.fnWidth=fn;}
return bars;}
bars.height=function(val){if(arguments.length==0)return fns.fnHeight;var fn=(typeof val=="function")?val:function(){return val};if(transitions.length>0){transitions[transitions.length-1].fnHeight=fn;}else{fns.fnHeight=fn;}
return bars;}
bars.data=function(val){if(arguments.length==0)return fns.fnData;var fn=(typeof val=="function")?val:function(){return val};if(transitions.length>0){transitions[transitions.length-1].prevFnData=fns.fnData;transitions[transitions.length-1].fnData=fn;}else{if(fns.fnData!=identityFn){fns.prevFnData=fns.fnData;}
fns.fnData=fn;}
return bars;}
bars.on=function(eventName,callback){globe.on(eventName,function(evt){var latlon=evt.latlon;if(latlon==null)return;evt.bar=null;var data=fns.fnData(evt.datum);var mind=null;for(var i=0;i<data.length;i++){var lat=fns.fnLat(data[i],i);var lon=fns.fnLon(data[i],i);var rad=fns.fnWidth(data[i],i)/2;var dlat=lat-latlon[0];var dlon=(lon-latlon[1])*Math.cos(lat*Math.PI/180);var d=Math.sqrt(dlat*dlat+dlon*dlon);if(d>Math.max(4,rad+2))continue;if(!mind||(d<mind)){mind=d;evt.bar=data[i];}}
callback(evt);});return bars;}
bars.transition=function(){transitions.push({started:false});return bars;}
bars.transition.update=function(){if(transitions.length==0)return;var transition=transitions[0];if(!transition.started){transition.started=true;transition.t=0.0;transition.dt=1/transitions[0].duration;}
if(transition.delay-->0)return;transition.t+=transition.dt;}
bars.transition.updateBarState=function(bar,dataElem){if(transitions.length==0)return;var transition=transitions[0];var target={height:transition.fnHeight(dataElem)};if(transition.t>=1.){bar.state.height=target.height;bars.transition.end(bar);}else{var t;if(typeof transition.fnEase!='undefined'){t=transition.fnEase(transition.t);}else{t=transition.t;}
bar.state.height=bar.state.height+
(target.height-bar.state.height)*t;}}
bars.transition.end=function(bar){Object.keys(transitions[0]).forEach(function(fnKey){if(typeof fns[fnKey]!='undefined'){fns[fnKey]=transitions[0][fnKey];}});transitions=transitions.slice(1);}
bars.delay=function(val){transitions[transitions.length-1].delay=60*val/1000;return bars;}
bars.duration=function(val){transitions[transitions.length-1].duration=val;return bars;}
bars.ease=function(val,param1,param2){var fn=(typeof val=="function")?val:d3.ease(val,param1,param2);transitions[transitions.length-1].fnEase=fn;return bars;}
function removePreviousBars(gl,datum){if(!fns.prevFnData)return;var array=fns.prevFnData(datum);array.forEach(function(elem){var elemId=fns.fnId(elem);var bar=barObjs[elemId];gl.scene.remove(bar);delete barObjs[elemId];});gl.meshes.bars=[];fns.prevFnData=false;}
overlay3D.push(bars);return bars;};globe.arcs=function(){var fnData=function(globeDatum){return globeDatum;};var fnId=function(d,i){return i;};var fnStart,fnEnd;var fnApex=function(){return 0.05};var fnLineWidth=function(){return 1};var fnOpacity=function(){return 1};var fnPartialArc=function(){return 1};var fnColor=function(){return 0x000000};var arcObjs={};function arcs(gl,datum){var array=fnData(datum);var elemIds=[]
array.forEach(function(elem,ix){var elemId=fnId(elem,ix);elemIds.push(elemId);var arc=arcObjs[elemId];if(!arc){arc=new THREE.Line(new THREE.Geometry(),new THREE.LineBasicMaterial());arcObjs[elemId]=arc;arc.orientation={x:0,y:0,z:0};gl.scene.add(arc);gl.meshes.arcs.push(arc);}
var llS=fnStart(elem);var llE=fnEnd(elem);var latS=llS[0]*Math.PI/180,lonS=llS[1]*Math.PI/180;var latE=llE[0]*Math.PI/180,lonE=llE[1]*Math.PI/180;var vS=new THREE.Vector3(Math.cos(latS)*Math.cos(lonS),Math.sin(latS),-Math.cos(latS)*Math.sin(lonS));var vE=new THREE.Vector3(Math.cos(latE)*Math.cos(lonE),Math.sin(latE),-Math.cos(latE)*Math.sin(lonE));var vAxis=new THREE.Vector3().cross(vS,vE);var theta=vS.angleTo(vE);var npoints=100;var partialArc=fnPartialArc(elem,ix);var matA=new THREE.Matrix4().rotateByAxis(vAxis,theta*partialArc/npoints);var matB=new THREE.Matrix4().rotateByAxis(vAxis,-theta*partialArc/npoints);var mat;if(matA.multiplyVector3(new THREE.Vector3().copy(vS)).distanceTo(vE)<matB.multiplyVector3(new THREE.Vector3().copy(vS)).distanceTo(vE)){mat=matA;}else{mat=matB;}
var arcGeom=arc.geometry;var apex=fnApex(elem,ix);var vecGS=new THREE.Vector3().copy(vS);arcGeom.vertices=[];for(var i=0;i<npoints;i++){var t=partialArc*i/(npoints-1);mat.multiplyVector3(vecGS);var radius=t*(1-t)*4;radius=1-(1-radius)*(1-radius);radius=radius*apex+1;var vecArc=new THREE.Vector3().copy(vecGS).multiplyScalar(radius);arcGeom.vertices.push(vecArc);}
arcGeom.verticesNeedUpdate=true;var col=fnColor(elem,ix);var opa=fnOpacity(elem,ix);var lw=fnLineWidth(elem,ix);arc.material=new THREE.LineBasicMaterial({color:col,opacity:opa,linewidth:lw});});}
arcs.data=function(data){if(!arguments.length)return fnData;if(typeof(data)==="function")fnData=data;else fnData=function(){return data;}
return arcs;}
arcs.start=function(startLatLon){if(!arguments.length)return fnStart;if(typeof(startLatLon)==="function")fnStart=startLatLon;else fnStart=function(){return startLatLon;}
return arcs;}
arcs.end=function(endLatLon){if(!arguments.length)return fnEnd;if(typeof(endLatLon)==="function")fnEnd=endLatLon;else fnEnd=function(){return endLatLon;}
return arcs;}
arcs.apex=function(apex){if(!arguments.length)return fnApex;if(typeof(apex)==="function")fnApex=apex;else fnApex=function(){return apex;}
return arcs;}
arcs.lineWidth=function(lineWidth){if(!arguments.length)return fnLineWidth;if(typeof(lineWidth)==="function")fnLineWidth=lineWidth;else fnLineWidth=function(){return lineWidth;}
return arcs;}
arcs.color=function(color){if(!arguments.length)return fnColor;if(typeof(color)==="function")fnColor=color;else fnColor=function(){return color;}
return arcs;}
arcs.opacity=function(opacity){if(!arguments.length)return fnOpacity;if(typeof(opacity)==="function")fnOpacity=opacity;else fnOpacity=function(){return opacity;}
return arcs;}
arcs.partialArc=function(partialArc){if(!arguments.length)return fnPartialArc;if(typeof(partialArc)==="function")fnPartialArc=partialArc;else fnPartialArc=function(){return partialArc;}
return arcs;}
overlay3D.push(arcs);return arcs;}
globe.painter=function(){var fnData=function(d){return d;};var fnPaint;function painter(gl,context,datum){fnPaint(gl,context,fnData(datum));}
painter.paint=function(val){if(arguments.length==0)return fnPaint;if(typeof val=="function")fnPaint=val;else fnPaint=function(){return val;};return painter;}
painter.data=function(val){if(arguments.length==0)return fnData;if(typeof val=="function")fnData=val;else fnData=function(){return val;};return painter;}
overlayTex.push(painter);return painter;}
shaders.globe={};shaders.globe.vertex=["// texture coordinate for vertex to be interpolated and passed into","// fragment shader per fragment","varying vec2 vUv;","","void main() {","    vUv = uv;","    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1);","}"].join("\n");shaders.globe.fragment=["uniform sampler2D texBase;    // background texture","uniform sampler2D texOverlay; // canvas overlay texture","","uniform sampler2D texShapes;  // shape texture. grayscale.","uniform sampler2D texColorLookup; // shape color -> color","uniform int lookupShapes;","","uniform float transparency;","varying vec2 vUv;             // texture coordinats","","int colorToShapeId(vec3 rgb) {","    // first put rgb into [0, 255] scale","    float r = clamp(rgb.r * 256., 0., 255.);","    float g = clamp(rgb.g * 256., 0., 255.);","    float b = clamp(rgb.b * 256., 0., 255.);","","    float divisor = 25.5;","    int dr = int(r/divisor + 0.5);","    int dg = int(g/divisor + 0.5);","    int db = int(b/divisor + 0.5);","    return dr*10*10 + dg*10 + db;","}","","vec4 lookupColor(vec2 uv) {","    vec4 shapeColor = texture2D(texShapes, vec2(","        clamp(uv.x, 0., 1.), clamp(uv.y, 0., 1.)));","    int id = 3*colorToShapeId(shapeColor.rgb) + 1;","    return texture2D(texColorLookup, vec2(float(id)/3072., 0.));","}","","void main() {","    vec4 colorShape = vec4(0.);","    if(lookupShapes==1) {","        float du = 1./4000.;","        float dv = 1./2000.;","        float maxDistance = sqrt(8.);","        for(int dx=-2; dx<=2; dx++) {","            for(int dy=-2; dy<=2; dy++) {","                vec2 dist = vec2(float(dx)*du, float(dy)*dv);","                vec4 nextColor = lookupColor(vec2(","                    vUv.x+dist.x,","                    vUv.y+dist.y","                ));","                colorShape = mix(nextColor, colorShape,","                    smoothstep(0., maxDistance, length(vec2(dx, dy))));","            }","        }","    }","","    vec4 colorBase = texture2D(texBase, vUv);","    vec4 colorOverlay = texture2D(texOverlay, vUv);","","    gl_FragColor = mix(gl_FragColor, colorBase, 1.0);","    gl_FragColor = mix(gl_FragColor, colorShape, colorShape.a);","    gl_FragColor = mix(gl_FragColor, colorOverlay, colorOverlay.a);","    gl_FragColor.a = max(colorShape.a, max(colorOverlay.a, transparency));","}",].join("\n");shaders.bars={};shaders.bars.vertex=["void main() {","    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1);","}"].join("\n");shaders.bars.fragment=["uniform vec3 color;","","void main() {","    gl_FragColor = vec4(color, 1.0);","}"].join("\n");shaders.atmosphere={};shaders.atmosphere.vertex=["varying vec3 vNormal;","void main() {","   vNormal = normalize(normalMatrix * normal);","   gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1);","}"].join("\n");shaders.atmosphere.fragment=["uniform int atmosphereFlag;","uniform vec3 atmosphereColor;","varying vec3 vNormal;","void main() {","   if(atmosphereFlag==0) {","       gl_FragColor = vec4(0);","       return;","   }","   float halo = 0.2-vNormal.z;","   halo *= halo;","   gl_FragColor = vec4(atmosphereColor,halo);","}"].join("\n");return globe;};